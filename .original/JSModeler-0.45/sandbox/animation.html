<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>

	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<script type="text/javascript" src="../build/lib/three.min.js"></script>
<!-- JSModeler includes start -->
	<script type="text/javascript" src="../src/core/jsm.js"></script>
	<script type="text/javascript" src="../src/core/timer.js"></script>
	<script type="text/javascript" src="../src/core/algorithm.js"></script>
	<script type="text/javascript" src="../src/core/async.js"></script>
	<script type="text/javascript" src="../src/core/check.js"></script>
	<script type="text/javascript" src="../src/core/jsonloader.js"></script>
	<script type="text/javascript" src="../src/geometry/definitions.js"></script>
	<script type="text/javascript" src="../src/geometry/coord2d.js"></script>
	<script type="text/javascript" src="../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../src/geometry/line.js"></script>
	<script type="text/javascript" src="../src/geometry/box.js"></script>
	<script type="text/javascript" src="../src/geometry/sphere.js"></script>
	<script type="text/javascript" src="../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon2d.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../src/geometry/cutpolygon.js"></script>
	<script type="text/javascript" src="../src/geometry/triangulation.js"></script>
	<script type="text/javascript" src="../src/geometry/octree.js"></script>
	<script type="text/javascript" src="../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../src/geometry/curves.js"></script>
	<script type="text/javascript" src="../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../src/geometry/ray.js"></script>
	<script type="text/javascript" src="../src/geometry/path.js"></script>
	<script type="text/javascript" src="../src/modeler/color.js"></script>
	<script type="text/javascript" src="../src/modeler/material.js"></script>
	<script type="text/javascript" src="../src/modeler/materialset.js"></script>
	<script type="text/javascript" src="../src/modeler/body.js"></script>
	<script type="text/javascript" src="../src/modeler/model.js"></script>
	<script type="text/javascript" src="../src/modeler/adjacencyinfo.js"></script>
	<script type="text/javascript" src="../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../src/modeler/explode.js"></script>
	<script type="text/javascript" src="../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../src/modeler/trianglebody.js"></script>
	<script type="text/javascript" src="../src/modeler/trianglemodel.js"></script>
	<script type="text/javascript" src="../src/modeler/converter.js"></script>
	<script type="text/javascript" src="../src/modeler/rayutils.js"></script>
	<script type="text/javascript" src="../src/import/binaryreader.js"></script>
	<script type="text/javascript" src="../src/import/importerutils.js"></script>
	<script type="text/javascript" src="../src/import/importer3ds.js"></script>
	<script type="text/javascript" src="../src/import/importerobj.js"></script>
	<script type="text/javascript" src="../src/import/importerstl.js"></script>
	<script type="text/javascript" src="../src/import/importeroff.js"></script>
	<script type="text/javascript" src="../src/import/importercommon.js"></script>
	<script type="text/javascript" src="../src/renderer/webglutils.js"></script>
	<script type="text/javascript" src="../src/renderer/renderlight.js"></script>
	<script type="text/javascript" src="../src/renderer/rendermaterial.js"></script>
	<script type="text/javascript" src="../src/renderer/rendermesh.js"></script>
	<script type="text/javascript" src="../src/renderer/renderbody.js"></script>
	<script type="text/javascript" src="../src/renderer/shaderprogram.js"></script>
	<script type="text/javascript" src="../src/renderer/renderer.js"></script>
	<script type="text/javascript" src="../src/renderer/pointcloudrenderer.js"></script>
	<script type="text/javascript" src="../src/renderer/renderconverter.js"></script>
	<script type="text/javascript" src="../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../src/viewer/painter.js"></script>
	<script type="text/javascript" src="../src/viewer/drawing.js"></script>
	<script type="text/javascript" src="../src/viewer/navigation.js"></script>
	<script type="text/javascript" src="../src/viewer/softwareviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/spriteviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../src/viewer/pointcloudviewer.js"></script>
	<script type="text/javascript" src="../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../src/extras/csg.js"></script>
	<script type="text/javascript" src="../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../src/extensions/svgtomodel/svgtomodel.js"></script>
	<script type="text/javascript" src="../src/extensions/textgenerator/textgenerator.js"></script>
	<script type="text/javascript" src="../src/extensions/threeviewer/threeconverter.js"></script>
	<script type="text/javascript" src="../src/extensions/threeviewer/threeviewer.js"></script>
<!-- JSModeler includes end -->
	<title>Example</title>

	<script type="text/javascript">
		JSM.Animation = function (object, settings)
		{
			this.object = object;
			this.settings = {
				frameCount : 0,
				translation : null,
				rotation : null,
				onFrameCallback : null,
				onReadyCallback : null
			};
			this.animationData = null;
			JSM.CopyObjectProperties (settings, this.settings, true);
		};

		JSM.Animation.prototype.Do = function ()
		{
			this.animationData = {
				currentFrame : 0,
				originalTransformation : this.object.GetTransformation ().Clone ()
			};
			this.DoFrame ();
		};

		JSM.Animation.prototype.DoFrame = function ()
		{
			if (this.animationData.currentFrame < this.settings.frameCount) {
				var currentTransformation = this.animationData.originalTransformation.Clone ();
				var frameMultiplier = (this.animationData.currentFrame + 1) / this.settings.frameCount;

				if (this.settings.translation !== null) {
					var currentTranslation = this.settings.translation.vector.Clone ().MultiplyScalar (frameMultiplier);
					var translation = JSM.TranslationTransformation (currentTranslation);
					currentTransformation.Append (translation);
				}

				if (this.settings.rotation !== null) {
					var rotationOrigin = currentTransformation.Apply (this.settings.rotation.origo);
					var currentRotation = frameMultiplier * this.settings.rotation.angle;
					var rotation = JSM.RotationTransformation (this.settings.rotation.axis, currentRotation, rotationOrigin);
					currentTransformation.Append (rotation);
				}

				this.object.SetTransformation (currentTransformation);
				if (this.settings.onFrameCallback !== null) {
					this.settings.onFrameCallback ();
				}
				
				this.animationData.currentFrame++;
				requestAnimationFrame (this.DoFrame.bind (this));
			} else if (this.settings.onReadyCallback !== null) {
				this.settings.onReadyCallback ();
			}
		};
		
		function Load ()
		{
			var camera = new JSM.Camera (
				new JSM.Coord (2.0, 6.0, 3.0),
				new JSM.Coord (0.0, 0.0, 0.0),
				new JSM.Vector (0.0, 0.0, 1.0)
			);
			
			var viewer = new JSM.Viewer ();
			if (!viewer.Init (document.getElementById ('example'), camera)) {
				alert ('error');
			}

			var body = JSM.GenerateCuboid (1.0, 1.0, 1.0);
			var renderBody = JSM.ConvertBodyToRenderBody (body);
			viewer.AddBody (renderBody);
			
			var body2 = JSM.GenerateCuboid (1.0, 1.0, 1.0);
			var renderBody2 = JSM.ConvertBodyToRenderBody (body);
			renderBody2.SetTransformation (JSM.TranslationTransformation (new JSM.Coord (0.0, -1.0, 0.0)));
			
			viewer.AddBodies ([renderBody, renderBody2]);

			var animation = new JSM.Animation (renderBody, {
				frameCount : 100,
				translation : {
					vector : new JSM.Vector (-1.0, 0.0, 0.0)
				},
				rotation : {
					axis : new JSM.Vector (0.0, 0.0, 1.0),
					angle : 2.0 * Math.PI,
					origo : new JSM.Vector (0.0, 0.0, 0.0)
				},
				onFrameCallback : function () {
					viewer.Draw ();
				},
				onReadyCallback : function () {
					// alert ('ready');
				}
			});
			animation.Do ();
			
			viewer.Draw ();
		}
	
	    window.onload = function ()
		{
			Load ();
		}
	</script>

</head>

<body>
	<canvas id="example" width="800" height="500"></canvas>
	<div id="fps"></div>
</body>

</html>
