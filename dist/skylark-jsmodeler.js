/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
!function(e,o){var t=o.define,require=o.require,r="function"==typeof t&&t.amd,n=!r&&"undefined"!=typeof exports;if(!r&&!t){var i={};t=o.define=function(e,o,t){"function"==typeof t?(i[e]={factory:t,deps:o.map(function(o){return function(e,o){if("."!==e[0])return e;var t=o.split("/"),r=e.split("/");t.pop();for(var n=0;n<r.length;n++)"."!=r[n]&&(".."==r[n]?t.pop():t.push(r[n]));return t.join("/")}(o,e)}),resolved:!1,exports:null},require(e)):i[e]={factory:null,resolved:!0,exports:t}},require=o.require=function(e){if(!i.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=i[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(o,t)||null,module.resolved=!0}return module.exports}}if(!t)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jsmodeler/core/jsm",[],function(){var e=function(){this.mainVersion=0,this.subVersion=45};return e.RandomNumber=function(e,o){return Math.random()*(o-e)+e},e.RandomInt=function(e,o){return Math.floor(Math.random()*(o-e+1)+e)},e.RandomBoolean=function(){return 1===e.RandomInt(0,1)},e.SeededRandomInt=function(e,o,t){var r=(9301*t+49297)%233280/233280;return Math.floor(r*(o-e+1)+e)},e.ValueOrDefault=function(e,o){return void 0===e||null===e?o:e},e.PrevIndex=function(e,o){return e>0?e-1:o-1},e.NextIndex=function(e,o){return e<o-1?e+1:0},e.CopyObjectProperties=function(e,o,t){var r;if(void 0!==e&&null!==e&&void 0!==o&&null!==o)for(r in e)e.hasOwnProperty(r)&&(t||void 0===o[r]||null===o[r])&&(o[r]=e[r])},e.GetObjectProperty=function(e,o,t){if(void 0===e||null===e)return t;var r=e[o];return void 0===r||null===r?t:r},e.Message=function(e){console.log("JSModeler: "+e)},e}),e("skylark-jsmodeler/core/timer",["./jsm"],function(e){return e.Timer=function(){this.start=0,this.stop=0},e.Timer.prototype.Start=function(){var e=new Date;this.start=e.getTime()},e.Timer.prototype.Stop=function(){var e=new Date;this.end=e.getTime()},e.Timer.prototype.Result=function(){return this.end-this.start},e.FPSCounter=function(){this.start=null,this.frames=null,this.current=null},e.FPSCounter.prototype.Get=function(e){var o=new Date,t=o.getTime();null===this.start&&(this.start=t,this.frames=0,this.current=0),null!==e&&void 0!==e||(e=1e3),this.frames=this.frames+1;var r=t-this.start;return r>=e&&(this.current=this.frames/r*1e3,this.start=t,this.frames=0),parseInt(this.current,10)},e}),e("skylark-jsmodeler/core/algorithm",["./jsm"],function(e){return e.SwapArrayValues=function(e,o,t){var r=e[o];e[o]=e[t],e[t]=r},e.BubbleSort=function(o,t,r){if(o.length<2)return!1;var n=t;if(void 0===n||null===n)return!1;var i,d,a=r;for(void 0!==a&&null!==a||(a=function(t,r){e.SwapArrayValues(o,t,r)}),i=0;i<o.length-1;i++)for(d=0;d<o.length-i-1;d++)n(o[d],o[d+1])||a(d,d+1);return!0},e.ShiftArray=function(e,o){var t;for(t=0;t<o;t++)e.push(e.shift())},e}),e("skylark-jsmodeler/core/async",["./jsm"],function(e){return e.AsyncRunTask=function(e,o,t,r,n){var i;if(void 0!==o&&null!==o)!function(e,o,t){void 0!==t.onStart&&null!==t.onStart&&t.onStart(e,o)}(t,n,o),function o(n,i,d){var a=e();!function(e,o,t){void 0!==t.onProgress&&null!==t.onProgress&&t.onProgress(e,o)}(n,i,d);a&&n<t-1?setTimeout(function(){o(n+1,i,d)},r):setTimeout(function(){!function(e,o){void 0!==o.onFinish&&null!==o.onFinish&&o.onFinish(e)}(i,d)},r)}(0,n,o);else for(i=0;i<t&&e();i++);},e}),e("skylark-jsmodeler/core/check",["./jsm"],function(e){return e.IsWebGLEnabled=function(){if(!window.WebGLRenderingContext)return!1;try{var e=document.createElement("canvas");if(!e.getContext("experimental-webgl")&&!e.getContext("webgl"))return!1}catch(e){return!1}return!0},e.IsFileApiEnabled=function(){return!!(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.URL)},e}),e("skylark-jsmodeler/core/jsonloader",["./jsm"],function(e){return e.LoadJsonFile=function(e,o){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){if(4==t.readyState){var e=JSON.parse(t.responseText);o(e)}},t.send(null)},e}),e("skylark-jsmodeler/geometry/definitions",["../core/jsm"],function(e){return e.Eps=1e-8,e.Inf=9999999999,e.RadDeg=57.29577951308232,e.DegRad=.017453292519943,e.IsZero=function(o){return Math.abs(o)<e.Eps},e.IsPositive=function(o){return o>e.Eps},e.IsNegative=function(o){return o<-e.Eps},e.IsLower=function(o,t){return t-o>e.Eps},e.IsGreater=function(o,t){return o-t>e.Eps},e.IsEqual=function(o,t){return Math.abs(t-o)<e.Eps},e.IsEqualWithEps=function(e,o,t){return Math.abs(o-e)<t},e.IsLowerOrEqual=function(o,t){return e.IsLower(o,t)||e.IsEqual(o,t)},e.IsGreaterOrEqual=function(o,t){return e.IsGreater(o,t)||e.IsEqual(o,t)},e.Minimum=function(o,t){return e.IsLower(o,t)?o:t},e.Maximum=function(o,t){return e.IsGreater(o,t)?o:t},e.ArcSin=function(o){return e.IsGreaterOrEqual(o,1)?Math.PI/2:e.IsLowerOrEqual(o,-1)?-Math.PI/2:Math.asin(o)},e.ArcCos=function(o){return e.IsGreaterOrEqual(o,1)?0:e.IsLowerOrEqual(o,-1)?Math.PI:Math.acos(o)},e}),e("skylark-jsmodeler/geometry/coord2d",["../core/jsm"],function(e){return e.Coord2D=function(e,o){this.x=e,this.y=o},e.Coord2D.prototype.Set=function(e,o){this.x=e,this.y=o},e.Coord2D.prototype.IsEqual=function(o){return e.IsEqual(this.x,o.x)&&e.IsEqual(this.y,o.y)},e.Coord2D.prototype.IsEqualWithEps=function(o,t){return e.IsEqualWithEps(this.x,o.x,t)&&e.IsEqualWithEps(this.y,o.y,t)},e.Coord2D.prototype.DistanceTo=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))},e.Coord2D.prototype.AngleTo=function(o){var t=this.Clone().Normalize(),r=o.Clone().Normalize();if(t.IsEqual(r))return 0;var n=e.VectorDot2D(t,r);return e.ArcCos(n)},e.Coord2D.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.Coord2D.prototype.MultiplyScalar=function(e){return this.x*=e,this.y*=e,this},e.Coord2D.prototype.Normalize=function(){var o=this.Length();return e.IsPositive(o)&&this.MultiplyScalar(1/o),this},e.Coord2D.prototype.SetLength=function(o){var t=this.Length();return e.IsPositive(t)&&this.MultiplyScalar(o/t),this},e.Coord2D.prototype.Offset=function(e,o){var t=e.Clone().Normalize();return this.x+=t.x*o,this.y+=t.y*o,this},e.Coord2D.prototype.Rotate=function(e,o){var t=this.x-o.x,r=this.y-o.y,n=Math.cos(e),i=Math.sin(e);return this.x=t*n-r*i+o.x,this.y=t*i+r*n+o.y,this},e.Coord2D.prototype.ToString=function(){return"("+this.x+", "+this.y+")"},e.Coord2D.prototype.Clone=function(){return new e.Coord2D(this.x,this.y)},e.Vector2D=e.Coord2D,e.CoordFromArray2D=function(o){return new e.Coord2D(o[0],o[1])},e.CoordToArray2D=function(e){return[e.x,e.y]},e.CoordAdd2D=function(o,t){return new e.Coord2D(o.x+t.x,o.y+t.y)},e.CoordSub2D=function(o,t){return new e.Coord2D(o.x-t.x,o.y-t.y)},e.VectorDot2D=function(e,o){return e.x*o.x+e.y*o.y},e}),e("skylark-jsmodeler/geometry/coord",["../core/jsm"],function(e){return e.Coord=function(e,o,t){this.x=e,this.y=o,this.z=t},e.Coord.prototype.Set=function(e,o,t){this.x=e,this.y=o,this.z=t},e.Coord.prototype.IsEqual=function(o){return e.IsEqual(this.x,o.x)&&e.IsEqual(this.y,o.y)&&e.IsEqual(this.z,o.z)},e.Coord.prototype.IsEqualWithEps=function(o,t){return e.IsEqualWithEps(this.x,o.x,t)&&e.IsEqualWithEps(this.y,o.y,t)&&e.IsEqualWithEps(this.z,o.z,t)},e.Coord.prototype.DistanceTo=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)+(e.z-this.z)*(e.z-this.z))},e.Coord.prototype.AngleTo=function(o){var t=this.Clone().Normalize(),r=o.Clone().Normalize();if(t.IsEqual(r))return 0;var n=e.VectorDot(t,r);return e.ArcCos(n)},e.Coord.prototype.IsCollinearWith=function(o){var t=this.AngleTo(o);return e.IsEqual(t,0)||e.IsEqual(t,Math.PI)},e.Coord.prototype.IsPerpendicularWith=function(o){var t=this.AngleTo(o);return e.IsEqual(t,Math.PI/2)},e.Coord.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.Coord.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},e.Coord.prototype.Sub=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},e.Coord.prototype.MultiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Coord.prototype.Normalize=function(){var o=this.Length();return e.IsPositive(o)&&this.MultiplyScalar(1/o),this},e.Coord.prototype.SetLength=function(o){var t=this.Length();return e.IsPositive(t)&&this.MultiplyScalar(o/t),this},e.Coord.prototype.Offset=function(e,o){var t=e.Clone().Normalize();return this.x+=t.x*o,this.y+=t.y*o,this.z+=t.z*o,this},e.Coord.prototype.Rotate=function(e,o,t){var r=e.Clone().Normalize(),n=r.x,i=r.y,d=r.z,a=this.x-t.x,s=this.y-t.y,l=this.z-t.z,u=Math.sin(o),y=Math.cos(o);return this.x=-n*(-n*a-i*s-d*l)*(1-y)+a*y+(-d*s+i*l)*u,this.y=-i*(-n*a-i*s-d*l)*(1-y)+s*y+(d*a-n*l)*u,this.z=-d*(-n*a-i*s-d*l)*(1-y)+l*y+(-i*a+n*s)*u,this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.Coord.prototype.ToCoord2D=function(o){var t=new e.Coord(0,0,0),r=new e.Vector(0,0,1),n=e.VectorCross(o,r),i=o.AngleTo(r),d=this.Clone().Rotate(n,i,t);return new e.Coord2D(d.x,d.y)},e.Coord.prototype.ToString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},e.Coord.prototype.Clone=function(){return new e.Coord(this.x,this.y,this.z)},e.Vector=e.Coord,e.CoordFromArray=function(o){return new e.Coord(o[0],o[1],o[2])},e.CoordToArray=function(e){return[e.x,e.y,e.z]},e.CoordAdd=function(o,t){return new e.Coord(o.x+t.x,o.y+t.y,o.z+t.z)},e.CoordSub=function(o,t){return new e.Coord(o.x-t.x,o.y-t.y,o.z-t.z)},e.VectorDot=function(e,o){return e.x*o.x+e.y*o.y+e.z*o.z},e.VectorCross=function(o,t){var r=new e.Vector(0,0,0);return r.x=o.y*t.z-o.z*t.y,r.y=o.z*t.x-o.x*t.z,r.z=o.x*t.y-o.y*t.x,r},e}),e("skylark-jsmodeler/geometry/determinant",["../core/jsm"],function(e){return e.MatrixDeterminant2x2=function(e,o,t,r){return e*r-o*t},e.MatrixDeterminant3x3=function(o,t,r,n,i,d,a,s,l){var u=e.MatrixDeterminant2x2(i,d,s,l),y=e.MatrixDeterminant2x2(n,d,a,l),c=e.MatrixDeterminant2x2(n,i,a,s);return o*u-t*y+r*c},e.MatrixDeterminant4x4=function(o,t,r,n,i,d,a,s,l,u,y,c,h,f,g,x){var p=e.MatrixDeterminant3x3(d,a,s,u,y,c,f,g,x),T=e.MatrixDeterminant3x3(i,a,s,l,y,c,h,g,x),C=e.MatrixDeterminant3x3(i,d,s,l,u,c,h,f,x),v=e.MatrixDeterminant3x3(i,d,a,l,u,y,h,f,g);return p*o-T*t+C*r-v*n},e}),e("skylark-jsmodeler/geometry/coordutils",["../core/jsm"],function(e){return e.Orientation={Invalid:0,CounterClockwise:1,Clockwise:2},e.MidCoord2D=function(o,t){return new e.Coord2D((o.x+t.x)/2,(o.y+t.y)/2)},e.CoordOrientation2D=function(o,t,r){var n=o.x,i=o.y,d=t.x,a=t.y,s=r.x,l=r.y,u=n*a+i*s+d*l-a*s-i*d-n*l;return e.IsPositive(u)?e.Orientation.CounterClockwise:e.IsNegative(u)?e.Orientation.Clockwise:e.Orientation.Invalid},e.CoordSignedDistance2D=function(o,t,r){var n=e.CoordSub2D(t,o),i=o.DistanceTo(t),d=n.AngleTo(r);return e.IsPositive(d)&&(i=-i),i},e.PolarToCartesian=function(o,t){var r=new e.Coord2D(0,0);return r.x=o*Math.cos(t),r.y=o*Math.sin(t),r},e.GetArcLengthFromAngle=function(e,o){return o*e},e.GetAngleFromArcLength=function(o,t){return e.IsEqual(o,0)?0:t/o},e.MidCoord=function(o,t){return new e.Coord((o.x+t.x)/2,(o.y+t.y)/2,(o.z+t.z)/2)},e.CoordSignedDistance=function(o,t,r){var n=e.CoordSub(t,o),i=o.DistanceTo(t),d=n.AngleTo(r);return e.IsPositive(d)&&(i=-i),i},e.GetVectorsFullAngle=function(o,t,r){var n=o.AngleTo(t),i=new e.Coord(0,0,0);return e.CoordOrientation(o,i,t,r)==e.Orientation.Clockwise&&(n=2*Math.PI-n),n},e.CoordOrientation=function(o,t,r,n){var i=o.ToCoord2D(n),d=t.ToCoord2D(n),a=r.ToCoord2D(n),s=e.CoordOrientation2D(i,d,a),l=new e.Vector(0,0,1),u=n.AngleTo(l);return e.IsEqual(u,Math.PI)&&(s==e.Orientation.CounterClockwise?s=e.Orientation.Clockwise:s==e.Orientation.Clockwise&&(s=e.Orientation.CounterClockwise)),s},e.SphericalToCartesian=function(o,t,r){var n=new e.Coord(0,0,0);return n.x=o*Math.sin(t)*Math.cos(r),n.y=o*Math.sin(t)*Math.sin(r),n.z=o*Math.cos(t),n},e.CylindricalToCartesian=function(o,t,r){var n=new e.Coord(0,0,0);return n.x=o*Math.cos(r),n.y=o*Math.sin(r),n.z=t,n},e.GetArcLength=function(e,o,t){var r=e.AngleTo(o);return r*t},e.GetFullArcLength=function(o,t,r,n){var i=e.GetVectorsFullAngle(o,t,n);return i*r},e.CalculateCentroid=function(o){var t=o.length,r=new e.Coord(0,0,0);if(t>=1){var n;for(n=0;n<t;n++)r=e.CoordAdd(r,o[n]);r.MultiplyScalar(1/t)}return r},e.CalculateTriangleNormal=function(o,t,r){var n=e.CoordSub(t,o),i=e.CoordSub(r,o),d=new e.Vector(0,0,0);return d.x=n.y*i.z-n.z*i.y,d.y=n.z*i.x-n.x*i.z,d.z=n.x*i.y-n.y*i.x,d.Normalize(),d},e.CalculateNormal=function(o){var t,r,n,i,d=o.length,a=new e.Vector(0,0,0);if(d>=3)for(t=0;t<d;t++)r=(t+1)%d,n=o[t%d],i=o[r],a.x+=(n.y-i.y)*(n.z+i.z),a.y+=(n.z-i.z)*(n.x+i.x),a.z+=(n.x-i.x)*(n.y+i.y);return a.Normalize(),a},e.BarycentricInterpolation=function(o,t,r,n,i,d,a){function s(e,o,t){var r=(e+o+t)/2,n=r*(r-e)*(r-o)*(r-t);return n<0?0:Math.sqrt(n)}var l=o.DistanceTo(t),u=t.DistanceTo(r),y=r.DistanceTo(o),c=o.DistanceTo(a),h=t.DistanceTo(a),f=r.DistanceTo(a),g=s(l,u,y);if(e.IsZero(g))return n;var x=s(l,c,h),p=s(u,h,f),T=s(y,c,f),C=n.Clone().MultiplyScalar(p),v=i.Clone().MultiplyScalar(T),A=d.Clone().MultiplyScalar(x),m=e.CoordAdd(e.CoordAdd(C,v),A);return m.MultiplyScalar(1/g),m},e}),e("skylark-jsmodeler/geometry/matrix",["../core/jsm"],function(e){return e.MatrixIdentity=function(){var e=[];return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.MatrixClone=function(e){var o=[];return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o},e.MatrixTranspose=function(e){var o=[];return o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15],o},e.MatrixVectorMultiply=function(e,o){var t=o[0],r=o[1],n=o[2],i=o[3],d=e[0],a=e[1],s=e[2],l=e[3],u=e[4],y=e[5],c=e[6],h=e[7],f=e[8],g=e[9],x=e[10],p=e[11],T=e[12],C=e[13],v=e[14],A=e[15],m=[];return m[0]=t*d+r*u+n*f+i*T,m[1]=t*a+r*y+n*g+i*C,m[2]=t*s+r*c+n*x+i*v,m[3]=t*l+r*h+n*p+i*A,m},e.MatrixMultiply=function(e,o){var t=e[0],r=e[1],n=e[2],i=e[3],d=e[4],a=e[5],s=e[6],l=e[7],u=e[8],y=e[9],c=e[10],h=e[11],f=e[12],g=e[13],x=e[14],p=e[15],T=o[0],C=o[1],v=o[2],A=o[3],m=o[4],B=o[5],P=o[6],V=o[7],w=o[8],S=o[9],G=o[10],I=o[11],M=o[12],R=o[13],b=o[14],E=o[15],D=[];return D[0]=t*T+r*m+n*w+i*M,D[1]=t*C+r*B+n*S+i*R,D[2]=t*v+r*P+n*G+i*b,D[3]=t*A+r*V+n*I+i*E,D[4]=d*T+a*m+s*w+l*M,D[5]=d*C+a*B+s*S+l*R,D[6]=d*v+a*P+s*G+l*b,D[7]=d*A+a*V+s*I+l*E,D[8]=u*T+y*m+c*w+h*M,D[9]=u*C+y*B+c*S+h*R,D[10]=u*v+y*P+c*G+h*b,D[11]=u*A+y*V+c*I+h*E,D[12]=f*T+g*m+x*w+p*M,D[13]=f*C+g*B+x*S+p*R,D[14]=f*v+g*P+x*G+p*b,D[15]=f*A+g*V+x*I+p*E,D},e.MatrixDeterminant=function(e){var o=e[0],t=e[1],r=e[2],n=e[3],i=e[4],d=e[5],a=e[6],s=e[7],l=e[8],u=e[9],y=e[10],c=e[11],h=e[12],f=e[13],g=e[14],x=e[15],p=o*d-t*i,T=o*a-r*i,C=o*s-n*i,v=t*a-r*d,A=t*s-n*d,m=r*s-n*a,B=l*f-u*h,P=l*g-y*h,V=l*x-c*h,w=u*g-y*f,S=u*x-c*f,G=y*x-c*g,I=p*G-T*S+C*w+v*V-A*P+m*B;return I},e.MatrixInvert=function(o){var t=o[0],r=o[1],n=o[2],i=o[3],d=o[4],a=o[5],s=o[6],l=o[7],u=o[8],y=o[9],c=o[10],h=o[11],f=o[12],g=o[13],x=o[14],p=o[15],T=t*a-r*d,C=t*s-n*d,v=t*l-i*d,A=r*s-n*a,m=r*l-i*a,B=n*l-i*s,P=u*g-y*f,V=u*x-c*f,w=u*p-h*f,S=y*x-c*g,G=y*p-h*g,I=c*p-h*x,M=T*I-C*G+v*S+A*w-m*V+B*P;if(e.IsZero(M))return null;var R=[];return R[0]=(a*I-s*G+l*S)/M,R[1]=(n*G-r*I-i*S)/M,R[2]=(g*B-x*m+p*A)/M,R[3]=(c*m-y*B-h*A)/M,R[4]=(s*w-d*I-l*V)/M,R[5]=(t*I-n*w+i*V)/M,R[6]=(x*v-f*B-p*C)/M,R[7]=(u*B-c*v+h*C)/M,R[8]=(d*G-a*w+l*P)/M,R[9]=(r*w-t*G-i*P)/M,R[10]=(f*m-g*v+p*T)/M,R[11]=(y*v-u*m-h*T)/M,R[12]=(a*V-d*S-s*P)/M,R[13]=(t*S-r*V+n*P)/M,R[14]=(g*C-f*A-x*T)/M,R[15]=(u*A-y*C+c*T)/M,R},e.MatrixTranslation=function(e,o,t){var r=[];return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e,r[13]=o,r[14]=t,r[15]=1,r},e.MatrixRotation=function(e,o,t){var r=e.Clone().Normalize(),n=r.x,i=r.y,d=r.z,a=n*n,s=i*i,l=d*d,u=Math.sin(o),y=Math.cos(o),c=[];if(void 0===t||null===t)c[0]=a+(s+l)*y,c[1]=n*i*(1-y)+d*u,c[2]=n*d*(1-y)-i*u,c[3]=0,c[4]=n*i*(1-y)-d*u,c[5]=s+(a+l)*y,c[6]=i*d*(1-y)+n*u,c[7]=0,c[8]=n*d*(1-y)+i*u,c[9]=i*d*(1-y)-n*u,c[10]=l+(a+s)*y,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1;else{var h=t.x,f=t.y,g=t.z;c[0]=a+(s+l)*y,c[1]=n*i*(1-y)+d*u,c[2]=n*d*(1-y)-i*u,c[3]=0,c[4]=n*i*(1-y)-d*u,c[5]=s+(a+l)*y,c[6]=i*d*(1-y)+n*u,c[7]=0,c[8]=n*d*(1-y)+i*u,c[9]=i*d*(1-y)-n*u,c[10]=l+(a+s)*y,c[11]=0,c[12]=(h*(s+l)-n*(f*i+g*d))*(1-y)+(f*d-g*i)*u,c[13]=(f*(a+l)-i*(h*n+g*d))*(1-y)+(g*n-h*d)*u,c[14]=(g*(a+s)-d*(h*n+f*i))*(1-y)+(h*i-f*n)*u,c[15]=1}return c},e.MatrixRotationQuaternion=function(e){var o=e[0],t=e[1],r=e[2],n=e[3],i=o+o,d=t+t,a=r+r,s=o*i,l=o*d,u=o*a,y=t*d,c=t*a,h=r*a,f=n*i,g=n*d,x=n*a,p=[];return p[0]=1-(y+h),p[1]=l+x,p[2]=u-g,p[3]=0,p[4]=l-x,p[5]=1-(s+h),p[6]=c+f,p[7]=0,p[8]=u+g,p[9]=c-f,p[10]=1-(s+y),p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},e.MatrixRotationX=function(e){var o=Math.sin(e),t=Math.cos(e),r=[];return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},e.MatrixRotationY=function(e){var o=Math.sin(e),t=Math.cos(e),r=[];return r[0]=t,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=t,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},e.MatrixRotationZ=function(e){var o=Math.sin(e),t=Math.cos(e),r=[];return r[0]=t,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=t,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},e.ApplyTransformation=function(o,t){var r=[];r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=1;var n=e.MatrixVectorMultiply(o,r),i=new e.Coord(n[0],n[1],n[2]);return i},e.ApplyRotation=function(o,t){var r=[];r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=0;var n=e.MatrixVectorMultiply(o,r),i=new e.Coord(n[0],n[1],n[2]);return i},e}),e("skylark-jsmodeler/geometry/coordsystem",["../core/jsm"],function(e){return e.CoordSystem=function(e,o,t,r){this.origo=e,this.e1=o,this.e2=t,this.e3=r},e.CoordSystem.prototype.Set=function(e,o,t,r){this.origo=e,this.e1=o,this.e2=t,this.e3=r},e.CoordSystem.prototype.ToDirectionVectors=function(){return this.e1=e.CoordSub(this.e1,this.origo),this.e2=e.CoordSub(this.e2,this.origo),this.e3=e.CoordSub(this.e3,this.origo),this},e.CoordSystem.prototype.ToAbsoluteCoords=function(){return this.e1=e.CoordAdd(this.e1,this.origo),this.e2=e.CoordAdd(this.e2,this.origo),this.e3=e.CoordAdd(this.e3,this.origo),this},e.CoordSystem.prototype.Clone=function(){return new e.CoordSystem(this.origo.Clone(),this.e1.Clone(),this.e2.Clone(),this.e3.Clone())},e}),e("skylark-jsmodeler/geometry/sector",["../core/jsm"],function(e){return e.CoordSectorPosition2D={CoordInsideOfSector:0,CoordOnSectorEndCoord:1,CoordOutsideOfSector:2},e.SectorSectorPosition2D={SectorsDontIntersect:0,SectorsIntersectCoincident:1,SectorsIntersectEndPoint:2,SectorsIntersectOnePoint:3},e.CoordSectorPosition={CoordInsideOfSector:0,CoordOnSectorEndCoord:1,CoordOutsideOfSector:2},e.Sector2D=function(e,o){this.beg=e,this.end=o},e.Sector2D.prototype.Set=function(e,o){this.beg=e,this.end=o},e.Sector2D.prototype.GetLength=function(){return this.beg.DistanceTo(this.end)},e.Sector2D.prototype.CoordPosition=function(o){var t=o.x,r=o.y,n=this.beg.x,i=this.beg.y,d=this.end.x,a=this.end.y,s=this.GetLength();if(e.IsZero(s))return o.IsEqual(this.beg)?e.CoordSectorPosition2D.CoordOnSectorEndCoord:e.CoordSectorPosition2D.CoordOutsideOfSector;var l=((t-n)*(d-n)+(r-i)*(a-i))/(s*s);if(e.IsLower(l,0)||e.IsGreater(l,1))return e.CoordSectorPosition2D.CoordOutsideOfSector;var u=n+l*(d-n),y=i+l*(a-i);return e.IsEqual(u,t)&&e.IsEqual(y,r)?e.IsEqual(l,0)||e.IsEqual(l,1)?e.CoordSectorPosition2D.CoordOnSectorEndCoord:e.CoordSectorPosition2D.CoordInsideOfSector:e.CoordSectorPosition2D.CoordOutsideOfSector},e.Sector2D.prototype.SectorPosition=function(o,t){function r(o,t,r){return!(r.IsEqual(o)||r.IsEqual(t)||!e.IsLowerOrEqual(r.x,Math.max(o.x,t.x))||!e.IsLowerOrEqual(r.y,Math.max(o.y,t.y))||!e.IsGreaterOrEqual(r.x,Math.min(o.x,t.x))||!e.IsGreaterOrEqual(r.y,Math.min(o.y,t.y)))}var n=void 0!==t&&null!==t,i=this.beg,d=this.end,a=o.beg,s=o.end,l=i.IsEqual(a)||i.IsEqual(s),u=d.IsEqual(a)||d.IsEqual(s);if(l&&u)return e.SectorSectorPosition2D.SectorsIntersectCoincident;var y=i.x,c=i.y,h=d.x,f=d.y,g=a.x,x=a.y,p=s.x,T=s.y,C=(p-g)*(c-x)-(T-x)*(y-g),v=(h-y)*(c-x)-(f-c)*(y-g),A=(T-x)*(h-y)-(p-g)*(f-c);if(e.IsZero(A)){if(e.IsZero(C)&&e.IsZero(v)){if(r(i,d,a)||r(i,d,s)||r(a,s,i)||r(a,s,d))return e.SectorSectorPosition2D.SectorsIntersectCoincident;if(l)return n&&(t.x=i.x,t.y=i.y),e.SectorSectorPosition2D.SectorsIntersectEndPoint;if(u)return n&&(t.x=d.x,t.y=d.y),e.SectorSectorPosition2D.SectorsIntersectEndPoint}return e.SectorSectorPosition2D.SectorsDontIntersect}var m=C/A,B=v/A;return e.IsLower(m,0)||e.IsGreater(m,1)||e.IsLower(B,0)||e.IsGreater(B,1)?e.SectorSectorPosition2D.SectorsDontIntersect:l?(n&&(t.x=i.x,t.y=i.y),e.SectorSectorPosition2D.SectorsIntersectEndPoint):u?(n&&(t.x=d.x,t.y=d.y),e.SectorSectorPosition2D.SectorsIntersectEndPoint):(n&&(t.x=y+m*(h-y),t.y=c+m*(f-c)),e.SectorSectorPosition2D.SectorsIntersectOnePoint)},e.Sector2D.prototype.ProjectCoord=function(o){var t=o.x,r=o.y,n=this.beg,i=this.end,d=n.x,a=n.y,s=i.x,l=i.y,u=(s-d)*(s-d)+(l-a)*(l-a);if(e.IsZero(u))return n.Clone();var y=((s-d)*(t-d)+(l-a)*(r-a))/u;if(e.IsLower(y,0))return n.Clone();if(e.IsGreater(y,1))return i.Clone();var c=e.CoordSub2D(i,n).MultiplyScalar(y),h=e.CoordAdd2D(n,c);return h},e.Sector2D.prototype.Clone=function(){return new e.Sector2D(this.beg.Clone(),this.end.Clone())},e.Sector=function(e,o){this.beg=e,this.end=o},e.Sector.prototype.Set=function(e,o){this.beg=e,this.end=o},e.Sector.prototype.GetLength=function(){return this.beg.DistanceTo(this.end)},e.Sector.prototype.CoordPosition=function(o){var t=o.x,r=o.y,n=o.z,i=this.beg,d=e.CoordSub(this.end,this.beg),a=i.x,s=i.y,l=i.z,u=i.x+d.x,y=i.y+d.y,c=i.z+d.z,h=(u-a)*(u-a)+(y-s)*(y-s)+(c-l)*(c-l);if(e.IsZero(h))return i.IsEqual(o)?e.CoordSectorPosition.CoordOnSectorEndCoord:e.CoordSectorPosition.CoordOutsideOfSector;var f=((u-a)*(t-a)+(y-s)*(r-s)+(c-l)*(n-l))/h,g=d.Clone().MultiplyScalar(f),x=e.CoordAdd(i,g),p=o.DistanceTo(x);return e.IsZero(p)?e.IsLower(f,0)||e.IsGreater(f,1)?e.CoordSectorPosition.CoordOutsideOfSector:e.IsEqual(f,0)||e.IsEqual(f,1)?e.CoordSectorPosition.CoordOnSectorEndCoord:e.CoordSectorPosition.CoordInsideOfSector:e.CoordSectorPosition.CoordOutsideOfSector},e.Sector.prototype.Clone=function(){return new e.Sector(this.beg.Clone(),this.end.Clone())},e.GetSectorSegmentation2D=function(o,t){var r,n,i=e.CoordSub2D(o.end,o.beg),d=o.beg.DistanceTo(o.end),a=d/t,s=0,l=[];for(r=0;r<=t;r++)n=o.beg.Clone().Offset(i,s),l.push(n),s+=a;return l},e.GetSectorSegmentation=function(o,t){var r,n,i=e.CoordSub(o.end,o.beg),d=o.beg.DistanceTo(o.end),a=d/t,s=0,l=[];for(r=0;r<=t;r++)n=o.beg.Clone().Offset(i,s),l.push(n),s+=a;return l},e}),e("skylark-jsmodeler/geometry/line",["../core/jsm"],function(e){return e.CoordLinePosition2D={CoordOnLine:0,CoordAtLineLeft:1,CoordAtLineRight:2},e.LineLinePosition2D={LinesDontIntersect:0,LinesIntersectsOnePoint:1,LinesIntersectsCoincident:2},e.CoordLinePosition={CoordOnLine:0,CoordOutsideOfLine:1},e.LineLinePosition={LinesDontIntersect:0,LinesIntersectsOnePoint:1,LinesIntersectsCoincident:2},e.Line2D=function(e,o){this.start=e,this.direction=o},e.Line2D.prototype.Set=function(e,o){this.start=e,this.direction=o},e.Line2D.prototype.CoordPosition=function(o){var t=this.CoordSignedDistance(o);return e.IsPositive(t)?e.CoordLinePosition2D.CoordAtLineLeft:e.IsNegative(t)?e.CoordLinePosition2D.CoordAtLineRight:e.CoordLinePosition2D.CoordOnLine},e.Line2D.prototype.CoordSignedDistance=function(e){var o=e.x,t=e.y,r=this.start,n=this.direction;return n.x*(t-r.y)-n.y*(o-r.x)},e.Line2D.prototype.LinePosition=function(o,t){var r=this.start.x,n=this.start.y,i=this.start.x+this.direction.x,d=this.start.y+this.direction.y,a=o.start.x,s=o.start.y,l=o.start.x+o.direction.x,u=o.start.y+o.direction.y,y=(l-a)*(n-s)-(u-s)*(r-a),c=(i-r)*(n-s)-(d-n)*(r-a),h=(u-s)*(i-r)-(l-a)*(d-n);if(e.IsZero(h))return e.IsZero(y)&&e.IsZero(c)?e.LineLinePosition2D.LinesIntersectsCoincident:e.LineLinePosition2D.LinesDontIntersect;var f=y/h;return null!==t&&(t.x=r+f*(i-r),t.y=n+f*(d-n)),e.LineLinePosition2D.LinesIntersectsOnePoint},e.Line2D.prototype.Clone=function(){return new e.Line2D(this.start.Clone(),this.direction.Clone())},e.Line=function(e,o){this.start=e,this.direction=o},e.Line.prototype.Set=function(e,o){this.start=e,this.direction=o},e.Line.prototype.CoordPosition=function(o,t){var r=o.x,n=o.y,i=o.z,d=this.start,a=this.direction,s=d.x,l=d.y,u=d.z,y=d.x+a.x,c=d.y+a.y,h=d.z+a.z,f=(y-s)*(y-s)+(c-l)*(c-l)+(h-u)*(h-u);if(e.IsZero(f))return void 0!==t&&t.Set(d.x,d.y,d.z),d.IsEqual(o)?e.CoordLinePosition.CoordOnLine:e.CoordLinePosition.CoordOutsideOfLine;var g=((y-s)*(r-s)+(c-l)*(n-l)+(h-u)*(i-u))/f,x=a.Clone().MultiplyScalar(g),p=e.CoordAdd(d,x);void 0!==t&&t.Set(p.x,p.y,p.z);var T=o.DistanceTo(p);return e.IsZero(T)?e.CoordLinePosition.CoordOnLine:e.CoordLinePosition.CoordOutsideOfLine},e.Line.prototype.ProjectCoord=function(o){var t=o.x,r=o.y,n=o.z,i=this.start,d=this.direction,a=i.x,s=i.y,l=i.z,u=i.x+d.x,y=i.y+d.y,c=i.z+d.z,h=(u-a)*(u-a)+(y-s)*(y-s)+(c-l)*(c-l);if(e.IsZero(h))return i.Clone();var f=((u-a)*(t-a)+(y-s)*(r-s)+(c-l)*(n-l))/h,g=d.Clone().MultiplyScalar(f);return e.CoordAdd(i,g)},e.Line.prototype.ClosestPoint=function(o,t,r){function n(e,o,t,r,n){var i=(e[o].x-e[t].x)*(e[r].x-e[n].x)+(e[o].y-e[t].y)*(e[r].y-e[n].y)+(e[o].z-e[t].z)*(e[r].z-e[n].z);return i}var i=this.direction.Clone().Normalize(),d=this.start,a=e.CoordAdd(d,i),s=o.direction.Clone().Normalize(),l=o.start,u=e.CoordAdd(l,s),y=[d,a,l,u],c=n(y,1,0,1,0),h=n(y,0,2,1,0),f=n(y,0,2,3,2),g=n(y,3,2,1,0),x=n(y,3,2,3,2),p=c*x-g*g;if(e.IsEqual(p,0))return!1;var T=f*g-h*x,C=T/p,v=(f+C*g)/x;if(void 0!==t){i.MultiplyScalar(C);var A=e.CoordAdd(d,i);t.Set(A.x,A.y,A.z)}if(void 0!==r){s.MultiplyScalar(v);var m=e.CoordAdd(l,s);r.Set(m.x,m.y,m.z)}return!0},e.Line.prototype.LinePosition=function(o,t){var r=new e.Coord(0,0,0),n=new e.Coord(0,0,0);return this.ClosestPoint(o,r,n)?r.IsEqual(n)?(void 0!==t&&t.Set(r.x,r.y,r.z),e.LineLinePosition.LinesIntersectsOnePoint):e.LineLinePosition.LinesDontIntersect:e.LineLinePosition.LinesIntersectsCoincident},e.Line.prototype.Clone=function(){return new e.Line(this.start.Clone(),this.direction.Clone())},e}),e("skylark-jsmodeler/geometry/box",["../core/jsm"],function(e){return e.Box2D=function(e,o){this.min=e,this.max=o},e.Box2D.prototype.Set=function(e,o){this.min=e,this.max=o},e.Box2D.prototype.GetCenter=function(){return e.MidCoord2D(this.min,this.max)},e.Box2D.prototype.Clone=function(){return new e.Box2D(this.min.Clone(),this.max.Clone())},e.Box=function(e,o){this.min=e,this.max=o},e.Box.prototype.Set=function(e,o){this.min=e,this.max=o},e.Box.prototype.GetCenter=function(){return e.MidCoord(this.min,this.max)},e.Box.prototype.GetSize=function(){return e.CoordSub(this.max,this.min)},e.Box.prototype.IsCoordInside=function(o){return!(e.IsLower(o.x,this.min.x)||e.IsLower(o.y,this.min.y)||e.IsLower(o.z,this.min.z))&&!(e.IsGreater(o.x,this.max.x)||e.IsGreater(o.y,this.max.y)||e.IsGreater(o.z,this.max.z))},e.Box.prototype.Clone=function(){return new e.Box(this.min.Clone(),this.max.Clone())},e.BoxUnion=function(o,t){var r=new e.Coord(e.Minimum(o.min.x,t.min.x),e.Minimum(o.min.y,t.min.y),e.Minimum(o.min.z,t.min.z)),n=new e.Coord(e.Maximum(o.max.x,t.max.x),e.Maximum(o.max.y,t.max.y),e.Maximum(o.max.z,t.max.z));return new e.Box(r,n)},e}),e("skylark-jsmodeler/geometry/sphere",["../core/jsm"],function(e){return e.Sphere=function(e,o){this.center=e,this.radius=o},e.Sphere.prototype.Set=function(e,o){this.center=e,this.radius=o},e.Sphere.prototype.GetCenter=function(){return this.center},e.Sphere.prototype.GetRadius=function(){return this.radius},e.Sphere.prototype.Clone=function(){return new e.Sphere(this.center.Clone(),this.radius)},e}),e("skylark-jsmodeler/geometry/transformation",["../core/jsm"],function(e){return e.Transformation=function(){this.matrix=e.MatrixIdentity()},e.Transformation.prototype.GetMatrix=function(){return this.matrix},e.Transformation.prototype.SetMatrix=function(e){this.matrix=e},e.Transformation.prototype.Append=function(o){this.matrix=e.MatrixMultiply(this.matrix,o.matrix)},e.Transformation.prototype.Apply=function(o){return e.ApplyTransformation(this.matrix,o)},e.Transformation.prototype.Clone=function(){var o=new e.Transformation;return o.matrix=e.MatrixClone(this.matrix),o},e.IdentityTransformation=function(){var o=new e.Transformation;return o.matrix=e.MatrixIdentity(),o},e.TranslationTransformation=function(o){var t=new e.Transformation;return t.matrix=e.MatrixTranslation(o.x,o.y,o.z),t},e.OffsetTransformation=function(o,t){var r=o.Clone().Normalize(),n=r.Clone().MultiplyScalar(t);return e.TranslationTransformation(n)},e.RotationTransformation=function(o,t,r){var n=new e.Transformation;return n.matrix=e.MatrixRotation(o,t,r),n},e.RotationXTransformation=function(o,t){var r=new e.Transformation;return void 0===t||null===t?r.matrix=e.MatrixRotationX(o):(r.Append(e.TranslationTransformation(new e.Vector(-t.x,-t.y,-t.z))),r.Append(e.RotationXTransformation(o)),r.Append(e.TranslationTransformation(new e.Vector(t.x,t.y,t.z)))),r},e.RotationYTransformation=function(o,t){var r=new e.Transformation;return void 0===t||null===t?r.matrix=e.MatrixRotationY(o):(r.Append(e.TranslationTransformation(new e.Vector(-t.x,-t.y,-t.z))),r.Append(e.RotationYTransformation(o)),r.Append(e.TranslationTransformation(new e.Vector(t.x,t.y,t.z)))),r},e.RotationZTransformation=function(o,t){var r=new e.Transformation;return void 0===t||null===t?r.matrix=e.MatrixRotationZ(o):(r.Append(e.TranslationTransformation(new e.Vector(-t.x,-t.y,-t.z))),r.Append(e.RotationZTransformation(o)),r.Append(e.TranslationTransformation(new e.Vector(t.x,t.y,t.z)))),r},e.RotationXYZTransformation=function(o,t,r,n){var i=new e.Transformation;return i.Append(e.RotationXTransformation(o,n)),i.Append(e.RotationYTransformation(t,n)),i.Append(e.RotationZTransformation(r,n)),i},e}),e("skylark-jsmodeler/geometry/plane",["../core/jsm"],function(e){return e.CoordPlanePosition={CoordOnPlane:0,CoordInFrontOfPlane:1,CoordAtBackOfPlane:2},e.LinePlanePosition={LineParallelToPlane:0,LineIntersectsPlane:1},e.Plane=function(e,o,t,r){this.a=e,this.b=o,this.c=t,this.d=r},e.Plane.prototype.Set=function(e,o,t,r){this.a=e,this.b=o,this.c=t,this.d=r},e.Plane.prototype.GetNormal=function(){return new e.Vector(this.a,this.b,this.c)},e.Plane.prototype.CoordSignedDistance=function(e){var o=e.x,t=e.y,r=e.z,n=this.a,i=this.b,d=this.c,a=this.d,s=(n*o+i*t+d*r+a)/Math.sqrt(n*n+i*i+d*d);return s},e.Plane.prototype.CoordDistance=function(e){var o=this.CoordSignedDistance(e);return Math.abs(o)},e.Plane.prototype.ProjectCoord=function(o){var t=o.x,r=o.y,n=o.z,i=this.a,d=this.b,a=this.c,s=this.d,l=this.CoordDistance(o),u=i*t+d*r+a*n+s;e.IsGreater(u,0)&&(l=-l);var y=this.GetNormal().Normalize(),c=o.Clone().Offset(y,l);return c},e.Plane.prototype.CoordPosition=function(o){var t=this.a,r=this.b,n=this.c,i=this.d,d=o.x,a=o.y,s=o.z,l=t*d+r*a+n*s+i;return e.IsPositive(l)?e.CoordPlanePosition.CoordInFrontOfPlane:e.IsNegative(l)?e.CoordPlanePosition.CoordAtBackOfPlane:e.CoordPlanePosition.CoordOnPlane},e.Plane.prototype.LinePosition=function(o,t){var r=o.direction.Clone().Normalize(),n=o.start.x,i=o.start.y,d=o.start.z,a=o.start.x+r.x,s=o.start.y+r.y,l=o.start.z+r.z,u=this.a,y=this.b,c=this.c,h=this.d,f=u*(n-a)+y*(i-s)+c*(d-l);if(e.IsZero(f))return e.LinePlanePosition.LineParallelToPlane;var g=(u*n+y*i+c*d+h)/f;if(void 0!==t){r.MultiplyScalar(g);var x=e.CoordAdd(o.start,r);t.Set(x.x,x.y,x.z)}return e.LinePlanePosition.LineIntersectsPlane},e.Plane.prototype.LineIntersection=function(o){var t=o.direction.Clone().Normalize(),r=o.start.x,n=o.start.y,i=o.start.z,d=o.start.x+t.x,a=o.start.y+t.y,s=o.start.z+t.z,l=this.a,u=this.b,y=this.c,c=this.d,h=l*(r-d)+u*(n-a)+y*(i-s);if(e.IsZero(h))return null;var f=(l*r+u*n+y*i+c)/h;return t.MultiplyScalar(f),e.CoordAdd(o.start,t)},e.Plane.prototype.Clone=function(){return new e.Plane(this.a,this.b,this.c,this.d)},e.GetPlaneFromCoordAndDirection=function(o,t){var r=new e.Plane,n=t.Clone().Normalize(),i=n.x,d=n.y,a=n.z,s=-(i*o.x+d*o.y+a*o.z);return r.Set(i,d,a,s),r},e.GetPlaneFromThreeCoords=function(o,t,r){var n=new e.Plane,i=(t.y-o.y)*(r.z-o.z)-(r.y-o.y)*(t.z-o.z),d=(t.z-o.z)*(r.x-o.x)-(r.z-o.z)*(t.x-o.x),a=(t.x-o.x)*(r.y-o.y)-(r.x-o.x)*(t.y-o.y),s=-(i*o.x+d*o.y+a*o.z);return n.Set(i,d,a,s),n},e.CoordPlaneSignedDirectionalDistance=function(o,t,r){var n=t.Clone().Normalize(),i=o.x,d=o.y,a=o.z,s=o.x+n.x,l=o.y+n.y,u=o.z+n.z,y=r.a,c=r.b,h=r.c,f=r.d,g=y*(i-s)+c*(d-l)+h*(a-u);if(e.IsZero(g))return 0;var x=(y*i+c*d+h*a+f)/g;n.MultiplyScalar(x);var p=e.CoordAdd(o,n),T=o.DistanceTo(p),C=y*i+c*d+h*a+f;return e.IsNegative(C)&&(T=-T),T},e.CoordPlaneDirectionalDistance=function(o,t,r){return Math.abs(e.CoordPlaneSignedDirectionalDistance(o,t,r))},e}),e("skylark-jsmodeler/geometry/projection",["../core/jsm"],function(e){return e.MatrixView=function(o,t,r){if(o.IsEqual(t))return e.MatrixIdentity();var n=[],i=e.CoordSub(o,t).Normalize(),d=e.VectorCross(r,i).Normalize(),a=e.VectorCross(i,d).Normalize();return n[0]=d.x,n[1]=a.x,n[2]=i.x,n[3]=0,n[4]=d.y,n[5]=a.y,n[6]=i.y,n[7]=0,n[8]=d.z,n[9]=a.z,n[10]=i.z,n[11]=0,n[12]=-e.VectorDot(d,o),n[13]=-e.VectorDot(a,o),n[14]=-e.VectorDot(i,o),n[15]=1,n},e.MatrixPerspective=function(e,o,t,r){var n=[],i=1/Math.tan(e/2),d=1/(t-r);return n[0]=i/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(r+t)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*r*t*d,n[15]=0,n},e.Project=function(o,t,r,n,i,d,a,s,l){var u=[o.x,o.y,o.z,1],y=e.MatrixView(t,r,n),c=e.MatrixPerspective(i,d,a,s),h=e.MatrixMultiply(y,c),f=e.MatrixVectorMultiply(h,u),g=f[3];if(e.IsZero(g))return null;var x=new e.Coord(0,0,0);return x.x=(f[0]/g*.5+.5)*l[2]+l[0],x.y=(f[1]/g*.5+.5)*l[3]+l[1],x.z=f[2]/g*.5+.5,x},e.Unproject=function(o,t,r,n,i,d,a,s,l){var u=[(o.x-l[0])/l[2]*2-1,(o.y-l[1])/l[3]*2-1,2*o.z-1,1],y=e.MatrixView(t,r,n),c=e.MatrixPerspective(i,d,a,s),h=e.MatrixMultiply(y,c),f=e.MatrixInvert(h),g=e.MatrixVectorMultiply(f,u),x=g[3];if(e.IsZero(x))return null;var p=new e.Coord(0,0,0);return p.x=g[0]/g[3],p.y=g[1]/g[3],p.z=g[2]/g[3],p},e}),e("skylark-jsmodeler/geometry/convexhull",["../core/jsm"],function(e){return e.ConvexHull2D=function(o){function t(o,t){var r,n=o.length,i=0;for(r=1;r<n;r++)t==i?i=r:e.CoordOrientation2D(o[t],o[i],o[r])==e.Orientation.Clockwise&&(i=r);return i}var r=[],n=o.length;if(n<3)return r;var i,d=function(o){var t,r,n=o.length,i=e.Inf,d=-1;for(t=0;t<n;t++)r=o[t].x,e.IsLower(r,i)&&(i=r,d=t);return d}(o),a=d;do{r.push(a),i=t(o,a),a=i}while(i!=d);return r},e.ConvexHull3D=function(o){function t(e,o){var t=new function(){this.position=null};return t.position=o,e.vertices.push(t),e.vertices.length-1}function r(e,o,t,r){var n,i,d=-1;for(n=0;n<e.edges.length;n++)if((i=e.edges[n]).vert1==t&&i.vert2==r||i.vert1==r&&i.vert2==t){d=n;break}if(-1==d){var a=new function(){this.vert1=null,this.vert2=null,this.tri1=null,this.tri2=null};a.vert1=t,a.vert2=r,a.tri1=-1,a.tri2=-1,e.edges.push(a),d=e.edges.length-1}var s=e.edges[d];return s.tri1!=o&&s.tri2!=o&&(-1==s.tri1?s.tri1=o:-1==s.tri2&&(s.tri2=o)),d}function n(e,o,t,n){var i=e.triangles.length,d=r(e,i,o,t),a=r(e,i,t,n),s=r(e,i,n,o),l=new function(){this.vertices=null,this.edges=null,this.valid=null};return l.vertices=[o,t,n],l.edges=[d,a,s],l.valid=!0,e.triangles.push(l),e.triangles.length-1}function i(e,o,t){var r=e.edges[t];r.tri1==o?r.tri1=-1:r.tri2==o&&(r.tri2=-1)}function d(e,o){var t=e.triangles[o];t.valid&&(i(e,o,t.edges[0]),i(e,o,t.edges[1]),i(e,o,t.edges[2]),t.valid=!1)}function a(o,t,r,n,i){return!e.IsLower(function(o,t,r,n,i){var d=o.vertices[t].position,a=o.vertices[r].position,s=o.vertices[n].position,l=o.vertices[i].position,u=e.CoordSub(d,l),y=e.CoordSub(a,l),c=e.CoordSub(s,l);return e.VectorDot(u,e.VectorCross(y,c))/6}(o,t,r,n,i),0)}function s(e,o){var t,r,i,s,l,u,y,c,h=[];for(t=0;t<e.triangles.length;t++)(r=e.triangles[t]).valid&&a(e,r.vertices[0],r.vertices[2],r.vertices[1],o)?h.push(!0):h.push(!1);var f,g=[];for(t=0;t<h.length;t++)h[t]&&(r=e.triangles[t]).valid&&(i=e.edges[r.edges[0]],s=e.edges[r.edges[1]],l=e.edges[r.edges[2]],u=-1==i.tri1||-1==i.tri2||h[i.tri1]!=h[i.tri2],y=-1==s.tri1||-1==s.tri2||h[s.tri1]!=h[s.tri2],c=-1==l.tri1||-1==l.tri2||h[l.tri1]!=h[l.tri2],u&&g.push([r.vertices[0],r.vertices[1],o]),y&&g.push([r.vertices[1],r.vertices[2],o]),c&&g.push([r.vertices[2],r.vertices[0],o]));for(t=0;t<h.length;t++)h[t]&&(r=e.triangles[t]).valid&&d(e,t);for(t=0;t<g.length;t++)f=g[t],n(e,f[0],f[1],f[2])}var l=[],u=o.length;if(u<4)return l;var y,c,h=new function(){this.vertices=[],this.edges=[],this.triangles=[]};for(y=0;y<u;y++)t(h,o[y]);for(function(e){var o=-1;o=a(e,0,1,2,3)?n(e,0,1,2):n(e,0,2,1);var t=e.triangles[o];n(e,t.vertices[0],t.vertices[2],3),n(e,t.vertices[2],t.vertices[1],3),n(e,t.vertices[1],t.vertices[0],3)}(h),y=4;y<u;y++)s(h,y);for(y=0;y<h.triangles.length;y++)(c=h.triangles[y]).valid&&l.push(c.vertices);return l},e}),e("skylark-jsmodeler/geometry/polygon2d",["../core/jsm"],function(e){return e.Complexity={Invalid:0,Convex:1,Concave:2,Complex:3},e.CoordPolygonPosition2D={OnVertex:0,OnEdge:1,Inside:2,Outside:3},e.SectorPolygonPosition2D={IntersectionOnePoint:0,IntersectionCoincident:1,IntersectionOnVertex:2,NoIntersection:3},e.Polygon2D=function(){this.vertices=null,this.cache=null,this.Clear()},e.Polygon2D.prototype.AddVertex=function(o,t){this.AddVertexCoord(new e.Coord2D(o,t))},e.Polygon2D.prototype.AddVertexCoord=function(e){this.vertices.push(e),this.ClearCache()},e.Polygon2D.prototype.GetVertex=function(e){return this.vertices[e]},e.Polygon2D.prototype.RemoveVertex=function(e){this.vertices.splice(e,1)},e.Polygon2D.prototype.VertexCount=function(){return this.vertices.length},e.Polygon2D.prototype.EnumerateVertices=function(e,o,t){var r=this.vertices.length,n=e;for(t(n);n!=o;)t(n=(n+1)%r)},e.Polygon2D.prototype.GetNextVertex=function(o){return e.NextIndex(o,this.vertices.length)},e.Polygon2D.prototype.GetPrevVertex=function(o){return e.PrevIndex(o,this.vertices.length)},e.Polygon2D.prototype.ShiftVertices=function(o){e.ShiftArray(this.vertices,o),this.ClearCache()},e.Polygon2D.prototype.ReverseVertices=function(){this.vertices.reverse(),this.ClearCache()},e.Polygon2D.prototype.GetVertexAngle=function(o){var t=this.vertices[this.GetPrevVertex(o)],r=this.vertices[o],n=this.vertices[this.GetNextVertex(o)],i=e.CoordSub2D(t,r),d=e.CoordSub2D(n,r);return i.AngleTo(d)},e.Polygon2D.prototype.GetSignedArea=function(){if(null!==this.cache.signedArea)return this.cache.signedArea;var e=this.vertices.length,o=0;if(e>=3){var t,r,n;for(t=0;t<e;t++)r=this.vertices[t],n=this.vertices[(t+1)%e],o+=r.x*n.y-n.x*r.y;o*=.5}return this.cache.signedArea=o,o},e.Polygon2D.prototype.GetArea=function(){var e=this.GetSignedArea();return Math.abs(e)},e.Polygon2D.prototype.GetOrientation=function(){if(null!==this.cache.orientation)return this.cache.orientation;var o=e.Orientation.Invalid;if(this.vertices.length>=3){var t=this.GetSignedArea();e.IsPositive(t)?o=e.Orientation.CounterClockwise:e.IsNegative(t)&&(o=e.Orientation.Clockwise)}return this.cache.orientation=o,o},e.Polygon2D.prototype.GetComplexity=function(){if(null!==this.cache.complexity)return this.cache.complexity;var o=this.vertices.length;if(o<3)return e.Complexity.Invalid;var t,r=e.Complexity.Invalid,n=this.GetOrientation();if(n!=e.Orientation.Invalid)for(r=e.Complexity.Convex,t=0;t<o;t++)if(this.IsConcaveVertex(t)){r=e.Complexity.Concave;break}return this.cache.complexity=r,r},e.Polygon2D.prototype.GetVertexOrientation=function(o){if(void 0!==this.cache.vertexOrientations[o])return this.cache.vertexOrientations[o];var t=this.vertices[this.GetPrevVertex(o)],r=this.vertices[o],n=this.vertices[this.GetNextVertex(o)],i=e.CoordOrientation2D(t,r,n);return this.cache.vertexOrientations[o]=i,i},e.Polygon2D.prototype.IsConvexVertex=function(o){var t=this.GetOrientation(),r=this.GetVertexOrientation(o);return r!=e.Orientation.Invalid&&r==t},e.Polygon2D.prototype.IsConcaveVertex=function(o){var t=this.GetOrientation(),r=this.GetVertexOrientation(o);return r!=e.Orientation.Invalid&&r!=t},e.Polygon2D.prototype.CoordPosition=function(o){function t(o,t,r){var n=t.y-o.y,i=r.y-o.y,d=e.IsNegative(n),a=e.IsPositive(n),s=e.IsNegative(i),l=e.IsPositive(i);if(d&&s||a&&l)return 0;var u=!d&&!a,y=!s&&!l;if(u&&y)return 0;var c=function(o,t,r){var n=new e.Coord2D(t.x,o.y);if(!e.IsEqual(t.y,o.y)){var i=Math.abs((t.y-o.y)/(r.y-t.y));n.x=t.x+(r.x-t.x)*i}return n}(o,t,r);if(e.IsLower(c.x,o.x))return 0;if(e.IsGreater(c.x,o.x)){if(u||y){var h=e.IsGreater(r.y,t.y);return u&&h||y&&!h?1:0}return 1}return 1}var r,n,i,d,a,s=this.vertices.length,l=0;for(r=0;r<s;r++){if(n=this.vertices[r],i=this.vertices[(r+1)%s],d=new e.Sector2D(n,i),(a=d.CoordPosition(o))==e.CoordSectorPosition2D.CoordInsideOfSector)return e.CoordPolygonPosition2D.OnEdge;if(a==e.CoordSectorPosition2D.CoordOnSectorEndCoord)return e.CoordPolygonPosition2D.OnVertex;l+=t(o,n,i)}return l%2!=0?e.CoordPolygonPosition2D.Inside:e.CoordPolygonPosition2D.Outside},e.Polygon2D.prototype.SectorPosition=function(o,t,r){var n,i,d,a,s,l,u,y=e.SectorPolygonPosition2D.NoIntersection,c=this.vertices.length;if(c<3)return y;for(n=0;n<c;n++)if(i=n,d=(n+1)%c,a=this.vertices[i],s=this.vertices[d],i!=t&&d!=t&&i!=r&&d!=r){if(l=new e.Sector2D(a,s),(u=o.SectorPosition(l))==e.SectorSectorPosition2D.SectorsIntersectOnePoint)return e.SectorPolygonPosition2D.IntersectionOnePoint;if(u==e.SectorSectorPosition2D.SectorsIntersectCoincident)return e.SectorPolygonPosition2D.IntersectionCoincident;u==e.SectorSectorPosition2D.SectorsIntersectEndPoint&&(y=e.SectorPolygonPosition2D.IntersectionOnVertex)}return y},e.Polygon2D.prototype.IsDiagonal=function(o,t){if(o==t)return!1;if(this.GetPrevVertex(o)==t||this.GetNextVertex(o)==t)return!1;var r=this.vertices[o],n=this.vertices[t];return!r.IsEqual(n)&&(!function(o,t,r){var n=o.GetVertex(t),i=o.GetVertex(r),d=new e.Sector2D(n,i);if(o.SectorPosition(d,t,r)!=e.SectorPolygonPosition2D.NoIntersection)return!0;return!1}(this,o,t)&&!!function(o,t,r){var n=o.GetVertex(t),i=o.GetVertex(r),d=new e.Coord2D((n.x+i.x)/2,(n.y+i.y)/2);return o.CoordPosition(d)==e.CoordPolygonPosition2D.Inside}(this,o,t))},e.Polygon2D.prototype.ToArray=function(){var e,o,t=[];for(e=0;e<this.vertices.length;e++)o=this.vertices[e],t.push(o.Clone());return t},e.Polygon2D.prototype.FromArray=function(e){var o,t;for(this.Clear(),o=0;o<e.length;o++)t=e[o],this.AddVertex(t.x,t.y)},e.Polygon2D.prototype.GetBoundingBox=function(){if(null!==this.cache.boundingBox)return this.cache.boundingBox;var o,t,r=new e.Box2D(new e.Coord2D(e.Inf,e.Inf),new e.Coord2D(-e.Inf,-e.Inf));for(o=0;o<this.vertices.length;o++)t=this.vertices[o],r.min.x=e.Minimum(r.min.x,t.x),r.min.y=e.Minimum(r.min.y,t.y),r.max.x=e.Maximum(r.max.x,t.x),r.max.y=e.Maximum(r.max.y,t.y);return this.cache.boundingBox=r,r},e.Polygon2D.prototype.Clear=function(){this.vertices=[],this.ClearCache()},e.Polygon2D.prototype.ClearCache=function(){this.cache={signedArea:null,orientation:null,vertexOrientations:{},complexity:null,boundingBox:null}},e.Polygon2D.prototype.Clone=function(){var o,t,r=new e.Polygon2D;for(o=0;o<this.vertices.length;o++)t=this.vertices[o],r.AddVertexCoord(t.Clone());return r},e.ContourPolygon2D=function(){this.contours=null,this.Clear()},e.ContourPolygon2D.prototype.AddVertex=function(e,o){this.lastContour.AddVertex(e,o)},e.ContourPolygon2D.prototype.AddVertexCoord=function(e){this.lastContour.AddVertexCoord(e)},e.ContourPolygon2D.prototype.AddContourVertex=function(e,o,t){return this.contours[e].AddVertex(o,t)},e.ContourPolygon2D.prototype.AddContourVertexCoord=function(e,o){return this.contours[e].AddVertexCoord(o)},e.ContourPolygon2D.prototype.VertexCount=function(){var e,o=0;for(e=0;e<this.contours.length;e++)o+=this.contours[e].VertexCount();return o},e.ContourPolygon2D.prototype.ReverseVertices=function(){var e;for(e=0;e<this.contours.length;e++)this.contours[e].ReverseVertices()},e.ContourPolygon2D.prototype.ContourVertexCount=function(e){return this.contours[e].VertexCount()},e.ContourPolygon2D.prototype.AddContour=function(o){this.lastContour=void 0===o||null===o?new e.Polygon2D:o,this.contours.push(this.lastContour)},e.ContourPolygon2D.prototype.GetLastContour=function(){return this.lastContour},e.ContourPolygon2D.prototype.GetContourVertex=function(e,o){return this.contours[e].GetVertex(o)},e.ContourPolygon2D.prototype.GetContour=function(e){return this.contours[e]},e.ContourPolygon2D.prototype.ContourCount=function(){return this.contours.length},e.ContourPolygon2D.prototype.GetSignedArea=function(){var e,o=0;for(e=0;e<this.contours.length;e++)o+=this.contours[e].GetSignedArea();return o},e.ContourPolygon2D.prototype.GetArea=function(){var e=this.GetSignedArea();return Math.abs(e)},e.ContourPolygon2D.prototype.GetOrientation=function(){if(null===this.lastContour)return e.Orientation.Invalid;var o,t,r=this.contours[0].GetOrientation();if(1==this.contours.length)return r;if(r==e.Orientation.Invalid)return e.Orientation.Invalid;for(o=1;o<this.contours.length;o++){if((t=this.contours[o].GetOrientation())==e.Orientation.Invalid)return e.Orientation.Invalid;if(r==t)return e.Orientation.Invalid}return r},e.ContourPolygon2D.prototype.GetComplexity=function(){if(null===this.lastContour)return e.Complexity.Invalid;if(1==this.contours.length)return this.contours[0].GetComplexity();var o;for(o=1;o<this.contours.length;o++)if(this.contours[o].GetComplexity()==e.Complexity.Invalid)return e.Complexity.Invalid;return e.Complexity.Complex},e.ContourPolygon2D.prototype.ToArray=function(){var e,o,t,r,n=[];for(e=0;e<this.contours.length;e++){for(t=this.contours[e],o=0;o<t.VertexCount();o++)r=t.GetVertex(o),n.push(r.Clone());e<this.contours.length-1&&n.push(null)}return n},e.ContourPolygon2D.prototype.FromArray=function(e){var o,t;for(this.Clear(),this.AddContour(),o=0;o<e.length;o++)null===(t=e[o])?this.AddContour():this.AddVertex(t.x,t.y)},e.ContourPolygon2D.prototype.Clear=function(){this.contours=[],this.lastContour=null},e.ContourPolygon2D.prototype.Clone=function(){var o,t,r=new e.ContourPolygon2D;for(o=0;o<this.contours.length;o++)t=this.contours[o],r.AddContour(t.Clone());return r},e}),e("skylark-jsmodeler/geometry/polygon",["../core/jsm"],function(e){return e.Polygon=function(){this.vertices=null,this.cache=null,this.Clear()},e.Polygon.prototype.AddVertex=function(o,t,r){this.AddVertexCoord(new e.Coord(o,t,r))},e.Polygon.prototype.AddVertexCoord=function(e){this.vertices.push(e),this.ClearCache()},e.Polygon.prototype.GetVertex=function(e){return this.vertices[e]},e.Polygon.prototype.VertexCount=function(){return this.vertices.length},e.Polygon.prototype.GetNextVertex=function(o){return e.NextIndex(o,this.vertices.length)},e.Polygon.prototype.ReverseVertices=function(){this.vertices.reverse(),this.ClearCache()},e.Polygon.prototype.GetPrevVertex=function(o){return e.PrevIndex(o,this.vertices.length)},e.Polygon.prototype.GetVertexAngle=function(o){var t=this.vertices[this.GetPrevVertex(o)],r=this.vertices[o],n=this.vertices[this.GetNextVertex(o)],i=e.CoordSub(t,r),d=e.CoordSub(n,r);return i.AngleTo(d)},e.Polygon.prototype.GetNormal=function(){if(null!==this.cache.normal)return this.cache.normal;var o=e.CalculateNormal(this.vertices);return this.cache.normal=o,o},e.Polygon.prototype.ToPolygon2D=function(){var o,t,r=this.GetNormal(),n=new e.Polygon2D;for(o=0;o<this.vertices.length;o++)t=this.vertices[o].ToCoord2D(r),n.AddVertex(t.x,t.y);return n},e.Polygon.prototype.ToArray=function(){var e,o,t=[];for(e=0;e<this.vertices.length;e++)o=this.vertices[e],t.push(o.Clone());return t},e.Polygon.prototype.FromArray=function(e){var o,t;for(this.Clear(),o=0;o<e.length;o++)t=e[o],this.AddVertex(t.x,t.y,t.z)},e.Polygon.prototype.Clear=function(){this.vertices=[],this.ClearCache()},e.Polygon.prototype.ClearCache=function(){this.cache={normal:null}},e.Polygon.prototype.Clone=function(){var o,t,r=new e.Polygon;for(o=0;o<this.vertices.length;o++)t=this.vertices[o],r.AddVertexCoord(t.Clone());return r},e.ContourPolygon=function(){this.contours=null,this.Clear()},e.ContourPolygon.prototype.AddVertex=function(e,o,t){this.lastContour.AddVertex(e,o,t)},e.ContourPolygon.prototype.AddVertexCoord=function(e){this.lastContour.AddVertexCoord(e)},e.ContourPolygon.prototype.AddContourVertex=function(e,o,t,r){return this.contours[e].AddVertex(o,t,r)},e.ContourPolygon.prototype.AddContourVertexCoord=function(e,o){return this.contours[e].AddVertexCoord(o)},e.ContourPolygon.prototype.VertexCount=function(){var e,o=0;for(e=0;e<this.contours.length;e++)o+=this.contours[e].VertexCount();return o},e.ContourPolygon.prototype.ContourVertexCount=function(e){return this.contours[e].VertexCount()},e.ContourPolygon.prototype.AddContour=function(o){this.lastContour=void 0===o||null===o?new e.Polygon:o,this.contours.push(this.lastContour)},e.ContourPolygon.prototype.GetLastContour=function(){return this.lastContour},e.ContourPolygon.prototype.GetContourVertex=function(e,o){return this.contours[e].GetVertex(o)},e.ContourPolygon.prototype.GetContour=function(e){return this.contours[e]},e.ContourPolygon.prototype.ContourCount=function(){return this.contours.length},e.ContourPolygon.prototype.ToContourPolygon2D=function(){var o,t,r,n,i=this.contours[0].GetNormal(),d=new e.ContourPolygon2D;for(o=0;o<this.contours.length;o++)for(d.AddContour(),r=this.contours[o],t=0;t<r.VertexCount();t++)n=r.GetVertex(t),d.AddVertexCoord(n.ToCoord2D(i));return d},e.ContourPolygon.prototype.ToArray=function(){var e,o,t,r,n=[];for(e=0;e<this.contours.length;e++){for(t=this.contours[e],o=0;o<t.VertexCount();o++)r=t.GetVertex(o),n.push(r.Clone());e<this.contours.length-1&&n.push(null)}return n},e.ContourPolygon.prototype.FromArray=function(e){var o,t;for(this.Clear(),this.AddContour(),o=0;o<e.length;o++)null===(t=e[o])?this.AddContour():this.AddVertex(t.x,t.y,t.z)},e.ContourPolygon.prototype.Clear=function(){this.contours=[],this.lastContour=null},e.ContourPolygon.prototype.Clone=function(){var o,t,r=new e.ContourPolygon;for(o=0;o<this.contours.length;o++)t=this.contours[o],r.AddContour(t.Clone());return r},e.OffsetPolygonContour=function(o,t){var r,n,i,d,a,s,l,u,y,c,h,f,g=o.VertexCount(),x=o.GetNormal(),p=new e.Polygon;for(h=0;h<g;h++)r=o.GetPrevVertex(h),n=h,i=o.GetNextVertex(h),d=o.GetVertex(r),a=o.GetVertex(n),s=o.GetVertex(i),l=e.CoordSub(d,a),u=e.CoordSub(s,a),f=l.AngleTo(u)/2,e.CoordOrientation(d,a,s,x)==e.Orientation.Clockwise&&(f=Math.PI-f),y=t/Math.sin(f),(c=a.Clone()).Offset(u,y),c.Rotate(x,f,a),p.AddVertex(c.x,c.y,c.z);return p},e}),e("skylark-jsmodeler/geometry/cutpolygon",["../core/jsm"],function(e){return e.CutVertexType={Left:1,Right:2,Cut:3},e.PolygonCutter=function(e){this.geometryInterface=e,this.Reset()},e.PolygonCutter.prototype.Cut=function(o,t,r,n){this.Reset();var i=this.CalculateOriginalPolygonData(o);if(null!==i){var d=o.Clone();return i==e.CutVertexType.Left?t.push(d):i==e.CutVertexType.Right?r.push(d):n.push(d),!0}return!!this.CalculateCutPolygonData()&&(!!this.CalculateEntryVertices()&&!!this.CalculateCuttedPolygons(t,r))},e.PolygonCutter.prototype.Reset=function(){this.originalPolygon=null,this.originalPolygonVertexTypes=null,this.cutPolygon=null,this.cutPolygonVertexTypes=null,this.cutPolygonVertexDistances=null,this.cutVertexIndices=null,this.entryVertices=null,this.entryVertexTypes=null},e.PolygonCutter.prototype.CalculateOriginalPolygonData=function(o){this.originalPolygon=o,this.originalPolygonVertexTypes=[];var t,r,n,i=!1,d=!1;for(t=0;t<this.originalPolygon.VertexCount();t++)r=o.GetVertex(t),(n=this.geometryInterface.getVertexSide(r))==e.CutVertexType.Left?i=!0:n==e.CutVertexType.Right&&(d=!0),this.originalPolygonVertexTypes.push(n);return i&&d?null:i?e.CutVertexType.Left:d?e.CutVertexType.Right:e.CutVertexType.Cut},e.PolygonCutter.prototype.CalculateCutPolygonData=function(){function o(o,t){if(0===o.length)return!1;var r=o[o.length-1];return r!=e.CutVertexType.Cut&&t!=e.CutVertexType.Cut&&r!=t}function t(o,t,r){o.cutPolygon.AddVertexCoord(t),o.cutPolygonVertexTypes.push(r),r==e.CutVertexType.Cut&&o.cutVertexIndices.push(o.cutPolygonVertexTypes.length-1)}function r(o,r){var n=o.originalPolygon.GetPrevVertex(r),i=o.originalPolygon.GetVertex(n),d=o.originalPolygon.GetVertex(r),a=o.geometryInterface.getIntersectionVertex(i,d);return null!==a&&(t(o,a,e.CutVertexType.Cut),!0)}function n(o,r,n){var i=o.originalPolygon.GetVertex(r).Clone();t(o,i,n);var d=o.originalPolygon.VertexCount(),a=o.originalPolygonVertexTypes[e.PrevIndex(r,d)],s=o.originalPolygonVertexTypes[e.NextIndex(r,d)];return n==e.CutVertexType.Cut&&a==s&&t(o,i,n),!0}this.cutPolygon=this.geometryInterface.createPolygon(),this.cutPolygonVertexTypes=[],this.cutVertexIndices=[];var i,d,a,s,l=this.originalPolygon.VertexCount();for(i=0;i<=l;i++)a=i,(d=i===l)&&(a=0),s=this.originalPolygonVertexTypes[a],o(this.cutPolygonVertexTypes,s)&&r(this,a),d||n(this,a,s);return this.cutPolygonVertexDistances=this.geometryInterface.getVertexDistances(this.cutPolygon),!!function(o,t,r){if(t.length<2)return!1;return e.BubbleSort(t,function(o,t){var n=r[o],i=r[t];return e.IsLower(n,i)},function(o,r){e.SwapArrayValues(t,o,r)}),!0}(this.cutPolygon,this.cutVertexIndices,this.cutPolygonVertexDistances)},e.PolygonCutter.prototype.CalculateEntryVertices=function(){function o(o,t,r){var n=o[r];if(n!=e.CutVertexType.Cut)return 0;var i=e.PrevIndex(r,o.length),d=e.NextIndex(r,o.length),a=o[i],s=o[d],l=t[r],u=t[i],y=t[d];if(a==e.CutVertexType.Right){if(s==e.CutVertexType.Left)return 1;if(s==e.CutVertexType.Cut&&e.IsLowerOrEqual(l,y))return 1}else if(a==e.CutVertexType.Left){if(s==e.CutVertexType.Right)return-1;if(s==e.CutVertexType.Cut&&e.IsGreaterOrEqual(l,y))return-1}else if(a==e.CutVertexType.Cut)if(s==e.CutVertexType.Left){if(e.IsLowerOrEqual(l,u))return 1}else if(s==e.CutVertexType.Right&&e.IsGreaterOrEqual(l,u))return-1;return 0}var t,r,n;for(this.entryVertices=[],this.entryVertexTypes=[],t=0;t<this.cutVertexIndices.length;t++)r=this.cutVertexIndices[t],0!==(n=o(this.cutPolygonVertexTypes,this.cutPolygonVertexDistances,r))&&(this.entryVertices.push(r),this.entryVertexTypes.push(n));return 0!==this.entryVertices.length&&this.entryVertices.length%2==0},e.PolygonCutter.prototype.CalculateCuttedPolygons=function(o,t){function r(o,t,r,n){function i(e,o,t,r){e[o[t]]=o[r],e[o[r]]=o[t]}function d(o,t,r){if(-1!=r[o]){var n=r[o];return function(e,o){e[e[o]]=-1,e[o]=-1}(r,o),n}return e.NextIndex(o,t.VertexCount())}function a(o,t,r,n,i){function a(e,o){var t=e.VertexCount();t>0&&e.GetVertex(t-1).IsEqual(o)||e.AddVertexCoord(o)}var s=o.entryVertices[r];if(-1!==t[s]){var l=o.geometryInterface.createPolygon();l.AddVertexCoord(o.cutPolygon.GetVertex(s).Clone());for(var u=d(s,o.cutPolygon,t),y=null;u!=s;)null===y&&o.cutPolygonVertexTypes[u]!==e.CutVertexType.Cut&&(y=o.cutPolygonVertexTypes[u]),a(l,o.cutPolygon.GetVertex(u).Clone()),u=d(u,o.cutPolygon,t);l.VertexCount()>2&&(y==e.CutVertexType.Left?n.push(l):y==e.CutVertexType.Right&&i.push(l))}}var s=function(e,o,t){function r(e,o,t,r){var n;for(n=r+1;n<o.length;n++)if(-1==e[o[n]]&&t[r]!=t[n])return n;return-1}var n,d,a=[];for(n=0;n<e.VertexCount();n++)a.push(-1);for(n=0;n<o.length;n++)if(-1==a[o[n]]){if(-1==(d=r(a,o,t,n)))return null;i(a,o,n,d)}return a}(o.cutPolygon,o.entryVertices,o.entryVertexTypes);if(null===s)return!1;for(var l=n?o.entryVertices.length-1:0;l>=0&&l<o.entryVertices.length;)a(o,s,l,t,r),l=n?l-1:l+1;return!0}return!!r(this,o,t,!1)&&!!r(this,o,t,!0)},e.CutPolygon2DWithLine=function(o,t,r,n,i){var d={createPolygon:function(){return new e.Polygon2D},getVertexSide:function(o){var r=t.CoordPosition(o),n=e.CutVertexType.Cut;return r==e.CoordLinePosition2D.CoordAtLineLeft?n=e.CutVertexType.Left:r==e.CoordLinePosition2D.CoordAtLineRight&&(n=e.CutVertexType.Right),n},getIntersectionVertex:function(o,r){var n=new e.Line2D(r,e.CoordSub2D(r,o)),i=new e.Coord2D(0,0),d=t.LinePosition(n,i);return d!=e.LineLinePosition2D.LinesIntersectsOnePoint?null:i},getVertexDistances:function(o){var r,n,i=new e.Coord2D(0,0),d=t.start.Clone(),a=t.direction.Clone().Rotate(-Math.PI/2,i),s=new e.Line2D(d,a),l=[];for(r=0;r<o.VertexCount();r++)n=o.GetVertex(r),l.push(s.CoordSignedDistance(n));return l}},a=new e.PolygonCutter(d);return a.Cut(o,r,n,i)},e.CutPolygonWithPlane=function(o,t,r,n,i){var d={createPolygon:function(){return new e.Polygon},getVertexSide:function(o){var r=t.CoordPosition(o),n=e.CutVertexType.Cut;return r==e.CoordPlanePosition.CoordInFrontOfPlane?n=e.CutVertexType.Left:r==e.CoordPlanePosition.CoordAtBackOfPlane&&(n=e.CutVertexType.Right),n},getIntersectionVertex:function(o,r){var n=new e.Line(r,e.CoordSub(r,o)),i=new e.Coord(0,0,0),d=t.LinePosition(n,i);return d!=e.LinePlanePosition.LineIntersectsPlane?null:i},getVertexDistances:function(o){var r,n,i=o.GetNormal(),d=new e.Vector(t.a,t.b,t.c),a=e.VectorCross(d,i),s=o.GetVertex(0),l=e.GetPlaneFromCoordAndDirection(s,a),u=[];for(r=0;r<o.VertexCount();r++)n=o.GetVertex(r),u.push(l.CoordSignedDistance(n));return u}},a=new e.PolygonCutter(d);return a.Cut(o,r,n,i)},e.SegmentPolygon2D=function(o,t,r){function n(o,t,r,n,i,d,a){function s(o,t,r,n){var i=[],d=[];if(e.CutPolygon2DWithLine(o,t,i,d,[])){var a;for(a=0;a<i.length;a++)r.push(i[a]);for(a=0;a<d.length;a++)n.push(d[a])}}var l,u,y,c,h=o,f=i.Clone();for(l=1;l<r;l++){for(f.Offset(d,n),y=new e.Line2D(f,a),c=[],u=0;u<h.length;u++)s(h[u],y,t,c);h=c}for(u=0;u<h.length;u++)t.push(h[u])}var i=o.GetBoundingBox(),d=i.max.x-i.min.x,a=i.max.y-i.min.y,s=d/t,l=a/r,u=[o],y=new e.Coord2D(i.min.x,i.min.y),c=new e.Coord2D(i.min.x,i.max.y),h=[],f=[];return n(u,h,t,s,y,new e.Vector2D(1,0),new e.Vector2D(0,1)),n(h,f,r,l,c,new e.Vector2D(0,-1),new e.Vector2D(1,0)),f},e}),e("skylark-jsmodeler/geometry/triangulation",["../core/jsm"],function(e){return e.ConvertContourPolygonToPolygon2D=function(o,t){function r(e,o,t,r,n){e.AddVertexCoord(o),void 0!==t&&null!==t&&t.push([r,n])}function n(o,t,n,i,d){var a=function(o,t,r,n){function i(o,t,r,n,i){function d(o,t,r){var n=new e.Sector2D(t,r),i=o.SectorPosition(n,-1,-1);return i==e.SectorPolygonPosition2D.IntersectionOnePoint||i==e.SectorPolygonPosition2D.IntersectionCoincident}if(d(t,r,n))return!1;var a;for(a=1;a<o.ContourCount();a++)if(void 0===i.addedHoles[a]&&d(o.GetContour(a),r,n))return!1;return!0}function d(e,o){var t;for(t=0;t<o.entryPositions.length;t++)if(e.IsEqual(o.entryPositions[t]))return!0;return!1}var a,s,l,u,y=o.GetContour(r);for(a=0;a<t.VertexCount();a++)for(s=0;s<y.VertexCount();s++)if(l=t.GetVertex(a),u=y.GetVertex(s),i(o,t,l,u,n)){if(d(l,n)||d(u,n))continue;return n.entryPositions.push(l.Clone()),n.entryPositions.push(u.Clone()),{beg:a,end:s}}return null}(o,t,n,d);return null!==a&&(function(o,t,n,i,d){var a=t.GetContour(n),s=i.beg,l=o.GetVertex(s).Clone();o.ShiftVertices(s+1);var u=0,y=0;void 0!==d&&null!==d&&(u=d[s][0],y=d[s][1],e.ShiftArray(d,s+1));var c=i.end,h=a.GetPrevVertex(c);a.EnumerateVertices(c,h,function(e){r(o,a.GetVertex(e).Clone(),d,n,e)}),r(o,a.GetVertex(c).Clone(),d,n,c),r(o,l,d,u,y)}(t,o,n,a,i),!0)}var i,d,a=o.ContourCount(),s=o.GetContour(0),l=new e.Polygon2D;for(i=0;i<s.VertexCount();i++)d=s.GetVertex(i),r(l,d.Clone(),t,0,i);if(1==a)return l;var u,y=[];for(u=1;u<a;u++)y.push(u);for(var c={addedHoles:{},holeTryouts:{},entryPositions:[]};y.length>0;)if(u=y.shift(),n(o,l,u,t,c))c.addedHoles[u]=!0;else{if(void 0===c.holeTryouts[u]&&(c.holeTryouts[u]=0),c.holeTryouts[u]+=1,c.holeTryouts[u]>10)return null;y.push(u)}return l},e.TriangulateConvexPolygon=function(e){var o,t=[];for(o=1;o<e.VertexCount()-1;o++)t.push([0,o,o+1]);return t},e.TriangulateConcavePolygon2D=function(o){function t(e){var o,t,r=e.VertexCount();for(o=0;o<r;o++)for(t=0;t<r;t++)if(o!=t&&e.IsDiagonal(o,t))return{beg:o,end:t};return null}function r(o,t){function r(e,o,t){o.polygon.AddVertexCoord(e.polygon.GetVertex(t)),o.map.push(e.map[t])}var n,i,d={polygon:new e.Polygon2D,map:[]},a={polygon:new e.Polygon2D,map:[]};return n=t.beg,i=o.polygon.GetPrevVertex(t.end),r(o,d,t.end),o.polygon.EnumerateVertices(n,i,function(e){r(o,d,e)}),n=t.end,i=o.polygon.GetPrevVertex(t.beg),r(o,a,t.beg),o.polygon.EnumerateVertices(n,i,function(e){r(o,a,e)}),{resultData1:d,resultData2:a}}var n=[],i=o.VertexCount(),d=function(e){var o,t=[];for(o=0;o<e;o++)t[o]=o;return t}(i);n.push({polygon:o,map:d});for(var a,s,l,u,y=[];n.length>0;)if(a=n.pop(),!((s=a.polygon.VertexCount())<3))if(3!=s){if(null===(l=t(a.polygon)))return null;u=r(a,l),n.push(u.resultData1),n.push(u.resultData2)}else y.push(a.map);return y},e.TriangulatePolygon2D=function(o){if(null===o)return null;var t=o.VertexCount();if(t<3)return null;if(3==t)return[[0,1,2]];var r=o.GetComplexity();return r===e.Complexity.Invalid?null:r==e.Complexity.Convex?e.TriangulateConvexPolygon(o):e.TriangulateConcavePolygon2D(o)},e.TriangulatePolygon=function(o){var t=o.ToPolygon2D();return e.TriangulatePolygon2D(t)},e}),e("skylark-jsmodeler/geometry/octree",["../core/jsm"],function(e){return e.TraverseOctreeNodes=function(e,o){!function e(o,t){if(!t(o))return;if(null===o.children)return;var r,n;for(r=0;r<o.children.length;r++)n=o.children[r],e(n,t)}(e.root,o)},e.CreateOctreeChildNodes=function(o,t){function r(o,t,r,n,i){var d=o.GetSize().Clone();d.MultiplyScalar(.5);var a=new e.Coord(o.min.x+r*d.x,o.min.y+n*d.y,o.min.z+i*d.z),s=e.CoordAdd(a,d),l=new e.Box(a,s);return t(l)}var n=o.GetSize();if(e.IsZero(n.x)&&e.IsZero(n.y)&&e.IsZero(n.z))return null;var i=[r(o,t,0,0,0),r(o,t,1,0,0),r(o,t,1,1,0),r(o,t,0,1,0),r(o,t,0,0,1),r(o,t,1,0,1),r(o,t,1,1,1),r(o,t,0,1,1)];return i},e.Octree=function(e,o){this.coords=[],this.root=this.CreateNewNode(null,e),this.maxCoordNumInNodes=o,void 0!==this.maxCoordNumInNodes&&null!==this.maxCoordNumInNodes&&0!==this.maxCoordNumInNodes||(this.maxCoordNumInNodes=50)},e.Octree.prototype.AddCoord=function(e){return this.AddCoordToNode(e,this.root)},e.Octree.prototype.FindCoord=function(e){var o=this.FindNodeForCoord(e,this.root);return null===o?-1:this.FindCoordInNode(e,o)},e.Octree.prototype.FindCoordInNode=function(e,o){var t,r;for(t=0;t<o.coords.length;t++)if(r=o.coords[t],e.IsEqual(this.coords[r]))return r;return-1},e.Octree.prototype.AddCoordToNode=function(e,o){var t=this.FindNodeForCoord(e,o);if(null===t)return-1;var r=this.FindCoordInNode(e,t);if(-1!=r)return r;if(t.coords.length>=this.maxCoordNumInNodes&&this.SplitNode(t))return this.AddCoordToNode(e,t);var n=this.coords.length;return this.coords.push(e),t.coords.push(n),n},e.Octree.prototype.FindNodeForCoord=function(e,o){if(null===o.children)return o;var t=o.box.GetCenter(),r=e.x>t.x,n=e.y>t.y,i=e.z>t.z;return r||n||i?!r||n||i?r&&n&&!i?this.FindNodeForCoord(e,o.children[2]):r||!n||i?r||n||!i?r&&!n&&i?this.FindNodeForCoord(e,o.children[5]):r&&n&&i?this.FindNodeForCoord(e,o.children[6]):!r&&n&&i?this.FindNodeForCoord(e,o.children[7]):null:this.FindNodeForCoord(e,o.children[4]):this.FindNodeForCoord(e,o.children[3]):this.FindNodeForCoord(e,o.children[1]):this.FindNodeForCoord(e,o.children[0])},e.Octree.prototype.SplitNode=function(o){var t=this,r=e.CreateOctreeChildNodes(o.box,function(e){return t.CreateNewNode(o,e)});if(null===r)return!1;o.children=r;var n,i=o.coords;for(o.coords=[],n=0;n<i.length;n++)this.FindNodeForCoord(this.coords[i[n]],o).coords.push(i[n]);return!0},e.Octree.prototype.CreateNewNode=function(e,o){var t={parent:e,box:o,coords:[],children:null};return t},e.TriangleOctree=function(e){this.root=this.CreateNewNode(null,e)},e.TriangleOctree.prototype.AddTriangle=function(e,o,t,r){return this.AddTriangleToNode(e,o,t,this.root,r)},e.TriangleOctree.prototype.AddTriangleToNode=function(o,t,r,n,i){if(!function(e,o,t,r){return r.box.IsCoordInside(e)&&r.box.IsCoordInside(o)&&r.box.IsCoordInside(t)}(o,t,r,n))return!1;if(null===n.children){var d=this;n.children=e.CreateOctreeChildNodes(n.box,function(e){return d.CreateNewNode(n,e)})}var a,s;if(null!==n.children)for(a=0;a<n.children.length;a++)if(s=n.children[a],this.AddTriangleToNode(o,t,r,s,i))return!0;return n.triangles.push({v0:o,v1:t,v2:r,userData:i}),!0},e.TriangleOctree.prototype.CreateNewNode=function(e,o){var t={parent:e,box:o,triangles:[],children:null};return t},e}),e("skylark-jsmodeler/geometry/bsptree",["../core/jsm"],function(e){return e.BSPTree=function(){this.root=null},e.BSPTree.prototype.AddPolygon=function(e,o){return null===this.root&&(this.root=this.CreateNewNode()),this.AddPolygonToNode(this.root,e,o)},e.BSPTree.prototype.Traverse=function(e){this.TraverseNode(this.root,e)},e.BSPTree.prototype.TraverseNode=function(e,o){null!==e&&(o(e),this.TraverseNode(e.inside,o),this.TraverseNode(e.outside,o))},e.BSPTree.prototype.GetNodes=function(){var e=[];return this.Traverse(function(o){e.push(o)}),e},e.BSPTree.prototype.NodeCount=function(){var e=0;return this.Traverse(function(){e+=1}),e},e.BSPTree.prototype.AddPolygonToNode=function(o,t,r){if(t.VertexCount()<3)return!1;var n;if(null===o.polygon){n=t.GetNormal();var i=e.GetPlaneFromCoordAndDirection(t.GetVertex(0),n);o.polygon=t,void 0!==r&&(o.userData=r),o.plane=i}else{var d=[],a=[],s=[],l=e.CutPolygonWithPlane(t,o.plane,a,d,s);l&&(d.length>0&&this.AddInsidePolygonsToNode(o,d,r),a.length>0&&this.AddOutsidePolygonsToNode(o,a,r),s.length>0&&(n=t.GetNormal(),e.VectorDot(n,o.plane.GetNormal())>0?this.AddInsidePolygonsToNode(o,s,r):this.AddOutsidePolygonsToNode(o,s,r)))}return!0},e.BSPTree.prototype.AddInsidePolygonsToNode=function(e,o,t){var r;for(null===e.inside&&(e.inside=this.CreateNewNode(),e.inside.parent=e),r=0;r<o.length;r++)this.AddPolygonToNode(e.inside,o[r],t)},e.BSPTree.prototype.AddOutsidePolygonsToNode=function(e,o,t){var r;for(null===e.outside&&(e.outside=this.CreateNewNode(),e.outside.parent=e),r=0;r<o.length;r++)this.AddPolygonToNode(e.outside,o[r],t)},e.BSPTree.prototype.CreateNewNode=function(){return{polygon:null,userData:null,plane:null,parent:null,inside:null,outside:null}},e.ClipPolygonWithBSPTree=function(o,t,r,n,i,d){function a(o,t,r){if(null!==t){var n=[],i=[],d=[],a=e.CutPolygonWithPlane(o,t.plane,i,n,d);if(a&&(n.length>0&&u(t,n,r),i.length>0&&y(t,i,r),d.length>0)){var s=o.GetNormal();e.VectorDot(s,t.plane.GetNormal())>0?u(t,d,!0):y(t,d,!0)}}}function s(e,o,t){var r;for(r=0;r<e.length;r++)a(e[r],o,t)}function l(e,o){var t;for(t=0;t<e.length;t++)o.push(e[t])}function u(e,o,t){null!==e.inside?s(o,e.inside,t):l(o,t?d:n)}function y(e,o,t){null!==e.outside?s(o,e.outside,t):l(o,t?i:r)}return a(o,t.root,!1),!0},e.TraverseBSPTreeForEyePosition=function(o,t,r){!function o(n){if(null!==n){var i=n.plane.CoordPosition(t);i==e.CoordPlanePosition.CoordInFrontOfPlane?(o(n.inside),r(n),o(n.outside)):i==e.CoordPlanePosition.CoordAtBackOfPlane?(o(n.outside),r(n),o(n.inside)):(o(n.outside),o(n.inside))}}(o.root)},e}),e("skylark-jsmodeler/geometry/curves",["../core/jsm"],function(e){return e.GenerateCubicBezierCurve=function(o,t,r,n,i){function d(o,t,r,n,i){var d=i*i,a=d*i,s=1-i,l=s*s,u=l*s,y=u*o.x+3*l*i*t.x+3*s*d*r.x+a*n.x,c=u*o.y+3*l*i*t.y+3*s*d*r.y+a*n.y;return new e.Coord2D(y,c)}var a,s,l=[],u=1/i;for(a=0;a<=i;a++)s=d(o,t,r,n,a*u),l.push(s);return l},e.BernsteinPolynomial=function(o,t,r){var n=function(o,t){var r,n=1,i=e.Minimum(t,o-t);for(r=0;r<i;r++)n*=o-r,n/=r+1;return n}(t,o);return n*Math.pow(r,o)*Math.pow(1-r,t-o)},e.GenerateBezierCurve=function(o,t){var r,n,i,d,a,s,l=[],u=o.length-1,y=1/t;for(r=0;r<=t;r++){for(i=r*y,s=new e.Coord2D(0,0),n=0;n<=u;n++)d=o[n],a=e.BernsteinPolynomial(n,u,i),s.x+=d.x*a,s.y+=d.y*a;l.push(s)}return l},e}),e("skylark-jsmodeler/geometry/utilities",["../core/jsm"],function(e){return e.GetGaussianCParameter=function(e,o,t,r){return Math.sqrt(-Math.pow(e-t,2)/(2*Math.log(r/Math.abs(o))))},e.GetGaussianValue=function(e,o,t,r){return o*Math.exp(-Math.pow(e-t,2)/(2*Math.pow(r,2)))},e.GenerateCirclePoints=function(o,t,r){var n,i,d=[],a=t,s=2*Math.PI,l=2*Math.PI/a;for(n=0;n<a;n++)i=e.CylindricalToCartesian(o,0,s),void 0!==r&&null!==r&&(i=e.CoordAdd(i,r)),d.push(i),s+=l;return d},e.GetRuledMesh=function(o,t,r,n,i){if(o.length===t.length){var d,a,s,l,u,y,c,h=o.length-1,f=r,g=[],x=[];for(d=0;d<=h;d++)g.push(e.CoordSub(t[d],o[d])),x.push(o[d].DistanceTo(t[d]));for(d=0;d<=h;d++)for(s=x[d]/f,a=0;a<=f;a++)l=o[d].Clone().Offset(g[d],s*a),n.push(l);for(d=0;d<h;d++)for(a=0;a<f;a++)y=(u=d*(f+1)+a)+1,u+f+1+1,c=[u=d*(f+1)+a,y=u+f+1,y+1,u+1],i.push(c)}},e}),e("skylark-jsmodeler/geometry/ray",["../core/jsm"],function(e){return e.Ray=function(e,o,t){this.origin=e,this.direction=o.Normalize(),this.length=t},e.Ray.prototype.Set=function(e,o,t){this.origin=e,this.direction=o.Normalize(),this.length=t},e.Ray.prototype.GetOrigin=function(){return this.origin},e.Ray.prototype.GetDirection=function(){return this.direction},e.Ray.prototype.IsLengthReached=function(o){return void 0!==this.length&&null!==this.length&&e.IsGreater(o,this.length)},e.Ray.prototype.Clone=function(){return new e.Ray(this.origin.Clone(),this.direction.Clone(),this.length)},e}),e("skylark-jsmodeler/geometry/path",["../core/jsm"],function(e){return e.Path2D=function(o){this.settings={segmentation:10,offset:new e.Vector2D(0,0),scale:new e.Coord2D(1,1)},e.CopyObjectProperties(o,this.settings,!0),this.position=new e.Coord2D(0,0),this.positionAdded=!1,this.polygons=[],this.currentPolygon=null},e.Path2D.prototype.MoveTo=function(e,o){this.Close(),this.position.Set(e,o),this.positionAdded=!1},e.Path2D.prototype.LineTo=function(e,o){this.positionAdded||this.AddPolygonPoint(this.position.x,this.position.y),this.AddPolygonPoint(e,o)},e.Path2D.prototype.CubicBezierTo=function(o,t,r,n,i,d){var a,s=e.GenerateCubicBezierCurve(new e.Coord2D(this.position.x,this.position.y),new e.Coord2D(r,n),new e.Coord2D(i,d),new e.Coord2D(o,t),this.settings.segmentation);for(a=1;a<s.length;a++)this.LineTo(s[a].x,s[a].y)},e.Path2D.prototype.Close=function(){if(null!==this.currentPolygon){if(function(e){if(0===e.VertexCount())return!1;e.GetVertex(0).IsEqual(e.GetVertex(e.VertexCount()-1))&&e.RemoveVertex(e.VertexCount()-1);if(e.VertexCount()<3)return!1;return!0}(this.currentPolygon)){var o=function(o,t){function r(o,t){if(d=i.GetOrientation(),a=t.GetOrientation(),d!==a){var r=t.GetVertex(0),n=i.CoordPosition(r);if(n==e.CoordPolygonPosition2D.Inside)return!0}return!1}var n,i,d,a;for(n=o.length-1;n>=0;n--)if(r(i=o[n].GetContour(0),t))return o[n];return null}(this.polygons,this.currentPolygon);if(null===o){var t=new e.ContourPolygon2D;t.AddContour(this.currentPolygon),this.polygons.push(t)}else o.AddContour(this.currentPolygon)}this.currentPolygon=null}},e.Path2D.prototype.PolygonCount=function(){return this.polygons.length},e.Path2D.prototype.GetPolygon=function(e){return this.polygons[e]},e.Path2D.prototype.GetPolygons=function(){return this.polygons},e.Path2D.prototype.GetCurrentPolygon=function(){return null===this.currentPolygon&&(this.currentPolygon=new e.Polygon2D),this.currentPolygon},e.Path2D.prototype.AddPolygonPoint=function(e,o){var t=this.GetCurrentPolygon(),r=this.settings.offset.x+e*this.settings.scale.x,n=this.settings.offset.y+o*this.settings.scale.y;t.AddVertex(r,n),this.position.Set(e,o),this.positionAdded=!0},e}),e("skylark-jsmodeler/modeler/color",["../core/jsm"],function(e){return e.HexColorToRGBComponents=function(e){for(var o=e.toString(16);o.length<6;)o="0"+o;var t=parseInt(o.substr(0,2),16),r=parseInt(o.substr(2,2),16),n=parseInt(o.substr(4,2),16);return[t,r,n]},e.HexColorToNormalizedRGBComponents=function(o){var t=e.HexColorToRGBComponents(o);return[t[0]/255,t[1]/255,t[2]/255]},e.HexColorToRGBColor=function(e){var o="0x"+e;return parseInt(o,16)},e.RGBComponentsToHexColor=function(e,o,t){function r(e){for(var o=parseInt(e,10).toString(16);o.length<2;)o="0"+o;return o}var n=r(e),i=r(o),d=r(t),a="0x"+n+i+d;return parseInt(a,16)},e}),e("skylark-jsmodeler/modeler/material",["../core/jsm"],function(e){return e.Material=function(o){this.ambient=52224,this.diffuse=52224,this.specular=0,this.shininess=0,this.opacity=1,this.reflection=0,this.singleSided=!1,this.pointSize=.1,this.texture=null,this.textureWidth=1,this.textureHeight=1,e.CopyObjectProperties(o,this,!0)},e}),e("skylark-jsmodeler/modeler/materialset",["../core/jsm"],function(e){return e.MaterialSet=function(){this.materials=[],this.defaultMaterial=new e.Material},e.MaterialSet.prototype.AddMaterial=function(e){return this.materials.push(e),this.materials.length-1},e.MaterialSet.prototype.GetMaterial=function(e){return e<0||e>=this.materials.length?this.defaultMaterial:this.materials[e]},e.MaterialSet.prototype.GetDefaultMaterial=function(){return this.defaultMaterial},e.MaterialSet.prototype.Count=function(){return this.materials.length},e}),e("skylark-jsmodeler/modeler/body",["../core/jsm"],function(e){return e.BodyVertex=function(e){this.position=e},e.BodyVertex.prototype.GetPosition=function(){return this.position},e.BodyVertex.prototype.SetPosition=function(e){this.position=e},e.BodyVertex.prototype.Clone=function(){return new e.BodyVertex(this.position.Clone())},e.BodyPoint=function(e){this.vertex=e,this.material=-1},e.BodyPoint.prototype.GetVertexIndex=function(){return this.vertex},e.BodyPoint.prototype.SetVertexIndex=function(e){this.vertex=e},e.BodyPoint.prototype.HasMaterialIndex=function(){return-1!==this.material},e.BodyPoint.prototype.GetMaterialIndex=function(){return this.material},e.BodyPoint.prototype.SetMaterialIndex=function(e){this.material=e},e.BodyPoint.prototype.InheritAttributes=function(e){this.material=e.material},e.BodyPoint.prototype.Clone=function(){var o=new e.BodyPoint(this.vertex);return o.material=this.material,o},e.BodyLine=function(e,o){this.beg=e,this.end=o,this.material=-1},e.BodyLine.prototype.GetBegVertexIndex=function(){return this.beg},e.BodyLine.prototype.SetBegVertexIndex=function(e){this.beg=e},e.BodyLine.prototype.GetEndVertexIndex=function(){return this.end},e.BodyLine.prototype.SetEndVertexIndex=function(e){this.end=e},e.BodyLine.prototype.HasMaterialIndex=function(){return-1!==this.material},e.BodyLine.prototype.GetMaterialIndex=function(){return this.material},e.BodyLine.prototype.SetMaterialIndex=function(e){this.material=e},e.BodyLine.prototype.InheritAttributes=function(e){this.material=e.material},e.BodyLine.prototype.Clone=function(){var o=new e.BodyLine(this.beg,this.end);return o.material=this.material,o},e.BodyPolygon=function(e){this.vertices=e,this.material=-1,this.curved=-1},e.BodyPolygon.prototype.AddVertexIndex=function(e){this.vertices.push(e)},e.BodyPolygon.prototype.InsertVertexIndex=function(e,o){this.vertices.splice(o,0,e)},e.BodyPolygon.prototype.GetVertexIndex=function(e){return this.vertices[e]},e.BodyPolygon.prototype.SetVertexIndex=function(e,o){this.vertices[e]=o},e.BodyPolygon.prototype.GetVertexIndices=function(){return this.vertices},e.BodyPolygon.prototype.SetVertexIndices=function(e){this.vertices=e},e.BodyPolygon.prototype.VertexIndexCount=function(){return this.vertices.length},e.BodyPolygon.prototype.HasMaterialIndex=function(){return-1!==this.material},e.BodyPolygon.prototype.GetMaterialIndex=function(){return this.material},e.BodyPolygon.prototype.SetMaterialIndex=function(e){this.material=e},e.BodyPolygon.prototype.HasCurveGroup=function(){return-1!==this.curved},e.BodyPolygon.prototype.GetCurveGroup=function(){return this.curved},e.BodyPolygon.prototype.SetCurveGroup=function(e){this.curved=e},e.BodyPolygon.prototype.ReverseVertexIndices=function(){this.vertices.reverse()},e.BodyPolygon.prototype.InheritAttributes=function(e){this.material=e.material,this.curved=e.curved},e.BodyPolygon.prototype.Clone=function(){var o,t=new e.BodyPolygon([]);for(o=0;o<this.vertices.length;o++)t.vertices.push(this.vertices[o]);return t.material=this.material,t.curved=this.curved,t},e.TextureProjectionType={Planar:0,Cubic:1,Cylindrical:2},e.BodyTextureProjection=function(){this.type=null,this.coords=null,this.SetCubic(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1))},e.BodyTextureProjection.prototype.GetType=function(){return this.type},e.BodyTextureProjection.prototype.GetCoords=function(){return this.coords},e.BodyTextureProjection.prototype.SetType=function(e){this.type=e},e.BodyTextureProjection.prototype.SetCoords=function(e){this.coords=e},e.BodyTextureProjection.prototype.SetPlanar=function(o,t,r){this.type=e.TextureProjectionType.Planar,this.coords=new e.CoordSystem(o,t,r,new e.Coord(0,0,0))},e.BodyTextureProjection.prototype.SetCubic=function(o,t,r,n){this.type=e.TextureProjectionType.Cubic,this.coords=new e.CoordSystem(o,t,r,n)},e.BodyTextureProjection.prototype.SetCylindrical=function(o,t,r,n){this.type=e.TextureProjectionType.Cylindrical,this.coords=new e.CoordSystem(o,r.Clone().SetLength(t),e.VectorCross(n,r).SetLength(t),n)},e.BodyTextureProjection.prototype.Transform=function(e){this.coords.ToAbsoluteCoords(),this.coords.origo=e.Apply(this.coords.origo),this.coords.e1=e.Apply(this.coords.e1),this.coords.e2=e.Apply(this.coords.e2),this.coords.e3=e.Apply(this.coords.e3),this.coords.ToDirectionVectors()},e.BodyTextureProjection.prototype.Clone=function(){var o=new e.BodyTextureProjection;return o.SetType(this.type),o.SetCoords(this.coords.Clone()),o},e.Body=function(){this.Clear()},e.Body.prototype.AddVertex=function(e){return this.vertices.push(e),this.vertices.length-1},e.Body.prototype.AddPoint=function(e){return this.points.push(e),this.points.length-1},e.Body.prototype.AddLine=function(e){return this.lines.push(e),this.lines.length-1},e.Body.prototype.AddPolygon=function(e){return this.polygons.push(e),this.polygons.length-1},e.Body.prototype.GetVertex=function(e){return this.vertices[e]},e.Body.prototype.GetVertexPosition=function(e){return this.vertices[e].position},e.Body.prototype.SetVertexPosition=function(e,o){this.vertices[e].position=o},e.Body.prototype.GetPoint=function(e){return this.points[e]},e.Body.prototype.GetLine=function(e){return this.lines[e]},e.Body.prototype.GetPolygon=function(e){return this.polygons[e]},e.Body.prototype.SetPointsMaterialIndex=function(e){var o;for(o=0;o<this.points.length;o++)this.points[o].SetMaterialIndex(e)},e.Body.prototype.SetLinesMaterialIndex=function(e){var o;for(o=0;o<this.lines.length;o++)this.lines[o].SetMaterialIndex(e)},e.Body.prototype.SetPolygonsMaterialIndex=function(e){var o;for(o=0;o<this.polygons.length;o++)this.polygons[o].SetMaterialIndex(e)},e.Body.prototype.SetPolygonsCurveGroup=function(e){var o;for(o=0;o<this.polygons.length;o++)this.polygons[o].SetCurveGroup(e)},e.Body.prototype.RemoveVertex=function(e){var o,t,r,n,i,d,a=[],s=[],l=[];for(o=0;o<this.points.length;o++)(r=this.points[o]).GetVertexIndex()==e?a.push(o):r.GetVertexIndex()>=e&&r.SetVertexIndex(r.GetVertexIndex()-1);for(o=0;o<this.lines.length;o++)(n=this.lines[o]).GetBegVertexIndex()==e||n.GetEndVertexIndex()==e?s.push(o):(n.GetBegVertexIndex()>=e&&n.SetBegVertexIndex(n.GetBegVertexIndex()-1),n.GetEndVertexIndex()>=e&&n.SetEndVertexIndex(n.GetEndVertexIndex()-1));for(o=0;o<this.polygons.length;o++)for(i=this.polygons[o],t=0;t<i.VertexIndexCount();t++){if(d=i.GetVertexIndex(t),i.GetVertexIndex(t)==e){l.push(o);break}d>=e&&i.SetVertexIndex(t,d-1)}for(o=0;o<a.length;o++)this.RemovePoint(a[o]-o);for(o=0;o<s.length;o++)this.RemoveLine(s[o]-o);for(o=0;o<l.length;o++)this.RemovePolygon(l[o]-o);this.vertices.splice(e,1)},e.Body.prototype.RemovePoint=function(e){this.points.splice(e,1)},e.Body.prototype.RemoveLine=function(e){this.lines.splice(e,1)},e.Body.prototype.RemovePolygon=function(e){this.polygons.splice(e,1)},e.Body.prototype.VertexCount=function(){return this.vertices.length},e.Body.prototype.PointCount=function(){return this.points.length},e.Body.prototype.LineCount=function(){return this.lines.length},e.Body.prototype.PolygonCount=function(){return this.polygons.length},e.Body.prototype.GetTextureProjection=function(){return this.projection},e.Body.prototype.SetTextureProjection=function(e){this.projection=e},e.Body.prototype.SetPlanarTextureProjection=function(e,o,t){this.projection.SetPlanar(e,o,t)},e.Body.prototype.SetCubicTextureProjection=function(e,o,t,r){this.projection.SetCubic(e,o,t,r)},e.Body.prototype.SetCylindricalTextureProjection=function(e,o,t,r){this.projection.SetCylindrical(e,o,t,r)},e.Body.prototype.Transform=function(e){var o;for(o=0;o<this.vertices.length;o++)this.vertices[o].position=e.Apply(this.vertices[o].position);this.projection.Transform(e)},e.Body.prototype.GetBoundingBox=function(){var o,t,r=new e.Coord(e.Inf,e.Inf,e.Inf),n=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(o=0;o<this.vertices.length;o++)t=this.vertices[o].position,r.x=e.Minimum(r.x,t.x),r.y=e.Minimum(r.y,t.y),r.z=e.Minimum(r.z,t.z),n.x=e.Maximum(n.x,t.x),n.y=e.Maximum(n.y,t.y),n.z=e.Maximum(n.z,t.z);return new e.Box(r,n)},e.Body.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.Body.prototype.GetBoundingSphere=function(){var o,t,r=this.GetCenter(),n=0;for(o=0;o<this.vertices.length;o++)t=r.DistanceTo(this.vertices[o].position),e.IsGreater(t,n)&&(n=t);var i=new e.Sphere(r,n);return i},e.Body.prototype.OffsetToOrigo=function(){var o,t=this.GetCenter().Clone();for(t.MultiplyScalar(-1),o=0;o<this.vertices.length;o++)this.vertices[o].position=e.CoordAdd(this.vertices[o].position,t)},e.Body.prototype.Merge=function(e){var o,t,r,n,i,d=this.vertices.length;for(o=0;o<e.VertexCount();o++)this.vertices.push(e.GetVertex(o).Clone());for(o=0;o<e.PointCount();o++)(r=e.GetPoint(o).Clone()).SetVertexIndex(r.GetVertexIndex()+d),this.points.push(r);for(o=0;o<e.LineCount();o++)(n=e.GetLine(o).Clone()).SetBegVertexIndex(n.GetBegVertexIndex()+d),n.SetEndVertexIndex(n.GetEndVertexIndex()+d),this.lines.push(n);for(o=0;o<e.PolygonCount();o++){for(i=e.GetPolygon(o).Clone(),t=0;t<i.VertexIndexCount();t++)i.vertices[t]+=d;this.polygons.push(i)}},e.Body.prototype.Clear=function(){this.vertices=[],this.points=[],this.lines=[],this.polygons=[],this.projection=new e.BodyTextureProjection},e.Body.prototype.Clone=function(){var o,t=new e.Body;for(o=0;o<this.vertices.length;o++)t.AddVertex(this.vertices[o].Clone());for(o=0;o<this.points.length;o++)t.AddPoint(this.points[o].Clone());for(o=0;o<this.lines.length;o++)t.AddLine(this.lines[o].Clone());for(o=0;o<this.polygons.length;o++)t.AddPolygon(this.polygons[o].Clone());return t.SetTextureProjection(this.projection.Clone()),t},e}),e("skylark-jsmodeler/modeler/model",["../core/jsm"],function(e){return e.Model=function(){this.bodies=[],this.materials=new e.MaterialSet},e.Model.prototype.AddBody=function(e){return this.bodies.push(e),this.bodies.length-1},e.Model.prototype.AddBodies=function(e){var o,t;for(o=0;o<e.length;o++)t=e[o],this.AddBody(t)},e.Model.prototype.GetBody=function(e){return this.bodies[e]},e.Model.prototype.BodyCount=function(){return this.bodies.length},e.Model.prototype.AddMaterial=function(e){return this.materials.AddMaterial(e)},e.Model.prototype.GetMaterial=function(e){return this.materials.GetMaterial(e)},e.Model.prototype.GetDefaultMaterial=function(){return this.materials.GetDefaultMaterial()},e.Model.prototype.GetMaterialSet=function(){return this.materials},e.Model.prototype.MaterialCount=function(){return this.materials.Count()},e.Model.prototype.VertexCount=function(){var e,o=0;for(e=0;e<this.bodies.length;e++)o+=this.bodies[e].VertexCount();return o},e.Model.prototype.PolygonCount=function(){var e,o=0;for(e=0;e<this.bodies.length;e++)o+=this.bodies[e].PolygonCount();return o},e}),e("skylark-jsmodeler/modeler/adjacencyinfo",["../core/jsm"],function(e){return e.VertInfo=function(){this.edges=[],this.pgons=[]},e.EdgeInfo=function(){this.vert1=-1,this.vert2=-1,this.pgon1=-1,this.pgon2=-1},e.PolyEdgeInfo=function(){this.index=-1,this.reverse=!1},e.PgonInfo=function(){this.verts=[],this.pedges=[]},e.AdjacencyInfo=function(e){this.verts=null,this.edges=null,this.pgons=null,this.Calculate(e)},e.AdjacencyInfo.prototype.Calculate=function(o){function t(o,t,r){function n(o,t,r,n,i){var d,a,s=new e.PolyEdgeInfo;for(d=0;d<o.edges.length;d++)(a=o.edges[d]).vert1===r&&a.vert2===n?(s.index=d,s.reverse=!1):a.vert1===n&&a.vert2===r&&(s.index=d,s.reverse=!0);if(-1===s.index){var l=new e.EdgeInfo;l.vert1=r,l.vert2=n,l.pgon1=i,l.pgon2=-1,o.edges.push(l),s.index=o.edges.length-1,s.reverse=!1}else{var u=o.edges[s.index];-1===u.pgon1?u.pgon1=i:u.pgon1!==i&&-1===u.pgon2&&(u.pgon2=i)}!function(e,o,t,r,n,i){function d(e,o,t){-1==e.edges.indexOf(t)&&e.edges.push(t),-1==e.pgons.indexOf(o)&&e.pgons.push(o)}i.verts.push(t),i.pedges.push(n),d(e.verts[t],o,n.index),d(e.verts[r],o,n.index)}(o,i,r,n,s,t)}var i,d,a,s=t.GetPolygon(r),l=new e.PgonInfo,u=s.VertexIndexCount();for(i=0;i<u;i++)d=s.GetVertexIndex(i),a=s.GetVertexIndex(i<u-1?i+1:0),n(o,l,d,a,r);o.pgons.push(l)}var r,n,i;for(this.verts=[],this.edges=[],this.pgons=[],r=0;r<o.VertexCount();r++)n=this,void 0,i=new e.VertInfo,n.verts.push(i);for(r=0;r<o.PolygonCount();r++)t(this,o,r)},e.AdjacencyInfo.prototype.IsContourVertex=function(e){var o,t;for(o=0;o<e.edges.length;o++)if(t=e.edges[o],this.IsContourEdge(this.edges[t]))return!0;return!1},e.AdjacencyInfo.prototype.IsContourEdge=function(e){var o=this.GetEdgePolygonCount(e);return 1==o},e.AdjacencyInfo.prototype.GetEdgePolygonCount=function(e){var o=0;return-1!=e.pgon1&&(o+=1),-1!=e.pgon2&&(o+=2),o},e.AdjacencyInfo.prototype.GetAnotherPgonOfEdge=function(e,o){return-1!=e.pgon1&&e.pgon1!=o?e.pgon1:-1!=e.pgon2&&e.pgon2!=o?e.pgon2:-1},e.AdjacencyInfo.prototype.GetPolyEdgeStartVertex=function(e){return e.reverse?this.edges[e.index].vert2:this.edges[e.index].vert1},e.AdjacencyInfo.prototype.GetPolyEdgeEndVertex=function(e){return e.reverse?this.edges[e.index].vert1:this.edges[e.index].vert2},e.CalculateBodyVertexToPolygon=function(e){var o,t,r,n=[];for(o=0;o<e.VertexCount();o++)n.push([]);for(o=0;o<e.PolygonCount();o++)for(r=e.GetPolygon(o),t=0;t<r.VertexIndexCount();t++)n[r.GetVertexIndex(t)].push(o);return n},e.IsSolidBody=function(o){var t,r,n=new e.AdjacencyInfo(o);if(0===n.edges.length)return!1;for(t=0;t<n.edges.length;t++)if(-1===(r=n.edges[t]).pgon1||-1===r.pgon2)return!1;return!0},e.CheckSolidBody=function(o){var t,r,n,i,d,a,s,l,u,y=new e.AdjacencyInfo(o);for(t=0;t<y.edges.length;t++){if(-1===(n=y.edges[t]).pgon1||-1===n.pgon2)return!1;for(a=y.pgons[n.pgon1],d=!1,r=0;r<a.pedges.length;r++)if((i=a.pedges[r]).index==t){l=i.reverse,d=!0;break}if(!d)return!1;for(s=y.pgons[n.pgon2],d=!1,r=0;r<s.pedges.length;r++)if((i=s.pedges[r]).index==t){u=i.reverse,d=!0;break}if(!d)return!1;if(l==u)return!1}return!0},e.TraversePgonsAlongEdges=function(e,o,t){function r(e,o,t){var r,n,i,d=o.pgons[e];for(r=0;r<d.pedges.length;r++)n=o.edges[d.pedges[r].index],-1!=(i=o.GetAnotherPgonOfEdge(n,e))&&t.push(i)}for(var n,i={},d=[e];d.length>0;)n=d.pop(),i[n]||(i[n]=!0,t(n)&&r(n,o,d))},e}),e("skylark-jsmodeler/modeler/bodyutils",["../core/jsm"],function(e){return e.AddVertexToBody=function(o,t,r,n){return o.AddVertex(new e.BodyVertex(new e.Coord(t,r,n)))},e.AddPointToBody=function(o,t){return o.AddPoint(new e.BodyPoint(t))},e.AddLineToBody=function(o,t,r){return o.AddLine(new e.BodyLine(t,r))},e.AddPolygonToBody=function(o,t){return o.AddPolygon(new e.BodyPolygon(t))},e.CheckBody=function(e){var o,t,r,n,i,d=e.VertexCount();for(o=0;o<e.PointCount();o++)if((r=e.GetPoint(o)).GetVertexIndex()<0||r.GetVertexIndex()>=d)return!1;for(o=0;o<e.LineCount();o++){if((n=e.GetLine(o)).GetBegVertexIndex()<0||n.GetBegVertexIndex()>=d)return!1;if(n.GetEndVertexIndex()<0||n.GetEndVertexIndex()>=d)return!1}for(o=0;o<e.PolygonCount();o++){if((i=e.GetPolygon(o)).VertexIndexCount()<3)return!1;for(t=0;t<i.VertexIndexCount();t++)if(i.GetVertexIndex(t)<0||i.GetVertexIndex(t)>=d)return!1}return!0},e.CalculateBodyPolygonNormal=function(o,t){var r,n,i,d,a,s=o.GetPolygon(t),l=s.VertexIndexCount(),u=new e.Vector(0,0,0);if(l>=3)for(r=0;r<l;r++)n=r,i=(r+1)%l,d=o.GetVertexPosition(s.GetVertexIndex(n)),a=o.GetVertexPosition(s.GetVertexIndex(i)),u.x+=(d.y-a.y)*(d.z+a.z),u.y+=(d.z-a.z)*(d.x+a.x),u.z+=(d.x-a.x)*(d.y+a.y);return u.Normalize(),u},e.CalculateBodyPolygonNormals=function(o){var t,r=[];for(t=0;t<o.PolygonCount();t++)r.push(e.CalculateBodyPolygonNormal(o,t));return r},e.CalculateBodyVertexNormals=function(o){var t,r,n,i,d,a,s,l,u=[],y=e.CalculateBodyPolygonNormals(o),c=null;for(t=0;t<o.PolygonCount();t++)if(i=o.GetPolygon(t),u[t]=[],i.HasCurveGroup())for(null===c&&(c=e.CalculateBodyVertexToPolygon(o)),r=0;r<i.VertexIndexCount();r++){for(a=new e.Vector(0,0,0),s=0,l=c[i.GetVertexIndex(r)],n=0;n<l.length;n++)o.GetPolygon(l[n]).GetCurveGroup()===i.GetCurveGroup()&&(a=e.CoordAdd(a,y[l[n]]),s++);a.MultiplyScalar(1/s),a.Normalize(),u[t].push(a)}else for(d=y[t],r=0;r<i.VertexIndexCount();r++)u[t].push(new e.Vector(d.x,d.y,d.z));return u},e.CalculatePolygonCurveGroups=function(e,o){var t,r,n=[],i=e.VertexCount();for(t=0;t<i;t++)n.push(0);for(t=0;t<i;t++)r=n[e.GetPrevVertex(t)],e.GetVertexAngle(t)>o?n[t]=r:n[t]=r+1;var d=n[0],a=n[i-1];if(0===d&&d!=a)for(t=0;n[t]==d;t++)n[t]=a;return n},e.CalculatePolygonCentroid=function(o,t){var r,n=o.GetPolygon(t),i=n.VertexIndexCount(),d=new e.Coord(0,0,0);for(r=0;r<i;r++)d=e.CoordAdd(d,o.GetVertexPosition(n.GetVertexIndex(r)));return d.MultiplyScalar(1/i),d},e.MakeBodyInsideOut=function(e){var o;for(o=0;o<e.PolygonCount();o++)e.GetPolygon(o).ReverseVertexIndices()},e.SoftMoveBodyVertex=function(o,t,r,n,i){var d,a,s,l=o.GetVertexPosition(t).Clone(),u=i,y=e.GetGaussianCParameter(r,u,0,1e-5);for(d=0;d<o.VertexCount();d++)a=l.DistanceTo(o.GetVertex(d).position),e.IsGreater(a,r)||(s=e.GetGaussianValue(a,i,0,y),o.GetVertexPosition(d).Offset(n,s))},e.GenerateWireBody=function(o){var t,r=new e.Body;for(t=0;t<o.VertexCount();t++)r.AddVertex(o.GetVertex(t).Clone());var n,i=new e.AdjacencyInfo(o);for(t=0;t<i.edges.length;t++)n=i.edges[t],e.AddLineToBody(r,n.vert1,n.vert2);return r},e.TriangulateWithCentroids=function(o){var t,r,n,i,d,a,s,l,u,y=o.PolygonCount();for(t=0;t<y;t++)for(n=e.CalculatePolygonCentroid(o,t),i=o.AddVertex(new e.BodyVertex(n)),d=o.GetPolygon(t),a=d.VertexIndexCount(),r=0;r<a;r++)l=d.GetVertexIndex(r),u=d.GetVertexIndex(r<a-1?r+1:0),(s=new e.BodyPolygon([l,u,i])).InheritAttributes(d),o.AddPolygon(s);for(t=0;t<y;t++)o.RemovePolygon(0)},e.TriangulatePolygons=function(o){var t,r,n,i,d,a,s,l,u=o.PolygonCount();for(t=0;t<u;t++){for(n=o.GetPolygon(t),i=new e.Polygon,r=0;r<n.VertexIndexCount();r++)d=o.GetVertexPosition(n.GetVertexIndex(r)),i.AddVertex(d.x,d.y,d.z);if(null!==(a=e.TriangulatePolygon(i)))for(r=0;r<a.length;r++)s=a[r],(l=new e.BodyPolygon([n.GetVertexIndex(s[0]),n.GetVertexIndex(s[1]),n.GetVertexIndex(s[2])])).InheritAttributes(n),o.AddPolygon(l)}for(t=0;t<u;t++)o.RemovePolygon(0)},e.GenerateRandomMaterials=function(o,t,r){function n(o,t){return void 0!==o&&o?e.SeededRandomInt(0,16777215,t+1):e.RandomInt(0,16777215)}var i,d,a,s=0;for(i=0;i<o.LineCount();i++)d=n(r,s++),a=t.AddMaterial(new e.Material({ambient:d,diffuse:d})),o.GetLine(i).SetMaterialIndex(a);for(i=0;i<o.PointCount();i++)d=n(r,s++),a=t.AddMaterial(new e.Material({ambient:d,diffuse:d})),o.GetPoint(i).SetMaterialIndex(a);for(i=0;i<o.PolygonCount();i++)d=n(r,s++),a=t.AddMaterial(new e.Material({ambient:d,diffuse:d})),o.GetPolygon(i).SetMaterialIndex(a)},e.AddBodyToBSPTree=function(o,t,r){function n(o,t,r){var n=o.GetPolygon(t);r.material=n.GetMaterialIndex();var i,d,a=new e.Polygon;for(i=0;i<n.VertexIndexCount();i++)d=o.GetVertexPosition(n.GetVertexIndex(i)),a.AddVertex(d.x,d.y,d.z);return a}var i,d,a;for(i=0;i<o.PolygonCount();i++)d=n(o,i,a={id:r,originalPolygon:i,material:-1}),t.AddPolygon(d,a)},e}),e("skylark-jsmodeler/modeler/textureutils",["../core/jsm"],function(e){return e.CalculatePlanarTextureCoord=function(o,t){var r=new e.Coord2D(0,0),n=t.e1.Clone().Normalize(),i=t.e2.Clone().Normalize(),d=e.VectorCross(t.e1,t.e2),a=e.GetPlaneFromCoordAndDirection(t.origo,d),s=e.GetPlaneFromCoordAndDirection(t.origo,i),l=e.GetPlaneFromCoordAndDirection(t.origo,n),u=a.ProjectCoord(o);return r.x=l.CoordSignedDistance(u),r.y=s.CoordSignedDistance(u),r},e.CalculateCubicTextureCoord=function(o,t,r){var n,i,d,a=new e.Coord2D(0,0),s=r.e1.Clone().Normalize(),l=r.e2.Clone().Normalize(),u=r.e3.Clone().Normalize(),y=-1,c=0;for(n=0;n<3;n++)0===n?i=s:1===n?i=l:2===n&&(i=u),d=Math.abs(e.VectorDot(t,i)),e.IsGreater(d,c)&&(y=n,c=d);if(-1===y)return a;var h=null;return 0===y?h=new e.CoordSystem(r.origo,l,u,new e.Coord(0,0,0)):1===y?h=new e.CoordSystem(r.origo,s,u,new e.Coord(0,0,0)):2===y&&(h=new e.CoordSystem(r.origo,s,l,new e.Coord(0,0,0))),null===h?a:e.CalculatePlanarTextureCoord(o,h)},e.CalculateCylindricalTextureCoord=function(o,t,r){var n=new e.Coord2D(0,0),i=r.e3.Clone().Normalize();if(i.IsCollinearWith(t))return[n=e.CalculateCubicTextureCoord(o,t,r),0];var d=new e.Line(r.origo,i),a=d.ProjectCoord(o),s=e.CoordSignedDistance(r.origo,a,i),l=r.e1.Clone().Normalize(),u=e.CoordSub(o,a),y=e.GetVectorsFullAngle(u,l,i),c=r.e1.Length();return n.x=y*c,n.y=s,[n,y]},e.CalculatePolygonPlanarTextureCoords=function(o,t){var r,n,i=[],d=o.GetPolygon(t),a=o.GetTextureProjection().GetCoords();for(r=0;r<d.VertexIndexCount();r++)n=o.GetVertexPosition(d.GetVertexIndex(r)),i.push(e.CalculatePlanarTextureCoord(n,a));return i},e.CalculatePolygonCubicTextureCoords=function(o,t,r){var n,i,d=[],a=o.GetPolygon(t),s=o.GetTextureProjection().GetCoords();for(n=0;n<a.VertexIndexCount();n++)i=o.GetVertexPosition(a.GetVertexIndex(n)),d.push(e.CalculateCubicTextureCoord(i,r,s));return d},e.CalculatePolygonCylindricalTextureCoords=function(o,t,r){var n,i,d,a,s=[],l=[],u=o.GetPolygon(t),y=o.GetTextureProjection().GetCoords();for(n=0;n<u.VertexIndexCount();n++)d=o.GetVertexPosition(u.GetVertexIndex(n)),a=e.CalculateCylindricalTextureCoord(d,r,y),s.push(a[0]),l.push(a[1]);var c=y.e3.Clone().Normalize();if(c.IsCollinearWith(r))return s;var h=!1;for(n=0;n<l.length;n++){for(i=n+1;i<l.length;i++)if(e.IsGreater(Math.abs(l[n]-l[i]),Math.PI)){h=!0;break}if(h)break}if(h){var f=y.e1.Length();for(n=0;n<l.length;n++)e.IsLower(l[n],Math.PI)&&(s[n].x=f*(l[n]+2*Math.PI))}return s},e.CalculateBodyPlanarTextureCoords=function(o){var t,r=[];for(t=0;t<o.PolygonCount();t++)r.push(e.CalculatePolygonPlanarTextureCoords(o,t));return r},e.CalculateBodyCubicTextureCoords=function(o){var t,r,n=[],i=e.CalculateBodyPolygonNormals(o);for(t=0;t<o.PolygonCount();t++)r=i[t],n.push(e.CalculatePolygonCubicTextureCoords(o,t,r));return n},e.CalculateBodyCylindricalTextureCoords=function(o){var t,r,n=[],i=e.CalculateBodyPolygonNormals(o);for(t=0;t<o.PolygonCount();t++)r=i[t],n.push(e.CalculatePolygonCylindricalTextureCoords(o,t,r));return n},e.CalculateBodyTextureCoords=function(o){var t=[],r=o.GetTextureProjection().GetType();return r===e.TextureProjectionType.Planar?t=e.CalculateBodyPlanarTextureCoords(o):r===e.TextureProjectionType.Cubic?t=e.CalculateBodyCubicTextureCoords(o):r===e.TextureProjectionType.Cylindrical&&(t=e.CalculateBodyCylindricalTextureCoords(o)),t},e}),e("skylark-jsmodeler/modeler/cututils",["../core/jsm"],function(e){return e.CutBodyByPlane=function(o,t){function r(o,t,r){function n(o,t,r,n){r.push(new e.Coord(t.x,t.y,t.z)),n.push(o)}function i(r,n,i,d){var a=e.CoordSub(o[n],o[r]).Normalize(),s=new e.Line(o[r],a),l=t.LineIntersection(s);i.push(new e.Coord(l.x,l.y,l.z)),d.push(-1)}var d,a,s,l=void 0!==r&&null!==r,u=o.length,y=[],c=[],h=!1;for(d=0;d<u;d++)s=o[d],a=t.CoordPosition(s),c.push(a!==e.CoordPlanePosition.CoordAtBackOfPlane),d>0&&c[d-1]!==c[d]&&(h=!0);if(!h){if(!1===c[0])return y;for(d=0;d<u;d++)s=o[d],y.push(new e.Coord(s.x,s.y,s.z)),l&&r.push(d);return y}var f,g,x,p,T,C,v=[],A=[];for(d=0;d<u;d++)f=d-1,g=d,0===d&&(f=u-1),s=o[g],c[g]?(c[f]||i(f,g,v,A),n(g,s,v,A)):c[f]&&i(f,g,v,A);for(d=0;d<v.length;d++)x=v[d],T=y[y.length-1],0!==d&&T.IsEqual(x)?l&&(C=A[d-1],-1!==(p=A[d])?r[r.length-1]=p:-1!==C&&(r[r.length-1]=C)):(y.push(new e.Coord(x.x,x.y,x.z)),l&&(p=A[d],r.push(p)));return y}function n(o,t,r){var n,i=-1;for(n=r;n<o.VertexCount();n++)if(t.IsEqual(o.GetVertexPosition(n))){i=n;break}return-1===i&&(i=o.AddVertex(new e.BodyVertex(new e.Coord(t.x,t.y,t.z)))),i}var i,d,a,s,l,u,y,c,h=new e.Body,f=[],g=[],x=[],p=[];for(i=0;i<o.PolygonCount();i++){for(a=o.GetPolygon(i),s=[],d=0;d<a.VertexIndexCount();d++)l=o.GetVertexPosition(a.GetVertexIndex(d)),s.push(new e.Coord(l.x,l.y,l.z));for(u=r(s,t,y=[]),d=0;d<y.length;d++)-1!==y[d]&&(x[a.GetVertexIndex(y[d])]=!0);f.push(u),g.push(y)}for(i=0;i<o.VertexCount();i++)x[i]&&(c=o.GetVertexPosition(i),p[i]=h.AddVertex(new e.BodyVertex(new e.Coord(c.x,c.y,c.z))));var T,C,v=h.VertexCount();for(i=0;i<o.PolygonCount();i++)if(a=o.GetPolygon(i),u=f[i],0!==(y=g[i]).length){for(C=[],d=0;d<y.length;d++)-1!==y[d]?C.push(p[a.GetVertexIndex(y[d])]):(c=u[d],C.push(n(h,c,v)));(T=new e.BodyPolygon(C)).InheritAttributes(a),h.AddPolygon(T)}return h},e}),e("skylark-jsmodeler/modeler/generator",["../core/jsm"],function(e){return e.GenerateRectangle=function(o,t){var r=new e.Body,n=o/2,i=t/2;return r.AddVertex(new e.BodyVertex(new e.Coord(-n,-i,0))),r.AddVertex(new e.BodyVertex(new e.Coord(n,-i,0))),r.AddVertex(new e.BodyVertex(new e.Coord(n,i,0))),r.AddVertex(new e.BodyVertex(new e.Coord(-n,i,0))),r.AddPolygon(new e.BodyPolygon([0,1,2,3])),r.SetCubicTextureProjection(new e.Coord(-n,-i,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),r},e.GenerateCuboid=function(o,t,r){var n=new e.Body,i=o/2,d=t/2,a=r/2;return n.AddVertex(new e.BodyVertex(new e.Coord(-i,-d,-a))),n.AddVertex(new e.BodyVertex(new e.Coord(i,-d,-a))),n.AddVertex(new e.BodyVertex(new e.Coord(i,-d,a))),n.AddVertex(new e.BodyVertex(new e.Coord(-i,-d,a))),n.AddVertex(new e.BodyVertex(new e.Coord(-i,d,-a))),n.AddVertex(new e.BodyVertex(new e.Coord(i,d,-a))),n.AddVertex(new e.BodyVertex(new e.Coord(i,d,a))),n.AddVertex(new e.BodyVertex(new e.Coord(-i,d,a))),n.AddPolygon(new e.BodyPolygon([0,1,2,3])),n.AddPolygon(new e.BodyPolygon([1,5,6,2])),n.AddPolygon(new e.BodyPolygon([5,4,7,6])),n.AddPolygon(new e.BodyPolygon([4,0,3,7])),n.AddPolygon(new e.BodyPolygon([0,4,5,1])),n.AddPolygon(new e.BodyPolygon([3,2,6,7])),n.SetCubicTextureProjection(new e.Coord(-i,-d,-a),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),n},e.GenerateCuboidSides=function(o,t,r,n){var i=new e.Body,d=o/2,a=t/2,s=r/2;return i.AddVertex(new e.BodyVertex(new e.Coord(-d,-a,-s))),i.AddVertex(new e.BodyVertex(new e.Coord(d,-a,-s))),i.AddVertex(new e.BodyVertex(new e.Coord(d,-a,s))),i.AddVertex(new e.BodyVertex(new e.Coord(-d,-a,s))),i.AddVertex(new e.BodyVertex(new e.Coord(-d,a,-s))),i.AddVertex(new e.BodyVertex(new e.Coord(d,a,-s))),i.AddVertex(new e.BodyVertex(new e.Coord(d,a,s))),i.AddVertex(new e.BodyVertex(new e.Coord(-d,a,s))),n[0]&&i.AddPolygon(new e.BodyPolygon([0,1,2,3])),n[1]&&i.AddPolygon(new e.BodyPolygon([1,5,6,2])),n[2]&&i.AddPolygon(new e.BodyPolygon([5,4,7,6])),n[3]&&i.AddPolygon(new e.BodyPolygon([4,0,3,7])),n[4]&&i.AddPolygon(new e.BodyPolygon([0,4,5,1])),n[5]&&i.AddPolygon(new e.BodyPolygon([3,2,6,7])),i.SetCubicTextureProjection(new e.Coord(-d,-a,-s),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),i},e.GenerateSegmentedRectangle=function(o,t,r,n){var i=new e.Body,d=o/2,a=t/2,s=o/r,l=t/n;return function(){var o,t,u;for(o=0;o<=n;o++)for(t=0;t<=r;t++)u=new e.Coord(t*s-d,o*l-a,0),i.AddVertex(new e.BodyVertex(u))}(),function(){var o,t,d,a,s,l;for(t=0;t<n;t++)for(o=0;o<r;o++)a=(d=t*(r+1)+o)+1,l=(s=d+r+1)+1,i.AddPolygon(new e.BodyPolygon([d,a,l,s]))}(),i},e.GenerateSegmentedCuboid=function(o,t,r,n){function i(e){var o=0;return e>0&&e<=n&&(o=(n+1)*(n+1)+4*n*(e-1)),o}function d(e){var o,t=[],r=i(e);if(0===e||e===n){for(o=0;o<=n;o++)t.push(r+o);for(o=1;o<=n;o++)t.push(r+(o+1)*n+o);for(o=n-1;o>=0;o--)t.push(r+(n+1)*n+o);for(o=n-1;o>0;o--)t.push(r+o*(n+1))}else if(e>0&&e<n){for(o=0;o<=n;o++)t.push(r+o);for(o=1;o<n;o++)t.push(r+n+2*o);for(o=n;o>=0;o--)t.push(r+3*n+o-1);for(o=n-1;o>0;o--)t.push(r+n+2*o-1)}return t}function a(o){var t,r,i,d=o*x;if(0===o||o===n)for(t=0;t<=n;t++)for(r=0;r<=n;r++)i=new e.Coord(r*f-y,t*g-c,d-h),u.AddVertex(new e.BodyVertex(i));else if(o>0&&o<n)for(t=0;t<=n;t++)for(r=0;r<=n;r++)0!==t&&t!==n&&0!==r&&r!==n||(i=new e.Coord(r*f-y,t*g-c,d-h),u.AddVertex(new e.BodyVertex(i)))}function s(o){var t,r,d,a,s,l;if(0===o||o===n){var y=i(o);for(t=0;t<n;t++)for(r=0;r<n;r++)a=(d=y+t*(n+1)+r)+1,l=(s=d+n+1)+1,0===o?u.AddPolygon(new e.BodyPolygon([d,s,l,a])):u.AddPolygon(new e.BodyPolygon([d,a,l,s]))}if(o>0&&o<=n){var c=p[o-1],h=p[o];for(t=0;t<4*n;t++)d=c[t],s=h[t],t<4*n-1?(a=c[t+1],l=h[t+1]):(a=c[0],l=h[0]),u.AddPolygon(new e.BodyPolygon([d,a,l,s]))}}var l,u=new e.Body,y=o/2,c=t/2,h=r/2,f=o/n,g=t/n,x=r/n;for(l=0;l<=n;l++)a(l);var p=[];for(l=0;l<=n;l++)p.push(d(l));for(l=0;l<=n;l++)s(l);return u},e.GenerateCircle=function(o,t){var r,n=new e.Body,i=t,d=(Math.PI,2*Math.PI/i),a=e.GenerateCirclePoints(o,t);for(r=0;r<a.length;r++)n.AddVertex(new e.BodyVertex(a[r])),d;var s=new e.BodyPolygon([]);for(r=0;r<i;r++)s.AddVertexIndex(r);return n.AddPolygon(s),n.SetCylindricalTextureProjection(new e.Coord(0,0,0),o,new e.Coord(1,0,0),new e.Coord(0,0,1)),n},e.GenerateSphere=function(o,t,r){var n,i,d,a=new e.Body,s=t,l=2*s,u=a.AddVertex(new e.BodyVertex(e.SphericalToCartesian(o,0,0))),y=Math.PI/s,c=y;for(n=1;n<s;n++){for(d=0,i=0;i<l;i++)a.AddVertex(new e.BodyVertex(e.SphericalToCartesian(o,c,d))),d+=y;c+=y}var h,f,g,x,p,T,C=a.AddVertex(new e.BodyVertex(e.SphericalToCartesian(-o,0,0)));for(n=1;n<=s;n++)if(1===n)for(h=1,i=0;i<l;i++)g=(f=h+i)+1,i===l-1&&(g=h),T=new e.BodyPolygon([f,g,u]),r&&T.SetCurveGroup(0),a.AddPolygon(T);else if(n<s)for(h=(n-1)*l+1,i=0;i<l;i++)g=(f=h+i)+1,p=(x=f-l)+1,i===l-1&&(g=h,p=h-l),T=new e.BodyPolygon([f,g,p,x]),r&&T.SetCurveGroup(0),a.AddPolygon(T);else if(n===s)for(h=(n-2)*l+1,i=0;i<l;i++)g=(f=h+i)+1,i===l-1&&(g=h),T=new e.BodyPolygon([f,C,g]),r&&T.SetCurveGroup(0),a.AddPolygon(T);return a.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),a},e.GenerateTriangulatedSphere=function(o,t,r){var n,i,d,a,s,l,u,y,c,h,f,g,x=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2;return e.AddVertexToBody(o,0,1,+t),e.AddVertexToBody(o,0,1,-t),e.AddVertexToBody(o,0,-1,+t),e.AddVertexToBody(o,0,-1,-t),e.AddVertexToBody(o,1,+t,0),e.AddVertexToBody(o,1,-t,0),e.AddVertexToBody(o,-1,+t,0),e.AddVertexToBody(o,-1,-t,0),e.AddVertexToBody(o,+t,0,1),e.AddVertexToBody(o,-t,0,1),e.AddVertexToBody(o,+t,0,-1),e.AddVertexToBody(o,-t,0,-1),e.AddPolygonToBody(o,[0,2,8]),e.AddPolygonToBody(o,[0,4,6]),e.AddPolygonToBody(o,[0,6,9]),e.AddPolygonToBody(o,[0,8,4]),e.AddPolygonToBody(o,[0,9,2]),e.AddPolygonToBody(o,[1,3,11]),e.AddPolygonToBody(o,[1,4,10]),e.AddPolygonToBody(o,[1,6,4]),e.AddPolygonToBody(o,[1,10,3]),e.AddPolygonToBody(o,[1,11,6]),e.AddPolygonToBody(o,[2,5,8]),e.AddPolygonToBody(o,[2,7,5]),e.AddPolygonToBody(o,[2,9,7]),e.AddPolygonToBody(o,[3,5,7]),e.AddPolygonToBody(o,[3,7,11]),e.AddPolygonToBody(o,[3,10,5]),e.AddPolygonToBody(o,[4,8,10]),e.AddPolygonToBody(o,[6,11,9]),e.AddPolygonToBody(o,[5,10,8]),e.AddPolygonToBody(o,[7,9,11]),o}(),p=x.GetVertexPosition(0).Length(),T=o/p;for(n=0;n<x.VertexCount();n++)x.GetVertex(n).position.MultiplyScalar(T);for(d=0;d<t;d++){for(s=x,x=new e.Body,l=new e.AdjacencyInfo(s),n=0;n<l.verts.length;n++)a=s.GetVertexPosition(n),e.AddVertexToBody(x,a.x,a.y,a.z);for(y=[],n=0;n<l.edges.length;n++)u=l.edges[n],f=e.MidCoord(s.GetVertexPosition(u.vert1),s.GetVertexPosition(u.vert2)),y.push(x.AddVertex(new e.BodyVertex(f.SetLength(o))));for(n=0;n<l.pgons.length;n++){for(c=l.pgons[n],h=[],i=0;i<c.pedges.length;i++)g=c.pedges[i],h.push(l.GetPolyEdgeStartVertex(g)),h.push(y[g.index]);e.AddPolygonToBody(x,[h[0],h[1],h[5]]),e.AddPolygonToBody(x,[h[1],h[2],h[3]]),e.AddPolygonToBody(x,[h[3],h[4],h[5]]),e.AddPolygonToBody(x,[h[1],h[3],h[5]])}}if(r)for(n=0;n<x.PolygonCount();n++)x.GetPolygon(n).SetCurveGroup(0);return x.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),x},e.GenerateCylinder=function(o,t,r,n,i){var d,a,s,l,u=new e.Body,y=r,c=2*Math.PI,h=2*Math.PI/y;for(d=0;d<y;d++)u.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(o,t/2,c))),u.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(o,-t/2,c))),c-=h;for(d=0;d<y;d++)s=(a=2*d)+2,d===y-1&&(s=0),l=new e.BodyPolygon([a,s,s+1,a+1]),i&&l.SetCurveGroup(0),u.AddPolygon(l);if(n){var f=new e.BodyPolygon([]),g=new e.BodyPolygon([]);for(d=0;d<y;d++)f.AddVertexIndex(2*(y-d-1)),g.AddVertexIndex(2*d+1);u.AddPolygon(f),u.AddPolygon(g)}return u.SetCylindricalTextureProjection(new e.Coord(0,0,-t/2),o,new e.Coord(1,0,0),new e.Coord(0,0,1)),u},e.GeneratePie=function(o,t,r,n,i,d){var a,s,l,u,y=new e.Body,c=n,h=r,f=r/(c-1);for(y.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(0,t/2,0))),y.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(0,-t/2,0))),a=0;a<c;a++)y.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(o,t/2,h))),y.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(o,-t/2,h))),h-=f;for(a=0;a<=c;a++)l=(s=2*a)+2,a===c&&(l=0),u=new e.BodyPolygon([s,l,l+1,s+1]),d&&a>0&&a<c&&u.SetCurveGroup(0),y.AddPolygon(u);if(i){var g=new e.BodyPolygon([]),x=new e.BodyPolygon([]);for(a=0;a<=c;a++)g.AddVertexIndex(2*(c-a)),x.AddVertexIndex(2*a+1);y.AddPolygon(g),y.AddPolygon(x)}return y.SetCylindricalTextureProjection(new e.Coord(0,0,-t/2),o,new e.Coord(1,0,0),new e.Coord(0,0,1)),y},e.GenerateCone=function(o,t,r,n,i,d){var a,s,l,u,y,c,h=new e.Body,f=n,g=e.IsZero(o),x=e.IsZero(t),p=2*Math.PI,T=2*Math.PI/f;for(g&&h.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(0,r/2,0))),a=0;a<f;a++)g||h.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(o,r/2,p))),x||h.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(t,-r/2,p))),p-=T;for(x&&h.AddVertex(new e.BodyVertex(e.CylindricalToCartesian(0,-r/2,0))),a=0;a<f;a++)g?(l=(s=a+1)+1,a===f-1&&(l=1),u=new e.BodyPolygon([0,l,s]),d&&u.SetCurveGroup(0),h.AddPolygon(u)):x?(l=(s=a)+1,a===f-1&&(l=0),u=new e.BodyPolygon([s,l,f]),d&&u.SetCurveGroup(0),h.AddPolygon(u)):(l=(s=2*a)+2,a===f-1&&(l=0),u=new e.BodyPolygon([s,l,l+1,s+1]),d&&u.SetCurveGroup(0),h.AddPolygon(u));if(i)if(g){for(c=new e.BodyPolygon([]),a=0;a<f;a++)c.AddVertexIndex(a+1);h.AddPolygon(c)}else if(x){for(y=new e.BodyPolygon([]),a=0;a<f;a++)y.AddVertexIndex(f-a-1);h.AddPolygon(y)}else{for(y=new e.BodyPolygon([]),c=new e.BodyPolygon([]),a=0;a<f;a++)y.AddVertexIndex(2*(f-a-1)),c.AddVertexIndex(2*a+1);h.AddPolygon(y),h.AddPolygon(c)}var C=(o+t)/2;return h.SetCylindricalTextureProjection(new e.Coord(0,0,-r/2),C,new e.Coord(1,0,0),new e.Coord(0,0,1)),h},e.GeneratePrismGeometry=function(o,t,r){var n,i,d,a,s=new e.Body,l=o.length;for(n=0;n<l;n++)s.AddVertex(new e.BodyVertex(o[n].Clone())),s.AddVertex(new e.BodyVertex(t[n].Clone()));for(n=0;n<l;n++)d=(i=2*n)+2,n===l-1&&(d=0),a=new e.BodyPolygon([i,d,d+1,i+1]),s.AddPolygon(a);if(r){var u=new e.BodyPolygon([]),y=new e.BodyPolygon([]);for(n=0;n<l;n++)u.AddVertexIndex(2*n+1),y.AddVertexIndex(2*(l-n-1));s.AddPolygon(u),s.AddPolygon(y)}return s},e.GeneratePrismFromPolygon=function(o,t,r,n){var i,d,a=[],s=[],l=o.VertexCount();for(i=0;i<l;i++)d=o.GetVertex(i),a.push(new e.Coord(d.x,d.y,0)),s.push(new e.Coord(d.x,d.y,t));var u=e.GeneratePrismGeometry(a,s,r);if(void 0!==n&&null!==n){var y=e.CalculatePolygonCurveGroups(o,n);for(i=0;i<l;i++)u.GetPolygon(i).SetCurveGroup(y[i])}var c=a[0].Clone(),h=a[1].Clone(),f=e.CoordSub(h,c).Normalize(),g=new e.Vector(0,0,1),x=e.VectorCross(g,f),p=e.VectorCross(x,g);return u.SetCubicTextureProjection(c,p,x,g),u},e.GeneratePrism=function(o,t,r,n,i){var d=new e.Polygon;d.FromArray(o);var a,s=d.VertexCount(),l=[],u=[];for(a=0;a<s;a++)l.push(d.GetVertex(a).Clone()),u.push(d.GetVertex(a).Clone().Offset(t,r));var y=e.GeneratePrismGeometry(l,u,n);if(void 0!==i&&null!==i){var c=e.CalculatePolygonCurveGroups(d,i);for(a=0;a<s;a++)y.GetPolygon(a).SetCurveGroup(c[a])}var h=d.GetVertex(0).Clone(),f=d.GetVertex(1).Clone(),g=e.CoordSub(f,h).Normalize(),x=t.Clone().Normalize(),p=e.VectorCross(x,g),T=e.VectorCross(p,x);return y.SetCubicTextureProjection(h,T,p,x),y},e.GeneratePrismWithHole=function(o,t,r,n,i){var d=new e.Body,a=[],s=new e.ContourPolygon;s.FromArray(o),function(o,t,r,n){var i,d,a,s,l;for(i=0;i<o.ContourCount();i++)for(a=o.GetContour(i),d=0;d<a.VertexCount();d++)s=a.GetVertex(d).Clone(),l=a.GetVertex(d).Clone().Offset(t,r),n.AddVertex(new e.BodyVertex(s)),n.AddVertex(new e.BodyVertex(l))}(s,t,r,d),function(o,t,r,n){var i,d,a,s,l,u,y,c,h=0;for(i=0;i<o.ContourCount();i++){for(a=o.GetContour(i),c=null,void 0!==r&&null!==r&&(c=e.CalculatePolygonCurveGroups(a,r)),s=a.VertexCount(),t.push(h),d=0;d<s;d++)u=(l=2*h+2*d)+2,d==s-1&&(u=2*h),y=new e.BodyPolygon([l,u,u+1,l+1]),null!==c&&y.SetCurveGroup(c[d]),n.AddPolygon(y);h+=s}}(s,a,i,d),n&&function(o,t){var r=[],n=o.ToContourPolygon2D(),i=e.ConvertContourPolygonToPolygon2D(n,r);if(null===i)return;var a,s,l,u,y,c,h=e.TriangulatePolygon2D(i);if(null===h)return;for(a=0;a<h.length;a++){for(l=h[a],y=new e.BodyPolygon([]),c=new e.BodyPolygon([]),s=0;s<3;s++)u=r[l[s]],y.AddVertexIndex(2*t[u[0]]+2*u[1]+1),u=r[l[2-s]],c.AddVertexIndex(2*t[u[0]]+2*u[1]);d.AddPolygon(y),d.AddPolygon(c)}}(s,a);var l=e.CoordSub(o[1],o[0]).Normalize(),u=new e.Coord(o[0].x,o[0].y,o[0].z),y=t.Clone().Normalize(),c=e.VectorCross(y,l),h=e.VectorCross(c,y);return d.SetCubicTextureProjection(u,h,c,y),d},e.GeneratePrismsFromPath2D=function(o,t,r,n){function i(o){var t,r,n,i,d=[];for(t=0;t<o.ContourCount();t++){for(n=o.GetContour(t),r=0;r<n.VertexCount();r++)i=n.GetVertex(r),d.push(new e.Coord(i.x,i.y,0));t<o.ContourCount()-1&&d.push(null)}return d}var d,a,s=[],l=o.GetPolygons(),u=new e.Vector(0,0,1);for(d=0;d<l.length;d++)1===(a=l[d]).ContourCount()?s.push(e.GeneratePrism(i(a),u,t,r,n)):a.ContourCount()>1&&s.push(e.GeneratePrismWithHole(i(a),u,t,r,n));return s},e.GeneratePrismShell=function(o,t,r,n,i){var d,a=new e.Body,s=o.length;for(d=0;d<s;d++)a.AddVertex(new e.BodyVertex(o[d]));var l=new e.Polygon;l.vertices=o;var u,y,c,h,f,g=e.OffsetPolygonContour(l,n),x=g.vertices;for(d=0;d<s;d++)a.AddVertex(new e.BodyVertex(x[d]));for(d=0;d<s;d++)u=o[d].Clone().Offset(t,r),a.AddVertex(new e.BodyVertex(u));for(d=0;d<s;d++)u=x[d].Clone().Offset(t,r),a.AddVertex(new e.BodyVertex(u));for(d=0;d<s;d++)c=(y=d)+1,f=(h=y+2*s)+1,d===s-1&&(c=0,f=2*s),a.AddPolygon(new e.BodyPolygon([y,c,f,h])),a.AddPolygon(new e.BodyPolygon([y+s,h+s,f+s,c+s]));if(i)for(d=0;d<s;d++)c=(y=d)+1,f=(h=d+s)+1,d===s-1&&(c=0,f=s),a.AddPolygon(new e.BodyPolygon([y,h,f,c])),a.AddPolygon(new e.BodyPolygon([y+2*s,c+2*s,f+2*s,h+2*s]));var p=e.CoordSub(o[1],o[0]).Normalize(),T=new e.Coord(o[0].x,o[0].y,o[0].z),C=t.Clone().Normalize(),v=e.VectorCross(C,p),A=e.VectorCross(v,C);return a.SetCubicTextureProjection(T,A,v,C),a},e.GenerateCylinderShell=function(o,t,r,n,i,d){var a,s=new e.Vector(0,0,1),l=function(o,t,r){var n,i,d=[],a=2*Math.PI/t,s=0;for(s=0;s<t;s++)n=s*a,i=e.PolarToCartesian(o,n),d.push(new e.Coord(i.x,i.y,r));return d}(o,n,-t/2),u=e.GeneratePrismShell(l,s,t,r,i);if(d)for(a=0;a<n;a++)u.GetPolygon(2*a).SetCurveGroup(0),u.GetPolygon(2*a+1).SetCurveGroup(0);return u},e.GenerateLineShell=function(o,t,r,n,i,d){var a,s,l,u,y,c,h,f=new e.Body,g=o.length,x=[];for(a=0;a<g;a++)0===a||a===g-1?h=Math.PI/2:(s=a-1,l=a,u=a+1,c=e.CoordSub(o[u],o[l]),y=e.CoordSub(o[s],o[l]),h=c.AngleTo(y)/2,e.CoordOrientation(o[s],o[l],o[u],t)==e.Orientation.Clockwise&&(h=Math.PI-h)),x.push(h);var p,T,C,v,A,m,B=new e.Vector(0,0,1),P=[];for(a=0;a<g;a++)l=a,a===g-1?C=e.CoordSub(o[l-1],o[l]):(u=(a+1)%g,C=e.CoordSub(o[l],o[u])),h=x[l],p=n/Math.sin(h),(T=o[l].Clone()).Offset(C,p),T.Rotate(B,-(Math.PI-h),o[l]),P.push(T);for(a=0;a<g;a++)f.AddVertex(new e.BodyVertex(o[a]));for(a=0;a<g;a++)f.AddVertex(new e.BodyVertex(P[a]));for(a=0;a<g;a++)v=o[a].Clone().Offset(t,r),f.AddVertex(new e.BodyVertex(v));for(a=0;a<g;a++)v=P[a].Clone().Offset(t,r),f.AddVertex(new e.BodyVertex(v));for(a=0;a<g-1;a++)u=(l=a)+1,m=(A=l+2*g)+1,f.AddPolygon(new e.BodyPolygon([l,u,m,A])),f.AddPolygon(new e.BodyPolygon([l+g,A+g,m+g,u+g]));if(i&&(u=(l=0)+g,A=l+2*g,m=l+3*g,f.AddPolygon(new e.BodyPolygon([l,A,m,u])),u=(l=g-1)+g,A=l+2*g,m=l+3*g,f.AddPolygon(new e.BodyPolygon([l,u,m,A]))),d)for(a=0;a<g-1;a++)u=(l=a)+1,m=(A=a+g)+1,f.AddPolygon(new e.BodyPolygon([l,A,m,u])),f.AddPolygon(new e.BodyPolygon([l+2*g,u+2*g,m+2*g,A+2*g]));var V=e.CoordSub(o[1],o[0]).Normalize(),w=new e.Coord(o[0].x,o[0].y,o[0].z),S=t.Clone().Normalize(),G=e.VectorCross(S,V),I=e.VectorCross(G,S);return f.SetCubicTextureProjection(w,I,G,S),f},e.GenerateTorus=function(o,t,r,n,i){var d,a,s,l=new e.Body,u=0,y=2*Math.PI/n,c=[];for(d=0;d<n;d++)a=e.PolarToCartesian(t,u),s=new e.Coord(a.x+o,0,a.y),c.push(s),u+=y;var h,f,g,x,p,T,C,v=new e.Coord(0,0,1),A=new e.Coord(0,0,0);for(y=2*Math.PI/r,d=0;d<r;d++)for(h=0;h<n;h++)f=c[h].Clone().Rotate(v,d*y,A),l.AddVertex(new e.BodyVertex(f));for(d=0;d<r;d++)for(g=new e.BodyPolygon([]),h=0;h<n;h++)p=(x=d*n+h)+1,C=(T=x+n)+1,h===n-1&&(p=d*n,C=(d+1)*n),d===r-1&&(T=h,C=h+1,h===n-1&&(C=0)),g=new e.BodyPolygon([x,T,C,p]),i&&g.SetCurveGroup(0),l.AddPolygon(g);return l.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),l},e.GeneratePolyTorus=function(o,t,r,n){var i,d,a,s=new e.Body,l=o.length,u=(Math.PI,2*Math.PI/l),y=[];for(i=0;i<l;i++)d=o[i],a=new e.Coord(d.x+t,0,d.y),y.push(a),u;var c,h,f,g,x,p,T,C=new e.Coord(0,0,1),v=new e.Coord(0,0,0);for(u=2*Math.PI/r,i=0;i<r;i++)for(c=0;c<l;c++)h=y[c].Clone().Rotate(C,i*u,v),s.AddVertex(new e.BodyVertex(h));for(i=0;i<r;i++)for(f=new e.BodyPolygon([]),c=0;c<l;c++)x=(g=i*l+c)+1,T=(p=g+l)+1,c===l-1&&(x=i*l,T=(i+1)*l),i===r-1&&(p=c,T=c+1,c===l-1&&(T=0)),f=new e.BodyPolygon([g,p,T,x]),n&&f.SetCurveGroup(c),s.AddPolygon(f);return s.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),s},e.GenerateRuledFromSectors=function(o,t,r,n,i){var d,a,s,l=new e.Body,u=e.GetSectorSegmentation(o,r),y=e.GetSectorSegmentation(t,r),c=[],h=[];for(e.GetRuledMesh(u,y,n,c,h),d=0;d<c.length;d++)l.AddVertex(new e.BodyVertex(c[d]));for(d=0;d<h.length;d++)s=h[d],a=new e.BodyPolygon(s),i&&a.SetCurveGroup(0),l.AddPolygon(a);return l.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),l},e.GenerateGrid=function(o,t,r,n,i){var d=new e.Sector(new e.Coord(0,0,0),new e.Coord(o,0,0)),a=new e.Sector(new e.Coord(0,t,0),new e.Coord(o,t,0));return e.GenerateRuledFromSectors(d,a,r,n,i)},e.GenerateSquareGrid=function(o,t,r){return e.GenerateGrid(o,o,t,t,r)},e.GenerateRuledFromSectorsWithHeight=function(o,t,r,n,i,d){var a,s,l,u=new e.Body,y=e.GetSectorSegmentation(o,r),c=e.GetSectorSegmentation(t,r),h=[],f=[];for(e.GetRuledMesh(y,c,n,h,f),a=0;a<h.length;a++)u.AddVertex(new e.BodyVertex(h[a]));for(a=0;a<f.length;a++)l=f[a],s=new e.BodyPolygon(l),i&&s.SetCurveGroup(0),u.AddPolygon(s);var g,x,p,T,C,v,A,m,B=u.VertexCount();for(a=0;a<h.length;a++)x=h[a],(g=new e.Coord(x.x,x.y,x.z)).z-=d,u.AddVertex(new e.BodyVertex(g));for(a=0;a<f.length;a++){for(T=[],p=(l=f[a]).length-1;p>=0;p--)T.push(l[p]+B);s=new e.BodyPolygon(T),i&&s.SetCurveGroup(0),u.AddPolygon(s)}for(a=0;a<n;a++)v=(C=a+B)+1,m=(A=C-B)+1,s=new e.BodyPolygon([C,v,m,A]),u.AddPolygon(s);for(a=0;a<n;a++)v=(C=a+r*(n+1)+B)+1,m=(A=C-B)+1,s=new e.BodyPolygon([C,A,m,v]),u.AddPolygon(s);for(a=0;a<r;a++)v=(C=a*(n+1)+B)+n+1,m=(A=C-B)+n+1,s=new e.BodyPolygon([C,A,m,v]),u.AddPolygon(s);for(a=0;a<r;a++)v=(C=(a+1)*n+a+B)+n+1,m=(A=C-B)+n+1,s=new e.BodyPolygon([C,v,m,A]),u.AddPolygon(s);return u.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),u},e.GenerateRuledFromCoords=function(o,t,r,n){var i,d,a=new e.Body,s=[],l=[];for(e.GetRuledMesh(o,t,r,s,l),i=0;i<s.length;i++)a.AddVertex(new e.BodyVertex(s[i]));for(i=0;i<l.length;i++)s=l[i],d=new e.BodyPolygon(s),n&&d.SetCurveGroup(0),a.AddPolygon(d);return a.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),a},e.GenerateRevolved=function(o,t,r,n,i,d){var a,s,l,u=new e.Body,y=e.IsEqual(r,2*Math.PI),c=o.length,h=r/n,f=e.CoordSub(t.end,t.beg);for(a=0;a<c;a++)for(s=0;s<=n;s++)y&&s===n||(l=o[a].Clone().Rotate(f,s*h,t.beg),u.AddVertex(new e.BodyVertex(l)));var g,x,p,T,C,v=0;for("CurveSegments"==d?v=1:"CurveAll"==d&&(v=2),a=0;a<c-1;a++)for(s=0;s<n;s++)p=(g=a*(n+1)+s)+1,T=(x=g+n+1)+1,y&&(p=(g=a*n+s)+1,T=(x=g+n)+1,s===n-1&&(p=a*n,T=(a+1)*n)),C=new e.BodyPolygon([g,p,T,x]),1==v?C.SetCurveGroup(a):2==v&&C.SetCurveGroup(0),u.AddPolygon(C);if(y&&i){var A=new e.BodyPolygon([]),m=new e.BodyPolygon([]);for(a=0;a<n;a++)A.AddVertexIndex(n*(c-1)+a),m.AddVertexIndex(n-a-1);u.AddPolygon(A),u.AddPolygon(m)}var B,P=f.Clone().Normalize(),V=new e.Line(t.beg,P),w=0;for(a=0;a<c;a++)B=V.ProjectCoord(o[a]),w+=B.DistanceTo(o[a]);w/=c;var S=new e.Coord(t.beg.x,t.beg.y,t.beg.z),G=new e.Line(S,f),I=G.ProjectCoord(o[0]),M=e.CoordSub(o[0],I).Normalize();return u.SetCylindricalTextureProjection(S,w,M,P),u},e.GenerateTube=function(o,t){var r,n,i,d,a=new e.Body,s=o.length,l=o[0].length;for(n=0;n<l;n++)for(r=0;r<s;r++)a.AddVertex(new e.BodyVertex(o[r][n]));for(n=0;n<s-1;n++)for(r=0;r<l;r++)d=(i=n+s*r)+s,r===l-1&&(d=n),a.AddPolygon(new e.BodyPolygon([i,d,d+1,i+1]));if(t){var u=new e.BodyPolygon([]),y=new e.BodyPolygon([]);for(r=0;r<l;r++)u.AddVertexIndex(s*r+s-1);for(r=l-1;r>=0;r--)y.AddVertexIndex(s*r);a.AddPolygon(u),a.AddPolygon(y)}return a.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),a},e.GenerateFunctionSurface=function(o,t,r,n,i){var d,a,s=new e.Sector(new e.Coord(t.x,t.y,0),new e.Coord(r.x,t.y,0)),l=new e.Sector(new e.Coord(t.x,r.y,0),new e.Coord(r.x,r.y,0)),u=e.GenerateRuledFromSectors(s,l,n,n,i);for(d=0;d<u.VertexCount();d++)(a=u.GetVertexPosition(d)).z=o(a.x,a.y);return u.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),u},e.GenerateFunctionSurfaceSolid=function(o,t,r,n,i,d){var a,s,l=new e.Sector(new e.Coord(r.x,t.y,0),new e.Coord(t.x,t.y,0)),u=new e.Sector(new e.Coord(r.x,r.y,0),new e.Coord(t.x,r.y,0)),y=e.GenerateRuledFromSectorsWithHeight(l,u,n,n,i,d),c=(n+1)*(n+1);for(a=0;a<c;a++)(s=y.GetVertexPosition(a)).z=o(s.x,s.y);return y.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),y},e}),e("skylark-jsmodeler/modeler/camera",["../core/jsm"],function(e){return e.Camera=function(o,t,r,n,i,d){this.eye=e.ValueOrDefault(o,new e.Coord(1,1,1)),this.center=e.ValueOrDefault(t,new e.Coord(0,0,0)),this.up=e.ValueOrDefault(r,new e.Vector(0,0,1)),this.fieldOfView=e.ValueOrDefault(n,45),this.nearClippingPlane=e.ValueOrDefault(i,.1),this.farClippingPlane=e.ValueOrDefault(d,1e3)},e.Camera.prototype.Set=function(o,t,r,n,i,d){this.eye=o,this.center=t,this.up=r,this.fieldOfView=e.ValueOrDefault(n,45),this.nearClippingPlane=e.ValueOrDefault(i,.1),this.farClippingPlane=e.ValueOrDefault(d,1e3)},e.Camera.prototype.Clone=function(){var o=new e.Camera;return o.eye=this.eye,o.center=this.center,o.up=this.up,o.fieldOfView=this.fieldOfView,o.nearClippingPlane=this.nearClippingPlane,o.farClippingPlane=this.farClippingPlane,o},e}),e("skylark-jsmodeler/modeler/explode",["../core/jsm"],function(e){return e.ExplodeBody=function(o,t,r){function n(e,o,t,r){var n;for(n=0;n<e.Count();n++)o.push([]);var i,d=r.itemCount();for(n=0;n<d;n++)-1!==(i=r.getMaterial(n))?o[i].push(n):t.push(n)}return void 0!==r&&null!==r&&(void 0!==t&&null!==t||(t=new e.MaterialSet),function(e,o,t){function r(t,r,n){if(0!==t.length){var i,d,a,s=o.GetMaterial(r);if(void 0!==n.onPointGeometryStart&&null!==n.onPointGeometryStart&&n.onPointGeometryStart(s),void 0!==n.onPoint&&null!==n.onPoint)for(i=0;i<t.length;i++)d=e.GetPoint(t[i]),a=e.GetVertexPosition(d.GetVertexIndex()),n.onPoint(a);void 0!==n.onPointGeometryEnd&&null!==n.onPointGeometryEnd&&n.onPointGeometryEnd(s)}}if(0===e.PointCount())return;var i,d=[],a=[];for(n(o,d,a,{itemCount:function(){return e.PointCount()},getMaterial:function(o){return e.GetPoint(o).GetMaterialIndex()}}),i=0;i<d.length;i++)r(d[i],i,t);r(a,-1,t)}(o,t,r),function(e,o,t){function r(t,r,n){if(0!==t.length){var i,d,a,s,l=o.GetMaterial(r);if(void 0!==n.onLineGeometryStart&&null!==n.onLineGeometryStart&&n.onLineGeometryStart(l),void 0!==n.onLine&&null!==n.onLine)for(i=0;i<t.length;i++)d=e.GetLine(t[i]),a=e.GetVertexPosition(d.GetBegVertexIndex()),s=e.GetVertexPosition(d.GetEndVertexIndex()),n.onLine(a,s);void 0!==n.onLineGeometryEnd&&null!==n.onLineGeometryEnd&&n.onLineGeometryEnd(l)}}if(0===e.LineCount())return;var i,d=[],a=[];for(n(o,d,a,{itemCount:function(){return e.LineCount()},getMaterial:function(o){return e.GetLine(o).GetMaterialIndex()}}),i=0;i<d.length;i++)r(d[i],i,t);r(a,-1,t)}(o,t,r),function(o,t,r){function i(r,n,i,d){function a(t,r,n){function i(e,o,t,r,i,d,a,s,l){void 0!==n.onTriangle&&null!==n.onTriangle&&n.onTriangle(e,o,t,r,i,d,a,s,l)}var d=o.GetPolygon(t),a=d.VertexIndexCount();if(a<3)e.Message("Invalid polygon found.");else{var s,l,u,y,c,h,f,g,x,p,T=!1;if(void 0!==n.hasConvexPolygons&&null!==n.hasConvexPolygons&&(T=n.hasConvexPolygons),3==a||T)for(p=0;p<a-2;p++)s=o.GetVertexPosition(d.GetVertexIndex(0)),l=o.GetVertexPosition(d.GetVertexIndex((p+1)%a)),u=o.GetVertexPosition(d.GetVertexIndex((p+2)%a)),y=r.vertexNormals[t][0],c=r.vertexNormals[t][(p+1)%a],h=r.vertexNormals[t][(p+2)%a],f=null,g=null,x=null,null!==r.textureCoords&&(f=r.textureCoords[t][0],g=r.textureCoords[t][(p+1)%a],x=r.textureCoords[t][(p+2)%a]),i(s,l,u,y,c,h,f,g,x);else{var C,v=new e.Polygon;for(p=0;p<a;p++)C=o.GetVertexPosition(d.vertices[p]),v.AddVertex(C.x,C.y,C.z);var A,m=e.CalculateBodyPolygonNormal(o,t),B=e.TriangulatePolygon(v,m);if(null!==B)for(p=0;p<B.length;p++)A=B[p],s=o.GetVertexPosition(d.GetVertexIndex(A[0])),l=o.GetVertexPosition(d.GetVertexIndex(A[1])),u=o.GetVertexPosition(d.GetVertexIndex(A[2])),y=r.vertexNormals[t][A[0]],c=r.vertexNormals[t][A[1]],h=r.vertexNormals[t][A[2]],f=null,g=null,x=null,null!==r.textureCoords&&(f=r.textureCoords[t][A[0]],g=r.textureCoords[t][A[1]],x=r.textureCoords[t][A[2]]),i(s,l,u,y,c,h,f,g,x);else e.Message("Triangulation failed.")}}}if(0!==r.length){var s,l=t.GetMaterial(n);for(void 0!==d.onGeometryStart&&null!==d.onGeometryStart&&d.onGeometryStart(l),s=0;s<r.length;s++)a(r[s],i,d);void 0!==d.onGeometryEnd&&null!==d.onGeometryEnd&&d.onGeometryEnd(l)}}if(0===o.PolygonCount())return;var d=[],a=[];n(t,d,a,{itemCount:function(){return o.PolygonCount()},getMaterial:function(e){var t=o.GetPolygon(e);return t.GetMaterialIndex()}});var s,l=function(o,t){var r,n,i=e.CalculateBodyVertexNormals(o),d=!1;if(void 0!==t&&null!==t)for(r=0;r<t.Count();r++)if(null!==t.GetMaterial(r).texture){d=!0;break}var a,s,l=null;if(d)for(l=e.CalculateBodyTextureCoords(o),r=0;r<l.length;r++)if((a=o.GetPolygon(r)).HasMaterialIndex())for(s=t.GetMaterial(a.GetMaterialIndex()),n=0;n<l[r].length;n++)l[r][n].x/=s.textureWidth,l[r][n].y/=-s.textureHeight;return{vertexNormals:i,textureCoords:l}}(o,t);for(s=0;s<d.length;s++)i(d[s],s,l,r);i(a,-1,l,r)}(o,t,r),!0)},e}),e("skylark-jsmodeler/modeler/exporter",["../core/jsm"],function(e){return e.ExportBodyContentToStl=function(o,t,r){function n(e){s+=e+"\n"}function i(e,o,t,r){n("\tfacet normal "+e.x+" "+e.y+" "+e.z),n("\t\touter loop"),n("\t\t\tvertex "+o.x+" "+o.y+" "+o.z),n("\t\t\tvertex "+t.x+" "+t.y+" "+t.z),n("\t\t\tvertex "+r.x+" "+r.y+" "+r.z),n("\t\tendloop"),n("\tendfacet")}function d(t){var n=o.GetPolygon(t),d=n.VertexIndexCount();if(!(d<3)){var a,s,l,u=null;if(3===d)u=e.CalculateBodyPolygonNormal(o,t),a=o.GetVertex(n.GetVertexIndex(0)).position,s=o.GetVertex(n.GetVertexIndex(1)).position,l=o.GetVertex(n.GetVertexIndex(2)).position,i(u,a,s,l);else{var y,c=!0;if(void 0!==r&&r&&(c=!1),u=e.CalculateBodyPolygonNormal(o,t),c){var h,f=new e.Polygon;for(y=0;y<d;y++)h=o.GetVertex(n.vertices[y]),f.AddVertex(h.position.x,h.position.y,h.position.z);var g,x=e.TriangulatePolygon(f,u);if(null!==x)for(y=0;y<x.length;y++)g=x[y],a=o.GetVertex(n.GetVertexIndex(g[0])).position,s=o.GetVertex(n.GetVertexIndex(g[1])).position,l=o.GetVertex(n.GetVertexIndex(g[2])).position,i(u,a,s,l)}else for(y=0;y<d-2;y++)a=o.GetVertex(n.GetVertexIndex(0)).position,s=o.GetVertex(n.GetVertexIndex((y+1)%d)).position,l=o.GetVertex(n.GetVertexIndex((y+2)%d)).position,i(u,a,s,l)}}}var a,s="";for(a=0;a<o.PolygonCount();a++)d(a);return s},e.ExportBodyToStl=function(o,t,r){function n(e){i+=e+"\n"}var i="";return n("solid "+t),i+=e.ExportBodyContentToStl(o,t,r),n("endsolid "+t),i},e.ExportModelToStl=function(o,t,r){function n(e){a+=e+"\n"}var i,d,a="";for(n("solid "+t),i=0;i<o.BodyCount();i++)d=o.GetBody(i),a+=e.ExportBodyContentToStl(d,t+(i+1).toString(),r);return n("endsolid "+t),a},e.ExportBodyContentToObj=function(o,t,r){function n(e){y+=e}function i(e){y+=e+"\n"}function d(t){var r=e.CalculateBodyPolygonNormal(o,t);i("vn "+r.x+" "+r.y+" "+r.z)}function a(e){var d,a=o.GetPolygon(e);for(n("f "),d=0;d<a.VertexIndexCount();d++)n(t+a.GetVertexIndex(d)+1+"//"+(r+e+1)+" ");i("")}var s,l,u,y="";for(s=0;s<o.VertexCount();s++)l=s,void 0,i("v "+(u=o.GetVertex(l).position).x+" "+u.y+" "+u.z);for(s=0;s<o.PolygonCount();s++)d(s);for(s=0;s<o.PolygonCount();s++)a(s);return y},e.ExportBodyToObj=function(o){return e.ExportBodyContentToObj(o,0,0)},e.ExportModelToObj=function(o){var t,r,n="",i=0,d=0;for(t=0;t<o.BodyCount();t++)r=o.GetBody(t),n+=e.ExportBodyContentToObj(r,i,d),i+=r.VertexCount(),d+=r.PolygonCount();return n},e.ExportMaterialsToGdl=function(o){function t(o,t){var r,i,d=(r=o.diffuse,(i=e.HexColorToRGBComponents(r))[0]/255+","+i[1]/255+","+i[2]/255);n+='define material "material'+t+'" 2, '+d+" ! "+t+"\n"}var r,n="",i=!1;if(void 0!==o&&null!==o&&(i=!0),i)for(t(o.GetDefaultMaterial(),1),r=0;r<o.Count();r++)t(o.GetMaterial(r),r+2);return n},e.ExportBodyGeometryToGdl=function(o,t){function r(e){if(e.length>200){var o,t,r=0;for(o=0;o<e.length;o++)t=e[o],a+=t,++r>200&&","==t&&(a+="\n",r=0)}else a+=e}function n(e){r(e+"\n")}function i(e,t){var r=e.edges[t],i=0;-1!=r.pgon1&&-1!=r.pgon2&&o.GetPolygon(r.pgon1).HasCurveGroup()&&o.GetPolygon(r.pgon2).HasCurveGroup()&&o.GetPolygon(r.pgon1).GetCurveGroup()==o.GetPolygon(r.pgon2).GetCurveGroup()&&(i=2),n("edge "+(r.vert1+1)+", "+(r.vert2+1)+", -1, -1, "+i+" ! "+(t+1))}function d(e,i,d){var a=-1;t&&(a=o.GetPolygon(i).GetMaterialIndex()+2)!=d&&n('set material "material'+a+'"');var s=e.pgons[i],l=0;o.GetPolygon(i).HasCurveGroup()&&(l=2),r("pgon "+s.pedges.length+", 0, "+l+", ");var u,y,c="";for(u=0;u<s.pedges.length;u++)(y=s.pedges[u]).reverse?c+=-(y.index+1):c+=y.index+1,u<s.pedges.length-1&&(c+=", ");return r(c),r(" ! "+(i+1)),n(""),a}var a="";n("base");var s,l,u,y=new e.AdjacencyInfo(o);for(s=0;s<y.verts.length;s++)l=s,void 0,n("vert "+(u=o.GetVertex(l).position).x+", "+u.y+", "+u.z+" ! "+(l+1));for(s=0;s<y.edges.length;s++)i(y,s);var c=-1;for(s=0;s<y.pgons.length;s++)c=d(y,s,c);return n("body -1"),a},e.ExportBodyToGdl=function(o,t){var r="",n=!1;return void 0!==t&&null!==t&&(r+=e.ExportMaterialsToGdl(t),n=!0),r+=e.ExportBodyGeometryToGdl(o,n)},e.ExportModelToGdl=function(o,t){var r,n,i="",d=!1;for(void 0!==t&&null!==t&&(i+=e.ExportMaterialsToGdl(t),d=!0),r=0;r<o.BodyCount();r++)n=o.GetBody(r),i+=e.ExportBodyGeometryToGdl(n,d);return i},e}),e("skylark-jsmodeler/modeler/trianglebody",["../core/jsm"],function(e){return e.TriangleBody=function(e){this.name=e,this.vertices=[],this.normals=[],this.uvs=[],this.triangles=[],this.defaultUVIndex=-1},e.TriangleBody.prototype.SetName=function(e){this.name=e},e.TriangleBody.prototype.GetName=function(){return this.name},e.TriangleBody.prototype.AddVertex=function(o,t,r){return this.vertices.push(new e.Coord(o,t,r)),this.vertices.length-1},e.TriangleBody.prototype.GetVertex=function(e){return this.vertices[e]},e.TriangleBody.prototype.SetVertex=function(o,t,r,n){this.vertices[o]=new e.Coord(t,r,n)},e.TriangleBody.prototype.VertexCount=function(){return this.vertices.length},e.TriangleBody.prototype.AddNormal=function(o,t,r){return this.normals.push(new e.Vector(o,t,r)),this.normals.length-1},e.TriangleBody.prototype.GetNormal=function(e){return this.normals[e]},e.TriangleBody.prototype.GetTriangleNormal=function(o,t){var r=null,n=this.triangles[o];if(-1==n.curve)r=this.GetNormal(n.n0);else{var i=this.GetVertex(n.v0),d=this.GetVertex(n.v1),a=this.GetVertex(n.v2),s=this.GetNormal(n.n0),l=this.GetNormal(n.n1),u=this.GetNormal(n.n2);r=e.BarycentricInterpolation(i,d,a,s,l,u,t)}return r},e.TriangleBody.prototype.NormalCount=function(){return this.normals.length},e.TriangleBody.prototype.AddUV=function(o,t){return this.uvs.push(new e.Coord2D(o,t)),this.uvs.length-1},e.TriangleBody.prototype.AddDefaultUV=function(){return-1!=this.defaultUVIndex?this.defaultUVIndex:(this.defaultUVIndex=this.AddUV(0,0),this.defaultUVIndex)},e.TriangleBody.prototype.GetUV=function(e){return this.uvs[e]},e.TriangleBody.prototype.UVCount=function(){return this.uvs.length},e.TriangleBody.prototype.AddTriangle=function(e,o,t,r,n,i,d,a,s,l,u){return this.triangles.push({v0:e,v1:o,v2:t,n0:r,n1:n,n2:i,u0:d,u1:a,u2:s,mat:l,curve:u}),this.triangles.length-1},e.TriangleBody.prototype.GetTriangle=function(e){return this.triangles[e]},e.TriangleBody.prototype.TriangleCount=function(){return this.triangles.length},e.TriangleBody.prototype.GetBoundingBox=function(){var o,t,r=new e.Coord(e.Inf,e.Inf,e.Inf),n=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(o=0;o<this.vertices.length;o++)t=this.vertices[o],r.x=e.Minimum(r.x,t.x),r.y=e.Minimum(r.y,t.y),r.z=e.Minimum(r.z,t.z),n.x=e.Maximum(n.x,t.x),n.y=e.Maximum(n.y,t.y),n.z=e.Maximum(n.z,t.z);return new e.Box(r,n)},e.TriangleBody.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.TriangleBody.prototype.GetBoundingSphere=function(){var o,t,r=this.GetCenter(),n=0;for(o=0;o<this.vertices.length;o++)t=r.DistanceTo(this.vertices[o]),e.IsGreater(t,n)&&(n=t);var i=new e.Sphere(r,n);return i},e.TriangleBody.prototype.Finalize=function(o){function t(t,r,n,i){function d(o,t,r,n,i){var d,a,s,l=new e.Vector(0,0,0),u=0,y=o.GetTriangle(r),c=i[t];for(d=0;d<c.length;d++)a=c[d],s=o.GetTriangle(a),y.curve==s.curve&&(l=e.CoordAdd(l,n[a]),u+=1);return l.MultiplyScalar(1/u),l.Normalize(),o.AddNormal(l.x,l.y,l.z)}var a,s,l=t.triangles[r];(void 0===l.mat||l.mat<0)&&(l.mat=o.GetDefaultMaterialIndex()),void 0!==l.n0&&void 0!==l.n1&&void 0!==l.n2||(void 0===l.curve||l.curve<0?(a=n[r],s=t.AddNormal(a.x,a.y,a.z),l.n0=s,l.n1=s,l.n2=s,l.curve=-1):(l.n0=d(t,l.v0,r,n,i),l.n1=d(t,l.v1,r,n,i),l.n2=d(t,l.v2,r,n,i))),void 0!==l.u0&&void 0!==l.u1&&void 0!==l.u2||(l.u0=t.AddDefaultUV(),l.u1=t.AddDefaultUV(),l.u2=t.AddDefaultUV())}var r,n,i,d=[],a={};for(r=0;r<this.vertices.length;r++)a[r]=[];for(r=0;r<this.triangles.length;r++)n=this.triangles[r],i=e.CalculateTriangleNormal(this.vertices[n.v0],this.vertices[n.v1],this.vertices[n.v2]),d.push(i),a[n.v0].push(r),a[n.v1].push(r),a[n.v2].push(r);for(r=0;r<this.triangles.length;r++)t(this,r,d,a)},e.TriangleBody.prototype.Clone=function(){var o,t,r=new e.TriangleBody(this.name);for(o=0;o<this.vertices.length;o++)r.vertices.push(this.vertices[o].Clone());for(o=0;o<this.normals.length;o++)r.normals.push(this.normals[o].Clone());for(o=0;o<this.uvs.length;o++)r.uvs.push(this.uvs[o].Clone());for(o=0;o<this.triangles.length;o++)t=this.triangles[o],r.triangles.push({v0:t.v0,v1:t.v1,v2:t.v2,n0:t.n0,n1:t.n1,n2:t.n2,u0:t.u0,u1:t.u1,u2:t.u2,mat:t.mat,curve:t.curve});return r},e.ConvertTriangleBodyToOctree=function(o){var t,r,n,i,d,a=new e.TriangleOctree(o.GetBoundingBox());for(t=0;t<o.TriangleCount();t++)r=o.GetTriangle(t),n=o.GetVertex(r.v0),i=o.GetVertex(r.v1),d=o.GetVertex(r.v2),a.AddTriangle(n,i,d,{triangleIndex:t});return a},e}),e("skylark-jsmodeler/modeler/trianglemodel",["../core/jsm"],function(e){return e.TriangleModel=function(){this.materials=[],this.bodies=[],this.defaultMaterial=-1},e.TriangleModel.prototype.AddMaterial=function(e){return this.materials.push(e),this.materials.length-1},e.TriangleModel.prototype.GetMaterial=function(e){return this.materials[e]},e.TriangleModel.prototype.AddDefaultMaterial=function(){return-1==this.defaultMaterial&&(this.defaultMaterial=this.AddMaterial({})),this.defaultMaterial},e.TriangleModel.prototype.GetDefaultMaterialIndex=function(){return this.AddDefaultMaterial()},e.TriangleModel.prototype.MaterialCount=function(){return this.materials.length},e.TriangleModel.prototype.AddBody=function(e){return this.bodies.push(e),this.bodies.length-1},e.TriangleModel.prototype.AddBodyToIndex=function(e,o){return this.bodies.splice(o,0,e),o},e.TriangleModel.prototype.GetBody=function(e){return this.bodies[e]},e.TriangleModel.prototype.VertexCount=function(){var e,o,t=0;for(e=0;e<this.bodies.length;e++)o=this.bodies[e],t+=o.VertexCount();return t},e.TriangleModel.prototype.TriangleCount=function(){var e,o,t=0;for(e=0;e<this.bodies.length;e++)o=this.bodies[e],t+=o.TriangleCount();return t},e.TriangleModel.prototype.BodyCount=function(){return this.bodies.length},e.TriangleModel.prototype.FinalizeMaterials=function(){var o,t,r={name:"Default",ambient:[.5,.5,.5],diffuse:[.5,.5,.5],specular:[.1,.1,.1],shininess:0,opacity:1,reflection:0,texture:null,offset:null,scale:null,rotation:null};for(o=0;o<this.materials.length;o++)t=this.materials[o],e.CopyObjectProperties(r,t,!1)},e.TriangleModel.prototype.FinalizeBodies=function(){var e;for(e=0;e<this.bodies.length;e++)this.bodies[e].Finalize(this)},e.TriangleModel.prototype.Finalize=function(){this.FinalizeBodies(),this.FinalizeMaterials()},e}),e("skylark-jsmodeler/modeler/converter",["../core/jsm"],function(e){return e.ConvertBodyToTriangleBody=function(o){function t(e,o,t,r,n){var i=e.AddTriangle(t,r,n),d=e.GetTriangle(i);o.HasMaterialIndex()&&(d.mat=o.GetMaterialIndex()),o.HasCurveGroup()&&(d.curve=o.GetCurveGroup())}var r,n,i,d,a,s,l,u,y,c,h,f,g=new e.TriangleBody;for(r=0;r<o.VertexCount();r++)i=o.GetVertexPosition(r),g.AddVertex(i.x,i.y,i.z);for(r=0;r<o.PolygonCount();r++)if(d=o.GetPolygon(r),!((a=d.VertexIndexCount())<3))if(3==a)c=d.GetVertexIndex(0),h=d.GetVertexIndex(1),f=d.GetVertexIndex(2),t(g,d,c,h,f);else{for(s=new e.Polygon,n=0;n<a;n++)i=o.GetVertexPosition(d.GetVertexIndex(n)),s.AddVertex(i.x,i.y,i.z);if(l=e.CalculateBodyPolygonNormal(o,r),null!==(y=e.TriangulatePolygon(s,l)))for(n=0;n<y.length;n++)u=y[n],c=d.GetVertexIndex(u[0]),h=d.GetVertexIndex(u[1]),f=d.GetVertexIndex(u[2]),t(g,d,c,h,f)}return g},e.ConvertModelToTriangleModel=function(o){var t,r,n,i,d=new e.TriangleModel,a=o.GetMaterialSet();for(t=0;t<a.Count();t++)r=a.GetMaterial(t),d.AddMaterial({name:"Material"+t,ambient:e.HexColorToNormalizedRGBComponents(r.ambient),diffuse:e.HexColorToNormalizedRGBComponents(r.diffuse),specular:e.HexColorToNormalizedRGBComponents(r.specular),shininess:r.shininess,opacity:r.opacity,reflection:r.reflection});for(t=0;t<o.BodyCount();t++)n=o.GetBody(t),i=e.ConvertBodyToTriangleBody(n),d.AddBody(i);return d.Finalize(),d},e.ConvertTriangleModelToJsonData=function(o){function t(e,o,t){var r,n,i,d,a=[],s=e.MaterialCount();for(r=0;r<o.VertexCount();r++)i=o.GetVertex(r),t.vertices.push(i.x,i.y,i.z);for(r=0;r<o.NormalCount();r++)i=o.GetNormal(r),t.normals.push(i.x,i.y,i.z);for(r=0;r<o.UVCount();r++)i=o.GetUV(r),t.uvs.push(i.x,i.y);for(r=0;r<s;r++)a.push([]);for(r=0;r<o.TriangleCount();r++)void 0===(d=o.GetTriangle(r)).mat||d.mat<0||d.mat>=s||a[d.mat].push(r);var l,u;for(r=0;r<a.length;r++)if(0!==(l=a[r]).length){for(u={material:r,parameters:[]},n=0;n<l.length;n++)d=o.GetTriangle(l[n]),u.parameters.push(d.v0,d.v1,d.v2,d.n0,d.n1,d.n2,d.u0,d.u1,d.u2);l.length,t.triangles.push(u)}}var r,n,i,d={version:1,materials:[],meshes:[]};for(function(o,t){var r,n,i;for(r=0;r<o.MaterialCount();r++)n=o.GetMaterial(r),i={name:e.ValueOrDefault(n.name,""),ambient:n.ambient,diffuse:n.diffuse,specular:n.specular,shininess:n.shininess,opacity:n.opacity},void 0!==n.texture&&null!==n.texture&&(i.texture=e.ValueOrDefault(n.texture,null),i.offset=n.offset,i.scale=n.scale,i.rotation=n.rotation),t.push(i)}(o,d.materials),r=0;r<o.BodyCount();r++)0!==(n=o.GetBody(r)).TriangleCount()&&(i={name:n.GetName(),vertices:[],normals:[],uvs:[],triangles:[]},t(o,n,i),d.meshes.push(i));return d},e.MergeJsonDataMeshes=function(e){function o(e,o,t){function r(e,o,t,r,n,i){var d=o.material,a=t[d];void 0===a&&(e.triangles.push({material:d,parameters:[]}),a=e.triangles.length-1,t[d]=a);var s,l=e.triangles[a],u=l.parameters;for(s=0;s<o.parameters.length;s+=9)u.push(o.parameters[s]+r,o.parameters[s+1]+r,o.parameters[s+2]+r,o.parameters[s+3]+n,o.parameters[s+4]+n,o.parameters[s+5]+n,o.parameters[s+6]+i,o.parameters[s+7]+i,o.parameters[s+8]+i)}var n,i,d=e.vertices.length/3,a=e.normals.length/3,s=e.uvs.length/2;for(function(e,o){var t;for(t=0;t<o.vertices.length;t++)e.vertices.push(o.vertices[t]);for(t=0;t<o.normals.length;t++)e.normals.push(o.normals[t]);for(t=0;t<o.uvs.length;t++)e.uvs.push(o.uvs[t])}(e,o),n=0;n<o.triangles.length;n++)i=o.triangles[n],r(e,i,t,d,a,s)}var t,r,n={version:e.version,materials:e.materials,meshes:[]},i={name:"Merged",vertices:[],normals:[],uvs:[],triangles:[]},d={};for(t=0;t<e.meshes.length;t++)r=e.meshes[t],o(i,r,d);return n.meshes.push(i),n},e}),e("skylark-jsmodeler/modeler/rayutils",["../core/jsm"],function(e){return e.RayTriangleIntersection=function(o,t,r,n){var i=o.GetOrigin(),d=o.GetDirection(),a=e.CoordSub(r,t),s=e.CoordSub(n,t),l=e.VectorCross(d,s),u=e.VectorDot(a,l);if(e.IsZero(u))return null;var y=e.IsPositive(u);if(!y)return null;var c=1/u,h=e.CoordSub(i,t),f=e.VectorDot(h,l)*c;if(e.IsLower(f,0)||e.IsGreater(f,1))return null;var g=e.VectorCross(h,a),x=e.VectorDot(d,g)*c;if(e.IsLower(x,0)||e.IsGreater(f+x,1))return null;var p=e.VectorDot(s,g)*c;if(!e.IsPositive(p))return null;if(o.IsLengthReached(p))return null;var T=d.Clone().MultiplyScalar(p),C={position:e.CoordAdd(i,T),distance:p};return C},e.RayBoxIntersection=function(o,t,r){var n,i=o.GetOrigin(),d=o.GetDirection(),a=e.CoordToArray(i),s=e.CoordToArray(d),l=e.CoordToArray(t),u=e.CoordToArray(r),y=[0,0,0],c=[0,0,0],h=!0;for(n=0;n<3;n++)e.IsLower(a[n],l[n])?(y[n]=-1,c[n]=l[n],h=!1):e.IsGreater(a[n],u[n])?(y[n]=1,c[n]=u[n],h=!1):y[n]=0;if(h)return{position:i,distance:0};var f=[0,0,0];for(n=0;n<3;n++)0===y[n]||e.IsZero(s[n])?f[n]=-1:f[n]=(c[n]-a[n])/s[n];var g=0;for(n=1;n<3;n++)e.IsLower(f[g],f[n])&&(g=n);if(e.IsNegative(f[g]))return null;var x=[0,0,0];for(n=0;n<3;n++)if(g!=n){if(x[n]=a[n]+f[g]*s[n],e.IsLower(x[n],l[n])||e.IsGreater(x[n],u[n]))return null}else x[n]=c[n];var p=e.CoordFromArray(x),T=i.DistanceTo(p);return o.IsLengthReached(T)?null:{position:p,distance:T}},e.RayOctreeIntersection=function(o,t,r){var n=null,i=!1,d=null!==r&&void 0!==r;return e.TraverseOctreeNodes(t,function(t){if(!d&&i)return!1;if(!e.RayBoxIntersection(o,t.box.min,t.box.max))return!1;var r;for(r=0;r<t.triangles.length;r++){var a=t.triangles[r],s=a.v0,l=a.v1,u=a.v2,y=e.RayTriangleIntersection(o,s,l,u);if(null!==y){if(i=!0,!d)return!1;(null===n||y.distance<n.distance)&&((n=y).userData=a.userData)}}return!0}),d&&null!==n&&(r.position=n.position,r.distance=n.distance,r.userData=n.userData),i},e.RayTriangleBodyIntersection=function(o,t,r){var n,i,d,a,s,l,u=null,y=!1,c=null!==r&&void 0!==r;for(n=0;n<t.TriangleCount();n++)if(i=t.GetTriangle(n),d=t.GetVertex(i.v0),a=t.GetVertex(i.v1),s=t.GetVertex(i.v2),null!==(l=e.RayTriangleIntersection(o,d,a,s))){if(y=!0,!c)break;(null===u||l.distance<u.distance)&&((u=l).triangleIndex=n)}return c&&null!==u&&(r.position=u.position,r.distance=u.distance,r.triangleIndex=u.triangleIndex),y},e.RayTriangleModelIntersection=function(o,t,r){var n,i,d,a=null,s=!1,l=null!==r&&void 0!==r;for(n=0;n<t.BodyCount();n++)if(i=t.GetBody(n),d=l?{}:null,e.RayTriangleBodyIntersection(o,i,d)){if(s=!0,!l)break;(null===a||d.distance<a.distance)&&((a=d).bodyIndex=n)}return l&&null!==a&&(r.position=a.position,r.distance=a.distance,r.triangleIndex=a.triangleIndex,r.bodyIndex=a.bodyIndex),s},e.RayTriangleModelIntersectionWithOctree=function(o,t,r){var n,i,d,a,s=null,l=!1,u=null!==r&&void 0!==r;for(n=0;n<t.BodyCount();n++)if(i=t.GetBody(n),d=!1,a=u?{}:null,i.TriangleCount()>20?(void 0===i.octree&&(i.octree=e.ConvertTriangleBodyToOctree(i)),d=e.RayOctreeIntersection(o,i.octree,a)):d=e.RayTriangleBodyIntersection(o,i,a),d){if(l=!0,!u)break;(null===s||a.distance<s.distance)&&(s=a,void 0!==a.userData&&(s.triangleIndex=a.userData.triangleIndex),s.bodyIndex=n)}return u&&null!==s&&(r.position=s.position,r.distance=s.distance,r.triangleIndex=s.triangleIndex,r.bodyIndex=s.bodyIndex),l},e}),e("skylark-jsmodeler/import/binaryreader",["../core/jsm"],function(e){return e.BinaryReader=function(e,o){this.arrayBuffer=e,this.dataView=new DataView(e),this.isLittleEndian=o,this.position=0},e.BinaryReader.prototype.GetPosition=function(){return this.position},e.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength},e.BinaryReader.prototype.Skip=function(e){this.position=this.position+e},e.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength},e.BinaryReader.prototype.ReadBoolean=function(){var e=this.dataView.getInt8(this.position);return this.position=this.position+1,!!e},e.BinaryReader.prototype.ReadCharacter=function(){var e=this.dataView.getInt8(this.position);return this.position=this.position+1,e},e.BinaryReader.prototype.ReadUnsignedCharacter=function(){var e=this.dataView.getUint8(this.position);return this.position=this.position+1,e},e.BinaryReader.prototype.ReadInteger16=function(){var e=this.dataView.getInt16(this.position,this.isLittleEndian);return this.position=this.position+2,e},e.BinaryReader.prototype.ReadUnsignedInteger16=function(){var e=this.dataView.getUint16(this.position,this.isLittleEndian);return this.position=this.position+2,e},e.BinaryReader.prototype.ReadInteger32=function(){var e=this.dataView.getInt32(this.position,this.isLittleEndian);return this.position=this.position+4,e},e.BinaryReader.prototype.ReadUnsignedInteger32=function(){var e=this.dataView.getUint32(this.position,this.isLittleEndian);return this.position=this.position+4,e},e.BinaryReader.prototype.ReadFloat32=function(){var e=this.dataView.getFloat32(this.position,this.isLittleEndian);return this.position=this.position+4,e},e.BinaryReader.prototype.ReadDouble64=function(){var e=this.dataView.getFloat64(this.position,this.isLittleEndian);return this.position=this.position+8,e},e}),e("skylark-jsmodeler/import/importerutils",["../core/jsm"],function(e){return e.GetArrayBufferFromURL=function(e,o){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;e&&o.onReady&&o.onReady(e)},t.onerror=function(){o.onError&&o.onError()},t.send(null)},e.GetArrayBufferFromFile=function(e,o){var t=new FileReader;t.onloadend=function(e){e.target.readyState==FileReader.DONE&&o.onReady&&o.onReady(e.target.result)},t.onerror=function(){o.onError&&o.onError()},t.readAsArrayBuffer(e)},e.GetStringBufferFromURL=function(e,o){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="text",t.onload=function(){var e=t.response;e&&o.onReady&&o.onReady(e)},t.onerror=function(){o.onError&&o.onError()},t.send(null)},e.GetStringBufferFromFile=function(e,o){var t=new FileReader;t.onloadend=function(e){e.target.readyState==FileReader.DONE&&o.onReady&&o.onReady(e.target.result)},t.onerror=function(){o.onError&&o.onError()},t.readAsText(e)},e.LoadMultipleBuffers=function(o,t){!function o(t,r,n,i){if(r>=t.length)return void i(n);var d=t[r];var a=null;a=d.isFile?d.isArrayBuffer?e.GetArrayBufferFromFile:e.GetStringBufferFromFile:d.isArrayBuffer?e.GetArrayBufferFromURL:e.GetStringBufferFromURL;a(d.originalObject,{onReady:function(e){n.push(e),o(t,r+1,n,i)},onError:function(){n.push(null),o(t,r+1,n,i)}})}(o,0,[],function(e){t(e)})},e}),e("skylark-jsmodeler/import/importer3ds",["../core/jsm"],function(e){return e.Read3dsFile=function(o,t){function r(e,o){void 0!==t.onLog&&null!==t.onLog&&t.onLog(e,o)}function n(e,o,r){void 0!==t.onVertex&&null!==t.onVertex&&t.onVertex(e,o,r)}function i(e,o){void 0!==t.onTextureVertex&&null!==t.onTextureVertex&&t.onTextureVertex(e,o)}function d(e,o,r,n){void 0!==t.onFace&&null!==t.onFace&&t.onFace(e,o,r,n)}function a(e,o){void 0!==t.onFaceMaterial&&null!==t.onFaceMaterial&&t.onFaceMaterial(e,o)}function s(e,o){void 0!==t.onFaceSmoothingGroup&&null!==t.onFaceSmoothingGroup&&t.onFaceSmoothingGroup(e,o)}function l(e,o){var t=e.ReadUnsignedInteger16(),r=e.ReadUnsignedInteger32();o(t,r)}function u(e,o){e.Skip(o-6)}function y(e,o){return e.GetPosition()+o-6}function c(e){for(var o="",t=0,r=0;r<64&&0!==(t=e.ReadCharacter());)o+=String.fromCharCode(t),r+=1;return o}function h(e){var o,t=[];for(o=0;o<3;o++)t[o]=e.ReadFloat32();return t}function f(e,o,t){for(;e.GetPosition()<=o-6;)l(e,t)}void 0!==t&&null!==t||(t={});var g=new e.BinaryReader(o,!0);!function(e,o){function l(e,t,r){var n=[0,0,0],i=y(e,r),d=!1;return f(e,i,function(t,r){t==o.MAT_COLOR?d||(n[0]=e.ReadUnsignedCharacter()/255,n[1]=e.ReadUnsignedCharacter()/255,n[2]=e.ReadUnsignedCharacter()/255):t==o.MAT_LIN_COLOR?(n[0]=e.ReadUnsignedCharacter()/255,n[1]=e.ReadUnsignedCharacter()/255,n[2]=e.ReadUnsignedCharacter()/255,d=!0):t==o.MAT_COLOR_F?d||(n[0]=e.ReadFloat32(),n[1]=e.ReadFloat32(),n[2]=e.ReadFloat32()):t==o.MAT_LIN_COLOR_F?(n[0]=e.ReadFloat32(),n[1]=e.ReadFloat32(),n[2]=e.ReadFloat32(),d=!0):u(e,r)}),n}function g(e,t,r){var n=0,i=y(e,r);return f(e,i,function(t,r){t==o.PERCENTAGE?n=e.ReadUnsignedInteger16()/100:t==o.PERCENTAGE_F?n=e.ReadFloat32():u(e,r)}),n}function x(e,n,i){r("Read material chunk ("+n.toString(16)+", "+i+")",2);var d={},a=y(e,i);f(e,a,function(t,a){t==o.MAT_NAME?(r("Read material name chunk ("+n.toString(16)+", "+i+")",3),d.name=c(e)):t==o.MAT_AMBIENT?(r("Read material ambient chunk ("+n.toString(16)+", "+i+")",3),d.ambient=l(e,t,a)):t==o.MAT_DIFFUSE?(r("Read material diffuse chunk ("+n.toString(16)+", "+i+")",3),d.diffuse=l(e,t,a)):t==o.MAT_SPECULAR?(r("Read material specular chunk ("+n.toString(16)+", "+i+")",3),d.specular=l(e,t,a)):t==o.MAT_SHININESS?(r("Read material shininess chunk ("+n.toString(16)+", "+i+")",3),d.shininess=g(e,t,a)):t==o.MAT_SHININESS_STRENGTH?(r("Read material shininess strength chunk ("+n.toString(16)+", "+i+")",3),d.shininessStrength=g(e,t,a)):t==o.MAT_TRANSPARENCY?(r("Read material transparency chunk ("+n.toString(16)+", "+i+")",3),d.transparency=g(e,t,a)):t==o.MAT_TEXMAP?(r("Read material texture map chunk ("+n.toString(16)+", "+i+")",3),function(e,t,r,n){n.texture=null,n.offset=[0,0],n.scale=[1,1],n.rotation=0;var i=y(e,r);f(e,i,function(t,r){t==o.MAT_TEXMAP_NAME?n.texture=c(e):t==o.MAT_TEXMAP_UOFFSET?n.offset[0]=e.ReadFloat32():t==o.MAT_TEXMAP_VOFFSET?n.offset[1]=e.ReadFloat32():t==o.MAT_TEXMAP_USCALE?n.scale[0]=e.ReadFloat32():t==o.MAT_TEXMAP_VSCALE?n.scale[1]=e.ReadFloat32():t==o.MAT_TEXMAP_ROTATION?n.rotation=e.ReadFloat32():u(e,r)})}(e,0,a,d)):(r("Skip chunk ("+t.toString(16)+", "+a+")",3),u(e,a))}),function(e){void 0!==t.onMaterial&&null!==t.onMaterial&&t.onMaterial(e)}(d)}function p(e,t,n){r("Read faces chunk ("+t.toString(16)+", "+n+")",4);var i,l,h,g,x,p=y(e,n),T=e.ReadUnsignedInteger16();for(i=0;i<T;i++)l=e.ReadUnsignedInteger16(),h=e.ReadUnsignedInteger16(),g=e.ReadUnsignedInteger16(),x=e.ReadUnsignedInteger16(),d(l,h,g,x);f(e,p,function(t,n){t==o.TRI_MATERIAL?function(e,o,t){r("Read face materials chunk ("+o.toString(16)+", "+t+")",5);var n,i=c(e),d=e.ReadUnsignedInteger16();for(n=0;n<d;n++)a(e.ReadUnsignedInteger16(),i)}(e,t,n):t==o.TRI_SMOOTH?function(e,o,t,n){var i,d;for(r("Read face smoothing groups chunk ("+t.toString(16)+", "+n+")",5),i=0;i<o;i++)d=e.ReadUnsignedInteger32(),s(i,d)}(e,T,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",5),u(e,n))})}function T(e,o,n){r("Read transformation chunk ("+o.toString(16)+", "+n+")",4);var i,d,a=[];for(i=0;i<4;i++){for(d=0;d<3;d++)a.push(e.ReadFloat32());i<3?a.push(0):a.push(1)}!function(e){void 0!==t.onTransformation&&null!==t.onTransformation&&t.onTransformation(e)}(a)}function C(e,d,a,s){r("Read mesh chunk ("+d+", "+a.toString(16)+", "+s+")",3),function(e){void 0!==t.onMesh&&null!==t.onMesh&&t.onMesh(e)}(d);var l=y(e,s);f(e,l,function(t,d){t==o.TRI_VERTEX?function(e,o,t){r("Read vertices chunk ("+o.toString(16)+", "+t+")",4);var i,d,a,s,l=e.ReadUnsignedInteger16();for(i=0;i<l;i++)d=e.ReadFloat32(),a=e.ReadFloat32(),s=e.ReadFloat32(),n(d,a,s)}(e,t,d):t==o.TRI_TEXVERTEX?function(e,o,t){r("Read texture vertices chunk ("+o.toString(16)+", "+t+")",4);var n,d,a,s=e.ReadUnsignedInteger16();for(n=0;n<s;n++)d=e.ReadFloat32(),a=e.ReadFloat32(),i(d,a)}(e,t,d):t==o.TRI_FACE?p(e,t,d):t==o.TRI_TRANSFORMATION?T(e,t,d):(r("Skip chunk ("+t.toString(16)+", "+d+")",4),u(e,d))})}function v(e,t,n){r("Read object chunk ("+t.toString(16)+", "+n+")",2);var i=y(e,n),d=c(e);f(e,i,function(t,n){t==o.OBJ_TRIMESH?C(e,d,t,n):t==o.OBJ_LIGHT?function(e,o,t,n){r("Skip light chunk ("+o+", "+t.toString(16)+", "+n+")",3),u(e,n)}(e,d,t,n):t==o.OBJ_CAMERA?function(e,o,t,n){r("Skip camera chunk ("+o+", "+t.toString(16)+", "+n+")",3),u(e,n)}(e,d,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",3),u(e,n))})}function A(e,n,i){function d(e,t){var r,n,i,d=[];e.Skip(10);var a=e.ReadInteger32();for(r=0;r<a;r++)e.ReadInteger32(),0!==e.ReadUnsignedInteger16()&&e.ReadFloat32(),n=null,t==o.OBJECT_ROTATION?(i=e.ReadFloat32(),(n=h(e))[3]=i):n=h(e),d.push(n);return d}r("Read object node chunk ("+n.toString(16)+", "+i+")",2);var a={name:"",nodeId:-1,flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[]},s=y(e,i);f(e,s,function(t,n){t==o.OBJECT_HIERARCHY?(a.name=c(e),a.flags=e.ReadUnsignedInteger32(),a.userId=e.ReadUnsignedInteger16()):t==o.OBJECT_PIVOT?a.pivot=h(e):t==o.OBJECT_POSITION?a.positions=d(e,o.OBJECT_POSITION):t==o.OBJECT_ROTATION?a.rotations=d(e,o.OBJECT_ROTATION):t==o.OBJECT_SCALE?a.scales=d(e,o.OBJECT_SCALE):t==o.OBJECT_ID?a.nodeId=e.ReadUnsignedInteger16():(r("Skip chunk ("+t.toString(16)+", "+n+")",3),u(e,n))}),function(e){void 0!==t.onObjectNode&&null!==t.onObjectNode&&t.onObjectNode(e)}(a)}function m(e,t,n){r("Read main chunk ("+t.toString(16)+", "+n+")",0);var i=y(e,n);f(e,i,function(t,n){t==o.EDIT3DS?function(e,t,n){r("Read editor chunk ("+t.toString(16)+", "+n+")",1);var i=y(e,n);f(e,i,function(t,n){t==o.EDIT_MATERIAL?x(e,t,n):t==o.EDIT_OBJECT?v(e,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",2),u(e,n))})}(e,t,n):t==o.KF3DS?function(e,t,n){r("Read keyframe chunk ("+t.toString(16)+", "+n+")",1);var i=y(e,n);f(e,i,function(t,n){t==o.OBJECT_NODE?A(e,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",2),u(e,n))})}(e,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",1),u(e,n))})}var B=e.GetByteLength();f(e,B,function(t,n){t==o.MAIN3DS?m(e,t,n):(r("Skip chunk ("+t.toString(16)+", "+n+")",0),u(e,n))})}(g,{MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104})},e.Convert3dsToJsonData=function(o,t){function r(e){return void 0!==t.onFileRequested&&null!==t.onFileRequested?t.onFileRequested(e):null}void 0!==t&&null!==t||(t={});var n=new e.TriangleModel,i=null,d={},a={},s={nodes:[],nodeIdToIndex:{}};e.Read3dsFile(o,{onMaterial:function(e){if(void 0===d[e.name]){var o=n.AddMaterial({name:e.name,ambient:e.ambient,diffuse:e.diffuse,specular:e.specular,shininess:function(e,o){if(void 0===e||null===e)return 0;if(void 0===o||null===o)return 0;return e*o}(e.shininess,e.shininessStrength),opacity:function(e){if(void 0===e||null===e)return 1;return 1-e}(e.transparency)}),t=n.GetMaterial(o);if(void 0!==e.texture&&null!==e.texture){var i=r(e.texture);if(null!==i){var a=new window.Blob([i]),s=window.URL.createObjectURL(a);t.texture=s,t.offset=e.offset,t.scale=e.scale,t.rotation=-e.rotation}}d[e.name]=o}},onMesh:function(o){if(void 0===a[o]){var t=n.AddBody(new e.TriangleBody(o));(i=n.GetBody(t)).meshData={faceToMaterial:{},faceToSmoothingGroup:{},objectNodes:[],transformation:null},a[o]=t}},onTransformation:function(e){null!==i&&(i.meshData.transformation=e)},onObjectNode:function(e){var o=s.nodes.length;s.nodes.push(e),s.nodeIdToIndex[e.nodeId]=o;var t=a[e.name];if(void 0!==t){var r=n.GetBody(t);r.meshData.objectNodes.push(o)}},onVertex:function(e,o,t){null!==i&&i.AddVertex(e,o,t)},onTextureVertex:function(e,o){null!==i&&i.AddUV(e,o)},onFace:function(e,o,t){null!==i&&i.AddTriangle(e,o,t)},onFaceMaterial:function(e,o){null!==i&&(i.meshData.faceToMaterial[e]=o)},onFaceSmoothingGroup:function(e,o){null!==i&&(i.meshData.faceToSmoothingGroup[e]=o)},onFileRequested:r}),function(o,t,r){function n(o,t,r){function n(e,o){var t,r=o[0],n=o[1],i=o[2];for(t=0;t<4;t++)e[0+t]*=r,e[4+t]*=n,e[8+t]*=i;return e}function i(e,o){var t,r=o[0],n=o[1],i=o[2];for(t=0;t<3;t++)e[12+t]+=e[0+t]*r+e[4+t]*n+e[8+t]*i;return e}function d(o,t){var r,n,i;for(r=0;r<o.VertexCount();r++)n=o.GetVertex(r),i=e.ApplyTransformation(t,n),o.SetVertex(r,i.x,i.y,i.z)}var a=o.meshData,s=function(e){if(void 0===e||null===e)return null;return e.transformation}(a);if(null!==s){var l=null;l=null!==t?function o(t,r){if(void 0!==t.matrix)return t.matrix;var d=e.MatrixIdentity();d=i(d,function(e){if(0===e.positions.length)return[0,0,0];return e.positions[0]}(t));a=d,s=function(o){if(0===o.rotations.length)return[0,0,0,0];return function(o){var t=[0,0,0,1],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);if(e.IsPositive(r)){var n=-.5*o[3],i=Math.sin(n)/r;t=[i*o[0],i*o[1],i*o[2],Math.cos(n)]}return t}(o.rotations[0])}(t),l=e.MatrixRotationQuaternion(s),d=e.MatrixMultiply(l,a);var a,s,l;d=n(d,function(e){if(0===e.scales.length)return[0,0,0,0];return e.scales[0]}(t));if(65535!=t.userId){var u=r.nodeIdToIndex[t.userId];if(void 0!==u){var y=r.nodes[u],c=o(y,r);d=e.MatrixMultiply(d,c)}}t.matrix=d;return d}(t,r):s;var u=e.MatrixClone(l),y=e.MatrixClone(s),c=e.MatrixInvert(y);if(null!==c){!function(o,t,r){var i=e.MatrixDeterminant(t);if(!e.IsNegative(i))return;var a=e.MatrixClone(t);n(a,[-1,1,1]);var s=e.MatrixMultiply(r,a);d(o,s)}(o,y,c);var h=function(e){if(void 0===e||null===e)return[0,0,0];return e.pivot}(t);i(u,[-h[0],-h[1],-h[2]]);var f=e.MatrixMultiply(c,u);d(o,f)}}}function i(e,o,t,r){n(e,o,r),function(e,o){var t,r,n,i,d,a=e.UVCount()==e.VertexCount(),s=e.meshData;for(t=0;t<e.TriangleCount();t++)r=e.GetTriangle(t),a&&(r.u0=r.v0,r.u1=r.v1,r.u2=r.v2),void 0!==(n=s.faceToMaterial[t])&&void 0!==(i=o[n])&&(r.mat=i),void 0!==(d=s.faceToSmoothingGroup[t])&&d>0&&(r.curve=d)}(e,t)}function d(e,o,t,r){var n=o.Clone();return n.SetName(n.GetName()+" ("+r+")"),t<e.BodyCount()?e.AddBodyToIndex(n,t):e.AddBody(n),n}var a,s,l,u,y,c,h;for(a=0;a<t.BodyCount();a++)if(l=t.GetBody(a),0===(u=l.meshData).objectNodes.length)i(l,null,r,o);else{for(c=o.nodes[u.objectNodes[0]],s=1;s<u.objectNodes.length;s++)y=o.nodes[u.objectNodes[s]],(h=d(t,l,a+1,s+1)).meshData=l.meshData,i(h,y,r,o),a+=1;i(l,c,r,o)}}(s,n,d),n.Finalize();var l=e.ConvertTriangleModelToJsonData(n);return l},e}),e("skylark-jsmodeler/import/importerobj",["../core/jsm"],function(e){return e.ReadObjFile=function(e,o){function t(e,t){function n(e,o){return e>0?e-1:o+e}function i(e,o){var t=e.indexOf(o)+o.length,r=e.substr(t,e.length-t);return r.trim()}if(0!==e.length&&"#"!=e[0]){var d,a,s,l,u,y,c,h=e.split(/\s+/);if(0!==h.length&&"#"!=h[0][0])if("g"==h[0]){if(h.length<2)return;var f="";for(d=1;d<h.length;d++)f+=h[d],d<h.length-1&&(f+=" ");!function(e){void 0!==o.onMesh&&null!==o.onMesh&&o.onMesh(e)}(f)}else if("v"==h[0]){if(h.length<4)return;t.vertexCount+=1,u=parseFloat(h[1]),y=parseFloat(h[2]),c=parseFloat(h[3]),void 0!==o.onVertex&&null!==o.onVertex&&o.onVertex(u,y,c)}else if("vn"==h[0]){if(h.length<4)return;t.normalCount+=1,function(e,t,r){void 0!==o.onNormal&&null!==o.onNormal&&o.onNormal(e,t,r)}(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]))}else if("vt"==h[0]){if(h.length<3)return;t.uvCount+=1,function(e,t){void 0!==o.onTexCoord&&null!==o.onTexCoord&&o.onTexCoord(e,t)}(parseFloat(h[1]),parseFloat(h[2]))}else if("f"==h[0]){if(h.length<4)return;var g,x=[],p=[],T=[];for(d=1;d<h.length;d++)g=h[d].split("/"),x.push(n(parseInt(g[0],10),t.vertexCount)),g.length>1&&g[1].length>0&&T.push(n(parseInt(g[1],10),t.uvCount)),g.length>2&&g[2].length>0&&p.push(n(parseInt(g[2],10),t.normalCount));!function(e,t,r){void 0!==o.onFace&&null!==o.onFace&&o.onFace(e,t,r)}(x,p,T)}else if("usemtl"==h[0]){if(h.length<2)return;l=h[1],void 0!==o.onUseMaterial&&null!==o.onUseMaterial&&o.onUseMaterial(l)}else if("newmtl"==h[0]){if(h.length<2)return;!function(e){void 0!==o.onNewMaterial&&null!==o.onNewMaterial&&o.onNewMaterial(e)}(h[1])}else if("Ka"==h[0]||"Kd"==h[0]||"Ks"==h[0]){if(h.length<4)return;!function(e,t,r,n){void 0!==o.onMaterialComponent&&null!==o.onMaterialComponent&&o.onMaterialComponent(e,t,r,n)}(h[0],parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]))}else if("Ns"==h[0]||"Tr"==h[0]||"d"==h[0]){if(h.length<2)return;!function(e,t){void 0!==o.onMaterialParameter&&null!==o.onMaterialParameter&&o.onMaterialParameter(e,t)}(h[0],h[1])}else if("map_Kd"==h[0]){if(h.length<2)return;a=i(e,"map_Kd"),s=a,void 0!==o.onMaterialTexture&&null!==o.onMaterialTexture&&o.onMaterialTexture(s)}else if("mtllib"==h[0]){if(h.length<2)return;var C=function(e){if(void 0!==o.onFileRequested&&null!==o.onFileRequested)return o.onFileRequested(e);return null}((a=i(e,"mtllib")).trim());if(null===C)return;r(C)}}}function r(e,o){var r,n=e.split("\n");for(r=0;r<n.length;r++)t(n[r].trim(),o)}void 0!==o&&null!==o||(o={});r(e,{vertexCount:0,normalCount:0,uvCount:0})},e.ConvertObjToJsonData=function(o,t){function r(e){return void 0!==t.onFileRequested&&null!==t.onFileRequested?t.onFileRequested(e):null}void 0!==t&&null!==t||(t={});var n=new e.TriangleModel,i=n.AddBody(new e.TriangleBody("Default")),d=n.GetBody(i),a={},s=null,l=null,u=[],y=[],c=[],h={},f={},g={};e.ReadObjFile(o,{onNewMaterial:function(e){var o=n.AddMaterial({name:e});s=n.GetMaterial(o),a[e]=o},onMaterialComponent:function(e,o,t,r){null!==s&&("Ka"==e?s.ambient=[o,t,r]:"Kd"==e?s.diffuse=[o,t,r]:"Ks"==e&&(s.specular=[o,t,r]))},onMaterialParameter:function(o,t){null!==s&&("Ns"==o?(s.shininess=0,e.IsPositive(t)&&(s.shininess=(Math.log2(parseFloat(t))-1)/10)):"Tr"==o?s.opacity=1-parseFloat(t):"d"==o&&(s.opacity=parseFloat(t)))},onMaterialTexture:function(e){if(null!==s){var o=r(e);if(null!==o){var t=new window.Blob([o]),n=window.URL.createObjectURL(t);s.texture=n}}},onUseMaterial:function(e){var o=a[e];void 0!==o&&(l=o)},onMesh:function(o){var t=n.AddBody(new e.TriangleBody(o));d=n.GetBody(t),h={},f={},g={}},onVertex:function(o,t,r){u.push(new e.Coord(o,t,r))},onNormal:function(o,t,r){y.push(new e.Coord(o,t,r))},onTexCoord:function(o,t){c.push(new e.Coord2D(o,t))},onFace:function(e,o,t){function r(e,o,t,r){if(!(t<0||t>=e.length)){var n=o[t];if(void 0===n){var i=e[t];n=r(i),o[t]=n}return n}}function n(e,o,t,n){return r(o,t,n,function(o){return e.AddVertex(o.x,o.y,o.z)})}function i(e,o,t,n){return r(o,t,n,function(o){return e.AddNormal(o.x,o.y,o.z)})}function a(e,o,t,n){return r(o,t,n,function(o){return e.AddUV(o.x,o.y)})}var s,x,p,T,C,v,A=o.length==e.length,m=t.length==e.length,B=e.length;for(s=0;s<B-2;s++)x=n(d,u,h,e[0]),p=n(d,u,h,e[(s+1)%B]),T=n(d,u,h,e[(s+2)%B]),v=d.AddTriangle(x,p,T),C=d.GetTriangle(v),A&&(C.n0=i(d,y,f,o[0]),C.n1=i(d,y,f,o[(s+1)%B]),C.n2=i(d,y,f,o[(s+2)%B])),m&&(C.u0=a(d,c,g,t[0]),C.u1=a(d,c,g,t[(s+1)%B]),C.u2=a(d,c,g,t[(s+2)%B])),null!==l&&(C.mat=l)},onFileRequested:r}),n.Finalize();var x=e.ConvertTriangleModelToJsonData(n);return x},e}),e("skylark-jsmodeler/import/importerstl",["../core/jsm"],function(e){return e.ReadBinaryStlFile=function(o,t){function r(e,o,r,n){void 0!==t.onFace&&null!==t.onFace&&t.onFace(e,o,r,n)}function n(e){var o,t=[];for(o=0;o<3;o++)t[o]=e.ReadFloat32();return t}void 0!==t&&null!==t||(t={});var i=new e.BinaryReader(o,!0);i.Skip(80);var d,a,s,l,u,y=i.ReadUnsignedInteger32();for(d=0;d<y;d++)u=n(i),a=n(i),s=n(i),l=n(i),i.Skip(2),r(a,s,l,u)},e.ReadAsciiStlFile=function(e,o){function t(e,t){function r(e,o){return e[o].trim()}var n=r(e,t);if(0===n.length)return t+1;var i=n.split(/\s+/);if(0===i.length)return t+1;if("solid"==i[0])return t+1;if("facet"==i[0]&&"normal"==i[1]){if(i.length<5)return-1;var d=[parseFloat(i[2]),parseFloat(i[3]),parseFloat(i[4])],a=[],s=function(e,o,t){var n,i,d,a;for(n=o;n<e.length&&t.length<3;n++)if(0!==(i=r(e,n)).length&&0!==(d=i.split(/\s+/)).length&&"vertex"==d[0]){if(d.length<4)break;a=[parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])],t.push(a)}return n+1}(e,t+1,a);return 3!=a.length?-1:(function(e,t,r,n){void 0!==o.onFace&&null!==o.onFace&&o.onFace(e,t,r,n)}(a[0],a[1],a[2],d),s)}return t+1}void 0!==o&&null!==o||(o={});for(var r=0,n=e.split("\n");r<n.length&&-1!=r;)r=t(n,r)},e.IsBinaryStlFile=function(o){var t=o.byteLength;if(t<84)return!1;var r=new e.BinaryReader(o,!0);r.Skip(80);var n=r.ReadUnsignedInteger32();return t==50*n+84},e.ConvertStlToJsonData=function(o,t){var r=new e.TriangleModel,n=r.AddBody(new e.TriangleBody("Default")),i=r.GetBody(n);null!==o?e.ReadBinaryStlFile(o,{onFace:function(o,t,r,n){var d=i.AddVertex(o[0],o[1],o[2]),a=i.AddVertex(t[0],t[1],t[2]),s=i.AddVertex(r[0],r[1],r[2]),l=new e.Vector(n[0],n[1],n[2]).Normalize(),u=i.AddNormal(l.x,l.y,l.z);i.AddTriangle(d,a,s,u,u,u)}}):null!==t&&e.ReadAsciiStlFile(t,{onFace:function(o,t,r,n){var d=i.AddVertex(o[0],o[1],o[2]),a=i.AddVertex(t[0],t[1],t[2]),s=i.AddVertex(r[0],r[1],r[2]),l=new e.Vector(n[0],n[1],n[2]).Normalize(),u=i.AddNormal(l.x,l.y,l.z);i.AddTriangle(d,a,s,u,u,u)}}),r.Finalize();var d=e.ConvertTriangleModelToJsonData(r);return d},e}),e("skylark-jsmodeler/import/importeroff",["../core/jsm"],function(e){return e.ReadOffFile=function(e,o){function t(e,t){if(0!==e.length&&"#"!=e[0]){var r,n,i,d=e.split(/\s+/);if(0!==d.length&&"#"!=d[0][0])if(t.offHeaderFound)if(t.infoFound)if(t.readVertices<t.vertexCount)3==d.length&&(r=parseFloat(d[0]),n=parseFloat(d[1]),i=parseFloat(d[2]),void 0!==o.onVertex&&null!==o.onVertex&&o.onVertex(r,n,i),t.readVertices+=1);else if(t.readFaces<t.faceCount){var a=parseInt(d[0]);if(d.length>=a+1){var s,l,u=[];for(s=1;s<a+1;s++)l=parseInt(d[s]),u.push(l);!function(e){void 0!==o.onFace&&null!==o.onFace&&o.onFace(e)}(u),t.readFaces+=1}}else;else 3==d.length&&(t.vertexCount=parseInt(d[0]),t.faceCount=parseInt(d[1]),t.infoFound=!0);else 1==d.length&&"OFF"==d[0]&&(t.offHeaderFound=!0)}}void 0!==o&&null!==o||(o={}),function(e){var o,r={offHeaderFound:!1,infoFound:!1,vertexCount:0,faceCount:0,readVertices:0,readFaces:0},n=e.split("\n");for(o=0;o<n.length;o++)t(n[o].trim(),r)}(e)},e.ConvertOffToJsonData=function(o){var t=new e.TriangleModel,r=t.AddBody(new e.TriangleBody("Default")),n=t.GetBody(r);e.ReadOffFile(o,{onVertex:function(e,o,t){n.AddVertex(e,o,t)},onFace:function(e){var o,t,r,i,d=e.length;for(o=0;o<d-2;o++)t=e[0],r=e[o+1],i=e[o+2],n.AddTriangle(t,r,i)}}),t.Finalize();var i=e.ConvertTriangleModelToJsonData(t);return i},e}),e("skylark-jsmodeler/import/importercommon",["../core/jsm"],function(e){return e.ImportFileList=function(){this.descriptors=null,this.isFile=null},e.ImportFileList.prototype.InitFromFiles=function(e){var o,t,r;for(this.descriptors=[],o=0;o<e.length;o++)t=e[o],r={originalObject:t,originalFileName:t.name,fileName:t.name.toUpperCase(),extension:this.GetFileExtension(t.name).toUpperCase()},this.descriptors.push(r);this.isFile=!0},e.ImportFileList.prototype.InitFromURLs=function(e){var o,t,r,n;for(this.descriptors=[],o=0;o<e.length;o++)t=e[o],r=this.GetFileName(t),n={originalObject:t,originalFileName:r,fileName:r.toUpperCase(),extension:this.GetFileExtension(r).toUpperCase()},this.descriptors.push(n);this.isFile=!1},e.ImportFileList.prototype.GetInputList=function(){function e(e){return".OBJ"!=e.extension&&".MTL"!=e.extension&&".OFF"!=e.extension}var o,t,r,n=[];for(o=0;o<this.descriptors.length;o++)t=this.descriptors[o],r={originalObject:t.originalObject,isFile:this.isFile,isArrayBuffer:e(t)},n.push(r);return n},e.ImportFileList.prototype.GetFileName=function(e){var o=e.split("/");if(1==o.length&&(o=e.split("\\")),0===o.length)return"";var t=o[o.length-1];return decodeURI(t)},e.ImportFileList.prototype.GetFileDescriptor=function(e){return this.descriptors[e]},e.ImportFileList.prototype.GetMainFileIndex=function(){var e,o;for(e=0;e<this.descriptors.length;e++)if(o=this.descriptors[e],this.IsSupportedExtension(o.extension))return e;return-1},e.ImportFileList.prototype.GetFileIndexByName=function(e){var o,t,r;for(o=0;o<this.descriptors.length;o++)if(t=this.descriptors[o],r=this.GetFileName(e),t.fileName==r.toUpperCase())return o;return-1},e.ImportFileList.prototype.IsSupportedExtension=function(e){return".3DS"==e||".OBJ"==e||".STL"==e||".OFF"==e},e.ImportFileList.prototype.GetFileExtension=function(e){var o=e.lastIndexOf(".");if(-1==o)return"";var t=e.substr(o);return t},e.ConvertImportFileListToJsonData=function(o,t){function r(){void 0!==t.onError&&null!==t.onError&&t.onError()}function n(e,o){void 0!==t.onReady&&null!==t.onReady&&t.onReady(e,o)}function i(e,o,t,r){var n=e.GetFileIndexByName(t),i=e.GetFileName(t);return-1==n?(r.missing.push(i),null):(-1==r.requested.indexOf(i)&&r.requested.push(i),o[n])}var d=o.GetMainFileIndex();if(-1!==d){var a=o.GetFileDescriptor(d),s={main:a.originalFileName,requested:[],missing:[]},l=o.GetInputList();try{".3DS"==a.extension?e.LoadMultipleBuffers(l,function(t){var a=t[d];if(null===a)r();else{var l=e.Convert3dsToJsonData(a,{onFileRequested:function(e){return i(o,t,e,s)}});n(s,l)}}):".OBJ"==a.extension?e.LoadMultipleBuffers(l,function(t){var a=t[d];if(null===a)r();else{var l=e.ConvertObjToJsonData(a,{onFileRequested:function(e){return i(o,t,e,s)}});n(s,l)}}):".STL"==a.extension?e.LoadMultipleBuffers(l,function(o){var t=o[d];if(null===t)r();else if(e.IsBinaryStlFile(t)){var i=e.ConvertStlToJsonData(t,null);n(s,i)}else{var a;for(a=0;a<l.length;a++)l[a].isArrayBuffer=!1;e.LoadMultipleBuffers(l,function(o){var t=o[d];if(null===t)r();else{var i=e.ConvertStlToJsonData(null,t);n(s,i)}})}}):".OFF"==a.extension&&e.LoadMultipleBuffers(l,function(o){var t=o[d];if(null===t)r();else{var i=e.ConvertOffToJsonData(t);n(s,i)}})}catch(e){return void r()}}else r()},e.ConvertFileListToJsonData=function(o,t){var r=new e.ImportFileList;r.InitFromFiles(o),e.ConvertImportFileListToJsonData(r,t)},e.ConvertURLListToJsonData=function(o,t){var r=new e.ImportFileList;r.InitFromURLs(o),e.ConvertImportFileListToJsonData(r,t)},e}),e("skylark-jsmodeler/renderer/webglutils",["../core/jsm"],function(e){return e.IsPowerOfTwo=function(e){return e&e-1==0},e.NextPowerOfTwo=function(o){if(e.IsPowerOfTwo(o))return o;for(var t=1;t<o;)t*=2;return t},e.ResizeImageToPowerOfTwoSides=function(o){if(e.IsPowerOfTwo(o.width)&&!e.IsPowerOfTwo(o.height))return o;var t=e.NextPowerOfTwo(o.width),r=e.NextPowerOfTwo(o.height),n=document.createElement("canvas");n.width=t,n.height=r;var i=n.getContext("2d");return i.drawImage(o,0,0,t,r),i.getImageData(0,0,t,r)},e.WebGLInitContext=function(e){if(null===e)return null;if(void 0===e.getContext)return null;var o=e.getContext("webgl")||e.getContext("experimental-webgl");return null===o?null:(o.viewport(0,0,e.width,e.height),o.clearColor(1,1,1,1),o)},e.WebGLInitShaderProgram=function(e,o,t,r){function n(e,o,t,r){var n=e.createShader(t);return e.shaderSource(n,o),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(void 0!==r&&null!==r&&r(e.getShaderInfoLog(n)),null)}var i=function(e,o,t,r){var i=n(e,o,e.FRAGMENT_SHADER,r),d=n(e,t,e.VERTEX_SHADER,r);if(null===i||null===d)return null;var a=e.createProgram();if(e.attachShader(a,d),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))return null;return a}(e,t,o,r);return null===i?null:(e.useProgram(i),i)},e.WebGLGetFloatTextureBufferSize=function(o){return e.NextPowerOfTwo(Math.ceil(Math.sqrt(o.length/4)))},e.WebGLCreateFloatTextureBuffer=function(e,o,t){var r=null;if(null!==o){for(;o.length<t*t*4;)o.push(0);r=new Float32Array(o)}var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,t,0,e.RGBA,e.FLOAT,r),e.bindTexture(e.TEXTURE_2D,null),n},e}),e("skylark-jsmodeler/renderer/renderlight",["../core/jsm"],function(e){return e.RenderAmbientLight=function(o){this.color=e.HexColorToNormalizedRGBComponents(o)},e.RenderDirectionalLight=function(o,t,r){this.diffuse=e.HexColorToNormalizedRGBComponents(o),this.specular=e.HexColorToNormalizedRGBComponents(t),this.direction=r.Clone()},e}),e("skylark-jsmodeler/renderer/rendermaterial",["../core/jsm"],function(e){return e.RenderMaterialFlags={Point:1,Line:2,Triangle:4,Textured:8,Transparent:16},e.RenderMaterial=function(o,t){this.type=o,this.ambient=[0,.8,0],this.diffuse=[0,.8,0],this.specular=[0,0,0],this.shininess=0,this.opacity=1,this.reflection=0,this.singleSided=!1,this.pointSize=.1,this.texture=null,e.CopyObjectProperties(t,this,!0)},e.RenderMaterial.prototype.SetType=function(e){this.type=e},e.RenderMaterial.prototype.SetBuffers=function(e,o){this.textureBuffer=e,this.textureImage=o},e}),e("skylark-jsmodeler/renderer/rendermesh",["../core/jsm"],function(e){return e.RenderMesh=function(e){this.material=e,this.vertexArray=null,this.normalArray=null,this.uvArray=null,this.vertexBuffer=null,this.normalBuffer=null,this.uvBuffer=null},e.RenderMesh.prototype.SetMaterial=function(e){this.material=e},e.RenderMesh.prototype.GetMaterial=function(){return this.material},e.RenderMesh.prototype.SetVertexArray=function(e){this.vertexArray=new Float32Array(e)},e.RenderMesh.prototype.SetNormalArray=function(e){this.normalArray=new Float32Array(e)},e.RenderMesh.prototype.SetUVArray=function(e){this.uvArray=new Float32Array(e)},e.RenderMesh.prototype.HasVertexArray=function(){return null!==this.vertexArray},e.RenderMesh.prototype.HasNormalArray=function(){return null!==this.normalArray},e.RenderMesh.prototype.HasUVArray=function(){return null!==this.uvArray},e.RenderMesh.prototype.GetVertexArray=function(){return this.vertexArray},e.RenderMesh.prototype.GetNormalArray=function(){return this.normalArray},e.RenderMesh.prototype.GetUVArray=function(){return this.uvArray},e.RenderMesh.prototype.SetBuffers=function(e,o,t){this.vertexBuffer=e,this.normalBuffer=o,this.uvBuffer=t},e.RenderMesh.prototype.GetVertexBuffer=function(){return this.vertexBuffer},e.RenderMesh.prototype.GetNormalBuffer=function(){return this.normalBuffer},e.RenderMesh.prototype.GetUVBuffer=function(){return this.uvBuffer},e.RenderMesh.prototype.VertexCount=function(){return parseInt(this.vertexArray.length/3,10)},e.RenderMesh.prototype.NormalCount=function(){return parseInt(this.normalArray.length/3,10)},e.RenderMesh.prototype.UVCount=function(){return parseInt(this.uvArray.length/2,10)},e.RenderMesh.prototype.GetVertex=function(o){return new e.Coord(this.vertexArray[3*o],this.vertexArray[3*o+1],this.vertexArray[3*o+2])},e.RenderMesh.prototype.GetTransformedVertex=function(e,o){var t=this.GetVertex(e);return o.Apply(t)},e}),e("skylark-jsmodeler/renderer/renderbody",["../core/jsm"],function(e){return e.RenderBody=function(){this.transformation=new e.Transformation,this.meshes={}},e.RenderBody.prototype.AddMesh=function(e){void 0===this.meshes[e.material.type]&&(this.meshes[e.material.type]=[]),this.meshes[e.material.type].push(e)},e.RenderBody.prototype.EnumerateMeshes=function(e){var o;for(o in this.meshes)this.meshes.hasOwnProperty(o)&&this.EnumerateTypedMeshes(o,e)},e.RenderBody.prototype.HasTypedMeshes=function(e){return void 0!==this.meshes[e]},e.RenderBody.prototype.EnumerateTypedMeshes=function(e,o){if(this.HasTypedMeshes(e)){var t,r,n=this.meshes[e];for(t=0;t<n.length;t++)r=n[t],o(r)}},e.RenderBody.prototype.EnumerateMeshesWithFlag=function(e,o){var t;for(t in this.meshes)this.meshes.hasOwnProperty(t)&&t&e&&this.EnumerateTypedMeshes(t,o)},e.RenderBody.prototype.GetTransformation=function(){return this.transformation},e.RenderBody.prototype.GetTransformationMatrix=function(){return this.transformation.matrix},e.RenderBody.prototype.SetTransformation=function(e){this.transformation=e},e.RenderBody.prototype.AppendTransformation=function(e){this.transformation.Append(e)},e}),e("skylark-jsmodeler/renderer/shaderprogram",["../core/jsm"],function(e){return e.ShaderType={Point:0,Line:1,Triangle:2,TexturedTriangle:3},e.ShaderProgram=function(e){this.context=e,this.globalParams=null,this.shaders=null,this.currentShader=null,this.currentType=null,this.cullEnabled=null},e.ShaderProgram.prototype.Init=function(){return!!this.InitGlobalParams()&&!!this.InitShaders()},e.ShaderProgram.prototype.GetMaxLightCount=function(){return this.globalParams.maxLightCount},e.ShaderProgram.prototype.InitGlobalParams=function(){var o=new e.RenderDirectionalLight(0,0,new e.Vector(0,0,0));return this.globalParams={noDirectionalLight:o,maxLightCount:4},!0},e.ShaderProgram.prototype.InitShaders=function(){function o(o,t,r,n){var i=function(o){var t=null;o==e.ShaderType.Triangle||o==e.ShaderType.TexturedTriangle?t=["#define "+(o==e.ShaderType.Triangle?"NOTEXTURE":"USETEXTURE"),"attribute mediump vec3 aVertexPosition;","attribute mediump vec3 aVertexNormal;","uniform mediump mat4 uViewMatrix;","uniform mediump mat4 uProjectionMatrix;","uniform mediump mat4 uTransformationMatrix;","varying mediump vec3 vVertex;","varying mediump vec3 vNormal;","#ifdef USETEXTURE","attribute mediump vec2 aVertexUV;","varying mediump vec2 vUV;","#endif","void main (void) {","\tmat4 modelViewMatrix = uViewMatrix * uTransformationMatrix;","\tvVertex = vec3 (modelViewMatrix * vec4 (aVertexPosition, 1.0));","\tvNormal = normalize (vec3 (modelViewMatrix * vec4 (aVertexNormal, 0.0)));","#ifdef USETEXTURE","\tvUV = aVertexUV;","#endif","\tgl_Position = uProjectionMatrix * vec4 (vVertex, 1.0);","}"].join("\n"):o!=e.ShaderType.Point&&o!=e.ShaderType.Line||(t=["#define "+(o==e.ShaderType.Point?"POINT":"LINE"),"attribute mediump vec3 aVertexPosition;","uniform mediump mat4 uViewMatrix;","uniform mediump mat4 uProjectionMatrix;","uniform mediump mat4 uTransformationMatrix;","#ifdef POINT","uniform mediump float uPointSize;","#endif","varying mediump vec3 vVertex;","void main (void) {","\tmat4 modelViewMatrix = uViewMatrix * uTransformationMatrix;","\tvVertex = vec3 (modelViewMatrix * vec4 (aVertexPosition, 1.0));","#ifdef POINT","\tconst mediump float scale = 200.0;","\tgl_PointSize = uPointSize * (scale / length (vVertex));","#endif","\tgl_Position = uProjectionMatrix * vec4 (vVertex, 1.0);","}"].join("\n"));return t}(n),d=function(o,t){var r=null;o==e.ShaderType.Point||o==e.ShaderType.Line?r=["#define MAX_LIGHTS "+t.maxLightCount,"struct Light","{","\tmediump vec3 diffuseColor;","};","struct Material","{","\tmediump vec3 ambientColor;","\tmediump vec3 diffuseColor;","};","uniform mediump vec3 uAmbientLightColor;","uniform Light uLights[MAX_LIGHTS];","uniform Material uMaterial;","void main (void) {","\tmediump vec3 ambientComponent = uMaterial.ambientColor * uAmbientLightColor;","\tmediump vec3 diffuseComponent = vec3 (0.0, 0.0, 0.0);","\tfor (int i = 0; i < MAX_LIGHTS; i++) {","\t\tdiffuseComponent += uMaterial.diffuseColor * uLights[i].diffuseColor;","\t}","\tgl_FragColor = vec4 (ambientComponent + diffuseComponent, 1.0);","}"].join("\n"):o!=e.ShaderType.Triangle&&o!=e.ShaderType.TexturedTriangle||(r=["#define "+(o==e.ShaderType.Triangle?"NOTEXTURE":"USETEXTURE"),"#define MAX_LIGHTS "+t.maxLightCount,"struct Light","{","\tmediump vec3 diffuseColor;","\tmediump vec3 specularColor;","\tmediump vec3 direction;","};","struct Material","{","\tmediump vec3 ambientColor;","\tmediump vec3 diffuseColor;","\tmediump vec3 specularColor;","\tmediump float shininess;","\tmediump float opacity;","};","uniform mediump vec3 uAmbientLightColor;","uniform Light uLights[MAX_LIGHTS];","uniform Material uMaterial;","varying mediump vec3 vVertex;","varying mediump vec3 vNormal;","#ifdef USETEXTURE","varying mediump vec2 vUV;","uniform sampler2D uSampler;","#endif","void main (void) {","\tmediump vec3 N = normalize (vNormal);","\tif (!gl_FrontFacing) {","\t\tN = -N;","\t}","\tmediump vec3 ambientComponent = uMaterial.ambientColor * uAmbientLightColor;","\tmediump vec3 diffuseComponent = vec3 (0.0, 0.0, 0.0);","\tmediump vec3 specularComponent = vec3 (0.0, 0.0, 0.0);","\tmediump vec3 E = normalize (-vVertex);","\tfor (int i = 0; i < MAX_LIGHTS; i++) {","\t\tmediump vec3 L = normalize (-uLights[i].direction);","\t\tmediump vec3 R = normalize (-reflect (L, N));","\t\tdiffuseComponent += uMaterial.diffuseColor * uLights[i].diffuseColor * max (dot (N, L), 0.0);","\t\tspecularComponent += uMaterial.specularColor * uLights[i].specularColor * pow (max (dot (R, E), 0.0), uMaterial.shininess);","\t}","#ifdef USETEXTURE","\tmediump vec3 textureColor = texture2D (uSampler, vec2 (vUV.s, vUV.t)).xyz;","\tambientComponent = ambientComponent * textureColor;","\tdiffuseComponent = diffuseComponent * textureColor;","\tspecularComponent = specularComponent * textureColor;","#endif","\tambientComponent = clamp (ambientComponent, 0.0, 1.0);","\tdiffuseComponent = clamp (diffuseComponent, 0.0, 1.0);","\tspecularComponent = clamp (specularComponent, 0.0, 1.0);","\tgl_FragColor = vec4 (ambientComponent + diffuseComponent + specularComponent, uMaterial.opacity);","}"].join("\n"));return r}(n,r);if(null===i||null===d)return!1;var a=e.WebGLInitShaderProgram(o,i,d,function(o){e.Message(o)});return null!==a&&(o.useProgram(a),function(o,t,r,n){if(n==e.ShaderType.Triangle||n==e.ShaderType.TexturedTriangle){var i;for(t.vertexPositionAttribute=o.getAttribLocation(t,"aVertexPosition"),t.vertexNormalAttribute=o.getAttribLocation(t,"aVertexNormal"),t.ambientLightColorUniform=o.getUniformLocation(t,"uAmbientLightColor"),t.lightUniforms=[],i=0;i<r.maxLightCount;i++)t.lightUniforms.push({diffuseColor:o.getUniformLocation(t,"uLights["+i+"].diffuseColor"),specularColor:o.getUniformLocation(t,"uLights["+i+"].specularColor"),direction:o.getUniformLocation(t,"uLights["+i+"].direction")});t.materialUniforms={ambientColor:o.getUniformLocation(t,"uMaterial.ambientColor"),diffuseColor:o.getUniformLocation(t,"uMaterial.diffuseColor"),specularColor:o.getUniformLocation(t,"uMaterial.specularColor"),shininess:o.getUniformLocation(t,"uMaterial.shininess"),opacity:o.getUniformLocation(t,"uMaterial.opacity")},t.vMatrixUniform=o.getUniformLocation(t,"uViewMatrix"),t.pMatrixUniform=o.getUniformLocation(t,"uProjectionMatrix"),t.tMatrixUniform=o.getUniformLocation(t,"uTransformationMatrix"),n==e.ShaderType.TexturedTriangle&&(t.vertexUVAttribute=o.getAttribLocation(t,"aVertexUV"),t.samplerUniform=o.getUniformLocation(t,"uSampler"))}else if(n==e.ShaderType.Point||n==e.ShaderType.Line){for(t.vertexPositionAttribute=o.getAttribLocation(t,"aVertexPosition"),t.ambientLightColorUniform=o.getUniformLocation(t,"uAmbientLightColor"),t.lightUniforms=[],i=0;i<r.maxLightCount;i++)t.lightUniforms.push({diffuseColor:o.getUniformLocation(t,"uLights["+i+"].diffuseColor")});t.materialUniforms={ambientColor:o.getUniformLocation(t,"uMaterial.ambientColor"),diffuseColor:o.getUniformLocation(t,"uMaterial.diffuseColor")},t.vMatrixUniform=o.getUniformLocation(t,"uViewMatrix"),t.pMatrixUniform=o.getUniformLocation(t,"uProjectionMatrix"),t.tMatrixUniform=o.getUniformLocation(t,"uTransformationMatrix"),n==e.ShaderType.Point&&(t.pointSizeUniform=o.getUniformLocation(t,"uPointSize"))}}(o,a,r,n),t[n]=a,!0)}return this.shaders={},!!o(this.context,this.shaders,this.globalParams,e.ShaderType.Point)&&(!!o(this.context,this.shaders,this.globalParams,e.ShaderType.Line)&&(!!o(this.context,this.shaders,this.globalParams,e.ShaderType.Triangle)&&(!!o(this.context,this.shaders,this.globalParams,e.ShaderType.TexturedTriangle)&&(this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LEQUAL),this.context.enable(this.context.BLEND),this.context.blendEquation(this.context.FUNC_ADD),this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE_MINUS_SRC_ALPHA),this.context.disable(this.context.CULL_FACE),this.cullEnabled=!1,!0))))},e.ShaderProgram.prototype.CompileMaterial=function(o,t){if(null!==o.texture){var r=this.context,n=r.createTexture(),i=new Image;i.src=o.texture,i.onload=function(){var o=e.ResizeImageToPowerOfTwoSides(i);r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),void 0!==t&&null!==t&&t()},o.SetBuffers(n,i)}},e.ShaderProgram.prototype.CompileMesh=function(e){var o=this.context,t=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,e.GetVertexArray(),o.STATIC_DRAW),t.itemSize=3,t.numItems=e.VertexCount();var r=null;e.HasNormalArray()&&(r=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,r),o.bufferData(o.ARRAY_BUFFER,e.GetNormalArray(),o.STATIC_DRAW),r.itemSize=3,r.numItems=e.NormalCount());var n=null;e.HasUVArray()&&(n=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,n),o.bufferData(o.ARRAY_BUFFER,e.GetUVArray(),o.STATIC_DRAW),n.itemSize=2,n.numItems=e.UVCount()),e.SetBuffers(t,r,n)},e.ShaderProgram.prototype.GetShader=function(e){return this.shaders[e]},e.ShaderProgram.prototype.UseShader=function(e){this.currentShader=this.GetShader(e),this.currentType=e,this.context.useProgram(this.currentShader)},e.ShaderProgram.prototype.SetParameters=function(o,t,r,n){function i(e,o,t){return o<e.length?e[o]:t}var d,a,s,l=this.context,u=this.currentShader;if(this.currentType==e.ShaderType.Triangle||this.currentType==e.ShaderType.TexturedTriangle){for(l.uniform3f(u.ambientLightColorUniform,o.color[0],o.color[1],o.color[2]),d=0;d<this.globalParams.maxLightCount;d++)a=i(t,d,this.globalParams.noDirectionalLight),s=e.ApplyRotation(r,a.direction),l.uniform3f(u.lightUniforms[d].diffuseColor,a.diffuse[0],a.diffuse[1],a.diffuse[2]),l.uniform3f(u.lightUniforms[d].specularColor,a.specular[0],a.specular[1],a.specular[2]),l.uniform3f(u.lightUniforms[d].direction,s.x,s.y,s.z);l.uniformMatrix4fv(u.pMatrixUniform,!1,n),l.uniformMatrix4fv(u.vMatrixUniform,!1,r)}else if(this.currentType==e.ShaderType.Point||this.currentType==e.ShaderType.Line){for(l.uniform3f(u.ambientLightColorUniform,o.color[0],o.color[1],o.color[2]),d=0;d<this.globalParams.maxLightCount;d++)a=i(t,d,this.globalParams.noDirectionalLight),l.uniform3f(u.lightUniforms[d].diffuseColor,a.diffuse[0],a.diffuse[1],a.diffuse[2]);l.uniformMatrix4fv(u.pMatrixUniform,!1,n),l.uniformMatrix4fv(u.vMatrixUniform,!1,r)}},e.ShaderProgram.prototype.SetCullEnabled=function(e){e&&!this.cullEnabled?(this.context.enable(this.context.CULL_FACE),this.cullEnabled=!0):!e&&this.cullEnabled&&(this.context.disable(this.context.CULL_FACE),this.cullEnabled=!1)},e.ShaderProgram.prototype.DrawArrays=function(o,t,r,n,i){var d=this.context,a=this.currentShader;this.SetCullEnabled(o.singleSided),this.currentType==e.ShaderType.Triangle||this.currentType==e.ShaderType.TexturedTriangle?(d.uniform3f(a.materialUniforms.ambientColor,o.ambient[0],o.ambient[1],o.ambient[2]),d.uniform3f(a.materialUniforms.diffuseColor,o.diffuse[0],o.diffuse[1],o.diffuse[2]),d.uniform3f(a.materialUniforms.specularColor,o.specular[0],o.specular[1],o.specular[2]),d.uniform1f(a.materialUniforms.shininess,o.shininess),d.uniform1f(a.materialUniforms.opacity,o.opacity),d.uniformMatrix4fv(a.tMatrixUniform,!1,t),d.bindBuffer(d.ARRAY_BUFFER,r),d.enableVertexAttribArray(a.vertexPositionAttribute),d.vertexAttribPointer(a.vertexPositionAttribute,r.itemSize,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,n),d.enableVertexAttribArray(a.vertexNormalAttribute),d.vertexAttribPointer(a.vertexNormalAttribute,n.itemSize,d.FLOAT,!1,0,0),this.currentType==e.ShaderType.TexturedTriangle&&(d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,o.textureBuffer),d.bindBuffer(d.ARRAY_BUFFER,i),d.enableVertexAttribArray(a.vertexUVAttribute),d.vertexAttribPointer(a.vertexUVAttribute,i.itemSize,d.FLOAT,!1,0,0),d.uniform1i(a.samplerUniform,0)),d.drawArrays(d.TRIANGLES,0,r.numItems)):this.currentType!=e.ShaderType.Point&&this.currentType!=e.ShaderType.Line||(d.uniform3f(a.materialUniforms.ambientColor,o.ambient[0],o.ambient[1],o.ambient[2]),d.uniform3f(a.materialUniforms.diffuseColor,o.diffuse[0],o.diffuse[1],o.diffuse[2]),d.uniformMatrix4fv(a.tMatrixUniform,!1,t),d.bindBuffer(d.ARRAY_BUFFER,r),d.enableVertexAttribArray(a.vertexPositionAttribute),d.vertexAttribPointer(a.vertexPositionAttribute,r.itemSize,d.FLOAT,!1,0,0),this.currentType==e.ShaderType.Point?(d.uniform1f(a.pointSizeUniform,o.pointSize),d.drawArrays(d.POINTS,0,r.numItems)):this.currentType==e.ShaderType.Line&&d.drawArrays(d.LINES,0,r.numItems))},e}),e("skylark-jsmodeler/renderer/renderer",["../core/jsm"],function(e){return e.Renderer=function(){this.canvas=null,this.context=null,this.shader=null,this.ambientLight=null,this.directionalLights=null,this.bodies=null},e.Renderer.prototype.Init=function(o){return!!e.IsWebGLEnabled()&&(!!this.InitContext(o)&&(!!this.InitView()&&(!!this.InitShaders()&&(!!this.InitLights()&&!!this.InitBodies()))))},e.Renderer.prototype.InitContext=function(o){return this.canvas=o,null!==this.canvas&&(void 0!==this.canvas.getContext&&(this.context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),null!==this.context&&(this.context=e.WebGLInitContext(o),null!==this.context)))},e.Renderer.prototype.InitShaders=function(){return this.shader=new e.ShaderProgram(this.context),this.shader.Init()},e.Renderer.prototype.InitLights=function(){return this.ambientLight=new e.RenderAmbientLight(0),this.directionalLights=[],!0},e.Renderer.prototype.InitBodies=function(){return this.bodies=[],!0},e.Renderer.prototype.InitView=function(){return this.directionalLights=[],!0},e.Renderer.prototype.SetClearColor=function(e,o,t){this.context.clearColor(e,o,t,1)},e.Renderer.prototype.SetAmbientLight=function(e){this.ambientLight=e},e.Renderer.prototype.AddLight=function(e){var o=this.shader.GetMaxLightCount();return this.directionalLights.length>=o?-1:(this.directionalLights.push(e),this.directionalLights.length-1)},e.Renderer.prototype.RemoveLight=function(e){var o=this.directionalLights.indexOf(e);-1!=o&&this.directionalLights.splice(o,1)},e.Renderer.prototype.RemoveLights=function(){this.directionalLights=[]},e.Renderer.prototype.GetLight=function(e){return this.directionalLights[e]},e.Renderer.prototype.AddBody=function(e,o){var t=this.shader;e.EnumerateMeshes(function(e){t.CompileMaterial(e.GetMaterial(),o),t.CompileMesh(e)}),this.bodies.push(e)},e.Renderer.prototype.AddBodies=function(e,o){var t,r;for(t=0;t<e.length;t++)r=e[t],this.AddBody(r,o)},e.Renderer.prototype.EnumerateBodies=function(e){var o;for(o=0;o<this.bodies.length;o++)e(this.bodies[o])},e.Renderer.prototype.RemoveBody=function(e){var o=this.bodies.indexOf(e);-1!=o&&this.bodies.splice(o,1)},e.Renderer.prototype.RemoveBodies=function(){this.bodies=[]},e.Renderer.prototype.GetBody=function(e){return this.bodies[e]},e.Renderer.prototype.Resize=function(){this.context.viewport(0,0,this.canvas.width,this.canvas.height)},e.Renderer.prototype.FindObjects=function(o,t,r){var n=new e.Coord(t,this.canvas.height-r,.5),i=this.canvas.width/this.canvas.height,d=[0,0,this.canvas.width,this.canvas.height],a=e.Unproject(n,o.eye,o.center,o.up,o.fieldOfView*e.DegRad,i,o.nearClippingPlane,o.farClippingPlane,d),s=new e.Ray(o.eye,e.CoordSub(a,o.eye),null),l=[];return this.EnumerateBodies(function(o){var t=o.GetTransformation();o.EnumerateMeshesWithFlag(e.RenderMaterialFlags.Triangle,function(r){var n,i,d,a,u,y=r.VertexCount();for(n=0;n<y;n+=3)i=r.GetTransformedVertex(n+0,t),d=r.GetTransformedVertex(n+1,t),a=r.GetTransformedVertex(n+2,t),null!==(u=e.RayTriangleIntersection(s,i,d,a))&&l.push({renderBody:o,renderMesh:r,triangleIndex:parseInt(n/3,10),intersection:u})})}),l.sort(function(e,o){return e.intersection.distance-o.intersection.distance}),l},e.Renderer.prototype.Render=function(o){function t(o,t,r,n){var i=null;o.EnumerateBodies(function(d){if(d.HasTypedMeshes(t)){var a=d.GetTransformationMatrix();d.EnumerateTypedMeshes(t,function(d){null===i&&(i=function(o){function t(e,o){return e&o}if(t(o,e.RenderMaterialFlags.Triangle)){if(t(o,e.RenderMaterialFlags.Textured))return e.ShaderType.TexturedTriangle;if(!t(o,e.RenderMaterialFlags.Textured))return e.ShaderType.Triangle}else{if(t(o,e.RenderMaterialFlags.Line))return e.ShaderType.Line;if(t(o,e.RenderMaterialFlags.Point))return e.ShaderType.Point}return null}(t),o.shader.UseShader(i),o.shader.SetParameters(o.ambientLight,o.directionalLights,r,n));var s=d.GetMaterial(),l=d.GetVertexBuffer(),u=d.GetNormalBuffer(),y=d.GetUVBuffer();o.shader.DrawArrays(s,a,l,u,y)})}})}this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var r=e.MatrixView(o.eye,o.center,o.up),n=e.MatrixPerspective(o.fieldOfView*e.DegRad,this.canvas.width/this.canvas.height,o.nearClippingPlane,o.farClippingPlane);t(this,e.RenderMaterialFlags.Triangle,r,n),t(this,e.RenderMaterialFlags.Triangle+e.RenderMaterialFlags.Textured,r,n),t(this,e.RenderMaterialFlags.Line,r,n),t(this,e.RenderMaterialFlags.Point,r,n),t(this,e.RenderMaterialFlags.Triangle+e.RenderMaterialFlags.Transparent,r,n),t(this,e.RenderMaterialFlags.Triangle+e.RenderMaterialFlags.Transparent+e.RenderMaterialFlags.Textured,r,n)},e}),e("skylark-jsmodeler/renderer/pointcloudrenderer",["../core/jsm"],function(e){return e.PointCloudRenderer=function(){this.canvas=null,this.context=null,this.shader=null,this.camera=null,this.points=null,this.pointSize=null},e.PointCloudRenderer.prototype.Init=function(o,t){return!!e.IsWebGLEnabled()&&(!!this.InitContext(o)&&(!!this.InitShaders()&&(!!this.InitBuffers()&&!!this.InitView(t))))},e.PointCloudRenderer.prototype.InitContext=function(e){return this.canvas=e,null!==this.canvas&&(void 0!==this.canvas.getContext&&(this.context=this.canvas.getContext("experimental-webgl"),null!==this.context&&(this.context.clearColor(1,1,1,1),this.context.enable(this.context.DEPTH_TEST),!0)))},e.PointCloudRenderer.prototype.InitShaders=function(){function e(e,o,t){var r=e.createShader(t);return e.shaderSource(r,o),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:null}var o=["varying highp vec3 vColor;","void main (void) {","\tgl_FragColor = vec4 (vColor, 1.0);","}"].join("\n"),t=["attribute highp vec3 aVertexPosition;","attribute highp vec3 aVertexColor;","uniform highp mat4 uViewMatrix;","uniform highp mat4 uProjectionMatrix;","uniform highp float uPointSize;","varying highp vec3 vColor;","void main (void) {","\tvColor = aVertexColor;","\tgl_PointSize = uPointSize;","\tgl_Position = uProjectionMatrix * uViewMatrix * vec4 (aVertexPosition, 1.0);","}"].join("\n"),r=e(this.context,o,this.context.FRAGMENT_SHADER),n=e(this.context,t,this.context.VERTEX_SHADER);return null!==r&&null!==n&&(this.shader=this.context.createProgram(),this.context.attachShader(this.shader,n),this.context.attachShader(this.shader,r),this.context.linkProgram(this.shader),!!this.context.getProgramParameter(this.shader,this.context.LINK_STATUS)&&(this.context.useProgram(this.shader),this.shader.vertexPositionAttribute=this.context.getAttribLocation(this.shader,"aVertexPosition"),this.context.enableVertexAttribArray(this.shader.vertexPositionAttribute),this.shader.vertexColorAttribute=this.context.getAttribLocation(this.shader,"aVertexColor"),this.context.enableVertexAttribArray(this.shader.vertexColorAttribute),this.shader.pMatrixUniform=this.context.getUniformLocation(this.shader,"uProjectionMatrix"),this.shader.vMatrixUniform=this.context.getUniformLocation(this.shader,"uViewMatrix"),this.shader.pointSizeUniform=this.context.getUniformLocation(this.shader,"uPointSize"),!0))},e.PointCloudRenderer.prototype.InitBuffers=function(){return this.points=[],this.pointSize=1,!0},e.PointCloudRenderer.prototype.InitView=function(o){return this.camera=e.ValueOrDefault(o,new e.Camera),!!this.camera},e.PointCloudRenderer.prototype.SetClearColor=function(e,o,t){this.context.clearColor(e,o,t,1)},e.PointCloudRenderer.prototype.SetPointSize=function(e){this.pointSize=e},e.PointCloudRenderer.prototype.AddPoints=function(e,o){var t=this.context.createBuffer(),r=new Float32Array(e);this.context.bindBuffer(this.context.ARRAY_BUFFER,t),this.context.bufferData(this.context.ARRAY_BUFFER,r,this.context.STATIC_DRAW),t.itemSize=3,t.numItems=parseInt(r.length/3,10);var n=this.context.createBuffer(),i=new Float32Array(o);this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.bufferData(this.context.ARRAY_BUFFER,i,this.context.STATIC_DRAW),n.itemSize=3,n.numItems=parseInt(i.length/3,10),this.points.push({pointArray:r,pointBuffer:t,colorBuffer:n})},e.PointCloudRenderer.prototype.RemovePoints=function(){this.points=[]},e.PointCloudRenderer.prototype.Resize=function(){this.context.viewport(0,0,this.canvas.width,this.canvas.height)},e.PointCloudRenderer.prototype.Render=function(){this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var o=e.MatrixPerspective(this.camera.fieldOfView*e.DegRad,this.canvas.width/this.canvas.height,this.camera.nearClippingPlane,this.camera.farClippingPlane);this.context.uniformMatrix4fv(this.shader.pMatrixUniform,!1,o);var t,r,n,i=e.MatrixView(this.camera.eye,this.camera.center,this.camera.up);for(this.context.uniformMatrix4fv(this.shader.vMatrixUniform,!1,i),this.context.uniform1f(this.shader.pointSizeUniform,this.pointSize),t=0;t<this.points.length;t++)r=this.points[t].pointBuffer,n=this.points[t].colorBuffer,this.context.bindBuffer(this.context.ARRAY_BUFFER,r),this.context.vertexAttribPointer(this.shader.vertexPositionAttribute,r.itemSize,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.vertexAttribPointer(this.shader.vertexColorAttribute,n.itemSize,this.context.FLOAT,!1,0,0),this.context.drawArrays(this.context.POINTS,0,r.numItems)},e}),e("skylark-jsmodeler/renderer/renderconverter",["../core/jsm"],function(e){return e.ConvertBodyToRenderBody=function(o,t,r){function n(o,t){var r=e.HexColorToNormalizedRGBComponents(o.ambient),n=e.HexColorToNormalizedRGBComponents(o.diffuse),i=e.HexColorToNormalizedRGBComponents(o.specular),d=new e.RenderMaterial(t,{ambient:r,diffuse:n,specular:i,shininess:o.shininess,opacity:o.opacity,singleSided:o.singleSided,pointSize:o.pointSize,texture:o.texture});return d}var i=!1;void 0!==r&&null!==r&&void 0!==r.hasConvexPolygons&&null!==r.hasConvexPolygons&&(i=r.hasConvexPolygons);var d=new e.RenderBody,a=null,s=null,l=null,u={hasConvexPolygons:i,onPointGeometryStart:function(){a=[],s=null,l=null},onPointGeometryEnd:function(o){var t=e.RenderMaterialFlags.Point,r=n(o,t),i=new e.RenderMesh(r);i.SetVertexArray(a),d.AddMesh(i)},onPoint:function(e){a.push(e.x,e.y,e.z)},onLineGeometryStart:function(){a=[],s=null,l=null},onLineGeometryEnd:function(o){var t=e.RenderMaterialFlags.Line,r=n(o,t),i=new e.RenderMesh(r);i.SetVertexArray(a),d.AddMesh(i)},onLine:function(e,o){a.push(e.x,e.y,e.z),a.push(o.x,o.y,o.z)},onGeometryStart:function(){a=[],s=[],l=[]},onGeometryEnd:function(o){var t=e.RenderMaterialFlags.Triangle;null!==o.texture&&(t+=e.RenderMaterialFlags.Textured),o.opacity<1&&(t+=e.RenderMaterialFlags.Transparent);var r=n(o,t),i=new e.RenderMesh(r);i.SetVertexArray(a),i.SetNormalArray(s),null!==o.texture&&i.SetUVArray(l),d.AddMesh(i)},onTriangle:function(e,o,t,r,n,i,d,u,y){a.push(e.x,e.y,e.z),a.push(o.x,o.y,o.z),a.push(t.x,t.y,t.z),s.push(r.x,r.y,r.z),s.push(n.x,n.y,n.z),s.push(i.x,i.y,i.z),null!==d&&null!==u&&null!==y&&(l.push(d.x,d.y),l.push(u.x,u.y),l.push(y.x,y.y))}};return e.ExplodeBody(o,t,u),d},e.ConvertModelToRenderBodies=function(o,t){var r,n,i,d=[],a=o.GetMaterialSet();for(r=0;r<o.BodyCount();r++)n=o.GetBody(r),i=e.ConvertBodyToRenderBody(n,a,t),d.push(i);return d},e.ConvertJSONDataToRenderBodies=function(o,t){function r(o,t,r,n){var i=function(o,t){function r(o,t,r){function n(o,t,r,n,i){var d=new e.Vector2D(o,t);if(!e.IsZero(i)){var a=Math.sin(i*e.DegRad),s=Math.cos(i*e.DegRad);d.x=s*o-a*t,d.y=a*o+s*t}return d.x=r[0]+d.x*n[0],d.y=r[1]+d.y*n[1],d}function i(e,o,t,r,n){var i,d,a;for(i=0;i<3;i++)for(d=t[r+i],a=0;a<n;a++)e.push(o[d*n+a])}var d=r[t.material],a=new e.RenderMaterial(e.RenderMaterialFlags.Triangle,{ambient:d.ambient||[1,1,1],diffuse:d.diffuse||[1,1,1],specular:d.specular||[1,1,1],shininess:d.shininess||0,opacity:d.opacity||1}),s=void 0!==d.texture&&null!==d.texture;s&&(a.SetType(e.RenderMaterialFlags.Triangle+e.RenderMaterialFlags.Textured),a.texture=d.texture,a.ambient=[1,1,1],a.diffuse=[1,1,1]);var l,u=new e.RenderMesh(a),y=[],c=[],h=[];for(l=0;l<t.parameters.length;l+=9)i(y,o.vertices,t.parameters,l,3),i(c,o.normals,t.parameters,l+3,3),i(h,o.uvs,t.parameters,l+6,2);if(s){var f,g=d.offset||[0,0],x=d.scale||[1,1],p=d.rotation||0;for(l=0;l<h.length;l+=2)f=n(h[l+0],h[l+1],g,x,p),h[l+0]=f.x,h[l+1]=-f.y}return u.SetVertexArray(y),u.SetNormalArray(c),u.SetUVArray(h),u}var n,i,d,a=new e.RenderBody;for(n=0;n<o.triangles.length;n++)i=o.triangles[n],d=r(o,i,t),a.AddMesh(d);return a}(o[r],t);n.push(i)}var n=[],i=o.materials;if(void 0===i)return n;var d=o.meshes;if(void 0===d)return n;var a=0;return e.AsyncRunTask(function(){return r(d,i,a,n),a+=1,!0},t,d.length,0,n),n},e}),e("skylark-jsmodeler/viewer/mouse",["../core/jsm"],function(e){return e.Mouse=function(){this.down=!1,this.button=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.prev=new e.Coord2D(0,0),this.curr=new e.Coord2D(0,0),this.diff=new e.Coord2D(0,0)},e.Mouse.prototype.Down=function(e,o){var t=e||window.event;this.down=!0,this.button=e.which,this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.alt=e.altKey,this.SetCurrent(t,o),this.prev=this.curr.Clone()},e.Mouse.prototype.Move=function(o,t){var r=o||window.event;this.shift=o.shiftKey,this.ctrl=o.ctrlKey,this.alt=o.altKey,this.SetCurrent(r,t),this.diff=e.CoordSub2D(this.curr,this.prev),this.prev=this.curr.Clone()},e.Mouse.prototype.Up=function(e,o){var t=e||window.event;this.down=!1,this.SetCurrent(t,o)},e.Mouse.prototype.Out=function(e,o){var t=e||window.event;this.down=!1,this.SetCurrent(t,o)},e.Mouse.prototype.SetCurrent=function(o,t){var r=o.clientX,n=o.clientY;if(void 0!==t.getBoundingClientRect){var i=t.getBoundingClientRect();r-=i.left,n-=i.top}void 0!==window.pageXOffset&&void 0!==window.pageYOffset&&(r+=window.pageXOffset,n+=window.pageYOffset),this.curr=new e.Coord2D(r,n)},e}),e("skylark-jsmodeler/viewer/touch",["../core/jsm"],function(e){return e.Touch=function(){this.down=!1,this.fingers=0,this.prev=new e.Coord2D,this.curr=new e.Coord2D,this.diff=new e.Coord2D},e.Touch.prototype.Start=function(e,o){0!==e.touches.length&&(this.down=!0,this.fingers=e.touches.length,this.SetCurrent(e,o),this.prev=this.curr.Clone())},e.Touch.prototype.Move=function(o,t){0!==o.touches.length&&(this.fingers=o.touches.length,this.SetCurrent(o,t),this.diff=e.CoordSub2D(this.curr,this.prev),this.prev=this.curr.Clone())},e.Touch.prototype.End=function(e,o){0!==e.touches.length&&(this.down=!1,this.SetCurrent(e,o))},e.Touch.prototype.SetCurrent=function(o,t){function r(o,t){var r=o.pageX,n=o.pageY;if(void 0!==t.getBoundingClientRect){var i=t.getBoundingClientRect();r-=i.left,n-=i.top}return void 0!==window.pageXOffset&&void 0!==window.pageYOffset&&(r+=window.pageXOffset,n+=window.pageYOffset),new e.Coord2D(r,n)}if(1==o.touches.length||3==o.touches.length)this.curr=r(o.touches[0],t);else if(2==o.touches.length){var n=r(o.touches[0],t).DistanceTo(r(o.touches[1],t));this.curr=new e.Coord2D(n,n)}},e}),e("skylark-jsmodeler/viewer/painter",["../core/jsm"],function(e){return e.OrderPolygons=function(o,t,r){function n(e,o,t){var r=e[o];e[o]=e[t],e[t]=r}function i(t){var r,n,i=o.GetPolygon(t),d=new e.Coord(0,0,0);for(r=0;r<i.VertexIndexCount();r++)n=o.GetVertexPosition(i.GetVertexIndex(r)),d=e.CoordAdd(d,n);return d.MultiplyScalar(1/i.VertexIndexCount()),d}function d(o,t){return!!e.IsLower(y[o],y[t])||!(!e.IsEqual(y[o],y[t])||!e.IsLower(h[o],h[t]))}function a(t,r){return null!==x[t][r]?x[t][r]:function(o,t){return e.IsLowerOrEqual(u[o],y[t])}(t,r)&&function(t,r){var n,i,d=f[t],a=f[r],s=!0,l=o.GetPolygon(t);for(n=0;n<l.VertexIndexCount();n++)if(i=o.GetVertexPosition(l.GetVertexIndex(n)),a.CoordPosition(i)===e.CoordPlanePosition.CoordInFrontOfPlane){s=!1;break}if(s)return!1;var u=!0,y=o.GetPolygon(r);for(n=0;n<y.VertexIndexCount();n++)if(i=o.GetVertexPosition(y.GetVertexIndex(n)),d.CoordPosition(i)===e.CoordPlanePosition.CoordAtBackOfPlane){u=!1;break}if(u)return!1;return!0}(t,r)?(x[t][r]=!0,!0):(x[t][r]=!1,!1)}var s,l,u=[],y=[],c=[],h=[],f=[],g=[],x=[],p=o.PolygonCount();for(s=0;s<p;s++)for(g.push(s),x.push([]),l=0;l<p;l++)x[s].push(null);return function(){var n,d,a,s,l,g,x,p,T,C,v,A,m,B=e.CoordSub(r,t).Normalize(),P=e.GetPlaneFromCoordAndDirection(t,B);for(n=0;n<o.PolygonCount();n++){for(g=e.Inf,x=-e.Inf,a=o.GetPolygon(n),d=0;d<a.VertexIndexCount();d++)s=o.GetVertexPosition(a.GetVertexIndex(d)),l=P.CoordDistance(s),e.IsLower(l,g)&&(g=l),e.IsGreater(l,x)&&(x=l);u.push(g),y.push(x),p=i(n),T=P.CoordDistance(p),c.push(p),h.push(T),C=e.CalculateBodyPolygonNormal(o,n),v=e.CoordSub(p,t).Normalize(),A=e.VectorDot(C,v),e.IsGreaterOrEqual(A,0)&&C.MultiplyScalar(-1),m=e.GetPlaneFromCoordAndDirection(p,C),f.push(m)}}(),function(){var e,o,t=g.length;for(e=0;e<t-1;e++)for(o=0;o<t-e-1;o++)d(g[o],g[o+1])&&n(g,o,o+1)}(),function(){var e,o,t=g.length;for(e=0;e<t-1;e++)for(o=0;o<t-e-1;o++)a(g[o],g[o+1])&&n(g,o,o+1)}(),g},e}),e("skylark-jsmodeler/viewer/drawing",["../core/jsm"],function(e){return e.CanvasDrawer=function(e){this.canvas=e,this.context=this.canvas.getContext("2d")},e.CanvasDrawer.prototype.GetWidth=function(){return this.canvas.width},e.CanvasDrawer.prototype.GetHeight=function(){return this.canvas.height},e.CanvasDrawer.prototype.Clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ffffff",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},e.CanvasDrawer.prototype.DrawLine=function(e,o){this.context.beginPath(),this.context.moveTo(e.x,this.canvas.height-e.y),this.context.lineTo(o.x,this.canvas.height-o.y),this.context.stroke()},e.CanvasDrawer.prototype.DrawPolygon=function(o,t,r){var n,i,d,a,s;for(this.context.fillStyle=(n=t,"rgb("+(i=e.HexColorToRGBComponents(n))[0]+","+i[1]+","+i[2]+")"),this.context.beginPath(),d=0;d<o.VertexCount();d++)a=o.GetVertex(d),0===d?this.context.moveTo(a.x,this.canvas.height-a.y):this.context.lineTo(a.x,this.canvas.height-a.y);if(this.context.closePath(),this.context.fill(),r)for(d=0;d<o.VertexCount();d++)a=o.GetVertex(d),s=o.GetVertex(d<o.VertexCount()-1?d+1:0),this.DrawLine(a,s)},e.SVGDrawer=function(e){this.svgObject=e,this.svgNameSpace="http://www.w3.org/2000/svg"},e.SVGDrawer.prototype.GetWidth=function(){return this.svgObject.getAttribute("width")},e.SVGDrawer.prototype.GetHeight=function(){return this.svgObject.getAttribute("height")},e.SVGDrawer.prototype.Clear=function(){for(;this.svgObject.lastChild;)this.svgObject.removeChild(this.svgObject.lastChild)},e.SVGDrawer.prototype.DrawLine=function(e,o){var t=document.createElementNS(this.svgNameSpace,"line"),r=this.GetHeight();t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"x1",e.x),t.setAttributeNS(null,"y1",r-e.y),t.setAttributeNS(null,"x2",o.x),t.setAttributeNS(null,"y2",r-o.y),this.svgObject.appendChild(t)},e.SVGDrawer.prototype.DrawPolygon=function(o,t){var r,n,i="",d=this.GetHeight();for(r=0;r<o.VertexCount();r++)n=o.GetVertex(r),i=i+n.x+", "+(d-n.y),r<o.VertexCount()-1&&(i+=", ");var a,s,l=document.createElementNS(this.svgNameSpace,"polygon");l.setAttributeNS(null,"points",i),l.setAttributeNS(null,"fill",(a=t,"rgb("+(s=e.HexColorToRGBComponents(a))[0]+","+s[1]+","+s[2]+")")),l.setAttributeNS(null,"fill-opacity","1.0"),l.setAttributeNS(null,"stroke","black"),this.svgObject.appendChild(l)},e.DrawProjectedBody=function(o,t,r,n,i,d){function a(o,t){var r=e.Project(t,T,C,v,A*e.DegRad,m,B,P,V);o.AddVertex(r.x,r.y)}function s(t){var r,n,i=new e.Polygon2D;for(r=0;r<t.VertexIndexCount();r++)n=o.GetVertexPosition(t.GetVertexIndex(r)),a(i,n);return i}i&&d.Clear();var l,u,y,c,h,f,g,x=d.GetWidth(),p=d.GetHeight(),T=r.eye,C=r.center,v=r.up,A=r.fieldOfView,m=x/p,B=r.nearClippingPlane,P=r.farClippingPlane,V=[0,0,x,p];if("HiddenLinePainter"==n){var w=e.OrderPolygons(o,T,C);for(void 0!==t&&null!==t||(t=new e.MaterialSet),l=0;l<w.length;l++)y=o.GetPolygon(w[l]),h=s(y),f=y.GetMaterialIndex(),g=t.GetMaterial(f).diffuse,d.DrawPolygon(h,g,!0)}else if("HiddenLineBSPTree"==n){void 0!==t&&null!==t||(t=new e.MaterialSet);var S=new e.BSPTree;e.AddBodyToBSPTree(o,S),e.TraverseBSPTreeForEyePosition(S,r.eye,function(r){h=function(o){var t,r,n=new e.Polygon2D;for(t=0;t<o.VertexCount();t++)r=o.GetVertex(t),a(n,r);return n}(r.polygon),y=o.GetPolygon(r.userData.originalPolygon),f=y.GetMaterialIndex(),g=t.GetMaterial(f).diffuse,d.DrawPolygon(h,g,!0)})}else if("HiddenLineFrontFacing"==n)for(void 0!==t&&null!==t||(t=new e.MaterialSet),l=0;l<o.PolygonCount();l++)y=o.GetPolygon(l),(h=s(y)).GetOrientation()==e.Orientation.CounterClockwise&&(f=y.GetMaterialIndex(),g=t.GetMaterial(f).diffuse,d.DrawPolygon(h,g,!0));else if("Wireframe"==n){var G,I,M,R,b=[];for(l=0;l<o.PolygonCount();l++)for(I=null,M=null,y=o.GetPolygon(l),G=y.VertexIndexCount(),u=0;u<=G;u++)R=y.GetVertexIndex(u%G),c=o.GetVertexPosition(R),h=e.Project(c,T,C,v,A*e.DegRad,m,B,P,V),null!==I&&null!==M&&void 0===b[[M,R]]&&(d.DrawLine(I,h),b[[M,R]]=!0,b[[R,M]]=!0),M=R,I=h}return!0},e}),e("skylark-jsmodeler/viewer/navigation",["../core/jsm"],function(e){return e.Navigation=function(){this.canvas=null,this.camera=null,this.drawCallback=null,this.resizeCallback=null,this.mouse=null,this.touch=null,this.cameraFixUp=null,this.cameraEnableOrbit=null,this.cameraEnablePan=null,this.cameraEnableZoom=null,this.cameraNearDistanceLimit=null,this.cameraFarDistanceLimit=null,this.orbitCenter=null,this.fullscreen=null},e.Navigation.prototype.Init=function(o,t,r,n){this.canvas=o,this.camera=t,this.drawCallback=r,this.resizeCallback=n,this.mouse=new e.Mouse,this.touch=new e.Touch,this.cameraFixUp=!0,this.cameraEnableOrbit=!0,this.cameraEnablePan=!0,this.cameraEnableZoom=!0,this.orbitCenter=this.camera.center.Clone(),this.fullscreen=!1;var i=this;return document.addEventListener&&(document.addEventListener("mousemove",function(e){i.OnMouseMove(e)}),document.addEventListener("mouseup",function(e){i.OnMouseUp(e)})),this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",function(e){i.OnMouseDown(e)},!1),this.canvas.addEventListener("DOMMouseScroll",function(e){i.OnMouseWheel(e)},!1),this.canvas.addEventListener("mousewheel",function(e){i.OnMouseWheel(e)},!1),this.canvas.addEventListener("touchstart",function(e){i.OnTouchStart(e)},!1),this.canvas.addEventListener("touchmove",function(e){i.OnTouchMove(e)},!1),this.canvas.addEventListener("touchend",function(e){i.OnTouchEnd(e)},!1),this.canvas.addEventListener("contextmenu",function(e){i.OnContextMenu(e)},!1)),window.addEventListener&&window.addEventListener("resize",function(e){i.OnResize(e)},!1),!0},e.Navigation.prototype.SetCamera=function(e,o,t){this.camera.Set(e,o,t),this.orbitCenter=this.camera.center.Clone()},e.Navigation.prototype.EnableFixUp=function(e){this.cameraFixUp=e},e.Navigation.prototype.EnableOrbit=function(e){this.cameraEnableOrbit=e},e.Navigation.prototype.EnablePan=function(e){this.cameraEnablePan=e},e.Navigation.prototype.EnableZoom=function(e){this.cameraEnableZoom=e},e.Navigation.prototype.SetNearDistanceLimit=function(e){this.cameraNearDistanceLimit=e},e.Navigation.prototype.SetFarDistanceLimit=function(e){this.cameraFarDistanceLimit=e},e.Navigation.prototype.SetOrbitCenter=function(e){this.orbitCenter=e},e.Navigation.prototype.FitInWindow=function(o,t){if(!e.IsZero(t)){var r=e.CoordSub(this.camera.center,o);this.camera.center=o,this.camera.eye=e.CoordSub(this.camera.eye,r);var n=e.CoordSub(this.camera.eye,this.camera.center).Normalize(),i=this.camera.fieldOfView/2;this.canvas.width<this.canvas.height&&(i=i*this.canvas.width/this.canvas.height);var d=t/Math.sin(i*e.DegRad);this.camera.eye=this.camera.center.Clone().Offset(n,d),this.orbitCenter=this.camera.center.Clone()}},e.Navigation.prototype.SetFullscreen=function(e){this.fullscreen=e,this.ResizeCallback()},e.Navigation.prototype.Orbit=function(o,t){var r=o*e.DegRad,n=t*e.DegRad,i=e.CoordSub(this.camera.center,this.camera.eye).Normalize(),d=e.VectorCross(i,this.camera.up).Normalize(),a=!this.orbitCenter.IsEqual(this.camera.center);if(this.cameraFixUp){var s=i.AngleTo(this.camera.up),l=s+n;e.IsGreater(l,0)&&e.IsLower(l,Math.PI)&&(this.camera.eye.Rotate(d,-n,this.orbitCenter),a&&this.camera.center.Rotate(d,-n,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-r,this.orbitCenter),a&&this.camera.center.Rotate(this.camera.up,-r,this.orbitCenter)}else{var u=e.VectorCross(d,i).Normalize();this.camera.eye.Rotate(d,-n,this.orbitCenter),this.camera.eye.Rotate(u,-r,this.orbitCenter),a&&(this.camera.center.Rotate(d,-n,this.orbitCenter),this.camera.center.Rotate(u,-r,this.orbitCenter)),this.camera.up=u}},e.Navigation.prototype.Pan=function(o,t){var r=e.CoordSub(this.camera.center,this.camera.eye).Normalize(),n=e.VectorCross(r,this.camera.up).Normalize(),i=e.VectorCross(n,r).Normalize();this.camera.eye.Offset(n,-o),this.camera.center.Offset(n,-o),this.camera.eye.Offset(i,t),this.camera.center.Offset(i,t)},e.Navigation.prototype.Zoom=function(o){var t=e.CoordSub(this.camera.center,this.camera.eye),r=t.Length(),n=o>0;if(n&&null!==this.cameraNearDistanceLimit&&r<this.cameraNearDistanceLimit)return 0;if(!n&&null!==this.cameraFarDistanceLimit&&r>this.cameraFarDistanceLimit)return 0;var i=r*o;this.camera.eye.Offset(t,i)},e.Navigation.prototype.DrawCallback=function(){void 0!==this.drawCallback&&null!==this.drawCallback&&this.drawCallback()},e.Navigation.prototype.ResizeCallback=function(){void 0!==this.resizeCallback&&null!==this.resizeCallback&&(this.fullscreen&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight),this.resizeCallback())},e.Navigation.prototype.OnMouseDown=function(e){e.preventDefault(),this.mouse.Down(e,this.canvas)},e.Navigation.prototype.OnMouseMove=function(e){if(e.preventDefault(),this.mouse.Move(e,this.canvas),this.mouse.down){var o=0;if(1==this.mouse.button){if(!this.cameraEnableOrbit)return;o=.5,this.Orbit(this.mouse.diff.x*o,this.mouse.diff.y*o)}else if(3==this.mouse.button){if(!this.cameraEnablePan)return;var t=this.camera.eye.DistanceTo(this.camera.center);o=.001*t,this.Pan(this.mouse.diff.x*o,this.mouse.diff.y*o)}this.DrawCallback()}},e.Navigation.prototype.OnMouseUp=function(e){e.preventDefault(),this.mouse.Up(e,this.canvas)},e.Navigation.prototype.OnMouseOut=function(e){e.preventDefault(),this.mouse.Out(e,this.canvas)},e.Navigation.prototype.OnMouseWheel=function(e){if(e.preventDefault(),this.cameraEnableZoom){var o=e;null===o&&(o=window.event);var t=0;o.detail?t=-o.detail:o.wheelDelta&&(t=o.wheelDelta/40);var r=.1;t<0&&(r*=-1),this.Zoom(r),this.DrawCallback()}},e.Navigation.prototype.OnTouchStart=function(e){e.preventDefault(),this.touch.Start(e,this.canvas)},e.Navigation.prototype.OnTouchMove=function(e){if(e.preventDefault(),this.touch.Move(e,this.canvas),this.touch.down){var o=0;if(1==this.touch.fingers){if(!this.cameraEnableOrbit)return;o=.5,this.Orbit(this.touch.diff.x*o,this.touch.diff.y*o)}else if(2==this.touch.fingers){if(!this.cameraEnableZoom)return;o=.005,this.Zoom(this.touch.diff.x*o)}else if(3==this.touch.fingers){if(!this.cameraEnablePan)return;var t=this.camera.eye.DistanceTo(this.camera.center);o=.001*t,this.Pan(this.touch.diff.x*o,this.touch.diff.y*o)}this.DrawCallback()}},e.Navigation.prototype.OnTouchEnd=function(e){e.preventDefault(),this.touch.End(e,this.canvas)},e.Navigation.prototype.OnContextMenu=function(e){e.preventDefault()},e.Navigation.prototype.OnResize=function(e){e.preventDefault(),this.ResizeCallback()},e}),e("skylark-jsmodeler/viewer/softwareviewer",["../core/jsm"],function(e){return e.SoftwareViewer=function(){this.canvas=null,this.camera=null,this.bodies=null,this.drawer=null,this.drawMode=null,this.navigation=null},e.SoftwareViewer.prototype.Start=function(e,o){return!!this.InitCanvas(e)&&!!this.InitCamera(o)},e.SoftwareViewer.prototype.InitCanvas=function(o){return this.bodies=[],this.canvas=o,!!this.canvas&&(this.canvas instanceof HTMLCanvasElement?this.drawer=new e.CanvasDrawer(this.canvas):this.canvas instanceof SVGSVGElement&&(this.drawer=new e.SVGDrawer(this.canvas)),!!this.drawer&&(this.drawMode="Wireframe",!0))},e.SoftwareViewer.prototype.InitCamera=function(o){return this.camera=e.ValueOrDefault(o,new e.Camera),!!this.camera&&(this.navigation=new e.Navigation,!!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this),this.Resize.bind(this)))},e.SoftwareViewer.prototype.AddBody=function(e,o){this.bodies.push([e,o])},e.SoftwareViewer.prototype.RemoveBodies=function(){this.bodies=[]},e.SoftwareViewer.prototype.FitInWindow=function(){var e=this.GetBoundingSphere();this.navigation.FitInWindow(e.GetCenter(),e.GetRadius()),this.Draw()},e.SoftwareViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.SoftwareViewer.prototype.GetBoundingBox=function(){var o,t,r,n,i=new e.Coord(e.Inf,e.Inf,e.Inf),d=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(o=0;o<this.bodies.length;o++)for(r=this.bodies[o][0],t=0;t<r.VertexCount();t++)n=r.GetVertex(t),i.x=e.Minimum(i.x,n.position.x),i.y=e.Minimum(i.y,n.position.y),i.z=e.Minimum(i.z,n.position.z),d.x=e.Maximum(d.x,n.position.x),d.y=e.Maximum(d.y,n.position.y),d.z=e.Maximum(d.z,n.position.z);return new e.Box(i,d)},e.SoftwareViewer.prototype.GetBoundingSphere=function(){var o,t,r,n,i,d=this.GetCenter(),a=0;for(o=0;o<this.bodies.length;o++)for(r=this.bodies[o][0],t=0;t<r.VertexCount();t++)n=r.GetVertex(t),i=d.DistanceTo(n.position),e.IsGreater(i,a)&&(a=i);var s=new e.Sphere(d,a);return s},e.SoftwareViewer.prototype.Resize=function(){this.Draw()},e.SoftwareViewer.prototype.Draw=function(){var o,t;for(this.drawer.Clear(),o=0;o<this.bodies.length;o++)t=this.bodies[o],e.DrawProjectedBody(t[0],t[1],this.camera,this.drawMode,!1,this.drawer);return!0},e}),e("skylark-jsmodeler/viewer/spriteviewer",["../core/jsm"],function(e){return e.SpriteViewer=function(){this.canvas=null,this.camera=null,this.callbacks=null,this.points=null,this.projected=null,this.navigation=null},e.SpriteViewer.prototype.Start=function(e,o,t){return!!this.InitCanvas(e)&&(!!this.InitCamera(o)&&!!this.InitCallbacks(t))},e.SpriteViewer.prototype.InitCanvas=function(e){return this.points=[],this.canvas=e,!!this.canvas},e.SpriteViewer.prototype.InitCamera=function(o){return this.camera=e.ValueOrDefault(o,new e.Camera),!!this.camera&&(this.navigation=new e.Navigation,!!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this)))},e.SpriteViewer.prototype.InitCallbacks=function(e){return this.callbacks={onPointDraw:null},void 0!==e&&(void 0!==e.onDrawStart&&(this.callbacks.onDrawStart=e.onDrawStart),void 0!==e.onPointDraw&&(this.callbacks.onPointDraw=e.onPointDraw),void 0!==e.onDrawEnd&&(this.callbacks.onDrawEnd=e.onDrawEnd)),!0},e.SpriteViewer.prototype.AddPoint=function(e){this.points.push(e)},e.SpriteViewer.prototype.RemovePoints=function(){this.points=[]},e.SpriteViewer.prototype.Resize=function(){this.Draw()},e.SpriteViewer.prototype.NearestPointUnderPosition=function(o,t,r){var n,i,d,a=new e.Coord2D(t,r),s=-1,l=e.Inf;for(n=0;n<this.projected.length;n++)i=this.projected[n],d=a.DistanceTo(new e.Coord2D(i.position.x,i.position.y)),e.IsLower(d,o)&&e.IsLower(d,l)&&(s=i.originalIndex,l=d);return s},e.SpriteViewer.prototype.NearestPointUnderMouse=function(e){return this.NearestPointUnderPosition(e,this.navigation.mouse.curr.x,this.navigation.mouse.curr.y)},e.SpriteViewer.prototype.NearestPointUnderTouch=function(e){return this.NearestPointUnderPosition(e,this.navigation.touch.curr.x,this.navigation.touch.curr.y)},e.SpriteViewer.prototype.FitInWindow=function(){var e=this.GetBoundingSphere();this.navigation.FitInWindow(e.GetCenter(),e.GetRadius()),this.Draw()},e.SpriteViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.SpriteViewer.prototype.GetBoundingBox=function(){var o,t,r=new e.Coord(e.Inf,e.Inf,e.Inf),n=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(o=0;o<this.points.length;o++)t=this.points[o],r.x=e.Minimum(r.x,t.x),r.y=e.Minimum(r.y,t.y),r.z=e.Minimum(r.z,t.z),n.x=e.Maximum(n.x,t.x),n.y=e.Maximum(n.y,t.y),n.z=e.Maximum(n.z,t.z);return new e.Box(r,n)},e.SpriteViewer.prototype.GetBoundingSphere=function(){var o,t,r,n=this.GetCenter(),i=0;for(o=0;o<this.points.length;o++)t=this.points[o],r=n.DistanceTo(t),e.IsGreater(r,i)&&(i=r);var d=new e.Sphere(n,i);return d},e.SpriteViewer.prototype.Draw=function(){null!==this.callbacks.onDrawStart&&this.callbacks.onDrawStart(this.canvas);var o,t,r,n=this.canvas.width/this.canvas.height,i=[0,0,this.canvas.width,this.canvas.height];for(this.projected=[],o=0;o<this.points.length;o++)t=this.points[o],(r=e.Project(t,this.camera.eye,this.camera.center,this.camera.up,this.camera.fieldOfView*e.DegRad,n,this.camera.nearClippingPlane,this.camera.farClippingPlane,i)).y=this.canvas.height-r.y,null!==r&&this.projected.push({position:r,originalIndex:o});for(this.projected.sort(function(e,o){return e.position.z>o.position.z?-1:e.position.z<o.position.z?1:0}),o=0;o<this.projected.length;o++)null!==this.callbacks.onPointDraw&&this.callbacks.onPointDraw(this.canvas,this.projected[o].originalIndex,this.projected[o].position);return null!==this.callbacks.onDrawEnd&&this.callbacks.onDrawEnd(this.canvas),!0},e}),e("skylark-jsmodeler/viewer/viewer",["../core/jsm"],function(e){return e.Viewer=function(){this.camera=null,this.renderer=null,this.navigation=null,this.cameraLight=null},e.Viewer.prototype.Init=function(e,o){return!!this.InitRenderer(e)&&(!!this.InitNavigation(o)&&!!this.InitLights())},e.Viewer.prototype.Reset=function(){this.RemoveBodies(),this.RemoveLights(),this.SetAmbientLight(new e.RenderAmbientLight(8355711)),this.EnableCameraLight()},e.Viewer.prototype.InitRenderer=function(o){return this.renderer=new e.Renderer,!!this.renderer.Init(o)},e.Viewer.prototype.InitNavigation=function(o){return this.camera=e.ValueOrDefault(o,new e.Camera),!!this.camera&&(this.navigation=new e.Navigation,!!this.navigation.Init(this.renderer.canvas,this.camera,this.Draw.bind(this),this.Resize.bind(this)))},e.Viewer.prototype.InitLights=function(){return this.SetAmbientLight(new e.RenderAmbientLight(8355711)),this.EnableCameraLight(),!0},e.Viewer.prototype.SetClearColor=function(e,o,t){this.renderer.SetClearColor(e,o,t)},e.Viewer.prototype.EnableCameraLight=function(){null===this.cameraLight&&(this.cameraLight=new e.RenderDirectionalLight(8355711,16777215,new e.Vector(1,0,0)),this.AddLight(this.cameraLight))},e.Viewer.prototype.DisableCameraLight=function(){null!==this.cameraLight&&(this.RemoveLight(this.cameraLight),this.cameraLight=null)},e.Viewer.prototype.GetCameraLight=function(){return this.cameraLight},e.Viewer.prototype.SetAmbientLight=function(e){this.renderer.SetAmbientLight(e)},e.Viewer.prototype.AddLight=function(e){this.renderer.AddLight(e)},e.Viewer.prototype.RemoveLight=function(e){this.renderer.RemoveLight(e)},e.Viewer.prototype.RemoveLights=function(){this.renderer.RemoveLights(),this.cameraLight=null},e.Viewer.prototype.AddBody=function(e){this.renderer.AddBody(e,this.Draw.bind(this))},e.Viewer.prototype.AddBodies=function(e){this.renderer.AddBodies(e,this.Draw.bind(this))},e.Viewer.prototype.RemoveBody=function(e){this.renderer.RemoveBody(e)},e.Viewer.prototype.RemoveBodies=function(){this.renderer.RemoveBodies()},e.Viewer.prototype.FitInWindow=function(){var e=this.GetBoundingSphere();this.navigation.FitInWindow(e.GetCenter(),e.GetRadius())},e.Viewer.prototype.SetFullscreen=function(e){this.navigation.SetFullscreen(e)},e.Viewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.Viewer.prototype.GetBoundingBox=function(){var o=new e.Coord(e.Inf,e.Inf,e.Inf),t=new e.Coord(-e.Inf,-e.Inf,-e.Inf);return this.renderer.EnumerateBodies(function(r){var n=r.GetTransformation();r.EnumerateMeshes(function(r){var i,d;for(i=0;i<r.VertexCount();i++)d=r.GetTransformedVertex(i,n),o.x=e.Minimum(o.x,d.x),o.y=e.Minimum(o.y,d.y),o.z=e.Minimum(o.z,d.z),t.x=e.Maximum(t.x,d.x),t.y=e.Maximum(t.y,d.y),t.z=e.Maximum(t.z,d.z)})}),new e.Box(o,t)},e.Viewer.prototype.GetBoundingSphere=function(){var o=this.GetCenter(),t=0;this.renderer.EnumerateBodies(function(r){var n=r.GetTransformation();r.EnumerateMeshes(function(r){var i,d,a;for(i=0;i<r.VertexCount();i++)d=r.GetTransformedVertex(i,n),a=o.DistanceTo(d),e.IsGreater(a,t)&&(t=a)})});var r=new e.Sphere(o,t);return r},e.Viewer.prototype.FindObjects=function(e,o){return this.renderer.FindObjects(this.camera,e,o)},e.Viewer.prototype.Resize=function(){this.renderer.Resize(),this.Draw()},e.Viewer.prototype.Draw=function(){var o=this.camera,t=this.GetCameraLight();null!==t&&(t.direction=e.CoordSub(o.center,o.eye).Normalize()),this.renderer.Render(o)},e}),e("skylark-jsmodeler/viewer/pointcloudviewer",["../core/jsm"],function(e){return e.PointCloudViewer=function(){this.canvas=null,this.renderer=null,this.navigation=null},e.PointCloudViewer.prototype.Init=function(e,o){return!!this.InitRenderer(e,o)&&!!this.InitNavigation()},e.PointCloudViewer.prototype.InitRenderer=function(o,t){return this.renderer=new e.PointCloudRenderer,!!this.renderer.Init(o,t)},e.PointCloudViewer.prototype.InitNavigation=function(){return this.navigation=new e.Navigation,!!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))},e.PointCloudViewer.prototype.SetClearColor=function(e,o,t){this.renderer.SetClearColor(e,o,t)},e.PointCloudViewer.prototype.SetPointSize=function(e){this.renderer.SetPointSize(e)},e.PointCloudViewer.prototype.AddPoints=function(e,o){this.renderer.AddPoints(e,o)},e.PointCloudViewer.prototype.RemovePoints=function(){this.renderer.RemovePoints()},e.PointCloudViewer.prototype.FitInWindow=function(){var e=this.GetBoundingSphere();this.navigation.FitInWindow(e.GetCenter(),e.GetRadius()),this.Draw()},e.PointCloudViewer.prototype.GetCenter=function(){var e=this.GetBoundingBox();return e.GetCenter()},e.PointCloudViewer.prototype.GetBoundingBox=function(){var o,t,r,n,i=new e.Coord(e.Inf,e.Inf,e.Inf),d=new e.Coord(-e.Inf,-e.Inf,-e.Inf);for(o=0;o<this.renderer.points.length;o++)for(r=this.renderer.points[o].pointArray,t=0;t<r.length;t+=3)n=new e.Coord(r[t],r[t+1],r[t+2]),i.x=e.Minimum(i.x,n.x),i.y=e.Minimum(i.y,n.y),i.z=e.Minimum(i.z,n.z),d.x=e.Maximum(d.x,n.x),d.y=e.Maximum(d.y,n.y),d.z=e.Maximum(d.z,n.z);return new e.Box(i,d)},e.PointCloudViewer.prototype.GetBoundingSphere=function(){var o,t,r,n,i,d=this.GetCenter(),a=0;for(o=0;o<this.renderer.points.length;o++)for(r=this.renderer.points[o].pointArray,t=0;t<r.length;t+=3)n=new e.Coord(r[t],r[t+1],r[t+2]),i=d.DistanceTo(n),e.IsGreater(i,a)&&(a=i);var s=new e.Sphere(d,a);return s},e.PointCloudViewer.prototype.Resize=function(){this.renderer.Resize(),this.Draw()},e.PointCloudViewer.prototype.Draw=function(){this.renderer.Render()},e}),e("skylark-jsmodeler/extras/solidgenerator",["../core/jsm"],function(e){return e.GenerateSolidWithRadius=function(o,t){var r=new e.Body,n=!0;if("Tetrahedron"===o?r=e.GenerateTetrahedron():"Hexahedron"===o?r=e.GenerateHexahedron():"Octahedron"===o?r=e.GenerateOctahedron():"Dodecahedron"===o?r=e.GenerateDodecahedron():"Icosahedron"===o?r=e.GenerateIcosahedron():"TruncatedTetrahedron"===o?r=e.GenerateTruncatedTetrahedron():"Cuboctahedron"===o?r=e.GenerateCuboctahedron():"TruncatedCube"===o?r=e.GenerateTruncatedCube():"TruncatedOctahedron"===o?r=e.GenerateTruncatedOctahedron():"Rhombicuboctahedron"===o?r=e.GenerateRhombicuboctahedron():"TruncatedCuboctahedron"===o?r=e.GenerateTruncatedCuboctahedron():"SnubCube"===o?r=e.GenerateSnubCube():"Icosidodecahedron"===o?r=e.GenerateIcosidodecahedron():"TruncatedDodecahedron"===o?r=e.GenerateTruncatedDodecahedron():"TruncatedIcosahedron"===o?r=e.GenerateTruncatedIcosahedron():"Rhombicosidodecahedron"===o?r=e.GenerateRhombicosidodecahedron():"TruncatedIcosidodecahedron"===o?r=e.GenerateTruncatedIcosidodecahedron():"SnubDodecahedron"===o?r=e.GenerateSnubDodecahedron():"TetrakisHexahedron"===o?(r=e.GenerateTetrakisHexahedron(),n=!1):"RhombicDodecahedron"===o?(r=e.GenerateRhombicDodecahedron(),n=!1):"PentakisDodecahedron"===o?(r=e.GeneratePentakisDodecahedron(),n=!1):"SmallStellatedDodecahedron"===o?(r=e.GenerateSmallStellatedDodecahedron(),n=!1):"GreatDodecahedron"===o?(r=e.GenerateGreatDodecahedron(),n=!1):"SmallTriambicIcosahedron"===o?(r=e.GenerateSmallTriambicIcosahedron(),n=!1):"GreatStellatedDodecahedron"===o?(r=e.GenerateGreatStellatedDodecahedron(),n=!1):"SmallTriakisOctahedron"===o?(r=e.GenerateSmallTriakisOctahedron(),n=!1):"StellaOctangula"===o?(r=e.GenerateStellaOctangula(),n=!1):"TriakisTetrahedron"===o&&(r=e.GenerateTriakisTetrahedron(),n=!1),r.VertexCount()>0){var i,d,a=0;if(n)a=r.GetVertexPosition(0).Length();else for(i=0;i<r.VertexCount();i++)d=r.GetVertexPosition(i).Length(),e.IsGreater(d,a)&&(a=d);var s=t/a;for(i=0;i<r.VertexCount();i++)r.GetVertex(i).position.MultiplyScalar(s)}return r},e.GenerateTetrahedron=function(){var o=new e.Body;return o.AddVertex(new e.BodyVertex(new e.Coord(1,1,1))),o.AddVertex(new e.BodyVertex(new e.Coord(-1,-1,1))),o.AddVertex(new e.BodyVertex(new e.Coord(-1,1,-1))),o.AddVertex(new e.BodyVertex(new e.Coord(1,-1,-1))),o.AddPolygon(new e.BodyPolygon([0,1,3])),o.AddPolygon(new e.BodyPolygon([0,2,1])),o.AddPolygon(new e.BodyPolygon([0,3,2])),o.AddPolygon(new e.BodyPolygon([1,2,3])),o},e.GenerateHexahedron=function(){var o=new e.Body;return e.AddVertexToBody(o,1,1,1),e.AddVertexToBody(o,1,1,-1),e.AddVertexToBody(o,1,-1,1),e.AddVertexToBody(o,1,-1,-1),e.AddVertexToBody(o,-1,1,1),e.AddVertexToBody(o,-1,1,-1),e.AddVertexToBody(o,-1,-1,1),e.AddVertexToBody(o,-1,-1,-1),e.AddPolygonToBody(o,[0,1,5,4]),e.AddPolygonToBody(o,[0,2,3,1]),e.AddPolygonToBody(o,[0,4,6,2]),e.AddPolygonToBody(o,[1,3,7,5]),e.AddPolygonToBody(o,[2,6,7,3]),e.AddPolygonToBody(o,[4,5,7,6]),o},e.GenerateOctahedron=function(){var o=new e.Body;return e.AddVertexToBody(o,1,0,0),e.AddVertexToBody(o,-1,0,0),e.AddVertexToBody(o,0,1,0),e.AddVertexToBody(o,0,-1,0),e.AddVertexToBody(o,0,0,1),e.AddVertexToBody(o,0,0,-1),e.AddPolygonToBody(o,[0,2,4]),e.AddPolygonToBody(o,[0,3,5]),e.AddPolygonToBody(o,[0,4,3]),e.AddPolygonToBody(o,[0,5,2]),e.AddPolygonToBody(o,[1,2,5]),e.AddPolygonToBody(o,[1,3,4]),e.AddPolygonToBody(o,[1,4,2]),e.AddPolygonToBody(o,[1,5,3]),o},e.GenerateDodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=1/t;return e.AddVertexToBody(o,1,1,1),e.AddVertexToBody(o,1,1,-1),e.AddVertexToBody(o,1,-1,1),e.AddVertexToBody(o,-1,1,1),e.AddVertexToBody(o,1,-1,-1),e.AddVertexToBody(o,-1,1,-1),e.AddVertexToBody(o,-1,-1,1),e.AddVertexToBody(o,-1,-1,-1),e.AddVertexToBody(o,0,+r,+t),e.AddVertexToBody(o,0,+r,-t),e.AddVertexToBody(o,0,-r,+t),e.AddVertexToBody(o,0,-r,-t),e.AddVertexToBody(o,+r,+t,0),e.AddVertexToBody(o,+r,-t,0),e.AddVertexToBody(o,-r,+t,0),e.AddVertexToBody(o,-r,-t,0),e.AddVertexToBody(o,+t,0,+r),e.AddVertexToBody(o,-t,0,+r),e.AddVertexToBody(o,+t,0,-r),e.AddVertexToBody(o,-t,0,-r),e.AddPolygonToBody(o,[0,8,10,2,16]),e.AddPolygonToBody(o,[0,16,18,1,12]),e.AddPolygonToBody(o,[0,12,14,3,8]),e.AddPolygonToBody(o,[1,9,5,14,12]),e.AddPolygonToBody(o,[1,18,4,11,9]),e.AddPolygonToBody(o,[2,10,6,15,13]),e.AddPolygonToBody(o,[2,13,4,18,16]),e.AddPolygonToBody(o,[3,14,5,19,17]),e.AddPolygonToBody(o,[3,17,6,10,8]),e.AddPolygonToBody(o,[4,13,15,7,11]),e.AddPolygonToBody(o,[5,9,11,7,19]),e.AddPolygonToBody(o,[6,17,19,7,15]),o},e.GenerateIcosahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2;return e.AddVertexToBody(o,0,1,+t),e.AddVertexToBody(o,0,1,-t),e.AddVertexToBody(o,0,-1,+t),e.AddVertexToBody(o,0,-1,-t),e.AddVertexToBody(o,1,+t,0),e.AddVertexToBody(o,1,-t,0),e.AddVertexToBody(o,-1,+t,0),e.AddVertexToBody(o,-1,-t,0),e.AddVertexToBody(o,+t,0,1),e.AddVertexToBody(o,+t,0,-1),e.AddVertexToBody(o,-t,0,1),e.AddVertexToBody(o,-t,0,-1),e.AddPolygonToBody(o,[0,2,8]),e.AddPolygonToBody(o,[0,4,6]),e.AddPolygonToBody(o,[0,6,10]),e.AddPolygonToBody(o,[0,8,4]),e.AddPolygonToBody(o,[0,10,2]),e.AddPolygonToBody(o,[1,3,11]),e.AddPolygonToBody(o,[1,4,9]),e.AddPolygonToBody(o,[1,6,4]),e.AddPolygonToBody(o,[1,9,3]),e.AddPolygonToBody(o,[1,11,6]),e.AddPolygonToBody(o,[2,5,8]),e.AddPolygonToBody(o,[2,7,5]),e.AddPolygonToBody(o,[2,10,7]),e.AddPolygonToBody(o,[3,5,7]),e.AddPolygonToBody(o,[3,7,11]),e.AddPolygonToBody(o,[3,9,5]),e.AddPolygonToBody(o,[4,8,9]),e.AddPolygonToBody(o,[5,9,8]),e.AddPolygonToBody(o,[6,11,10]),e.AddPolygonToBody(o,[7,10,11]),o},e.GenerateTruncatedTetrahedron=function(){var o=new e.Body;return e.AddVertexToBody(o,1,1,3),e.AddVertexToBody(o,1,-1,-3),e.AddVertexToBody(o,-1,-1,3),e.AddVertexToBody(o,-1,1,-3),e.AddVertexToBody(o,1,3,1),e.AddVertexToBody(o,1,-3,-1),e.AddVertexToBody(o,-1,-3,1),e.AddVertexToBody(o,-1,3,-1),e.AddVertexToBody(o,3,1,1),e.AddVertexToBody(o,3,-1,-1),e.AddVertexToBody(o,-3,-1,1),e.AddVertexToBody(o,-3,1,-1),e.AddPolygonToBody(o,[0,8,4]),e.AddPolygonToBody(o,[1,9,5]),e.AddPolygonToBody(o,[2,10,6]),e.AddPolygonToBody(o,[3,11,7]),e.AddPolygonToBody(o,[0,2,6,5,9,8]),e.AddPolygonToBody(o,[0,4,7,11,10,2]),e.AddPolygonToBody(o,[1,3,7,4,8,9]),e.AddPolygonToBody(o,[1,5,6,10,11,3]),o},e.GenerateCuboctahedron=function(){var o=new e.Body;return e.AddVertexToBody(o,1,1,0),e.AddVertexToBody(o,1,-1,0),e.AddVertexToBody(o,-1,-1,0),e.AddVertexToBody(o,-1,1,0),e.AddVertexToBody(o,1,0,1),e.AddVertexToBody(o,1,0,-1),e.AddVertexToBody(o,-1,0,1),e.AddVertexToBody(o,-1,0,-1),e.AddVertexToBody(o,0,1,1),e.AddVertexToBody(o,0,-1,-1),e.AddVertexToBody(o,0,-1,1),e.AddVertexToBody(o,0,1,-1),e.AddPolygonToBody(o,[0,5,11]),e.AddPolygonToBody(o,[0,8,4]),e.AddPolygonToBody(o,[1,4,10]),e.AddPolygonToBody(o,[1,9,5]),e.AddPolygonToBody(o,[2,7,9]),e.AddPolygonToBody(o,[2,10,6]),e.AddPolygonToBody(o,[3,6,8]),e.AddPolygonToBody(o,[3,11,7]),e.AddPolygonToBody(o,[0,4,1,5]),e.AddPolygonToBody(o,[0,11,3,8]),e.AddPolygonToBody(o,[1,10,2,9]),e.AddPolygonToBody(o,[2,6,3,7]),e.AddPolygonToBody(o,[4,8,6,10]),e.AddPolygonToBody(o,[5,9,7,11]),o},e.GenerateTruncatedCube=function(){var o=new e.Body,t=Math.sqrt(2)-1;return e.AddVertexToBody(o,1,1,+t),e.AddVertexToBody(o,1,1,-t),e.AddVertexToBody(o,1,-1,+t),e.AddVertexToBody(o,-1,1,+t),e.AddVertexToBody(o,1,-1,-t),e.AddVertexToBody(o,-1,1,-t),e.AddVertexToBody(o,-1,-1,+t),e.AddVertexToBody(o,-1,-1,-t),e.AddVertexToBody(o,1,+t,1),e.AddVertexToBody(o,1,+t,-1),e.AddVertexToBody(o,1,-t,1),e.AddVertexToBody(o,-1,+t,1),e.AddVertexToBody(o,1,-t,-1),e.AddVertexToBody(o,-1,+t,-1),e.AddVertexToBody(o,-1,-t,1),e.AddVertexToBody(o,-1,-t,-1),e.AddVertexToBody(o,+t,1,1),e.AddVertexToBody(o,+t,1,-1),e.AddVertexToBody(o,+t,-1,1),e.AddVertexToBody(o,-t,1,1),e.AddVertexToBody(o,+t,-1,-1),e.AddVertexToBody(o,-t,1,-1),e.AddVertexToBody(o,-t,-1,1),e.AddVertexToBody(o,-t,-1,-1),e.AddPolygonToBody(o,[0,16,8]),e.AddPolygonToBody(o,[1,9,17]),e.AddPolygonToBody(o,[2,10,18]),e.AddPolygonToBody(o,[3,11,19]),e.AddPolygonToBody(o,[4,20,12]),e.AddPolygonToBody(o,[5,21,13]),e.AddPolygonToBody(o,[6,22,14]),e.AddPolygonToBody(o,[7,15,23]),e.AddPolygonToBody(o,[0,1,17,21,5,3,19,16]),e.AddPolygonToBody(o,[0,8,10,2,4,12,9,1]),e.AddPolygonToBody(o,[2,18,22,6,7,23,20,4]),e.AddPolygonToBody(o,[3,5,13,15,7,6,14,11]),e.AddPolygonToBody(o,[8,16,19,11,14,22,18,10]),e.AddPolygonToBody(o,[9,12,20,23,15,13,21,17]),o},e.GenerateTruncatedOctahedron=function(){var o=new e.Body;return e.AddVertexToBody(o,0,1,2),e.AddVertexToBody(o,0,1,-2),e.AddVertexToBody(o,0,-1,2),e.AddVertexToBody(o,0,-1,-2),e.AddVertexToBody(o,0,2,1),e.AddVertexToBody(o,0,-2,1),e.AddVertexToBody(o,0,2,-1),e.AddVertexToBody(o,0,-2,-1),e.AddVertexToBody(o,1,0,2),e.AddVertexToBody(o,1,0,-2),e.AddVertexToBody(o,-1,0,2),e.AddVertexToBody(o,-1,0,-2),e.AddVertexToBody(o,1,2,0),e.AddVertexToBody(o,1,-2,0),e.AddVertexToBody(o,-1,2,0),e.AddVertexToBody(o,-1,-2,0),e.AddVertexToBody(o,2,0,1),e.AddVertexToBody(o,-2,0,1),e.AddVertexToBody(o,2,0,-1),e.AddVertexToBody(o,-2,0,-1),e.AddVertexToBody(o,2,1,0),e.AddVertexToBody(o,-2,1,0),e.AddVertexToBody(o,2,-1,0),e.AddVertexToBody(o,-2,-1,0),e.AddPolygonToBody(o,[0,10,2,8]),e.AddPolygonToBody(o,[1,9,3,11]),e.AddPolygonToBody(o,[4,12,6,14]),e.AddPolygonToBody(o,[5,15,7,13]),e.AddPolygonToBody(o,[16,22,18,20]),e.AddPolygonToBody(o,[17,21,19,23]),e.AddPolygonToBody(o,[0,4,14,21,17,10]),e.AddPolygonToBody(o,[0,8,16,20,12,4]),e.AddPolygonToBody(o,[1,6,12,20,18,9]),e.AddPolygonToBody(o,[1,11,19,21,14,6]),e.AddPolygonToBody(o,[2,5,13,22,16,8]),e.AddPolygonToBody(o,[2,10,17,23,15,5]),e.AddPolygonToBody(o,[3,7,15,23,19,11]),e.AddPolygonToBody(o,[3,9,18,22,13,7]),o},e.GenerateRhombicuboctahedron=function(){var o=new e.Body,t=1+Math.sqrt(2);return e.AddVertexToBody(o,1,1,+t),e.AddVertexToBody(o,1,1,-t),e.AddVertexToBody(o,1,-1,+t),e.AddVertexToBody(o,-1,1,+t),e.AddVertexToBody(o,1,-1,-t),e.AddVertexToBody(o,-1,1,-t),e.AddVertexToBody(o,-1,-1,+t),e.AddVertexToBody(o,-1,-1,-t),e.AddVertexToBody(o,1,+t,1),e.AddVertexToBody(o,1,+t,-1),e.AddVertexToBody(o,1,-t,1),e.AddVertexToBody(o,-1,+t,1),e.AddVertexToBody(o,1,-t,-1),e.AddVertexToBody(o,-1,+t,-1),e.AddVertexToBody(o,-1,-t,1),e.AddVertexToBody(o,-1,-t,-1),e.AddVertexToBody(o,+t,1,1),e.AddVertexToBody(o,+t,1,-1),e.AddVertexToBody(o,+t,-1,1),e.AddVertexToBody(o,-t,1,1),e.AddVertexToBody(o,+t,-1,-1),e.AddVertexToBody(o,-t,1,-1),e.AddVertexToBody(o,-t,-1,1),e.AddVertexToBody(o,-t,-1,-1),e.AddPolygonToBody(o,[0,16,8]),e.AddPolygonToBody(o,[1,9,17]),e.AddPolygonToBody(o,[2,10,18]),e.AddPolygonToBody(o,[3,11,19]),e.AddPolygonToBody(o,[4,20,12]),e.AddPolygonToBody(o,[5,21,13]),e.AddPolygonToBody(o,[6,22,14]),e.AddPolygonToBody(o,[7,15,23]),e.AddPolygonToBody(o,[0,2,18,16]),e.AddPolygonToBody(o,[0,3,6,2]),e.AddPolygonToBody(o,[0,8,11,3]),e.AddPolygonToBody(o,[1,4,7,5]),e.AddPolygonToBody(o,[1,5,13,9]),e.AddPolygonToBody(o,[1,17,20,4]),e.AddPolygonToBody(o,[2,6,14,10]),e.AddPolygonToBody(o,[3,19,22,6]),e.AddPolygonToBody(o,[4,12,15,7]),e.AddPolygonToBody(o,[5,7,23,21]),e.AddPolygonToBody(o,[8,9,13,11]),e.AddPolygonToBody(o,[8,16,17,9]),e.AddPolygonToBody(o,[10,12,20,18]),e.AddPolygonToBody(o,[10,14,15,12]),e.AddPolygonToBody(o,[11,13,21,19]),e.AddPolygonToBody(o,[14,22,23,15]),e.AddPolygonToBody(o,[16,18,20,17]),e.AddPolygonToBody(o,[19,21,23,22]),o},e.GenerateTruncatedCuboctahedron=function(){var o=new e.Body,t=1+Math.sqrt(2),r=1+2*Math.sqrt(2);return e.AddVertexToBody(o,1,+t,+r),e.AddVertexToBody(o,1,+t,-r),e.AddVertexToBody(o,1,-t,+r),e.AddVertexToBody(o,-1,+t,+r),e.AddVertexToBody(o,1,-t,-r),e.AddVertexToBody(o,-1,+t,-r),e.AddVertexToBody(o,-1,-t,+r),e.AddVertexToBody(o,-1,-t,-r),e.AddVertexToBody(o,1,+r,+t),e.AddVertexToBody(o,1,-r,+t),e.AddVertexToBody(o,1,+r,-t),e.AddVertexToBody(o,-1,+r,+t),e.AddVertexToBody(o,1,-r,-t),e.AddVertexToBody(o,-1,-r,+t),e.AddVertexToBody(o,-1,+r,-t),e.AddVertexToBody(o,-1,-r,-t),e.AddVertexToBody(o,+t,1,+r),e.AddVertexToBody(o,+t,1,-r),e.AddVertexToBody(o,-t,1,+r),e.AddVertexToBody(o,+t,-1,+r),e.AddVertexToBody(o,-t,1,-r),e.AddVertexToBody(o,+t,-1,-r),e.AddVertexToBody(o,-t,-1,+r),e.AddVertexToBody(o,-t,-1,-r),e.AddVertexToBody(o,+t,+r,1),e.AddVertexToBody(o,+t,-r,1),e.AddVertexToBody(o,-t,+r,1),e.AddVertexToBody(o,+t,+r,-1),e.AddVertexToBody(o,-t,-r,1),e.AddVertexToBody(o,+t,-r,-1),e.AddVertexToBody(o,-t,+r,-1),e.AddVertexToBody(o,-t,-r,-1),e.AddVertexToBody(o,+r,1,+t),e.AddVertexToBody(o,-r,1,+t),e.AddVertexToBody(o,+r,1,-t),e.AddVertexToBody(o,+r,-1,+t),e.AddVertexToBody(o,-r,1,-t),e.AddVertexToBody(o,-r,-1,+t),e.AddVertexToBody(o,+r,-1,-t),e.AddVertexToBody(o,-r,-1,-t),e.AddVertexToBody(o,+r,+t,1),e.AddVertexToBody(o,-r,+t,1),e.AddVertexToBody(o,+r,-t,1),e.AddVertexToBody(o,+r,+t,-1),e.AddVertexToBody(o,-r,-t,1),e.AddVertexToBody(o,-r,+t,-1),e.AddVertexToBody(o,+r,-t,-1),e.AddVertexToBody(o,-r,-t,-1),e.AddPolygonToBody(o,[0,8,11,3]),e.AddPolygonToBody(o,[1,5,14,10]),e.AddPolygonToBody(o,[2,6,13,9]),e.AddPolygonToBody(o,[4,12,15,7]),e.AddPolygonToBody(o,[16,19,35,32]),e.AddPolygonToBody(o,[17,34,38,21]),e.AddPolygonToBody(o,[18,33,37,22]),e.AddPolygonToBody(o,[23,39,36,20]),e.AddPolygonToBody(o,[24,40,43,27]),e.AddPolygonToBody(o,[25,29,46,42]),e.AddPolygonToBody(o,[26,30,45,41]),e.AddPolygonToBody(o,[28,44,47,31]),e.AddPolygonToBody(o,[0,16,32,40,24,8]),e.AddPolygonToBody(o,[1,10,27,43,34,17]),e.AddPolygonToBody(o,[2,9,25,42,35,19]),e.AddPolygonToBody(o,[3,11,26,41,33,18]),e.AddPolygonToBody(o,[4,21,38,46,29,12]),e.AddPolygonToBody(o,[5,20,36,45,30,14]),e.AddPolygonToBody(o,[6,22,37,44,28,13]),e.AddPolygonToBody(o,[7,15,31,47,39,23]),e.AddPolygonToBody(o,[0,3,18,22,6,2,19,16]),e.AddPolygonToBody(o,[1,17,21,4,7,23,20,5]),e.AddPolygonToBody(o,[8,24,27,10,14,30,26,11]),e.AddPolygonToBody(o,[9,13,28,31,15,12,29,25]),e.AddPolygonToBody(o,[32,35,42,46,38,34,43,40]),e.AddPolygonToBody(o,[33,41,45,36,39,47,44,37]),o},e.GenerateSnubCube=function(){var o=new e.Body,t=1/3*(Math.pow(17+3*Math.sqrt(33),1/3)-Math.pow(3*Math.sqrt(33)-17,1/3)-1),r=1/t;return e.AddVertexToBody(o,1,+t,-r),e.AddVertexToBody(o,1,-t,+r),e.AddVertexToBody(o,-1,+t,+r),e.AddVertexToBody(o,-1,-t,-r),e.AddVertexToBody(o,+t,-r,1),e.AddVertexToBody(o,-t,+r,1),e.AddVertexToBody(o,+t,+r,-1),e.AddVertexToBody(o,-t,-r,-1),e.AddVertexToBody(o,-r,1,+t),e.AddVertexToBody(o,+r,1,-t),e.AddVertexToBody(o,+r,-1,+t),e.AddVertexToBody(o,-r,-1,-t),e.AddVertexToBody(o,1,+r,+t),e.AddVertexToBody(o,1,-r,-t),e.AddVertexToBody(o,-1,+r,-t),e.AddVertexToBody(o,-1,-r,+t),e.AddVertexToBody(o,+t,1,+r),e.AddVertexToBody(o,-t,1,-r),e.AddVertexToBody(o,-t,-1,+r),e.AddVertexToBody(o,+t,-1,-r),e.AddVertexToBody(o,+r,+t,1),e.AddVertexToBody(o,-r,-t,1),e.AddVertexToBody(o,+r,-t,-1),e.AddVertexToBody(o,-r,+t,-1),e.AddPolygonToBody(o,[0,6,9]),e.AddPolygonToBody(o,[0,9,22]),e.AddPolygonToBody(o,[0,17,6]),e.AddPolygonToBody(o,[0,22,19]),e.AddPolygonToBody(o,[1,4,10]),e.AddPolygonToBody(o,[1,10,20]),e.AddPolygonToBody(o,[1,18,4]),e.AddPolygonToBody(o,[1,20,16]),e.AddPolygonToBody(o,[2,5,8]),e.AddPolygonToBody(o,[2,8,21]),e.AddPolygonToBody(o,[2,16,5]),e.AddPolygonToBody(o,[2,21,18]),e.AddPolygonToBody(o,[3,7,11]),e.AddPolygonToBody(o,[3,11,23]),e.AddPolygonToBody(o,[3,19,7]),e.AddPolygonToBody(o,[3,23,17]),e.AddPolygonToBody(o,[4,13,10]),e.AddPolygonToBody(o,[4,18,15]),e.AddPolygonToBody(o,[5,14,8]),e.AddPolygonToBody(o,[5,16,12]),e.AddPolygonToBody(o,[6,12,9]),e.AddPolygonToBody(o,[6,17,14]),e.AddPolygonToBody(o,[7,15,11]),e.AddPolygonToBody(o,[7,19,13]),e.AddPolygonToBody(o,[8,14,23]),e.AddPolygonToBody(o,[9,12,20]),e.AddPolygonToBody(o,[10,13,22]),e.AddPolygonToBody(o,[11,15,21]),e.AddPolygonToBody(o,[12,16,20]),e.AddPolygonToBody(o,[13,19,22]),e.AddPolygonToBody(o,[14,17,23]),e.AddPolygonToBody(o,[15,18,21]),e.AddPolygonToBody(o,[0,19,3,17]),e.AddPolygonToBody(o,[1,16,2,18]),e.AddPolygonToBody(o,[4,15,7,13]),e.AddPolygonToBody(o,[5,12,6,14]),e.AddPolygonToBody(o,[8,23,11,21]),e.AddPolygonToBody(o,[9,20,10,22]),o},e.GenerateIcosidodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=.5,n=t/2,i=(1+t)/2;return e.AddVertexToBody(o,0,0,+t),e.AddVertexToBody(o,0,0,-t),e.AddVertexToBody(o,0,+t,0),e.AddVertexToBody(o,0,-t,0),e.AddVertexToBody(o,+t,0,0),e.AddVertexToBody(o,-t,0,0),e.AddVertexToBody(o,.5,+n,+i),e.AddVertexToBody(o,.5,+n,-i),e.AddVertexToBody(o,.5,-n,+i),e.AddVertexToBody(o,-r,+n,+i),e.AddVertexToBody(o,.5,-n,-i),e.AddVertexToBody(o,-r,+n,-i),e.AddVertexToBody(o,-r,-n,+i),e.AddVertexToBody(o,-r,-n,-i),e.AddVertexToBody(o,+n,+i,.5),e.AddVertexToBody(o,+n,-i,.5),e.AddVertexToBody(o,-n,+i,.5),e.AddVertexToBody(o,+n,+i,-r),e.AddVertexToBody(o,-n,-i,.5),e.AddVertexToBody(o,+n,-i,-r),e.AddVertexToBody(o,-n,+i,-r),e.AddVertexToBody(o,-n,-i,-r),e.AddVertexToBody(o,+i,.5,+n),e.AddVertexToBody(o,-i,.5,+n),e.AddVertexToBody(o,+i,.5,-n),e.AddVertexToBody(o,+i,-r,+n),e.AddVertexToBody(o,-i,.5,-n),e.AddVertexToBody(o,-i,-r,+n),e.AddVertexToBody(o,+i,-r,-n),e.AddVertexToBody(o,-i,-r,-n),e.AddPolygonToBody(o,[0,6,9]),e.AddPolygonToBody(o,[0,12,8]),e.AddPolygonToBody(o,[1,10,13]),e.AddPolygonToBody(o,[1,11,7]),e.AddPolygonToBody(o,[2,14,17]),e.AddPolygonToBody(o,[2,20,16]),e.AddPolygonToBody(o,[3,18,21]),e.AddPolygonToBody(o,[3,19,15]),e.AddPolygonToBody(o,[4,22,25]),e.AddPolygonToBody(o,[4,28,24]),e.AddPolygonToBody(o,[5,26,29]),e.AddPolygonToBody(o,[5,27,23]),e.AddPolygonToBody(o,[6,22,14]),e.AddPolygonToBody(o,[7,17,24]),e.AddPolygonToBody(o,[8,15,25]),e.AddPolygonToBody(o,[9,16,23]),e.AddPolygonToBody(o,[10,28,19]),e.AddPolygonToBody(o,[11,26,20]),e.AddPolygonToBody(o,[12,27,18]),e.AddPolygonToBody(o,[13,21,29]),e.AddPolygonToBody(o,[0,8,25,22,6]),e.AddPolygonToBody(o,[0,9,23,27,12]),e.AddPolygonToBody(o,[1,7,24,28,10]),e.AddPolygonToBody(o,[1,13,29,26,11]),e.AddPolygonToBody(o,[2,16,9,6,14]),e.AddPolygonToBody(o,[2,17,7,11,20]),e.AddPolygonToBody(o,[3,15,8,12,18]),e.AddPolygonToBody(o,[3,21,13,10,19]),e.AddPolygonToBody(o,[4,24,17,14,22]),e.AddPolygonToBody(o,[4,25,15,19,28]),e.AddPolygonToBody(o,[5,23,16,20,26]),e.AddPolygonToBody(o,[5,29,21,18,27]),o},e.GenerateTruncatedDodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=1/t,n=2+t,i=2*t,d=Math.pow(t,2);return e.AddVertexToBody(o,0,+r,+n),e.AddVertexToBody(o,0,+r,-n),e.AddVertexToBody(o,0,-r,+n),e.AddVertexToBody(o,0,-r,-n),e.AddVertexToBody(o,+n,0,+r),e.AddVertexToBody(o,-n,0,+r),e.AddVertexToBody(o,+n,0,-r),e.AddVertexToBody(o,-n,0,-r),e.AddVertexToBody(o,+r,+n,0),e.AddVertexToBody(o,+r,-n,0),e.AddVertexToBody(o,-r,+n,0),e.AddVertexToBody(o,-r,-n,0),e.AddVertexToBody(o,+r,+t,+i),e.AddVertexToBody(o,+r,+t,-i),e.AddVertexToBody(o,+r,-t,+i),e.AddVertexToBody(o,-r,+t,+i),e.AddVertexToBody(o,+r,-t,-i),e.AddVertexToBody(o,-r,+t,-i),e.AddVertexToBody(o,-r,-t,+i),e.AddVertexToBody(o,-r,-t,-i),e.AddVertexToBody(o,+i,+r,+t),e.AddVertexToBody(o,+i,+r,-t),e.AddVertexToBody(o,+i,-r,+t),e.AddVertexToBody(o,-i,+r,+t),e.AddVertexToBody(o,+i,-r,-t),e.AddVertexToBody(o,-i,+r,-t),e.AddVertexToBody(o,-i,-r,+t),e.AddVertexToBody(o,-i,-r,-t),e.AddVertexToBody(o,+t,+i,+r),e.AddVertexToBody(o,+t,+i,-r),e.AddVertexToBody(o,+t,-i,+r),e.AddVertexToBody(o,-t,+i,+r),e.AddVertexToBody(o,+t,-i,-r),e.AddVertexToBody(o,-t,+i,-r),e.AddVertexToBody(o,-t,-i,+r),e.AddVertexToBody(o,-t,-i,-r),e.AddVertexToBody(o,+t,2,+d),e.AddVertexToBody(o,+t,2,-d),e.AddVertexToBody(o,+t,-2,+d),e.AddVertexToBody(o,-t,2,+d),e.AddVertexToBody(o,+t,-2,-d),e.AddVertexToBody(o,-t,2,-d),e.AddVertexToBody(o,-t,-2,+d),e.AddVertexToBody(o,-t,-2,-d),e.AddVertexToBody(o,+d,+t,2),e.AddVertexToBody(o,+d,+t,-2),e.AddVertexToBody(o,+d,-t,2),e.AddVertexToBody(o,-d,+t,2),e.AddVertexToBody(o,+d,-t,-2),e.AddVertexToBody(o,-d,+t,-2),e.AddVertexToBody(o,-d,-t,2),e.AddVertexToBody(o,-d,-t,-2),e.AddVertexToBody(o,2,+d,+t),e.AddVertexToBody(o,2,+d,-t),e.AddVertexToBody(o,2,-d,+t),e.AddVertexToBody(o,-2,+d,+t),e.AddVertexToBody(o,2,-d,-t),e.AddVertexToBody(o,-2,+d,-t),e.AddVertexToBody(o,-2,-d,+t),e.AddVertexToBody(o,-2,-d,-t),e.AddPolygonToBody(o,[0,12,15]),e.AddPolygonToBody(o,[1,17,13]),e.AddPolygonToBody(o,[2,18,14]),e.AddPolygonToBody(o,[3,16,19]),e.AddPolygonToBody(o,[4,20,22]),e.AddPolygonToBody(o,[5,26,23]),e.AddPolygonToBody(o,[6,24,21]),e.AddPolygonToBody(o,[7,25,27]),e.AddPolygonToBody(o,[8,28,29]),e.AddPolygonToBody(o,[9,32,30]),e.AddPolygonToBody(o,[10,33,31]),e.AddPolygonToBody(o,[11,34,35]),e.AddPolygonToBody(o,[36,44,52]),e.AddPolygonToBody(o,[37,53,45]),e.AddPolygonToBody(o,[38,54,46]),e.AddPolygonToBody(o,[39,55,47]),e.AddPolygonToBody(o,[40,48,56]),e.AddPolygonToBody(o,[41,49,57]),e.AddPolygonToBody(o,[42,50,58]),e.AddPolygonToBody(o,[43,59,51]),e.AddPolygonToBody(o,[0,2,14,38,46,22,20,44,36,12]),e.AddPolygonToBody(o,[0,15,39,47,23,26,50,42,18,2]),e.AddPolygonToBody(o,[1,3,19,43,51,27,25,49,41,17]),e.AddPolygonToBody(o,[1,13,37,45,21,24,48,40,16,3]),e.AddPolygonToBody(o,[4,6,21,45,53,29,28,52,44,20]),e.AddPolygonToBody(o,[4,22,46,54,30,32,56,48,24,6]),e.AddPolygonToBody(o,[5,7,27,51,59,35,34,58,50,26]),e.AddPolygonToBody(o,[5,23,47,55,31,33,57,49,25,7]),e.AddPolygonToBody(o,[8,10,31,55,39,15,12,36,52,28]),e.AddPolygonToBody(o,[8,29,53,37,13,17,41,57,33,10]),e.AddPolygonToBody(o,[9,11,35,59,43,19,16,40,56,32]),e.AddPolygonToBody(o,[9,30,54,38,14,18,42,58,34,11]),o},e.GenerateTruncatedIcosahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=3*t,n=1+2*t,i=2+t,d=2*t;return e.AddVertexToBody(o,0,1,+r),e.AddVertexToBody(o,0,1,-r),e.AddVertexToBody(o,0,-1,+r),e.AddVertexToBody(o,0,-1,-r),e.AddVertexToBody(o,1,+r,0),e.AddVertexToBody(o,1,-r,0),e.AddVertexToBody(o,-1,+r,0),e.AddVertexToBody(o,-1,-r,0),e.AddVertexToBody(o,+r,0,1),e.AddVertexToBody(o,-r,0,1),e.AddVertexToBody(o,+r,0,-1),e.AddVertexToBody(o,-r,0,-1),e.AddVertexToBody(o,2,+n,+t),e.AddVertexToBody(o,2,+n,-t),e.AddVertexToBody(o,2,-n,+t),e.AddVertexToBody(o,-2,+n,+t),e.AddVertexToBody(o,2,-n,-t),e.AddVertexToBody(o,-2,+n,-t),e.AddVertexToBody(o,-2,-n,+t),e.AddVertexToBody(o,-2,-n,-t),e.AddVertexToBody(o,+n,+t,2),e.AddVertexToBody(o,+n,-t,2),e.AddVertexToBody(o,-n,+t,2),e.AddVertexToBody(o,+n,+t,-2),e.AddVertexToBody(o,-n,-t,2),e.AddVertexToBody(o,+n,-t,-2),e.AddVertexToBody(o,-n,+t,-2),e.AddVertexToBody(o,-n,-t,-2),e.AddVertexToBody(o,+t,2,+n),e.AddVertexToBody(o,-t,2,+n),e.AddVertexToBody(o,+t,2,-n),e.AddVertexToBody(o,+t,-2,+n),e.AddVertexToBody(o,-t,2,-n),e.AddVertexToBody(o,-t,-2,+n),e.AddVertexToBody(o,+t,-2,-n),e.AddVertexToBody(o,-t,-2,-n),e.AddVertexToBody(o,1,+i,+d),e.AddVertexToBody(o,1,+i,-d),e.AddVertexToBody(o,1,-i,+d),e.AddVertexToBody(o,-1,+i,+d),e.AddVertexToBody(o,1,-i,-d),e.AddVertexToBody(o,-1,+i,-d),e.AddVertexToBody(o,-1,-i,+d),e.AddVertexToBody(o,-1,-i,-d),e.AddVertexToBody(o,+i,+d,1),e.AddVertexToBody(o,+i,-d,1),e.AddVertexToBody(o,-i,+d,1),e.AddVertexToBody(o,+i,+d,-1),e.AddVertexToBody(o,-i,-d,1),e.AddVertexToBody(o,+i,-d,-1),e.AddVertexToBody(o,-i,+d,-1),e.AddVertexToBody(o,-i,-d,-1),e.AddVertexToBody(o,+d,1,+i),e.AddVertexToBody(o,-d,1,+i),e.AddVertexToBody(o,+d,1,-i),e.AddVertexToBody(o,+d,-1,+i),e.AddVertexToBody(o,-d,1,-i),e.AddVertexToBody(o,-d,-1,+i),e.AddVertexToBody(o,+d,-1,-i),e.AddVertexToBody(o,-d,-1,-i),e.AddPolygonToBody(o,[0,28,36,39,29]),e.AddPolygonToBody(o,[1,32,41,37,30]),e.AddPolygonToBody(o,[2,33,42,38,31]),e.AddPolygonToBody(o,[3,34,40,43,35]),e.AddPolygonToBody(o,[4,12,44,47,13]),e.AddPolygonToBody(o,[5,16,49,45,14]),e.AddPolygonToBody(o,[6,17,50,46,15]),e.AddPolygonToBody(o,[7,18,48,51,19]),e.AddPolygonToBody(o,[8,20,52,55,21]),e.AddPolygonToBody(o,[9,24,57,53,22]),e.AddPolygonToBody(o,[10,25,58,54,23]),e.AddPolygonToBody(o,[11,26,56,59,27]),e.AddPolygonToBody(o,[0,2,31,55,52,28]),e.AddPolygonToBody(o,[0,29,53,57,33,2]),e.AddPolygonToBody(o,[1,3,35,59,56,32]),e.AddPolygonToBody(o,[1,30,54,58,34,3]),e.AddPolygonToBody(o,[4,6,15,39,36,12]),e.AddPolygonToBody(o,[4,13,37,41,17,6]),e.AddPolygonToBody(o,[5,7,19,43,40,16]),e.AddPolygonToBody(o,[5,14,38,42,18,7]),e.AddPolygonToBody(o,[8,10,23,47,44,20]),e.AddPolygonToBody(o,[8,21,45,49,25,10]),e.AddPolygonToBody(o,[9,11,27,51,48,24]),e.AddPolygonToBody(o,[9,22,46,50,26,11]),e.AddPolygonToBody(o,[12,36,28,52,20,44]),e.AddPolygonToBody(o,[13,47,23,54,30,37]),e.AddPolygonToBody(o,[14,45,21,55,31,38]),e.AddPolygonToBody(o,[15,46,22,53,29,39]),e.AddPolygonToBody(o,[16,40,34,58,25,49]),e.AddPolygonToBody(o,[17,41,32,56,26,50]),e.AddPolygonToBody(o,[18,42,33,57,24,48]),e.AddPolygonToBody(o,[19,51,27,59,35,43]),o},e.GenerateRhombicosidodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=Math.pow(t,2),n=Math.pow(t,3),i=2*t,d=2+t;return e.AddVertexToBody(o,1,1,+n),e.AddVertexToBody(o,1,1,-n),e.AddVertexToBody(o,1,-1,+n),e.AddVertexToBody(o,-1,1,+n),e.AddVertexToBody(o,1,-1,-n),e.AddVertexToBody(o,-1,1,-n),e.AddVertexToBody(o,-1,-1,+n),e.AddVertexToBody(o,-1,-1,-n),e.AddVertexToBody(o,+n,1,1),e.AddVertexToBody(o,+n,1,-1),e.AddVertexToBody(o,+n,-1,1),e.AddVertexToBody(o,-n,1,1),e.AddVertexToBody(o,+n,-1,-1),e.AddVertexToBody(o,-n,1,-1),e.AddVertexToBody(o,-n,-1,1),e.AddVertexToBody(o,-n,-1,-1),e.AddVertexToBody(o,1,+n,1),e.AddVertexToBody(o,1,+n,-1),e.AddVertexToBody(o,1,-n,1),e.AddVertexToBody(o,-1,+n,1),e.AddVertexToBody(o,1,-n,-1),e.AddVertexToBody(o,-1,+n,-1),e.AddVertexToBody(o,-1,-n,1),e.AddVertexToBody(o,-1,-n,-1),e.AddVertexToBody(o,+r,+t,+i),e.AddVertexToBody(o,+r,+t,-i),e.AddVertexToBody(o,+r,-t,+i),e.AddVertexToBody(o,-r,+t,+i),e.AddVertexToBody(o,+r,-t,-i),e.AddVertexToBody(o,-r,+t,-i),e.AddVertexToBody(o,-r,-t,+i),e.AddVertexToBody(o,-r,-t,-i),e.AddVertexToBody(o,+i,+r,+t),e.AddVertexToBody(o,+i,+r,-t),e.AddVertexToBody(o,+i,-r,+t),e.AddVertexToBody(o,-i,+r,+t),e.AddVertexToBody(o,+i,-r,-t),e.AddVertexToBody(o,-i,+r,-t),e.AddVertexToBody(o,-i,-r,+t),e.AddVertexToBody(o,-i,-r,-t),e.AddVertexToBody(o,+t,+i,+r),e.AddVertexToBody(o,+t,+i,-r),e.AddVertexToBody(o,+t,-i,+r),e.AddVertexToBody(o,-t,+i,+r),e.AddVertexToBody(o,+t,-i,-r),e.AddVertexToBody(o,-t,+i,-r),e.AddVertexToBody(o,-t,-i,+r),e.AddVertexToBody(o,-t,-i,-r),e.AddVertexToBody(o,+d,0,+r),e.AddVertexToBody(o,+d,0,-r),e.AddVertexToBody(o,-d,0,+r),e.AddVertexToBody(o,-d,0,-r),e.AddVertexToBody(o,+r,+d,0),e.AddVertexToBody(o,-r,+d,0),e.AddVertexToBody(o,+r,-d,0),e.AddVertexToBody(o,-r,-d,0),e.AddVertexToBody(o,0,+r,+d),e.AddVertexToBody(o,0,-r,+d),e.AddVertexToBody(o,0,+r,-d),e.AddVertexToBody(o,0,-r,-d),e.AddPolygonToBody(o,[0,56,3]),e.AddPolygonToBody(o,[1,5,58]),e.AddPolygonToBody(o,[2,6,57]),e.AddPolygonToBody(o,[4,59,7]),e.AddPolygonToBody(o,[8,48,10]),e.AddPolygonToBody(o,[9,12,49]),e.AddPolygonToBody(o,[11,14,50]),e.AddPolygonToBody(o,[13,51,15]),e.AddPolygonToBody(o,[16,52,17]),e.AddPolygonToBody(o,[18,20,54]),e.AddPolygonToBody(o,[19,21,53]),e.AddPolygonToBody(o,[22,55,23]),e.AddPolygonToBody(o,[24,32,40]),e.AddPolygonToBody(o,[25,41,33]),e.AddPolygonToBody(o,[26,42,34]),e.AddPolygonToBody(o,[27,43,35]),e.AddPolygonToBody(o,[28,36,44]),e.AddPolygonToBody(o,[29,37,45]),e.AddPolygonToBody(o,[30,38,46]),e.AddPolygonToBody(o,[31,47,39]),e.AddPolygonToBody(o,[0,3,6,2]),e.AddPolygonToBody(o,[0,24,40,56]),e.AddPolygonToBody(o,[1,4,7,5]),e.AddPolygonToBody(o,[1,58,41,25]),e.AddPolygonToBody(o,[2,57,42,26]),e.AddPolygonToBody(o,[3,56,43,27]),e.AddPolygonToBody(o,[4,28,44,59]),e.AddPolygonToBody(o,[5,29,45,58]),e.AddPolygonToBody(o,[6,30,46,57]),e.AddPolygonToBody(o,[7,59,47,31]),e.AddPolygonToBody(o,[8,10,12,9]),e.AddPolygonToBody(o,[8,32,24,48]),e.AddPolygonToBody(o,[9,49,25,33]),e.AddPolygonToBody(o,[10,48,26,34]),e.AddPolygonToBody(o,[11,13,15,14]),e.AddPolygonToBody(o,[11,50,27,35]),e.AddPolygonToBody(o,[12,36,28,49]),e.AddPolygonToBody(o,[13,37,29,51]),e.AddPolygonToBody(o,[14,38,30,50]),e.AddPolygonToBody(o,[15,51,31,39]),e.AddPolygonToBody(o,[16,17,21,19]),e.AddPolygonToBody(o,[16,40,32,52]),e.AddPolygonToBody(o,[17,52,33,41]),e.AddPolygonToBody(o,[18,22,23,20]),e.AddPolygonToBody(o,[18,54,34,42]),e.AddPolygonToBody(o,[19,53,35,43]),e.AddPolygonToBody(o,[20,44,36,54]),e.AddPolygonToBody(o,[21,45,37,53]),e.AddPolygonToBody(o,[22,46,38,55]),e.AddPolygonToBody(o,[23,55,39,47]),e.AddPolygonToBody(o,[0,2,26,48,24]),e.AddPolygonToBody(o,[1,25,49,28,4]),e.AddPolygonToBody(o,[3,27,50,30,6]),e.AddPolygonToBody(o,[5,7,31,51,29]),e.AddPolygonToBody(o,[8,9,33,52,32]),e.AddPolygonToBody(o,[10,34,54,36,12]),e.AddPolygonToBody(o,[11,35,53,37,13]),e.AddPolygonToBody(o,[14,15,39,55,38]),e.AddPolygonToBody(o,[16,19,43,56,40]),e.AddPolygonToBody(o,[17,41,58,45,21]),e.AddPolygonToBody(o,[18,42,57,46,22]),e.AddPolygonToBody(o,[20,23,47,59,44]),o},e.GenerateTruncatedIcosidodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=1/t,n=3+t,i=2/t,d=1+2*t,a=Math.pow(t,2),s=3*t-1,l=2*t-1,u=2+t,y=2*t;return e.AddVertexToBody(o,+r,+r,+n),e.AddVertexToBody(o,+r,+r,-n),e.AddVertexToBody(o,+r,-r,+n),e.AddVertexToBody(o,-r,+r,+n),e.AddVertexToBody(o,+r,-r,-n),e.AddVertexToBody(o,-r,+r,-n),e.AddVertexToBody(o,-r,-r,+n),e.AddVertexToBody(o,-r,-r,-n),e.AddVertexToBody(o,+r,+n,+r),e.AddVertexToBody(o,+r,-n,+r),e.AddVertexToBody(o,-r,+n,+r),e.AddVertexToBody(o,+r,+n,-r),e.AddVertexToBody(o,-r,-n,+r),e.AddVertexToBody(o,+r,-n,-r),e.AddVertexToBody(o,-r,+n,-r),e.AddVertexToBody(o,-r,-n,-r),e.AddVertexToBody(o,+n,+r,+r),e.AddVertexToBody(o,-n,+r,+r),e.AddVertexToBody(o,+n,+r,-r),e.AddVertexToBody(o,+n,-r,+r),e.AddVertexToBody(o,-n,+r,-r),e.AddVertexToBody(o,-n,-r,+r),e.AddVertexToBody(o,+n,-r,-r),e.AddVertexToBody(o,-n,-r,-r),e.AddVertexToBody(o,+i,+t,+d),e.AddVertexToBody(o,+i,+t,-d),e.AddVertexToBody(o,+i,-t,+d),e.AddVertexToBody(o,-i,+t,+d),e.AddVertexToBody(o,+i,-t,-d),e.AddVertexToBody(o,-i,+t,-d),e.AddVertexToBody(o,-i,-t,+d),e.AddVertexToBody(o,-i,-t,-d),e.AddVertexToBody(o,+t,+d,+i),e.AddVertexToBody(o,+t,-d,+i),e.AddVertexToBody(o,-t,+d,+i),e.AddVertexToBody(o,+t,+d,-i),e.AddVertexToBody(o,-t,-d,+i),e.AddVertexToBody(o,+t,-d,-i),e.AddVertexToBody(o,-t,+d,-i),e.AddVertexToBody(o,-t,-d,-i),e.AddVertexToBody(o,+d,+i,+t),e.AddVertexToBody(o,-d,+i,+t),e.AddVertexToBody(o,+d,+i,-t),e.AddVertexToBody(o,+d,-i,+t),e.AddVertexToBody(o,-d,+i,-t),e.AddVertexToBody(o,-d,-i,+t),e.AddVertexToBody(o,+d,-i,-t),e.AddVertexToBody(o,-d,-i,-t),e.AddVertexToBody(o,+r,+a,+s),e.AddVertexToBody(o,+r,+a,-s),e.AddVertexToBody(o,+r,-a,+s),e.AddVertexToBody(o,-r,+a,+s),e.AddVertexToBody(o,+r,-a,-s),e.AddVertexToBody(o,-r,+a,-s),e.AddVertexToBody(o,-r,-a,+s),e.AddVertexToBody(o,-r,-a,-s),e.AddVertexToBody(o,+a,+s,+r),e.AddVertexToBody(o,+a,-s,+r),e.AddVertexToBody(o,-a,+s,+r),e.AddVertexToBody(o,+a,+s,-r),e.AddVertexToBody(o,-a,-s,+r),e.AddVertexToBody(o,+a,-s,-r),e.AddVertexToBody(o,-a,+s,-r),e.AddVertexToBody(o,-a,-s,-r),e.AddVertexToBody(o,+s,+r,+a),e.AddVertexToBody(o,-s,+r,+a),e.AddVertexToBody(o,+s,+r,-a),e.AddVertexToBody(o,+s,-r,+a),e.AddVertexToBody(o,-s,+r,-a),e.AddVertexToBody(o,-s,-r,+a),e.AddVertexToBody(o,+s,-r,-a),e.AddVertexToBody(o,-s,-r,-a),e.AddVertexToBody(o,+l,2,+u),e.AddVertexToBody(o,+l,2,-u),e.AddVertexToBody(o,+l,-2,+u),e.AddVertexToBody(o,-l,2,+u),e.AddVertexToBody(o,+l,-2,-u),e.AddVertexToBody(o,-l,2,-u),e.AddVertexToBody(o,-l,-2,+u),e.AddVertexToBody(o,-l,-2,-u),e.AddVertexToBody(o,2,+u,+l),e.AddVertexToBody(o,2,-u,+l),e.AddVertexToBody(o,-2,+u,+l),e.AddVertexToBody(o,2,+u,-l),e.AddVertexToBody(o,-2,-u,+l),e.AddVertexToBody(o,2,-u,-l),e.AddVertexToBody(o,-2,+u,-l),e.AddVertexToBody(o,-2,-u,-l),e.AddVertexToBody(o,+u,+l,2),e.AddVertexToBody(o,-u,+l,2),e.AddVertexToBody(o,+u,+l,-2),e.AddVertexToBody(o,+u,-l,2),e.AddVertexToBody(o,-u,+l,-2),e.AddVertexToBody(o,-u,-l,2),e.AddVertexToBody(o,+u,-l,-2),e.AddVertexToBody(o,-u,-l,-2),e.AddVertexToBody(o,+t,3,+y),e.AddVertexToBody(o,+t,3,-y),e.AddVertexToBody(o,+t,-3,+y),e.AddVertexToBody(o,-t,3,+y),e.AddVertexToBody(o,+t,-3,-y),e.AddVertexToBody(o,-t,3,-y),e.AddVertexToBody(o,-t,-3,+y),e.AddVertexToBody(o,-t,-3,-y),e.AddVertexToBody(o,3,+y,+t),e.AddVertexToBody(o,3,-y,+t),e.AddVertexToBody(o,-3,+y,+t),e.AddVertexToBody(o,3,+y,-t),e.AddVertexToBody(o,-3,-y,+t),e.AddVertexToBody(o,3,-y,-t),e.AddVertexToBody(o,-3,+y,-t),e.AddVertexToBody(o,-3,-y,-t),e.AddVertexToBody(o,+y,+t,3),e.AddVertexToBody(o,-y,+t,3),e.AddVertexToBody(o,+y,+t,-3),e.AddVertexToBody(o,+y,-t,3),e.AddVertexToBody(o,-y,+t,-3),e.AddVertexToBody(o,-y,-t,3),e.AddVertexToBody(o,+y,-t,-3),e.AddVertexToBody(o,-y,-t,-3),e.AddPolygonToBody(o,[0,3,6,2]),e.AddPolygonToBody(o,[1,4,7,5]),e.AddPolygonToBody(o,[8,11,14,10]),e.AddPolygonToBody(o,[9,12,15,13]),e.AddPolygonToBody(o,[16,19,22,18]),e.AddPolygonToBody(o,[17,20,23,21]),e.AddPolygonToBody(o,[24,72,96,48]),e.AddPolygonToBody(o,[25,49,97,73]),e.AddPolygonToBody(o,[26,50,98,74]),e.AddPolygonToBody(o,[27,51,99,75]),e.AddPolygonToBody(o,[28,76,100,52]),e.AddPolygonToBody(o,[29,77,101,53]),e.AddPolygonToBody(o,[30,78,102,54]),e.AddPolygonToBody(o,[31,55,103,79]),e.AddPolygonToBody(o,[32,80,104,56]),e.AddPolygonToBody(o,[33,57,105,81]),e.AddPolygonToBody(o,[34,58,106,82]),e.AddPolygonToBody(o,[35,59,107,83]),e.AddPolygonToBody(o,[36,84,108,60]),e.AddPolygonToBody(o,[37,85,109,61]),e.AddPolygonToBody(o,[38,86,110,62]),e.AddPolygonToBody(o,[39,63,111,87]),e.AddPolygonToBody(o,[40,88,112,64]),e.AddPolygonToBody(o,[41,65,113,89]),e.AddPolygonToBody(o,[42,66,114,90]),e.AddPolygonToBody(o,[43,67,115,91]),e.AddPolygonToBody(o,[44,92,116,68]),e.AddPolygonToBody(o,[45,93,117,69]),e.AddPolygonToBody(o,[46,94,118,70]),e.AddPolygonToBody(o,[47,71,119,95]),e.AddPolygonToBody(o,[0,24,48,51,27,3]),e.AddPolygonToBody(o,[1,5,29,53,49,25]),e.AddPolygonToBody(o,[2,6,30,54,50,26]),e.AddPolygonToBody(o,[4,28,52,55,31,7]),e.AddPolygonToBody(o,[8,32,56,59,35,11]),e.AddPolygonToBody(o,[9,13,37,61,57,33]),e.AddPolygonToBody(o,[10,14,38,62,58,34]),e.AddPolygonToBody(o,[12,36,60,63,39,15]),e.AddPolygonToBody(o,[16,40,64,67,43,19]),e.AddPolygonToBody(o,[17,21,45,69,65,41]),e.AddPolygonToBody(o,[18,22,46,70,66,42]),e.AddPolygonToBody(o,[20,44,68,71,47,23]),e.AddPolygonToBody(o,[72,112,88,104,80,96]),e.AddPolygonToBody(o,[73,97,83,107,90,114]),e.AddPolygonToBody(o,[74,98,81,105,91,115]),e.AddPolygonToBody(o,[75,99,82,106,89,113]),e.AddPolygonToBody(o,[76,118,94,109,85,100]),e.AddPolygonToBody(o,[78,117,93,108,84,102]),e.AddPolygonToBody(o,[79,103,87,111,95,119]),e.AddPolygonToBody(o,[86,101,77,116,92,110]),e.AddPolygonToBody(o,[0,2,26,74,115,67,64,112,72,24]),e.AddPolygonToBody(o,[1,25,73,114,66,70,118,76,28,4]),e.AddPolygonToBody(o,[3,27,75,113,65,69,117,78,30,6]),e.AddPolygonToBody(o,[5,7,31,79,119,71,68,116,77,29]),e.AddPolygonToBody(o,[8,10,34,82,99,51,48,96,80,32]),e.AddPolygonToBody(o,[9,33,81,98,50,54,102,84,36,12]),e.AddPolygonToBody(o,[11,35,83,97,49,53,101,86,38,14]),e.AddPolygonToBody(o,[13,15,39,87,103,55,52,100,85,37]),e.AddPolygonToBody(o,[16,18,42,90,107,59,56,104,88,40]),e.AddPolygonToBody(o,[17,41,89,106,58,62,110,92,44,20]),e.AddPolygonToBody(o,[19,43,91,105,57,61,109,94,46,22]),e.AddPolygonToBody(o,[21,23,47,95,111,63,60,108,93,45]),o},e.GenerateSnubDodecahedron=function(){var o=new e.Body,t=(1+Math.sqrt(5))/2,r=Math.pow(t/2+.5*Math.sqrt(t-5/27),1/3)+Math.pow(t/2-.5*Math.sqrt(t-5/27),1/3),n=r-1/r,i=r*t+Math.pow(t,2)+t/r,d=2*n,a=2*i,s=n+i/t+t,l=-n*t+i+1/t,u=n/t+i*t-1,y=-n/t+i*t+1,c=i/t-n-t,h=n*t+i-1/t,f=-n/t+i*t-1,g=n-i/t-t,x=n*t+i+1/t,p=n+i/t-t,T=n*t-i+1/t,C=n/t+i*t+1;return e.AddVertexToBody(o,+d,2,-a),e.AddVertexToBody(o,+d,-2,+a),e.AddVertexToBody(o,-d,2,+a),e.AddVertexToBody(o,-d,-2,-a),e.AddVertexToBody(o,2,-a,+d),e.AddVertexToBody(o,-2,+a,+d),e.AddVertexToBody(o,2,+a,-d),e.AddVertexToBody(o,-2,-a,-d),e.AddVertexToBody(o,-a,+d,2),e.AddVertexToBody(o,+a,+d,-2),e.AddVertexToBody(o,+a,-d,2),e.AddVertexToBody(o,-a,-d,-2),e.AddVertexToBody(o,+s,+l,-u),e.AddVertexToBody(o,+s,-l,+u),e.AddVertexToBody(o,-s,+l,+u),e.AddVertexToBody(o,-s,-l,-u),e.AddVertexToBody(o,+l,-u,+s),e.AddVertexToBody(o,-l,+u,+s),e.AddVertexToBody(o,+l,+u,-s),e.AddVertexToBody(o,-l,-u,-s),e.AddVertexToBody(o,-u,+s,+l),e.AddVertexToBody(o,+u,+s,-l),e.AddVertexToBody(o,+u,-s,+l),e.AddVertexToBody(o,-u,-s,-l),e.AddVertexToBody(o,+y,+c,-h),e.AddVertexToBody(o,+y,-c,+h),e.AddVertexToBody(o,-y,+c,+h),e.AddVertexToBody(o,-y,-c,-h),e.AddVertexToBody(o,+c,-h,+y),e.AddVertexToBody(o,-c,+h,+y),e.AddVertexToBody(o,+c,+h,-y),e.AddVertexToBody(o,-c,-h,-y),e.AddVertexToBody(o,-h,+y,+c),e.AddVertexToBody(o,+h,+y,-c),e.AddVertexToBody(o,+h,-y,+c),e.AddVertexToBody(o,-h,-y,-c),e.AddVertexToBody(o,+f,+g,-x),e.AddVertexToBody(o,+f,-g,+x),e.AddVertexToBody(o,-f,+g,+x),e.AddVertexToBody(o,-f,-g,-x),e.AddVertexToBody(o,+g,-x,+f),e.AddVertexToBody(o,-g,+x,+f),e.AddVertexToBody(o,+g,+x,-f),e.AddVertexToBody(o,-g,-x,-f),e.AddVertexToBody(o,-x,+f,+g),e.AddVertexToBody(o,+x,+f,-g),e.AddVertexToBody(o,+x,-f,+g),e.AddVertexToBody(o,-x,-f,-g),e.AddVertexToBody(o,+p,+T,-C),e.AddVertexToBody(o,+p,-T,+C),e.AddVertexToBody(o,-p,+T,+C),e.AddVertexToBody(o,-p,-T,-C),e.AddVertexToBody(o,+T,-C,+p),e.AddVertexToBody(o,-T,+C,+p),e.AddVertexToBody(o,+T,+C,-p),e.AddVertexToBody(o,-T,-C,-p),e.AddVertexToBody(o,-C,+p,+T),e.AddVertexToBody(o,+C,+p,-T),e.AddVertexToBody(o,+C,-p,+T),e.AddVertexToBody(o,-C,-p,-T),e.AddPolygonToBody(o,[0,3,51]),e.AddPolygonToBody(o,[0,30,12]),e.AddPolygonToBody(o,[0,48,3]),e.AddPolygonToBody(o,[0,51,30]),e.AddPolygonToBody(o,[1,2,50]),e.AddPolygonToBody(o,[1,28,13]),e.AddPolygonToBody(o,[1,49,2]),e.AddPolygonToBody(o,[1,50,28]),e.AddPolygonToBody(o,[2,29,14]),e.AddPolygonToBody(o,[2,49,29]),e.AddPolygonToBody(o,[3,31,15]),e.AddPolygonToBody(o,[3,48,31]),e.AddPolygonToBody(o,[4,7,55]),e.AddPolygonToBody(o,[4,34,16]),e.AddPolygonToBody(o,[4,52,7]),e.AddPolygonToBody(o,[4,55,34]),e.AddPolygonToBody(o,[5,6,54]),e.AddPolygonToBody(o,[5,32,17]),e.AddPolygonToBody(o,[5,53,6]),e.AddPolygonToBody(o,[5,54,32]),e.AddPolygonToBody(o,[6,33,18]),e.AddPolygonToBody(o,[6,53,33]),e.AddPolygonToBody(o,[7,35,19]),e.AddPolygonToBody(o,[7,52,35]),e.AddPolygonToBody(o,[8,11,59]),e.AddPolygonToBody(o,[8,26,20]),e.AddPolygonToBody(o,[8,56,11]),e.AddPolygonToBody(o,[8,59,26]),e.AddPolygonToBody(o,[9,10,58]),e.AddPolygonToBody(o,[9,24,21]),e.AddPolygonToBody(o,[9,57,10]),e.AddPolygonToBody(o,[9,58,24]),e.AddPolygonToBody(o,[10,25,22]),e.AddPolygonToBody(o,[10,57,25]),e.AddPolygonToBody(o,[11,27,23]),e.AddPolygonToBody(o,[11,56,27]),e.AddPolygonToBody(o,[12,18,21]),e.AddPolygonToBody(o,[12,21,24]),e.AddPolygonToBody(o,[12,30,18]),e.AddPolygonToBody(o,[13,16,22]),e.AddPolygonToBody(o,[13,22,25]),e.AddPolygonToBody(o,[13,28,16]),e.AddPolygonToBody(o,[14,17,20]),e.AddPolygonToBody(o,[14,20,26]),e.AddPolygonToBody(o,[14,29,17]),e.AddPolygonToBody(o,[15,19,23]),e.AddPolygonToBody(o,[15,23,27]),e.AddPolygonToBody(o,[15,31,19]),e.AddPolygonToBody(o,[16,34,22]),e.AddPolygonToBody(o,[17,32,20]),e.AddPolygonToBody(o,[18,33,21]),e.AddPolygonToBody(o,[19,35,23]),e.AddPolygonToBody(o,[24,58,36]),e.AddPolygonToBody(o,[25,57,37]),e.AddPolygonToBody(o,[26,59,38]),e.AddPolygonToBody(o,[27,56,39]),e.AddPolygonToBody(o,[28,50,40]),e.AddPolygonToBody(o,[29,49,41]),e.AddPolygonToBody(o,[30,51,42]),e.AddPolygonToBody(o,[31,48,43]),e.AddPolygonToBody(o,[32,54,44]),e.AddPolygonToBody(o,[33,53,45]),e.AddPolygonToBody(o,[34,55,46]),e.AddPolygonToBody(o,[35,52,47]),e.AddPolygonToBody(o,[36,43,48]),e.AddPolygonToBody(o,[36,46,43]),e.AddPolygonToBody(o,[36,58,46]),e.AddPolygonToBody(o,[37,41,49]),e.AddPolygonToBody(o,[37,45,41]),e.AddPolygonToBody(o,[37,57,45]),e.AddPolygonToBody(o,[38,40,50]),e.AddPolygonToBody(o,[38,47,40]),e.AddPolygonToBody(o,[38,59,47]),e.AddPolygonToBody(o,[39,42,51]),e.AddPolygonToBody(o,[39,44,42]),e.AddPolygonToBody(o,[39,56,44]),e.AddPolygonToBody(o,[40,47,52]),e.AddPolygonToBody(o,[41,45,53]),e.AddPolygonToBody(o,[42,44,54]),e.AddPolygonToBody(o,[43,46,55]),e.AddPolygonToBody(o,[0,12,24,36,48]),e.AddPolygonToBody(o,[1,13,25,37,49]),e.AddPolygonToBody(o,[2,14,26,38,50]),e.AddPolygonToBody(o,[3,15,27,39,51]),e.AddPolygonToBody(o,[4,16,28,40,52]),e.AddPolygonToBody(o,[5,17,29,41,53]),e.AddPolygonToBody(o,[6,18,30,42,54]),e.AddPolygonToBody(o,[7,19,31,43,55]),e.AddPolygonToBody(o,[8,20,32,44,56]),e.AddPolygonToBody(o,[9,21,33,45,57]),e.AddPolygonToBody(o,[10,22,34,46,58]),e.AddPolygonToBody(o,[11,23,35,47,59]),o},e.AddCumulatedPolygonToBody=function(o,t,r){var n=new e.Coord(0,0,0),i=new e.Vector(0,0,0);!function(t,r,n){var i,d=[];for(i=0;i<t.length;i++)d.push(o.GetVertexPosition(t[i]));var a=e.CalculateCentroid(d),s=e.CalculateNormal(d);r.Set(a.x,a.y,a.z),n.Set(s.x,s.y,s.z)}(t,n,i),n.Offset(i,r);var d=o.VertexCount();e.AddVertexToBody(o,n.x,n.y,n.z);var a,s,l,u=t.length;for(a=0;a<u;a++)s=t[a],l=t[a<u-1?a+1:0],e.AddPolygonToBody(o,[s,l,d])},e.GenerateCumulatedTetrahedron=function(o){var t=new e.Body;t.AddVertex(new e.BodyVertex(new e.Coord(1,1,1))),t.AddVertex(new e.BodyVertex(new e.Coord(-1,-1,1))),t.AddVertex(new e.BodyVertex(new e.Coord(-1,1,-1))),t.AddVertex(new e.BodyVertex(new e.Coord(1,-1,-1)));var r=2*Math.sqrt(2),n=r*o;return e.AddCumulatedPolygonToBody(t,[0,1,3],n),e.AddCumulatedPolygonToBody(t,[0,2,1],n),e.AddCumulatedPolygonToBody(t,[0,3,2],n),e.AddCumulatedPolygonToBody(t,[1,2,3],n),t},e.GenerateCumulatedHexahedron=function(o){var t=new e.Body;e.AddVertexToBody(t,1,1,1),e.AddVertexToBody(t,1,1,-1),e.AddVertexToBody(t,1,-1,1),e.AddVertexToBody(t,-1,1,1),e.AddVertexToBody(t,1,-1,-1),e.AddVertexToBody(t,-1,1,-1),e.AddVertexToBody(t,-1,-1,1),e.AddVertexToBody(t,-1,-1,-1);var r=2*o;return e.AddCumulatedPolygonToBody(t,[0,1,5,3],r),e.AddCumulatedPolygonToBody(t,[0,2,4,1],r),e.AddCumulatedPolygonToBody(t,[0,3,6,2],r),e.AddCumulatedPolygonToBody(t,[1,4,7,5],r),e.AddCumulatedPolygonToBody(t,[2,6,7,4],r),e.AddCumulatedPolygonToBody(t,[3,5,7,6],r),t},e.GenerateCumulatedOctahedron=function(o){var t=new e.Body;e.AddVertexToBody(t,1,0,0),e.AddVertexToBody(t,-1,0,0),e.AddVertexToBody(t,0,1,0),e.AddVertexToBody(t,0,-1,0),e.AddVertexToBody(t,0,0,1),e.AddVertexToBody(t,0,0,-1);var r=Math.sqrt(2),n=r*o;return e.AddCumulatedPolygonToBody(t,[0,2,4],n),e.AddCumulatedPolygonToBody(t,[0,3,5],n),e.AddCumulatedPolygonToBody(t,[0,4,3],n),e.AddCumulatedPolygonToBody(t,[0,5,2],n),e.AddCumulatedPolygonToBody(t,[1,2,5],n),e.AddCumulatedPolygonToBody(t,[1,3,4],n),e.AddCumulatedPolygonToBody(t,[1,4,2],n),e.AddCumulatedPolygonToBody(t,[1,5,3],n),t},e.GenerateCumulatedDodecahedron=function(o){var t=new e.Body,r=(1+Math.sqrt(5))/2,n=1/r;e.AddVertexToBody(t,1,1,1),e.AddVertexToBody(t,1,1,-1),e.AddVertexToBody(t,1,-1,1),e.AddVertexToBody(t,-1,1,1),e.AddVertexToBody(t,1,-1,-1),e.AddVertexToBody(t,-1,1,-1),e.AddVertexToBody(t,-1,-1,1),e.AddVertexToBody(t,-1,-1,-1),e.AddVertexToBody(t,0,+n,+r),e.AddVertexToBody(t,0,+n,-r),e.AddVertexToBody(t,0,-n,+r),e.AddVertexToBody(t,0,-n,-r),e.AddVertexToBody(t,+n,+r,0),e.AddVertexToBody(t,+n,-r,0),e.AddVertexToBody(t,-n,+r,0),e.AddVertexToBody(t,-n,-r,0),e.AddVertexToBody(t,+r,0,+n),e.AddVertexToBody(t,-r,0,+n),e.AddVertexToBody(t,+r,0,-n),e.AddVertexToBody(t,-r,0,-n);var i=Math.sqrt(5)-1,d=i*o;return e.AddCumulatedPolygonToBody(t,[0,8,10,2,16],d),e.AddCumulatedPolygonToBody(t,[0,16,18,1,12],d),e.AddCumulatedPolygonToBody(t,[0,12,14,3,8],d),e.AddCumulatedPolygonToBody(t,[1,9,5,14,12],d),e.AddCumulatedPolygonToBody(t,[1,18,4,11,9],d),e.AddCumulatedPolygonToBody(t,[2,10,6,15,13],d),e.AddCumulatedPolygonToBody(t,[2,13,4,18,16],d),e.AddCumulatedPolygonToBody(t,[3,14,5,19,17],d),e.AddCumulatedPolygonToBody(t,[3,17,6,10,8],d),e.AddCumulatedPolygonToBody(t,[4,13,15,7,11],d),e.AddCumulatedPolygonToBody(t,[5,9,11,7,19],d),e.AddCumulatedPolygonToBody(t,[6,17,19,7,15],d),t},e.GenerateCumulatedIcosahedron=function(o){var t=new e.Body,r=(1+Math.sqrt(5))/2;e.AddVertexToBody(t,0,1,+r),e.AddVertexToBody(t,0,1,-r),e.AddVertexToBody(t,0,-1,+r),e.AddVertexToBody(t,0,-1,-r),e.AddVertexToBody(t,1,+r,0),e.AddVertexToBody(t,1,-r,0),e.AddVertexToBody(t,-1,+r,0),e.AddVertexToBody(t,-1,-r,0),e.AddVertexToBody(t,+r,0,1),e.AddVertexToBody(t,-r,0,1),e.AddVertexToBody(t,+r,0,-1),e.AddVertexToBody(t,-r,0,-1);var n=2*o;return e.AddCumulatedPolygonToBody(t,[0,2,8],n),e.AddCumulatedPolygonToBody(t,[0,4,6],n),e.AddCumulatedPolygonToBody(t,[0,6,9],n),e.AddCumulatedPolygonToBody(t,[0,8,4],n),e.AddCumulatedPolygonToBody(t,[0,9,2],n),e.AddCumulatedPolygonToBody(t,[1,3,11],n),e.AddCumulatedPolygonToBody(t,[1,4,10],n),e.AddCumulatedPolygonToBody(t,[1,6,4],n),e.AddCumulatedPolygonToBody(t,[1,10,3],n),e.AddCumulatedPolygonToBody(t,[1,11,6],n),e.AddCumulatedPolygonToBody(t,[2,5,8],n),e.AddCumulatedPolygonToBody(t,[2,7,5],n),e.AddCumulatedPolygonToBody(t,[2,9,7],n),e.AddCumulatedPolygonToBody(t,[3,5,7],n),e.AddCumulatedPolygonToBody(t,[3,7,11],n),e.AddCumulatedPolygonToBody(t,[3,10,5],n),e.AddCumulatedPolygonToBody(t,[4,8,10],n),e.AddCumulatedPolygonToBody(t,[6,11,9],n),e.AddCumulatedPolygonToBody(t,[5,10,8],n),e.AddCumulatedPolygonToBody(t,[7,9,11],n),t},e.GenerateTetrakisHexahedron=function(){return e.GenerateCumulatedHexahedron(.25)},e.GenerateRhombicDodecahedron=function(){return e.GenerateCumulatedHexahedron(.5)},e.GeneratePentakisDodecahedron=function(){var o=Math.sqrt((65+22*Math.sqrt(5))/5)/19;return e.GenerateCumulatedDodecahedron(o)},e.GenerateSmallStellatedDodecahedron=function(){var o=Math.sqrt((5+2*Math.sqrt(5))/5);return e.GenerateCumulatedDodecahedron(o)},e.GenerateGreatDodecahedron=function(){var o=Math.sqrt(3)*(Math.sqrt(5)-3)/6;return e.GenerateCumulatedIcosahedron(o)},e.GenerateSmallTriambicIcosahedron=function(){var o=Math.sqrt(15)/15;return e.GenerateCumulatedIcosahedron(o)},e.GenerateGreatStellatedDodecahedron=function(){var o=Math.sqrt(3)*(3+Math.sqrt(5))/6;return e.GenerateCumulatedIcosahedron(o)},e.GenerateSmallTriakisOctahedron=function(){var o=Math.sqrt(3)-2*Math.sqrt(6)/3;return e.GenerateCumulatedOctahedron(o)},e.GenerateStellaOctangula=function(){var o=Math.sqrt(6)/3;return e.GenerateCumulatedOctahedron(o)},e.GenerateTriakisTetrahedron=function(){var o=Math.sqrt(6)/15;return e.GenerateCumulatedTetrahedron(o)},e}),e("skylark-jsmodeler/extras/extgenerator",["../core/jsm"],function(e){return e.LegoDimensions=function(){this.legoWidth=.78,this.legoSmallHeight=.32,this.legoLargeHeight=.96,this.legoWallWidth=.16,this.legoCylinderWidth=.5,this.legoCylinderHeight=.17,this.legoBottomSmallCylinderWidth=.3,this.legoBottomLargeCylinderWidth=.6,this.legoBottomLargeCylinderWallWidth=.1},e.GenerateLegoBrick=function(o,t,r,n,i,d,a){function s(o,t){var r,n;for(r=0;r<o.VertexCount();r++)(n=o.GetVertex(r)).position=e.CoordAdd(n.position,t)}var l=new e.LegoDimensions,u=new e.Vector(0,0,1),y=l.legoWidth,c=l.legoLargeHeight;r||(c=l.legoSmallHeight);var h=l.legoWallWidth,f=l.legoCylinderWidth,g=l.legoCylinderHeight,x=l.legoBottomSmallCylinderWidth,p=l.legoBottomLargeCylinderWidth,T=l.legoBottomLargeCylinderWallWidth,C=[];C.push(new e.Coord(0,0,0)),C.push(new e.Coord(y*o,0,0)),C.push(new e.Coord(y*o,y*t,0)),C.push(new e.Coord(0,y*t,0));var v,A,m=new e.Body,B=e.GeneratePrismShell(C,u,c-h,h,!0);for(m.Merge(B),v=0;v<4;v++)C[v].z=c-h;var P,V,w,S,G=e.GeneratePrism(C,u,h,!0,null);if(m.Merge(G),n)for(v=0;v<o;v++)for(A=0;A<t;A++)P=new e.Coord(y*v+y/2,y*A+y/2,c+g/2),s(V=e.GenerateCylinder(f/2,g,d,!0,a),P),m.Merge(V);if(i)if(1===o&&t>1||1===t&&o>1)for(w=t,S=!0,o>t&&(w=o,S=!1),v=0;v<w-1;v++)P=S?new e.Coord(y/2,y*(v+1),(c-h)/2):new e.Coord(y*(v+1),y/2,(c-h)/2),s(V=e.GenerateCylinder(x/2,c-h,d,!0,a),P),m.Merge(V);else if(o>1&&t>1)for(v=0;v<o-1;v++)for(A=0;A<t-1;A++)[],P=new e.Coord(y*(v+1),y*(A+1),(c-h)/2),s(V=e.GenerateCylinderShell(p/2,c-h,T,d,!0,a),P),m.Merge(V);return m.SetCubicTextureProjection(new e.Coord(0,0,0),new e.Coord(1,0,0),new e.Coord(0,1,0),new e.Coord(0,0,1)),m},e.GenerateConvexHullBody=function(o){var t,r,n,i,d,a=new e.Body,s=e.ConvexHull3D(o),l={};for(t=0;t<s.length;t++)for(n=s[t],r=0;r<n.length;r++)(i=n[r])in l||(l[i]=a.VertexCount(),a.AddVertex(new e.BodyVertex(o[i])));for(t=0;t<s.length;t++){for(n=s[t],d=[],r=0;r<n.length;r++)i=n[r],d.push(l[i]);a.AddPolygon(new e.BodyPolygon(d))}return a},e.GenerateSuperShape=function(o,t,r,n,i,d,a,s,l,u,y,c,h,f){function g(e){var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),t=Math.asin(e.z/o),r=Math.atan2(e.y,e.x);return[o,t,r]}function x(e,o,t,r,n,i,d){var a=Math.abs(Math.cos(r*e/4)/o),s=Math.abs(Math.sin(r*e/4)/t);return Math.pow(Math.pow(a,i)+Math.pow(s,d),-1/n)}function p(h,f){var g=new e.Coord(0,0,0),p=x(h,a,s,l,u,y,c),T=x(f,o,t,r,n,i,d);return g.x=T*Math.cos(f)*p*Math.cos(h),g.y=T*Math.sin(f)*p*Math.cos(h),g.z=p*Math.sin(h),g}var T,C,v,A,m,B=e.GenerateSphere(1,h,f);for(T=0;T<B.VertexCount();T++)C=B.GetVertex(T),v=C.position,A=g(v),m=p(A[1],A[2]),C.SetPosition(m);return B},e}),e("skylark-jsmodeler/extras/subdivision",["../core/jsm"],function(e){return e.CatmullClarkSubdivisionOneIteration=function(o){var t=new e.Body,r=new e.AdjacencyInfo(o),n=[],i=[];return function(o,t,r){var n,i;for(n=0;n<r.verts.length;n++)i=o.GetVertexPosition(n),t.AddVertex(new e.BodyVertex(i.Clone()))}(o,t,r),function(o,t,r,n){var i,d,a,s,l;for(i=0;i<r.pgons.length;i++){for(a=r.pgons[i],l=new e.Coord(0,0,0),d=0;d<a.verts.length;d++)s=o.GetVertexPosition(a.verts[d]),l=e.CoordAdd(l,s);l.MultiplyScalar(1/a.verts.length),n.push(t.AddVertex(new e.BodyVertex(l)))}}(o,t,r,n),function(o,t,r,n,i){var d,a,s,l,u,y,c,h;for(d=0;d<r.edges.length;d++){if(s=r.edges[d],l=o.GetVertexPosition(s.vert1),u=o.GetVertexPosition(s.vert2),r.IsContourEdge(s))y=e.MidCoord(l,u);else{for(y=e.CoordAdd(l,u),a=0;a<2;a++)c=0===a?s.pgon1:s.pgon2,h=t.GetVertexPosition(n[c]),y=e.CoordAdd(y,h);y.MultiplyScalar(.25)}i.push(t.AddVertex(new e.BodyVertex(y)))}}(o,t,r,n,i),function(o,t,r,n){function i(e,o){o.x=e.x,o.y=e.y,o.z=e.z}function d(e,o,t,r){r.x=(e.x+2*o.x+(t-3)*r.x)/t,r.y=(e.y+2*o.y+(t-3)*r.y)/t,r.z=(e.z+2*o.z+(t-3)*r.z)/t}var a,s,l,u,y,c,h,f,g,x,p,T=[];for(l=0;l<r.edges.length;l++)a=r.edges[l],s=e.MidCoord(o.GetVertexPosition(a.vert1),o.GetVertexPosition(a.vert2)),T.push(s);for(l=0;l<r.verts.length;l++)if(y=r.verts[l],h=t.GetVertexPosition(l),r.IsContourVertex(y)){for(p=0,x=new e.Coord(0,0,0),u=0;u<y.edges.length;u++)a=y.edges[u],r.IsContourEdge(r.edges[a])&&(s=T[y.edges[u]],x.Add(s),p++);x.Add(h),p++,x.MultiplyScalar(1/p),i(x,h)}else{for(g=new e.Coord(0,0,0),x=new e.Coord(0,0,0),u=0;u<y.pgons.length;u++)c=y.pgons[u],f=t.GetVertexPosition(n[c]),g.Add(f);for(g.MultiplyScalar(1/y.pgons.length),u=0;u<y.edges.length;u++)a=y.edges[u],s=T[a],x.Add(s);x.MultiplyScalar(1/y.edges.length),d(g,x,y.edges.length,h)}}(o,t,r,n),function(o,t,r,n,i){var d,a,s,l,u,y,c,h,f,g,x,p;for(g=0;g<r.pgons.length;g++)for(p=r.pgons[g],d=p.verts.length,x=0;x<d;x++)a=p.pedges[x],s=p.pedges[(x+1)%d],l=n[g],u=i[a.index],y=r.GetPolyEdgeStartVertex(s),c=i[s.index],h=new e.BodyPolygon([l,u,y,c]),f=o.GetPolygon(g),h.material=f.material,h.curved=f.curved,t.AddPolygon(h)}(o,t,r,n,i),t},e.CatmullClarkSubdivision=function(o,t){var r,n=o;for(r=0;r<t;r++)n=e.CatmullClarkSubdivisionOneIteration(n);return n},e}),e("skylark-jsmodeler/extras/csg",["../core/jsm"],function(e){return e.BooleanOperation=function(o,t,r){function n(o,t,r,n){function i(o,r){return t.AddVertex(new e.BodyVertex(o))}var d,a,s=new e.BodyPolygon([]);if(n)for(d=o.VertexCount()-1;d>=0;d--)a=i(o.GetVertex(d),r),s.AddVertexIndex(a);else for(d=0;d<o.VertexCount();d++)a=i(o.GetVertex(d),r),s.AddVertexIndex(a);void 0!==o.userData&&s.SetMaterialIndex(o.userData.material),t.AddPolygon(s)}function i(e,o,t,r){var i;for(i=0;i<e.length;i++)n(e[i],o,t,r)}function d(o,t,r,n,i,d){function a(e,o){var t,r;for(t=0;t<e.length;t++)void 0===(r=e[t]).userData&&(r.userData=o)}var s,l;for(s=0;s<o.length;s++)l=o[s],e.ClipPolygonWithBSPTree(l.polygon,t,r,n,i,d),a(r,l.userData),a(n,l.userData),a(i,l.userData),a(d,l.userData)}var a=new e.BSPTree,s=new e.BSPTree;e.AddBodyToBSPTree(t,a,"a"),e.AddBodyToBSPTree(r,s,"b");var l=[],u=[],y=[],c=[];d(a.GetNodes(),s,l,u,y,c);var h=[],f=[],g=[];d(s.GetNodes(),a,h,f,g,[]);var x=new e.Body,p=new e.Octree(e.BoxUnion(t.GetBoundingBox(),r.GetBoundingBox()));return"Union"==o?(i(l,x,p,!1),i(y,x,p,!1),i(c,x,p,!1),i(h,x,p,!1),i(g,x,p,!1)):"Difference"==o?(i(l,x,p,!1),i(y,x,p,!1),i(f,x,p,!0)):"Intersection"==o&&(i(u,x,p,!1),i(c,x,p,!1),i(f,x,p,!1)),x},e}),e("skylark-jsmodeler/extras/surfaces",["../core/jsm"],function(e){return e.GenerateSurface=function(o,t,r,n,i,d,a,s){var l=new e.Body,u=o[0],y=t[0],c=o[1]-o[0],h=t[1]-t[0],f=c/r,g=h/n;return function(o,t,i,d,l){var u,y,c;for(u=0;u<=n;u++)for(y=0;y<=r;y++)c=a(u,y,t+y*d,i+u*l,s),o.AddVertex(new e.BodyVertex(c))}(l,u,y,f,g),function(o){var t,a,s,l,u,y,c;for(a=0;a<n;a++)for(t=0;t<r;t++)l=(s=a*(r+1)+t)+1,y=(u=s+r+1)+1,i?(c=new e.BodyPolygon([s,l,y]),d&&c.SetCurveGroup(0),o.AddPolygon(c),c=new e.BodyPolygon([s,y,u]),d&&c.SetCurveGroup(0),o.AddPolygon(c)):(c=new e.BodyPolygon([s,l,y,u]),d&&c.SetCurveGroup(0),o.AddPolygon(c))}(l),l},e.SurfaceControlPoints=function(o,t){var r,n;for(this.n=o,this.m=t,this.points=[],r=0;r<=this.n;r++)for(this.points.push([]),n=0;n<=this.m;n++)this.points[r].push(new e.Coord(0,0,0))},e.SurfaceControlPoints.prototype.GetNValue=function(){return this.n},e.SurfaceControlPoints.prototype.GetMValue=function(){return this.m},e.SurfaceControlPoints.prototype.GetControlPoint=function(e,o){return this.points[e][o]},e.SurfaceControlPoints.prototype.InitPlanar=function(e,o){var t,r,n,i=e/this.n,d=o/this.m;for(t=0;t<=this.n;t++)for(r=0;r<=this.m;r++)(n=this.points[t][r]).x=t*i,n.y=r*d},e.GenerateBezierSurface=function(o,t,r,n){var i=e.GenerateSurface([0,1],[0,1],t,r,!1,n,function(o,t,r,n,i){var d,a,s,l,u,y,c=i.GetNValue(),h=i.GetMValue();for(s=new e.Coord(0,0,0),d=0;d<=c;d++){for(l=new e.Coord(0,0,0),a=0;a<=h;a++)y=e.BernsteinPolynomial(d,c,r)*e.BernsteinPolynomial(a,h,n),u=i.GetControlPoint(d,a).Clone().MultiplyScalar(y),l=e.CoordAdd(l,u);s=e.CoordAdd(s,l)}return s},o);return i},e}),e("skylark-jsmodeler/extensions/svgtomodel/svgtomodel",["../../core/jsm"],function(e){return e.SvgToModel=function(o,t,r,n){function i(o,t){function r(o,t,r,n,i){var d=o.createSVGPoint();d.x=n,d.y=i;var a=d,s=r.getCTM();void 0!==s&&null!==s&&(a=d.matrixTransform(s));var l=new e.Coord2D(a.x,a.y),u=new e.Coord2D(n,i),y=t.GetLastContour(),c=y.VertexCount();return c>0&&y.GetVertex(c-1).IsEqualWithEps(l,.1)?u:(y.AddVertex(a.x,a.y),u)}function n(e,o,t,n,i,d){var a=function(e){var o,t,r,i,d,a=document.createElementNS("http://www.w3.org/2000/svg","path"),s=(l=n.x,u=n.y,"M "+l+" "+u+" ");var l,u;for(o=0;o<e.length;o++)(t=e[o]).pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL?(r=t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?"C":"c",s+=r+" "+t.x1+" "+t.y1+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y+" "):t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL?(r=t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?"Q":"q",s+=r+" "+t.x1+" "+t.y1+" "+t.x+" "+t.y+" "):t.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||t.pathSegType==SVGPathSeg.PATHSEG_ARC_REL?(r=t.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS?"A":"a",i=t.largeArcFlag?1:0,d=t.sweepFlag?1:0,s+=r+" "+t.r1+" "+t.r2+" "+t.angle+" "+i+" "+d+" "+t.x+" "+t.y+" "):t.pathSegType!=SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS&&t.pathSegType!=SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL||(r=t.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS?"S":"s",s+=r+" "+t.x2+" "+t.y2+" "+t.x+" "+t.y+" ");return a.setAttributeNS(null,"d",s),a}(i),s=a.getTotalLength(),l=0;t>0&&(l=parseInt(s/t,10)),l<3&&(l=3);var u,y,c=s/l;for(u=1;u<=l;u++)y=a.getPointAtLength(u*c),n=r(e,d,o,y.x,y.y);return n}function i(e){return e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL||e.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||e.pathSegType==SVGPathSeg.PATHSEG_ARC_REL||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL}function d(e){return e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL}function a(e){var o=e.GetLastContour(),t=o.VertexCount();if(0!==t){var r=o.GetVertex(0),n=o.GetVertex(t-1);r.IsEqualWithEps(n,.1)&&o.vertices.pop()}}function s(e){e.GetLastContour().VertexCount()>0&&(a(e),e.AddContour())}var l=new e.ContourPolygon2D;l.AddContour();var u,y,c=document.createElementNS("http://www.w3.org/2000/svg","svg");if(o instanceof SVGPathElement){var h,f,g,x=new e.Coord2D(0,0),p=new e.Coord2D(0,0),T=t;for(o.hasAttribute("segmentlength")&&(T=parseFloat(o.getAttribute("segmentlength"))),u=0;u<o.pathSegList.numberOfItems;u++)if((h=o.pathSegList.getItem(u)).pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH);else if(h.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)s(l),x=r(c,l,o,h.x,h.y),p=x.Clone();else if(h.pathSegType==SVGPathSeg.PATHSEG_MOVETO_REL)s(l),x=r(c,l,o,p.x+h.x,p.y+h.y),p=x.Clone();else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)x=r(c,l,o,h.x,h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_REL)x=r(c,l,o,x.x+h.x,x.y+h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS)x=r(c,l,o,h.x,x.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS)x=r(c,l,o,x.x,h.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL)x=r(c,l,o,x.x+h.x,x.y);else if(h.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL)x=r(c,l,o,x.x,x.y+h.y);else if(i(h)){if(f=[],d(h)){for(y=u;y<o.pathSegList.numberOfItems&&d(g=o.pathSegList.getItem(y));y++)f.push(g);u=y-1}else f.push(h);x=n(c,o,T,x,f,l)}a(l)}else if(o instanceof SVGRectElement)r(c,l,o,o.x.baseVal.value,o.y.baseVal.value),r(c,l,o,o.x.baseVal.value+o.width.baseVal.value,o.y.baseVal.value),r(c,l,o,o.x.baseVal.value+o.width.baseVal.value,o.y.baseVal.value+o.height.baseVal.value),r(c,l,o,o.x.baseVal.value,o.y.baseVal.value+o.height.baseVal.value);else if(o instanceof SVGPolygonElement){var C;for(u=0;u<o.points.numberOfItems;u++)C=o.points.getItem(u),r(c,l,o,C.x,C.y)}return l.color=function(o){var t="",r=o;for(;null!==r&&void 0!==r&&0===t.length;)null===(t=r.getAttribute("fill"))&&(t=r.style.fill),r=r.parentElement;var n=0;if(0===t.length)return n;if("#"==t[0])n=e.HexColorToRGBColor(t.substring(1));else{var i=t.indexOf("("),d=t.indexOf(")");if(-1==i||-1==d)return n;var a=t.substring(i+1,d),s=a.split(", ");if(3!=s.length)return n;n=e.RGBComponentsToHexColor(s[0],s[1],s[2])}return n}(o),l.originalElem=o,l}function d(o,t,r){function n(o,t,r){var n,i;if(r)for(n=o.VertexCount()-1;n>=0;n--)i=o.GetVertex(n),t.push(new e.Coord(i.x,-i.y,0));else for(n=0;n<o.VertexCount();n++)i=o.GetVertex(n),t.push(new e.Coord(i.x,-i.y,0))}function i(o){var t=[],r=o.GetOrientation(),i=r==e.Orientation.CounterClockwise;return n(o,t,i),t}function d(o,t){o.push(null);var r=t.GetOrientation(),i=r==e.Orientation.Clockwise;n(t,o,i)}var a,s,l,u=[],y=new e.Vector(0,0,1),c=t;void 0!==o.originalElem&&o.originalElem.hasAttribute("modelheight")&&(c=parseFloat(o.originalElem.getAttribute("modelheight")));var h=o.ContourCount();if(0===h)return null;if(1==h)s=o.GetContour(0).GetOrientation(),a=i(o.GetContour(0)),l=e.GeneratePrism(a,y,c,!0,r),u.push(l);else if(h>1){s=o.GetContour(0).GetOrientation();var f,g=i(o.GetContour(0)),x=!1;for(f=1;f<o.ContourCount();f++)o.GetContour(f).GetOrientation()==s?(a=i(o.GetContour(f)),l=e.GeneratePrism(a,y,c,!0,r),u.push(l)):(d(g,o.GetContour(f)),x=!0);x?(l=e.GeneratePrismWithHole(g,y,c,!0,r),u.push(l)):(l=e.GeneratePrism(g,y,c,!0,r),u.push(l))}var p=new e.Material({ambient:o.color,diffuse:o.color});return[u,p]}var a,s,l,u,y,c,h=new e.Model,f=function(e,o){function t(e,o,t){var r,n=e.getElementsByTagName(o);for(r=0;r<n.length;r++)t.push(n[r])}var r=[],n=[];t(e,"path",n),t(e,"rect",n),t(e,"polygon",n);var d,a,s=o;e.hasAttribute("segmentlength")&&(s=parseFloat(e.getAttribute("segmentlength")));for(d=0;d<n.length;d++)a=i(n[d],s),r.push(a);return r}(o,r),g=t;for(o.hasAttribute("modelheight")&&(g=parseFloat(o.getAttribute("modelheight"))),a=0;a<f.length;a++)if(null!==(l=d(f[a],g,n)))for(u=l[0],c=l[1],h.AddMaterial(c),s=0;s<u.length;s++)(y=u[s]).SetPolygonsMaterialIndex(h.MaterialCount()-1),h.AddBody(y);return h},e}),e("skylark-jsmodeler/extensions/textgenerator/textgenerator",["../../core/jsm"],function(e){return e.GenerateText=function(o,t,r,n,i){function d(o,t,r,n){function i(e){return parseFloat(e)}for(var d,a=new e.Path2D({segmentation:t,offset:r,scale:n}),s=o.split(" "),l=0;l<s.length;)0!==(d=s[l++]).length&&("m"==d?(a.MoveTo(i(s[l+0]),i(s[l+1])),l+=2):"l"==d?(a.LineTo(i(s[l+0]),i(s[l+1])),l+=2):"b"==d?(a.CubicBezierTo(i(s[l+0]),i(s[l+1]),i(s[l+2]),i(s[l+3]),i(s[l+4]),i(s[l+5])),l+=6):"z"==d?a.Close():e.Message("Invalid path command found: "+d));return a}var a,s,l,u,y,c=new e.Model,h=new e.Vector2D(0,0),f=new e.Coord2D(r,r);for(a=0;a<o.length;a++)s=o[a],void 0!==(l=t.glyphs[s])&&(u=d(l.o,i,h,f),y=e.GeneratePrismsFromPath2D(u,n,!0,160*e.DegRad),c.AddBodies(y),h.x+=l.ha*f.x);return c},e}),e("skylark-jsmodeler/extensions/threeviewer/threeconverter",["../../core/jsm"],function(e){return e.ConvertBodyToThreeMeshes=function(o,t,r){var n={textureLoadedCallback:null,hasConvexPolygons:!1};void 0!==r&&null!==r&&(n.textureLoadedCallback=e.ValueOrDefault(r.textureLoadedCallback,n.textureLoadedCallback),n.hasConvexPolygons=e.ValueOrDefault(r.hasConvexPolygons,n.hasConvexPolygons));var i=[],d=null,a=null,s={hasConvexPolygons:n.hasConvexPolygons,onPointGeometryStart:function(e){a=new THREE.PointsMaterial({color:e.diffuse,size:e.pointSize}),d=new THREE.Geometry},onPointGeometryEnd:function(){var e=new THREE.Points(d,a);i.push(e)},onPoint:function(e){d.vertices.push(new THREE.Vector3(e.x,e.y,e.z))},onLineGeometryStart:function(e){d=new THREE.Geometry,a=new THREE.LineBasicMaterial({color:e.diffuse})},onLineGeometryEnd:function(){var e=new THREE.LineSegments(d,a);i.push(e)},onLine:function(e,o){d.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),d.vertices.push(new THREE.Vector3(o.x,o.y,o.z))},onGeometryStart:function(o){var t=null!==o.texture,r=1!==o.opacity,i=o.diffuse,s=o.specular,l=o.shininess;if(0===l&&(s=0,l=1),a=new THREE.MeshPhongMaterial({color:i,specular:s,shininess:l}),o.singleSided||(a.side=THREE.DoubleSide),r&&(a.opacity=o.opacity,a.transparent=!0),t){var u=a,y=o.texture,c=new THREE.TextureLoader;c.load(y,function(o){o.image=e.ResizeImageToPowerOfTwoSides(o.image),o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,u.map=o,u.needsUpdate=!0,null!==n.textureLoadedCallback&&n.textureLoadedCallback()})}d=new THREE.Geometry},onGeometryEnd:function(){d.computeFaceNormals();var e=new THREE.Mesh(d,a);i.push(e)},onTriangle:function(e,o,t,r,n,i,a,s,l){var u=d.vertices.length;d.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),d.vertices.push(new THREE.Vector3(o.x,o.y,o.z)),d.vertices.push(new THREE.Vector3(t.x,t.y,t.z));var y=new THREE.Face3(u+0,u+1,u+2);if(d.faces.push(y),null!==r&&null!==n&&null!==i){var c=[];c.push(new THREE.Vector3(r.x,r.y,r.z)),c.push(new THREE.Vector3(n.x,n.y,n.z)),c.push(new THREE.Vector3(i.x,i.y,i.z)),d.faces[d.faces.length-1].vertexNormals=c}if(null!==a&&null!==s&&null!==l){var h=[];h.push(new THREE.Vector2(a.x,-a.y)),h.push(new THREE.Vector2(s.x,-s.y)),h.push(new THREE.Vector2(l.x,-l.y)),d.faceVertexUvs[0].push(h)}}};return e.ExplodeBody(o,t,s),i},e.ConvertModelToThreeMeshes=function(o,t){var r,n,i,d,a=[],s=o.GetMaterialSet();for(r=0;r<o.BodyCount();r++)for(i=o.GetBody(r),d=e.ConvertBodyToThreeMeshes(i,s,t),n=0;n<d.length;n++)a.push(d[n]);return a},e.ConvertJSONDataToThreeMeshes=function(o,t,r){var n=[],i=o.materials;if(void 0===i)return n;var d=o.meshes;if(void 0===d)return n;var a=0;return e.AsyncRunTask(function(){return function(o,r,n,i){function d(o,n,i,d,a,s){function l(o,t,r,n,i){var d=new THREE.Vector2(o,t);if(!e.IsZero(i)){var a=Math.sin(i*e.DegRad),s=Math.cos(i*e.DegRad);d.x=s*o-a*t,d.y=a*o+s*t}return d.x=r[0]+d.x*n[0],d.y=r[1]+d.y*n[1],d}var u=o.material,y=o.parameters,c=a[u],h=c.texture,f=c.offset,g=c.scale,x=c.rotation,p=new THREE.Color,T=new THREE.Color,C=c.shininess||0;p.setRGB(c.diffuse[0],c.diffuse[1],c.diffuse[2]),T.setRGB(c.specular[0],c.specular[1],c.specular[2]),void 0!==h&&null!==h&&(p.setRGB(1,1,1),T.setRGB(1,1,1),void 0!==f&&null!==f||(f=[0,0]),void 0!==g&&null!==g||(g=[1,1]),void 0!==x&&null!==x||(x=0)),0===C&&(T.setRGB(0,0,0),C=1);var v=new THREE.MeshPhongMaterial({color:p.getHex(),specular:T.getHex(),shininess:C,side:THREE.DoubleSide});if(1!==c.opacity&&(v.opacity=c.opacity,v.transparent=!0),void 0!==h&&null!==h){var A=new THREE.TextureLoader,m=v;A.load(h,function(o){o.image=e.ResizeImageToPowerOfTwoSides(o.image),o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,m.map=o,m.needsUpdate=!0,void 0!==t&&null!==t&&t()})}var B,P,V,w,S,G,I,M,R,b,E,D,L,O,N=new THREE.Geometry;for(O=0;O<y.length;O+=9)B=3*y[O+0],P=3*y[O+1],V=3*y[O+2],w=3*y[O+3],S=3*y[O+4],G=3*y[O+5],I=2*y[O+6],M=2*y[O+7],R=2*y[O+8],b=N.vertices.length,E=N.faces.length,N.vertices.push(new THREE.Vector3(n[B+0],n[B+1],n[B+2])),N.vertices.push(new THREE.Vector3(n[P+0],n[P+1],n[P+2])),N.vertices.push(new THREE.Vector3(n[V+0],n[V+1],n[V+2])),N.faces.push(new THREE.Face3(b+0,b+1,b+2)),(D=[]).push(new THREE.Vector3(i[w+0],i[w+1],i[w+2])),D.push(new THREE.Vector3(i[S+0],i[S+1],i[S+2])),D.push(new THREE.Vector3(i[G+0],i[G+1],i[G+2])),N.faces[E].vertexNormals=D,void 0!==h&&null!==h&&((L=[]).push(l(d[I+0],d[I+1],f,g,x)),L.push(l(d[M+0],d[M+1],f,g,x)),L.push(l(d[R+0],d[R+1],f,g,x)),N.faceVertexUvs[0].push(L));var F=new THREE.Mesh(N,v);F.originalJsonMaterialIndex=u,F.originalJsonMeshIndex=r,s.push(F)}var a=o.vertices;if(void 0===a)return;var s=o.normals;if(void 0===s)return;var l=o.uvs;if(void 0===l)return;var u,y=o.triangles;for(u=0;u<y.length;u++)d(y[u],a,s,l,n,i)}(d[a],a,i,n),a+=1,!0},r,d.length,0,n),n},e}),e("skylark-jsmodeler/extensions/threeviewer/threeviewer",["../../core/jsm"],function(e){return e.ThreeViewer=function(){this.canvas=null,this.scene=null,this.camera=null,this.renderer=null,this.ambientLight=null,this.directionalLight=null,this.runBeforeRender=null,this.runAfterRender=null,this.cameraMove=null,this.navigation=null,this.settings=null,this.drawLoop=null,this.enableDraw=null},e.ThreeViewer.prototype.Start=function(o,t){return!!e.IsWebGLEnabled()&&(!!this.InitSettings(t)&&(!!this.InitThree(o)&&(!!this.InitCamera(t)&&(!!this.InitLights()&&(this.drawLoop=!1,this.enableDraw=!0,this.DrawIfNeeded(),!0)))))},e.ThreeViewer.prototype.InitSettings=function(o){return this.settings={cameraEyePosition:new e.Coord(1,1,1),cameraCenterPosition:new e.Coord(0,0,0),cameraUpVector:new e.Coord(0,0,1),lightAmbientColor:[.5,.5,.5],lightDiffuseColor:[.5,.5,.5]},void 0!==o&&(void 0!==o.cameraEyePosition&&(this.settings.cameraEyePosition=e.CoordFromArray(o.cameraEyePosition)),void 0!==o.cameraCenterPosition&&(this.settings.cameraCenterPosition=e.CoordFromArray(o.cameraCenterPosition)),void 0!==o.cameraUpVector&&(this.settings.cameraUpVector=e.CoordFromArray(o.cameraUpVector)),void 0!==o.lightAmbientColor&&(this.settings.lightAmbientColor=o.lightAmbientColor),void 0!==o.lightDiffuseColor&&(this.settings.lightDiffuseColor=o.lightDiffuseColor)),!0},e.ThreeViewer.prototype.InitThree=function(e){if(this.canvas=e,!this.canvas||!this.canvas.getContext)return!1;if(this.scene=new THREE.Scene,!this.scene)return!1;var o={canvas:this.canvas,antialias:!0};return this.renderer=new THREE.WebGLRenderer(o),!!this.renderer&&(this.renderer.setClearColor(new THREE.Color(16777215)),this.renderer.setSize(this.canvas.width,this.canvas.height),!0)},e.ThreeViewer.prototype.InitCamera=function(o){return this.cameraMove=new e.Camera(e.CoordFromArray(o.cameraEyePosition),e.CoordFromArray(o.cameraCenterPosition),e.CoordFromArray(o.cameraUpVector),o.fieldOfView,o.nearClippingPlane,o.farClippingPlane),!!this.cameraMove&&(this.navigation=new e.Navigation,!!this.navigation.Init(this.canvas,this.cameraMove,this.DrawIfNeeded.bind(this),this.Resize.bind(this))&&(this.camera=new THREE.PerspectiveCamera(this.cameraMove.fieldOfView,this.canvas.width/this.canvas.height,this.cameraMove.nearClippingPlane,this.cameraMove.farClippingPlane),!!this.camera&&(this.scene.add(this.camera),!0)))},e.ThreeViewer.prototype.InitLights=function(){var e=new THREE.Color,o=new THREE.Color;if(e.setRGB(this.settings.lightAmbientColor[0],this.settings.lightAmbientColor[1],this.settings.lightAmbientColor[2]),o.setRGB(this.settings.lightDiffuseColor[0],this.settings.lightDiffuseColor[1],this.settings.lightDiffuseColor[2]),this.ambientLight=new THREE.AmbientLight(e.getHex()),!this.ambientLight)return!1;if(this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(o.getHex()),!this.directionalLight)return!1;var t=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);return this.directionalLight.position.set(t.x,t.y,t.z),this.scene.add(this.directionalLight),!0},e.ThreeViewer.prototype.SetRunBeforeRender=function(e){this.runBeforeRender=e},e.ThreeViewer.prototype.SetRunAfterRender=function(e){this.runAfterRender=e},e.ThreeViewer.prototype.SetClearColor=function(e){this.renderer.setClearColor(new THREE.Color(e)),this.DrawIfNeeded()},e.ThreeViewer.prototype.AddMesh=function(e){this.scene.add(e),this.DrawIfNeeded()},e.ThreeViewer.prototype.AddMeshes=function(e){var o;for(o=0;o<e.length;o++)this.scene.add(e[o]);this.DrawIfNeeded()},e.ThreeViewer.prototype.MeshCount=function(){var e=0,o=this;return this.scene.traverse(function(t){o.IsRelevantObject(t)&&(e+=1)}),e},e.ThreeViewer.prototype.VisibleMeshCount=function(){var e=0,o=this;return this.scene.traverse(function(t){o.IsVisibleObject(t)&&(e+=1)}),e},e.ThreeViewer.prototype.VertexCount=function(){var e=0,o=this;return this.scene.traverse(function(t){o.IsRelevantObject(t)&&(e+=t.geometry.vertices.length)}),e},e.ThreeViewer.prototype.FaceCount=function(){var e=0;return this.scene.traverse(function(o){o instanceof THREE.Mesh&&(e+=o.geometry.faces.length)}),e},e.ThreeViewer.prototype.GetMesh=function(e){var o,t=null,r=0;for(o=0;o<this.scene.children.length;o++)if(t=this.scene.children[o],this.IsRelevantObject(t)){if(r==e)return t;r+=1}return null},e.ThreeViewer.prototype.ShowMesh=function(e){e.visible=!0,this.DrawIfNeeded()},e.ThreeViewer.prototype.HideMesh=function(e){e.visible=!1,this.DrawIfNeeded()},e.ThreeViewer.prototype.RemoveMesh=function(e){e.geometry.dispose(),this.scene.remove(e),this.DrawIfNeeded()},e.ThreeViewer.prototype.RemoveMeshes=function(){var e,o;for(o=0;o<this.scene.children.length;o++)e=this.scene.children[o],this.IsRelevantObject(e)&&(e.geometry.dispose(),this.scene.remove(e),o--);this.DrawIfNeeded()},e.ThreeViewer.prototype.RemoveLastMesh=function(){var e=null,o=this;this.scene.traverse(function(t){o.IsRelevantObject(t)&&(e=t)}),null!==e&&this.scene.remove(e),this.DrawIfNeeded()},e.ThreeViewer.prototype.SetCamera=function(e,o,t){this.navigation.SetCamera(e,o,t),this.navigation.SetOrbitCenter(o.Clone()),this.DrawIfNeeded()},e.ThreeViewer.prototype.Resize=function(){this.camera.aspect=this.canvas.width/this.canvas.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.canvas.width,this.canvas.height),this.DrawIfNeeded()},e.ThreeViewer.prototype.FitInWindow=function(){if(0!==this.VisibleMeshCount()){var e=this.GetBoundingSphere();this.navigation.FitInWindow(e.GetCenter(),e.GetRadius()),this.DrawIfNeeded()}},e.ThreeViewer.prototype.FitMeshesInWindow=function(e){if(0!==e.length){var o=this.GetFilteredBoundingSphere(function(o){return-1!=e.indexOf(o)});this.navigation.FitInWindow(o.GetCenter(),o.GetRadius()),this.DrawIfNeeded()}},e.ThreeViewer.prototype.AdjustClippingPlanes=function(e){var o=this.GetBoundingSphere();o.GetRadius()<e?(this.camera.near=.1,this.camera.far=1e3):(this.camera.near=10,this.camera.far=1e6),this.camera.updateProjectionMatrix(),this.Draw()},e.ThreeViewer.prototype.GetCenter=function(){var e=this;return this.GetFilteredCenter(function(o){return e.IsVisibleObject(o)})},e.ThreeViewer.prototype.GetBoundingBox=function(){var e=this;return this.GetFilteredBoundingBox(function(o){return e.IsVisibleObject(o)})},e.ThreeViewer.prototype.GetBoundingSphere=function(){var e=this;return this.GetFilteredBoundingSphere(function(o){return e.IsVisibleObject(o)})},e.ThreeViewer.prototype.GetFilteredCenter=function(e){var o=this.GetFilteredBoundingBox(e);return o.GetCenter()},e.ThreeViewer.prototype.GetFilteredBoundingBox=function(o){var t,r,n=new e.Coord(e.Inf,e.Inf,e.Inf),i=new e.Coord(-e.Inf,-e.Inf,-e.Inf);return this.scene.traverse(function(d){var a;if(o(d))for(t=d.geometry,a=0;a<t.vertices.length;a++)(r=t.vertices[a].clone()).add(d.position),n.x=e.Minimum(n.x,r.x),n.y=e.Minimum(n.y,r.y),n.z=e.Minimum(n.z,r.z),i.x=e.Maximum(i.x,r.x),i.y=e.Maximum(i.y,r.y),i.z=e.Maximum(i.z,r.z)}),new e.Box(n,i)},e.ThreeViewer.prototype.GetFilteredBoundingSphere=function(o){var t,r,n,i=this.GetFilteredCenter(o),d=0;this.scene.traverse(function(a){var s;if(o(a))for(t=a.geometry,s=0;s<t.vertices.length;s++)(r=t.vertices[s].clone()).add(a.position),n=i.DistanceTo(new e.Coord(r.x,r.y,r.z)),e.IsGreater(n,d)&&(d=n)});var a=new e.Sphere(i,d);return a},e.ThreeViewer.prototype.GetObjectsUnderPosition=function(e,o){var t=e/this.canvas.width*2-1,r=-o/this.canvas.height*2+1,n=this.camera.position,i=new THREE.Vector3(t,r,.5);i.unproject(this.camera),i.sub(n),i.normalize();var d=new THREE.Raycaster(n,i);return d.intersectObjects(this.scene.children)},e.ThreeViewer.prototype.GetObjectsUnderMouse=function(){return this.GetObjectsUnderPosition(this.navigation.mouse.curr.x,this.navigation.mouse.curr.y)},e.ThreeViewer.prototype.GetObjectsUnderTouch=function(){return this.GetObjectsUnderPosition(this.navigation.touch.curr.x,this.navigation.touch.curr.y)},e.ThreeViewer.prototype.ProjectVector=function(e,o,t){var r=this.canvas.width,n=this.canvas.height,i=r/2,d=n/2,a=new THREE.Vector3(e,o,t);return a.project(this.camera),a.x=a.x*i+i,a.y=-a.y*d+d,a},e.ThreeViewer.prototype.EnableDraw=function(e){this.enableDraw=e},e.ThreeViewer.prototype.Draw=function(){if(this.enableDraw){null!==this.runBeforeRender&&this.runBeforeRender(),this.camera.position.set(this.cameraMove.eye.x,this.cameraMove.eye.y,this.cameraMove.eye.z),this.camera.up.set(this.cameraMove.up.x,this.cameraMove.up.y,this.cameraMove.up.z),this.camera.lookAt(new THREE.Vector3(this.cameraMove.center.x,this.cameraMove.center.y,this.cameraMove.center.z));var e=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(e.x,e.y,e.z),this.renderer.render(this.scene,this.camera),null!==this.runAfterRender&&this.runAfterRender(),this.drawLoop&&requestAnimationFrame(this.Draw.bind(this))}},e.ThreeViewer.prototype.DrawIfNeeded=function(){this.drawLoop||this.Draw()},e.ThreeViewer.prototype.StartDrawLoop=function(){this.drawLoop=!0,this.Draw()},e.ThreeViewer.prototype.IsRelevantObject=function(e){return e instanceof THREE.Mesh||e instanceof THREE.LineSegments||e instanceof THREE.Points},e.ThreeViewer.prototype.IsVisibleObject=function(e){return this.IsRelevantObject(e)&&e.visible},e}),e("skylark-jsmodeler/main",["skylark-langx/skylark","./core/jsm","./core/timer","./core/algorithm","./core/async","./core/check","./core/jsonloader","./geometry/definitions","./geometry/coord2d","./geometry/coord","./geometry/determinant","./geometry/coordutils","./geometry/matrix","./geometry/coordsystem","./geometry/sector","./geometry/line","./geometry/box","./geometry/sphere","./geometry/transformation","./geometry/plane","./geometry/projection","./geometry/convexhull","./geometry/polygon2d","./geometry/polygon","./geometry/cutpolygon","./geometry/triangulation","./geometry/octree","./geometry/bsptree","./geometry/curves","./geometry/utilities","./geometry/ray","./geometry/path","./modeler/color","./modeler/material","./modeler/materialset","./modeler/body","./modeler/model","./modeler/adjacencyinfo","./modeler/bodyutils","./modeler/textureutils","./modeler/cututils","./modeler/generator","./modeler/camera","./modeler/explode","./modeler/exporter","./modeler/trianglebody","./modeler/trianglemodel","./modeler/converter","./modeler/rayutils","./import/binaryreader","./import/importerutils","./import/importer3ds","./import/importerobj","./import/importerstl","./import/importeroff","./import/importercommon","./renderer/webglutils","./renderer/renderlight","./renderer/rendermaterial","./renderer/rendermesh","./renderer/renderbody","./renderer/shaderprogram","./renderer/renderer","./renderer/pointcloudrenderer","./renderer/renderconverter","./viewer/mouse","./viewer/touch","./viewer/painter","./viewer/drawing","./viewer/navigation","./viewer/softwareviewer","./viewer/spriteviewer","./viewer/viewer","./viewer/pointcloudviewer","./extras/solidgenerator","./extras/extgenerator","./extras/subdivision","./extras/csg","./extras/surfaces","./extensions/svgtomodel/svgtomodel","./extensions/textgenerator/textgenerator","./extensions/threeviewer/threeconverter","./extensions/threeviewer/threeviewer"],function(e,o){return skylark.attach("intg.jsmodeler",o)}),e("skylark-jsmodeler",["skylark-jsmodeler/main"],function(e){return e})}(t),!r){var d=require("skylark-langx/skylark");n?module.exports=d:o.skylarkjs=d}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsmodeler.js.map
