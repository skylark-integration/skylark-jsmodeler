/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(e){return e.ImportFileList=function(){this.descriptors=null,this.isFile=null},e.ImportFileList.prototype.InitFromFiles=function(e){var t,i,n;for(this.descriptors=[],t=0;t<e.length;t++)n={originalObject:i=e[t],originalFileName:i.name,fileName:i.name.toUpperCase(),extension:this.GetFileExtension(i.name).toUpperCase()},this.descriptors.push(n);this.isFile=!0},e.ImportFileList.prototype.InitFromURLs=function(e){var t,i,n,r;for(this.descriptors=[],t=0;t<e.length;t++)r={originalObject:i=e[t],originalFileName:n=this.GetFileName(i),fileName:n.toUpperCase(),extension:this.GetFileExtension(n).toUpperCase()},this.descriptors.push(r);this.isFile=!1},e.ImportFileList.prototype.GetInputList=function(){function e(e){return".OBJ"!=e.extension&&".MTL"!=e.extension&&".OFF"!=e.extension}var t,i,n,r=[];for(t=0;t<this.descriptors.length;t++)n={originalObject:(i=this.descriptors[t]).originalObject,isFile:this.isFile,isArrayBuffer:e(i)},r.push(n);return r},e.ImportFileList.prototype.GetFileName=function(e){var t=e.split("/");if(1==t.length&&(t=e.split("\\")),0===t.length)return"";var i=t[t.length-1];return decodeURI(i)},e.ImportFileList.prototype.GetFileDescriptor=function(e){return this.descriptors[e]},e.ImportFileList.prototype.GetMainFileIndex=function(){var e,t;for(e=0;e<this.descriptors.length;e++)if(t=this.descriptors[e],this.IsSupportedExtension(t.extension))return e;return-1},e.ImportFileList.prototype.GetFileIndexByName=function(e){var t,i,n;for(t=0;t<this.descriptors.length;t++)if(i=this.descriptors[t],n=this.GetFileName(e),i.fileName==n.toUpperCase())return t;return-1},e.ImportFileList.prototype.IsSupportedExtension=function(e){return".3DS"==e||".OBJ"==e||".STL"==e||".OFF"==e},e.ImportFileList.prototype.GetFileExtension=function(e){var t=e.lastIndexOf(".");return-1==t?"":e.substr(t)},e.ConvertImportFileListToJsonData=function(t,i){function n(){void 0!==i.onError&&null!==i.onError&&i.onError()}function r(e,t){void 0!==i.onReady&&null!==i.onReady&&i.onReady(e,t)}function o(e,t,i,n){var r=e.GetFileIndexByName(i),o=e.GetFileName(i);return-1==r?(n.missing.push(o),null):(-1==n.requested.indexOf(o)&&n.requested.push(o),t[r])}var s=t.GetMainFileIndex();if(-1!==s){var l=t.GetFileDescriptor(s),a={main:l.originalFileName,requested:[],missing:[]},u=t.GetInputList();try{".3DS"==l.extension?e.LoadMultipleBuffers(u,function(i){var l=i[s];if(null===l)n();else{var u=e.Convert3dsToJsonData(l,{onFileRequested:function(e){return o(t,i,e,a)}});r(a,u)}}):".OBJ"==l.extension?e.LoadMultipleBuffers(u,function(i){var l=i[s];if(null===l)n();else{var u=e.ConvertObjToJsonData(l,{onFileRequested:function(e){return o(t,i,e,a)}});r(a,u)}}):".STL"==l.extension?e.LoadMultipleBuffers(u,function(t){var i=t[s];if(null===i)n();else if(e.IsBinaryStlFile(i)){var o=e.ConvertStlToJsonData(i,null);r(a,o)}else{var l;for(l=0;l<u.length;l++)u[l].isArrayBuffer=!1;e.LoadMultipleBuffers(u,function(t){var i=t[s];if(null===i)n();else{var o=e.ConvertStlToJsonData(null,i);r(a,o)}})}}):".OFF"==l.extension&&e.LoadMultipleBuffers(u,function(t){var i=t[s];if(null===i)n();else{var o=e.ConvertOffToJsonData(i);r(a,o)}})}catch(e){return void n()}}else n()},e.ConvertFileListToJsonData=function(t,i){var n=new e.ImportFileList;n.InitFromFiles(t),e.ConvertImportFileListToJsonData(n,i)},e.ConvertURLListToJsonData=function(t,i){var n=new e.ImportFileList;n.InitFromURLs(t),e.ConvertImportFileListToJsonData(n,i)},e});
//# sourceMappingURL=../sourcemaps/import/importercommon.js.map
