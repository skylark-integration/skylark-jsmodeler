/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(t){return t.SpriteViewer=function(){this.canvas=null,this.camera=null,this.callbacks=null,this.points=null,this.projected=null,this.navigation=null},t.SpriteViewer.prototype.Start=function(t,i,n){return!!this.InitCanvas(t)&&(!!this.InitCamera(i)&&!!this.InitCallbacks(n))},t.SpriteViewer.prototype.InitCanvas=function(t){return this.points=[],this.canvas=t,!!this.canvas},t.SpriteViewer.prototype.InitCamera=function(i){return this.camera=t.ValueOrDefault(i,new t.Camera),!!this.camera&&(this.navigation=new t.Navigation,!!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this)))},t.SpriteViewer.prototype.InitCallbacks=function(t){return this.callbacks={onPointDraw:null},void 0!==t&&(void 0!==t.onDrawStart&&(this.callbacks.onDrawStart=t.onDrawStart),void 0!==t.onPointDraw&&(this.callbacks.onPointDraw=t.onPointDraw),void 0!==t.onDrawEnd&&(this.callbacks.onDrawEnd=t.onDrawEnd)),!0},t.SpriteViewer.prototype.AddPoint=function(t){this.points.push(t)},t.SpriteViewer.prototype.RemovePoints=function(){this.points=[]},t.SpriteViewer.prototype.Resize=function(){this.Draw()},t.SpriteViewer.prototype.NearestPointUnderPosition=function(i,n,e){var r,o,a,s=new t.Coord2D(n,e),h=-1,c=t.Inf;for(r=0;r<this.projected.length;r++)o=this.projected[r],a=s.DistanceTo(new t.Coord2D(o.position.x,o.position.y)),t.IsLower(a,i)&&t.IsLower(a,c)&&(h=o.originalIndex,c=a);return h},t.SpriteViewer.prototype.NearestPointUnderMouse=function(t){return this.NearestPointUnderPosition(t,this.navigation.mouse.curr.x,this.navigation.mouse.curr.y)},t.SpriteViewer.prototype.NearestPointUnderTouch=function(t){return this.NearestPointUnderPosition(t,this.navigation.touch.curr.x,this.navigation.touch.curr.y)},t.SpriteViewer.prototype.FitInWindow=function(){var t=this.GetBoundingSphere();this.navigation.FitInWindow(t.GetCenter(),t.GetRadius()),this.Draw()},t.SpriteViewer.prototype.GetCenter=function(){return this.GetBoundingBox().GetCenter()},t.SpriteViewer.prototype.GetBoundingBox=function(){var i,n,e=new t.Coord(t.Inf,t.Inf,t.Inf),r=new t.Coord(-t.Inf,-t.Inf,-t.Inf);for(i=0;i<this.points.length;i++)n=this.points[i],e.x=t.Minimum(e.x,n.x),e.y=t.Minimum(e.y,n.y),e.z=t.Minimum(e.z,n.z),r.x=t.Maximum(r.x,n.x),r.y=t.Maximum(r.y,n.y),r.z=t.Maximum(r.z,n.z);return new t.Box(e,r)},t.SpriteViewer.prototype.GetBoundingSphere=function(){var i,n,e,r=this.GetCenter(),o=0;for(i=0;i<this.points.length;i++)n=this.points[i],e=r.DistanceTo(n),t.IsGreater(e,o)&&(o=e);return new t.Sphere(r,o)},t.SpriteViewer.prototype.Draw=function(){null!==this.callbacks.onDrawStart&&this.callbacks.onDrawStart(this.canvas);var i,n,e,r=this.canvas.width/this.canvas.height,o=[0,0,this.canvas.width,this.canvas.height];for(this.projected=[],i=0;i<this.points.length;i++)n=this.points[i],(e=t.Project(n,this.camera.eye,this.camera.center,this.camera.up,this.camera.fieldOfView*t.DegRad,r,this.camera.nearClippingPlane,this.camera.farClippingPlane,o)).y=this.canvas.height-e.y,null!==e&&this.projected.push({position:e,originalIndex:i});for(this.projected.sort(function(t,i){return t.position.z>i.position.z?-1:t.position.z<i.position.z?1:0}),i=0;i<this.projected.length;i++)null!==this.callbacks.onPointDraw&&this.callbacks.onPointDraw(this.canvas,this.projected[i].originalIndex,this.projected[i].position);return null!==this.callbacks.onDrawEnd&&this.callbacks.onDrawEnd(this.canvas),!0},t});
//# sourceMappingURL=../sourcemaps/viewer/spriteviewer.js.map
