/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(t){return t.Navigation=function(){this.canvas=null,this.camera=null,this.drawCallback=null,this.resizeCallback=null,this.mouse=null,this.touch=null,this.cameraFixUp=null,this.cameraEnableOrbit=null,this.cameraEnablePan=null,this.cameraEnableZoom=null,this.cameraNearDistanceLimit=null,this.cameraFarDistanceLimit=null,this.orbitCenter=null,this.fullscreen=null},t.Navigation.prototype.Init=function(e,a,i,n){this.canvas=e,this.camera=a,this.drawCallback=i,this.resizeCallback=n,this.mouse=new t.Mouse,this.touch=new t.Touch,this.cameraFixUp=!0,this.cameraEnableOrbit=!0,this.cameraEnablePan=!0,this.cameraEnableZoom=!0,this.orbitCenter=this.camera.center.Clone(),this.fullscreen=!1;var s=this;return document.addEventListener&&(document.addEventListener("mousemove",function(t){s.OnMouseMove(t)}),document.addEventListener("mouseup",function(t){s.OnMouseUp(t)})),this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",function(t){s.OnMouseDown(t)},!1),this.canvas.addEventListener("DOMMouseScroll",function(t){s.OnMouseWheel(t)},!1),this.canvas.addEventListener("mousewheel",function(t){s.OnMouseWheel(t)},!1),this.canvas.addEventListener("touchstart",function(t){s.OnTouchStart(t)},!1),this.canvas.addEventListener("touchmove",function(t){s.OnTouchMove(t)},!1),this.canvas.addEventListener("touchend",function(t){s.OnTouchEnd(t)},!1),this.canvas.addEventListener("contextmenu",function(t){s.OnContextMenu(t)},!1)),window.addEventListener&&window.addEventListener("resize",function(t){s.OnResize(t)},!1),!0},t.Navigation.prototype.SetCamera=function(t,e,a){this.camera.Set(t,e,a),this.orbitCenter=this.camera.center.Clone()},t.Navigation.prototype.EnableFixUp=function(t){this.cameraFixUp=t},t.Navigation.prototype.EnableOrbit=function(t){this.cameraEnableOrbit=t},t.Navigation.prototype.EnablePan=function(t){this.cameraEnablePan=t},t.Navigation.prototype.EnableZoom=function(t){this.cameraEnableZoom=t},t.Navigation.prototype.SetNearDistanceLimit=function(t){this.cameraNearDistanceLimit=t},t.Navigation.prototype.SetFarDistanceLimit=function(t){this.cameraFarDistanceLimit=t},t.Navigation.prototype.SetOrbitCenter=function(t){this.orbitCenter=t},t.Navigation.prototype.FitInWindow=function(e,a){if(!t.IsZero(a)){var i=t.CoordSub(this.camera.center,e);this.camera.center=e,this.camera.eye=t.CoordSub(this.camera.eye,i);var n=t.CoordSub(this.camera.eye,this.camera.center).Normalize(),s=this.camera.fieldOfView/2;this.canvas.width<this.canvas.height&&(s=s*this.canvas.width/this.canvas.height);var r=a/Math.sin(s*t.DegRad);this.camera.eye=this.camera.center.Clone().Offset(n,r),this.orbitCenter=this.camera.center.Clone()}},t.Navigation.prototype.SetFullscreen=function(t){this.fullscreen=t,this.ResizeCallback()},t.Navigation.prototype.Orbit=function(e,a){var i=e*t.DegRad,n=a*t.DegRad,s=t.CoordSub(this.camera.center,this.camera.eye).Normalize(),r=t.VectorCross(s,this.camera.up).Normalize(),o=!this.orbitCenter.IsEqual(this.camera.center);if(this.cameraFixUp){var c=s.AngleTo(this.camera.up)+n;t.IsGreater(c,0)&&t.IsLower(c,Math.PI)&&(this.camera.eye.Rotate(r,-n,this.orbitCenter),o&&this.camera.center.Rotate(r,-n,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-i,this.orbitCenter),o&&this.camera.center.Rotate(this.camera.up,-i,this.orbitCenter)}else{var h=t.VectorCross(r,s).Normalize();this.camera.eye.Rotate(r,-n,this.orbitCenter),this.camera.eye.Rotate(h,-i,this.orbitCenter),o&&(this.camera.center.Rotate(r,-n,this.orbitCenter),this.camera.center.Rotate(h,-i,this.orbitCenter)),this.camera.up=h}},t.Navigation.prototype.Pan=function(e,a){var i=t.CoordSub(this.camera.center,this.camera.eye).Normalize(),n=t.VectorCross(i,this.camera.up).Normalize(),s=t.VectorCross(n,i).Normalize();this.camera.eye.Offset(n,-e),this.camera.center.Offset(n,-e),this.camera.eye.Offset(s,a),this.camera.center.Offset(s,a)},t.Navigation.prototype.Zoom=function(e){var a=t.CoordSub(this.camera.center,this.camera.eye),i=a.Length(),n=e>0;if(n&&null!==this.cameraNearDistanceLimit&&i<this.cameraNearDistanceLimit)return 0;if(!n&&null!==this.cameraFarDistanceLimit&&i>this.cameraFarDistanceLimit)return 0;var s=i*e;this.camera.eye.Offset(a,s)},t.Navigation.prototype.DrawCallback=function(){void 0!==this.drawCallback&&null!==this.drawCallback&&this.drawCallback()},t.Navigation.prototype.ResizeCallback=function(){void 0!==this.resizeCallback&&null!==this.resizeCallback&&(this.fullscreen&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight),this.resizeCallback())},t.Navigation.prototype.OnMouseDown=function(t){t.preventDefault(),this.mouse.Down(t,this.canvas)},t.Navigation.prototype.OnMouseMove=function(t){if(t.preventDefault(),this.mouse.Move(t,this.canvas),this.mouse.down){var e=0;if(1==this.mouse.button){if(!this.cameraEnableOrbit)return;e=.5,this.Orbit(this.mouse.diff.x*e,this.mouse.diff.y*e)}else if(3==this.mouse.button){if(!this.cameraEnablePan)return;e=.001*this.camera.eye.DistanceTo(this.camera.center),this.Pan(this.mouse.diff.x*e,this.mouse.diff.y*e)}this.DrawCallback()}},t.Navigation.prototype.OnMouseUp=function(t){t.preventDefault(),this.mouse.Up(t,this.canvas)},t.Navigation.prototype.OnMouseOut=function(t){t.preventDefault(),this.mouse.Out(t,this.canvas)},t.Navigation.prototype.OnMouseWheel=function(t){if(t.preventDefault(),this.cameraEnableZoom){var e=t;null===e&&(e=window.event);var a=0;e.detail?a=-e.detail:e.wheelDelta&&(a=e.wheelDelta/40);var i=.1;a<0&&(i*=-1),this.Zoom(i),this.DrawCallback()}},t.Navigation.prototype.OnTouchStart=function(t){t.preventDefault(),this.touch.Start(t,this.canvas)},t.Navigation.prototype.OnTouchMove=function(t){if(t.preventDefault(),this.touch.Move(t,this.canvas),this.touch.down){var e=0;if(1==this.touch.fingers){if(!this.cameraEnableOrbit)return;e=.5,this.Orbit(this.touch.diff.x*e,this.touch.diff.y*e)}else if(2==this.touch.fingers){if(!this.cameraEnableZoom)return;e=.005,this.Zoom(this.touch.diff.x*e)}else if(3==this.touch.fingers){if(!this.cameraEnablePan)return;e=.001*this.camera.eye.DistanceTo(this.camera.center),this.Pan(this.touch.diff.x*e,this.touch.diff.y*e)}this.DrawCallback()}},t.Navigation.prototype.OnTouchEnd=function(t){t.preventDefault(),this.touch.End(t,this.canvas)},t.Navigation.prototype.OnContextMenu=function(t){t.preventDefault()},t.Navigation.prototype.OnResize=function(t){t.preventDefault(),this.ResizeCallback()},t});
//# sourceMappingURL=../sourcemaps/viewer/navigation.js.map
