{"version":3,"sources":["extensions/threeviewer/threeviewer.js"],"names":["define","JSM","ThreeViewer","this","canvas","scene","camera","renderer","ambientLight","directionalLight","runBeforeRender","runAfterRender","cameraMove","navigation","settings","drawLoop","enableDraw","prototype","Start","IsWebGLEnabled","InitSettings","InitThree","InitCamera","InitLights","DrawIfNeeded","cameraEyePosition","Coord","cameraCenterPosition","cameraUpVector","lightAmbientColor","lightDiffuseColor","undefined","CoordFromArray","getContext","THREE","Scene","parameters","antialias","WebGLRenderer","setClearColor","Color","setSize","width","height","Camera","fieldOfView","nearClippingPlane","farClippingPlane","Navigation","Init","bind","Resize","PerspectiveCamera","add","ambientColor","diffuseColor","setRGB","AmbientLight","getHex","DirectionalLight","lightPosition","Vector3","subVectors","eye","center","position","set","x","y","z","SetRunBeforeRender","SetRunAfterRender","SetClearColor","color","AddMesh","mesh","AddMeshes","meshes","i","length","MeshCount","count","myThis","traverse","current","IsRelevantObject","VisibleMeshCount","IsVisibleObject","VertexCount","geometry","vertices","FaceCount","Mesh","faces","GetMesh","index","currIndex","children","ShowMesh","visible","HideMesh","RemoveMesh","dispose","remove","RemoveMeshes","RemoveLastMesh","found","SetCamera","up","SetOrbitCenter","Clone","aspect","updateProjectionMatrix","FitInWindow","sphere","GetBoundingSphere","GetCenter","GetRadius","FitMeshesInWindow","GetFilteredBoundingSphere","obj","indexOf","AdjustClippingPlanes","radiusLimit","near","far","Draw","GetFilteredCenter","GetBoundingBox","GetFilteredBoundingBox","needToProcess","coord","min","Inf","max","j","clone","Minimum","Maximum","Box","distance","radius","DistanceTo","IsGreater","Sphere","GetObjectsUnderPosition","mouseX","mouseY","cameraPosition","vector","unproject","sub","normalize","Raycaster","intersectObjects","GetObjectsUnderMouse","mouse","curr","GetObjectsUnderTouch","touch","ProjectVector","halfWidth","halfHeight","project","EnableDraw","enable","lookAt","render","requestAnimationFrame","StartDrawLoop","threeObj","LineSegments","Points"],"mappings":"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","file":"../../../extensions/threeviewer/threeviewer.js","sourcesContent":["define([\"../../core/jsm\"],function(JSM){\n\tJSM.ThreeViewer = function ()\n\t{\n\t\tthis.canvas = null;\n\t\t\n\t\tthis.scene = null;\n\t\tthis.camera = null;\n\t\tthis.renderer = null;\n\t\tthis.ambientLight = null;\n\t\tthis.directionalLight = null;\n\t\tthis.runBeforeRender = null;\n\t\tthis.runAfterRender = null;\n\n\t\tthis.cameraMove = null;\n\t\tthis.navigation = null;\n\t\tthis.settings = null;\n\t\tthis.drawLoop = null;\n\t\tthis.enableDraw = null;\n\t};\n\n\tJSM.ThreeViewer.prototype.Start = function (canvas, settings)\n\t{\n\t\tif (!JSM.IsWebGLEnabled ()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitSettings (settings)) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif (!this.InitThree (canvas)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitCamera (settings)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitLights ()) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.drawLoop = false;\n\t\tthis.enableDraw = true;\n\t\tthis.DrawIfNeeded ();\n\t\treturn true;\n\t};\n\n\tJSM.ThreeViewer.prototype.InitSettings = function (settings)\n\t{\n\t\tthis.settings = {\n\t\t\tcameraEyePosition : new JSM.Coord (1.0, 1.0, 1.0),\n\t\t\tcameraCenterPosition : new JSM.Coord (0.0, 0.0, 0.0),\n\t\t\tcameraUpVector : new JSM.Coord (0.0, 0.0, 1.0),\n\t\t\tlightAmbientColor : [0.5, 0.5, 0.5],\n\t\t\tlightDiffuseColor : [0.5, 0.5, 0.5]\n\t\t};\n\n\t\tif (settings !== undefined) {\n\t\t\tif (settings.cameraEyePosition !== undefined) { this.settings.cameraEyePosition = JSM.CoordFromArray (settings.cameraEyePosition); }\n\t\t\tif (settings.cameraCenterPosition !== undefined) { this.settings.cameraCenterPosition = JSM.CoordFromArray (settings.cameraCenterPosition); }\n\t\t\tif (settings.cameraUpVector !== undefined) { this.settings.cameraUpVector = JSM.CoordFromArray (settings.cameraUpVector); }\n\t\t\tif (settings.lightAmbientColor !== undefined) { this.settings.lightAmbientColor = settings.lightAmbientColor; }\n\t\t\tif (settings.lightDiffuseColor !== undefined) { this.settings.lightDiffuseColor = settings.lightDiffuseColor; }\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.ThreeViewer.prototype.InitThree = function (canvas)\n\t{\n\t\tthis.canvas = canvas;\n\t\tif (!this.canvas || !this.canvas.getContext) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.scene = new THREE.Scene();\n\t\tif (!this.scene) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar parameters = {\n\t\t\tcanvas : this.canvas,\n\t\t\tantialias : true\n\t\t};\n\t\tthis.renderer = new THREE.WebGLRenderer (parameters);\n\t\tif (!this.renderer) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.renderer.setClearColor (new THREE.Color (0xffffff));\n\t\tthis.renderer.setSize (this.canvas.width, this.canvas.height);\n\t\treturn true;\n\t};\n\n\tJSM.ThreeViewer.prototype.InitCamera = function (settings)\n\t{\n\t\tthis.cameraMove = new JSM.Camera (\n\t\t\tJSM.CoordFromArray (settings.cameraEyePosition),\n\t\t\tJSM.CoordFromArray (settings.cameraCenterPosition),\n\t\t\tJSM.CoordFromArray (settings.cameraUpVector),\n\t\t\tsettings.fieldOfView,\n\t\t\tsettings.nearClippingPlane,\n\t\t\tsettings.farClippingPlane\n\t\t);\n\t\tif (!this.cameraMove) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.navigation = new JSM.Navigation ();\n\t\tif (!this.navigation.Init (this.canvas, this.cameraMove, this.DrawIfNeeded.bind (this), this.Resize.bind (this))) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.camera = new THREE.PerspectiveCamera (this.cameraMove.fieldOfView, this.canvas.width / this.canvas.height, this.cameraMove.nearClippingPlane, this.cameraMove.farClippingPlane);\n\t\tif (!this.camera) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.scene.add (this.camera);\n\t\treturn true;\n\t};\n\n\tJSM.ThreeViewer.prototype.InitLights = function ()\n\t{\n\t\tvar ambientColor = new THREE.Color ();\n\t\tvar diffuseColor = new THREE.Color ();\n\t\tambientColor.setRGB (this.settings.lightAmbientColor[0], this.settings.lightAmbientColor[1], this.settings.lightAmbientColor[2]);\n\t\tdiffuseColor.setRGB (this.settings.lightDiffuseColor[0], this.settings.lightDiffuseColor[1], this.settings.lightDiffuseColor[2]);\n\n\t\tthis.ambientLight = new THREE.AmbientLight (ambientColor.getHex ());\n\t\tif (!this.ambientLight) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.scene.add (this.ambientLight);\n\t\t\n\t\tthis.directionalLight = new THREE.DirectionalLight (diffuseColor.getHex ());\n\t\tif (!this.directionalLight) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tvar lightPosition = new THREE.Vector3 ().subVectors (this.cameraMove.eye, this.cameraMove.center);\n\t\tthis.directionalLight.position.set (lightPosition.x, lightPosition.y, lightPosition.z);\n\n\t\tthis.scene.add (this.directionalLight);\n\t\treturn true;\n\t};\n\n\tJSM.ThreeViewer.prototype.SetRunBeforeRender = function (runBeforeRender)\n\t{\n\t\tthis.runBeforeRender = runBeforeRender;\n\t};\n\n\tJSM.ThreeViewer.prototype.SetRunAfterRender = function (runAfterRender)\n\t{\n\t\tthis.runAfterRender = runAfterRender;\n\t};\n\n\tJSM.ThreeViewer.prototype.SetClearColor = function (color)\n\t{\n\t\tthis.renderer.setClearColor (new THREE.Color (color));\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.AddMesh = function (mesh)\n\t{\n\t\tthis.scene.add (mesh);\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.AddMeshes = function (meshes)\n\t{\n\t\tvar i;\n\t\tfor (i = 0; i < meshes.length; i++) {\n\t\t\tthis.scene.add (meshes[i]);\n\t\t}\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.MeshCount = function ()\n\t{\n\t\tvar count = 0;\n\t\t\n\t\tvar myThis = this;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (myThis.IsRelevantObject (current)) {\n\t\t\t\tcount = count + 1;\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn count;\n\t};\n\n\tJSM.ThreeViewer.prototype.VisibleMeshCount = function ()\n\t{\n\t\tvar count = 0;\n\t\t\n\t\tvar myThis = this;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (myThis.IsVisibleObject (current)) {\n\t\t\t\tcount = count + 1;\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn count;\n\t};\n\n\tJSM.ThreeViewer.prototype.VertexCount = function ()\n\t{\n\t\tvar count = 0;\n\t\t\n\t\tvar myThis = this;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (myThis.IsRelevantObject (current)) {\n\t\t\t\tcount = count + current.geometry.vertices.length;\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn count;\n\t};\n\n\tJSM.ThreeViewer.prototype.FaceCount = function ()\n\t{\n\t\tvar count = 0;\n\t\t\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (current instanceof THREE.Mesh) {\n\t\t\t\tcount = count + current.geometry.faces.length;\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn count;\n\t};\n\n\tJSM.ThreeViewer.prototype.GetMesh = function (index)\n\t{\n\t\tvar current = null;\n\t\tvar currIndex = 0;\n\t\t\n\t\tvar i;\n\t\tfor (i = 0; i < this.scene.children.length; i++) {\n\t\t\tcurrent = this.scene.children[i];\n\t\t\tif (this.IsRelevantObject (current)) {\n\t\t\t\tif (currIndex == index) {\n\t\t\t\t\treturn current;\n\t\t\t\t}\n\t\t\t\tcurrIndex = currIndex + 1;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn null;\n\t};\n\n\tJSM.ThreeViewer.prototype.ShowMesh = function (mesh)\n\t{\n\t\tmesh.visible = true;\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.HideMesh = function (mesh)\n\t{\n\t\tmesh.visible = false;\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.RemoveMesh = function (mesh)\n\t{\n\t\tmesh.geometry.dispose ();\n\t\tthis.scene.remove (mesh);\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.RemoveMeshes = function ()\n\t{\n\t\tvar current;\n\t\tvar i;\n\t\tfor (i = 0; i < this.scene.children.length; i++) {\n\t\t\tcurrent = this.scene.children[i];\n\t\t\tif (this.IsRelevantObject (current)) {\n\t\t\t\tcurrent.geometry.dispose ();\n\t\t\t\tthis.scene.remove (current);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.RemoveLastMesh = function ()\n\t{\n\t\tvar found = null;\n\t\t\n\t\tvar myThis = this;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (myThis.IsRelevantObject (current)) {\n\t\t\t\tfound = current;\n\t\t\t}\n\t\t});\n\t\t\n\t\tif (found !== null) {\n\t\t\tthis.scene.remove (found);\n\t\t}\n\t\t\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.SetCamera = function (eye, center, up)\n\t{\n\t\tthis.navigation.SetCamera (eye, center, up);\n\t\tthis.navigation.SetOrbitCenter (center.Clone ());\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.Resize = function ()\n\t{\n\t\tthis.camera.aspect = this.canvas.width / this.canvas.height;\n\t\tthis.camera.updateProjectionMatrix ();\n\t\tthis.renderer.setSize (this.canvas.width, this.canvas.height);\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.FitInWindow = function ()\n\t{\n\t\tif (this.VisibleMeshCount () === 0) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar sphere = this.GetBoundingSphere ();\n\t\tthis.navigation.FitInWindow (sphere.GetCenter (), sphere.GetRadius ());\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.FitMeshesInWindow = function (meshes)\n\t{\n\t\tif (meshes.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tvar sphere = this.GetFilteredBoundingSphere (function (obj) {\n\t\t\treturn meshes.indexOf (obj) != -1;\n\t\t});\n\t\tthis.navigation.FitInWindow (sphere.GetCenter (), sphere.GetRadius ());\n\t\tthis.DrawIfNeeded ();\n\t};\n\n\tJSM.ThreeViewer.prototype.AdjustClippingPlanes = function (radiusLimit)\n\t{\n\t\tvar sphere = this.GetBoundingSphere ();\n\t\tif (sphere.GetRadius () < radiusLimit) {\n\t\t\tthis.camera.near = 0.1;\n\t\t\tthis.camera.far = 1000.0;\n\t\t} else {\n\t\t\tthis.camera.near = 10.0;\n\t\t\tthis.camera.far = 1000000.0;\n\t\t}\n\t\tthis.camera.updateProjectionMatrix ();\n\t\tthis.Draw ();\n\t};\n\n\tJSM.ThreeViewer.prototype.GetCenter = function ()\n\t{\n\t\tvar myThis = this;\n\t\treturn this.GetFilteredCenter (function (obj) {\n\t\t\treturn myThis.IsVisibleObject (obj);\n\t\t});\n\t};\n\n\tJSM.ThreeViewer.prototype.GetBoundingBox = function ()\n\t{\n\t\tvar myThis = this;\n\t\treturn this.GetFilteredBoundingBox (function (obj) {\n\t\t\treturn myThis.IsVisibleObject (obj);\n\t\t});\n\t};\n\n\tJSM.ThreeViewer.prototype.GetBoundingSphere = function ()\n\t{\n\t\tvar myThis = this;\n\t\treturn this.GetFilteredBoundingSphere (function (obj) {\n\t\t\treturn myThis.IsVisibleObject (obj);\n\t\t});\n\t};\n\n\tJSM.ThreeViewer.prototype.GetFilteredCenter = function (needToProcess)\n\t{\n\t\tvar boundingBox = this.GetFilteredBoundingBox (needToProcess);\n\t\treturn boundingBox.GetCenter ();\n\t};\n\n\tJSM.ThreeViewer.prototype.GetFilteredBoundingBox = function (needToProcess)\n\t{\n\t\tvar min = new JSM.Coord (JSM.Inf, JSM.Inf, JSM.Inf);\n\t\tvar max = new JSM.Coord (-JSM.Inf, -JSM.Inf, -JSM.Inf);\n\t\t\n\t\tvar geometry, coord;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (needToProcess (current)) {\n\t\t\t\tgeometry = current.geometry;\n\t\t\t\tvar j;\n\t\t\t\tfor (j = 0; j < geometry.vertices.length; j++) {\n\t\t\t\t\tcoord = geometry.vertices[j].clone ();\n\t\t\t\t\tcoord.add (current.position);\n\t\t\t\t\tmin.x = JSM.Minimum (min.x, coord.x);\n\t\t\t\t\tmin.y = JSM.Minimum (min.y, coord.y);\n\t\t\t\t\tmin.z = JSM.Minimum (min.z, coord.z);\n\t\t\t\t\tmax.x = JSM.Maximum (max.x, coord.x);\n\t\t\t\t\tmax.y = JSM.Maximum (max.y, coord.y);\n\t\t\t\t\tmax.z = JSM.Maximum (max.z, coord.z);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn new JSM.Box (min, max);\n\t};\n\n\tJSM.ThreeViewer.prototype.GetFilteredBoundingSphere = function (needToProcess)\n\t{\n\t\tvar center = this.GetFilteredCenter (needToProcess);\n\t\tvar radius = 0.0;\n\n\t\tvar geometry, coord, distance;\n\t\tthis.scene.traverse (function (current) {\n\t\t\tif (needToProcess (current)) {\n\t\t\t\tgeometry = current.geometry;\n\t\t\t\tvar j;\n\t\t\t\tfor (j = 0; j < geometry.vertices.length; j++) {\n\t\t\t\t\tcoord = geometry.vertices[j].clone ();\n\t\t\t\t\tcoord.add (current.position);\n\t\t\t\t\tdistance = center.DistanceTo (new JSM.Coord (coord.x, coord.y, coord.z));\n\t\t\t\t\tif (JSM.IsGreater (distance, radius)) {\n\t\t\t\t\t\tradius = distance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tvar sphere = new JSM.Sphere (center, radius);\n\t\treturn sphere;\n\t};\n\n\tJSM.ThreeViewer.prototype.GetObjectsUnderPosition = function (x, y)\n\t{\n\t\tvar mouseX = (x / this.canvas.width) * 2 - 1;\n\t\tvar mouseY = -(y / this.canvas.height) * 2 + 1;\n\n\t\tvar cameraPosition = this.camera.position;\n\t\tvar vector = new THREE.Vector3 (mouseX, mouseY, 0.5);\n\t\tvector.unproject (this.camera);\n\t\tvector.sub (cameraPosition);\n\t\tvector.normalize ();\n\n\t\tvar ray = new THREE.Raycaster (cameraPosition, vector);\n\t\treturn ray.intersectObjects (this.scene.children);\n\t};\n\n\tJSM.ThreeViewer.prototype.GetObjectsUnderMouse = function ()\n\t{\n\t\treturn this.GetObjectsUnderPosition (this.navigation.mouse.curr.x, this.navigation.mouse.curr.y);\n\t};\n\n\tJSM.ThreeViewer.prototype.GetObjectsUnderTouch = function ()\n\t{\n\t\treturn this.GetObjectsUnderPosition (this.navigation.touch.curr.x, this.navigation.touch.curr.y);\n\t};\n\n\tJSM.ThreeViewer.prototype.ProjectVector = function (x, y, z)\n\t{\n\t\tvar width = this.canvas.width;\n\t\tvar height = this.canvas.height;\n\t\tvar halfWidth = width / 2;\n\t\tvar halfHeight = height / 2;\n\n\t\tvar vector = new THREE.Vector3 (x, y, z);\n\t\tvector.project (this.camera);\n\t\tvector.x = (vector.x * halfWidth) + halfWidth;\n\t\tvector.y = -(vector.y * halfHeight) + halfHeight;\n\t\treturn vector;\n\t};\n\n\tJSM.ThreeViewer.prototype.EnableDraw = function (enable)\n\t{\n\t\tthis.enableDraw = enable;\n\t};\n\n\tJSM.ThreeViewer.prototype.Draw = function ()\n\t{\n\t\tif (!this.enableDraw) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.runBeforeRender !== null) {\n\t\t\tthis.runBeforeRender ();\n\t\t}\n\n\t\tthis.camera.position.set (this.cameraMove.eye.x, this.cameraMove.eye.y, this.cameraMove.eye.z);\n\t\tthis.camera.up.set (this.cameraMove.up.x, this.cameraMove.up.y, this.cameraMove.up.z);\n\t\tthis.camera.lookAt (new THREE.Vector3 (this.cameraMove.center.x, this.cameraMove.center.y, this.cameraMove.center.z));\n\n\t\tvar lightPosition = new THREE.Vector3 ().subVectors (this.cameraMove.eye, this.cameraMove.center);\n\t\tthis.directionalLight.position.set (lightPosition.x, lightPosition.y, lightPosition.z);\n\n\t\tthis.renderer.render (this.scene, this.camera);\n\t\t\n\t\tif (this.runAfterRender !== null) {\n\t\t\tthis.runAfterRender ();\n\t\t}\n\t\t\n\t\tif (this.drawLoop) {\n\t\t\trequestAnimationFrame (this.Draw.bind (this));\n\t\t}\n\t};\n\n\tJSM.ThreeViewer.prototype.DrawIfNeeded = function ()\n\t{\n\t\tif (!this.drawLoop) {\n\t\t\tthis.Draw ();\n\t\t}\n\t};\n\n\tJSM.ThreeViewer.prototype.StartDrawLoop = function ()\n\t{\n\t\tthis.drawLoop = true;\n\t\tthis.Draw ();\n\t};\n\n\tJSM.ThreeViewer.prototype.IsRelevantObject = function (threeObj)\n\t{\n\t\treturn (threeObj instanceof THREE.Mesh || threeObj instanceof THREE.LineSegments || threeObj instanceof THREE.Points);\n\t};\n\n\tJSM.ThreeViewer.prototype.IsVisibleObject = function (threeObj)\n\t{\n\t\treturn this.IsRelevantObject (threeObj) && threeObj.visible;\n\t};\n\n\treturn JSM;\n});\n"]}