{"version":3,"sources":["renderer/pointcloudrenderer.js"],"names":["define","JSM","PointCloudRenderer","this","canvas","context","shader","camera","points","pointSize","prototype","Init","IsWebGLEnabled","InitContext","InitShaders","InitBuffers","InitView","undefined","getContext","clearColor","enable","DEPTH_TEST","CreateShaderFromScript","script","type","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","fragmentShaderScript","join","vertexShaderScript","fragmentShader","FRAGMENT_SHADER","vertexShader","VERTEX_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","vertexPositionAttribute","getAttribLocation","enableVertexAttribArray","vertexColorAttribute","pMatrixUniform","getUniformLocation","vMatrixUniform","pointSizeUniform","ValueOrDefault","Camera","SetClearColor","red","green","blue","SetPointSize","AddPoints","colors","pointBuffer","createBuffer","pointArray","Float32Array","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","itemSize","numItems","parseInt","length","colorBuffer","colorArray","push","RemovePoints","Resize","viewport","width","height","Render","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","projectionMatrix","MatrixPerspective","fieldOfView","DegRad","nearClippingPlane","farClippingPlane","uniformMatrix4fv","i","viewMatrix","MatrixView","eye","center","up","uniform1f","vertexAttribPointer","FLOAT","drawArrays","POINTS"],"mappings":"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","file":"../../renderer/pointcloudrenderer.js","sourcesContent":["define([\"../core/jsm\"],function(JSM){\n\tJSM.PointCloudRenderer = function ()\n\t{\n\t\tthis.canvas = null;\n\t\tthis.context = null;\n\t\tthis.shader = null;\n\t\t\n\t\tthis.camera = null;\n\t\tthis.points = null;\n\t\tthis.pointSize = null;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.Init = function (canvas, camera)\n\t{\n\t\tif (!JSM.IsWebGLEnabled ()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitContext (canvas)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitShaders ()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitBuffers ()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitView (camera)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.InitContext = function (canvas)\n\t{\n\t\tthis.canvas = canvas;\n\t\tif (this.canvas === null) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif (this.canvas.getContext === undefined) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.context = this.canvas.getContext ('experimental-webgl');\n\t\tif (this.context === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.context.clearColor (1.0, 1.0, 1.0, 1.0);\n\t\tthis.context.enable (this.context.DEPTH_TEST);\n\n\t\treturn true;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.InitShaders = function ()\n\t{\n\t\tfunction CreateShaderFromScript (context, script, type)\n\t\t{\n\t\t\tvar shader = context.createShader (type);\n\t\t\tcontext.shaderSource (shader, script);\n\t\t\tcontext.compileShader (shader);\n\t\t\tif (!context.getShaderParameter (shader, context.COMPILE_STATUS)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn shader;\n\t\t}\n\n\t\tvar fragmentShaderScript = [\n\t\t\t'varying highp vec3 vColor;',\n\t\t\t'void main (void) {',\n\t\t\t'\tgl_FragColor = vec4 (vColor, 1.0);',\n\t\t\t'}'\n\t\t\t].join('\\n');\n\t\t\n\t\tvar vertexShaderScript = [\n\t\t\t'attribute highp vec3 aVertexPosition;',\n\t\t\t'attribute highp vec3 aVertexColor;',\n\n\t\t\t'uniform highp mat4 uViewMatrix;',\n\t\t\t'uniform highp mat4 uProjectionMatrix;',\n\n\t\t\t'uniform highp float uPointSize;',\n\t\t\t\n\t\t\t'varying highp vec3 vColor;',\n\t\t\t\n\t\t\t'void main (void) {',\n\t\t\t'\tvColor = aVertexColor;',\n\t\t\t'\tgl_PointSize = uPointSize;',\n\t\t\t'\tgl_Position = uProjectionMatrix * uViewMatrix * vec4 (aVertexPosition, 1.0);',\n\t\t\t'}'\n\t\t\t].join('\\n');\n\t\t\n\t\tvar fragmentShader = CreateShaderFromScript (this.context, fragmentShaderScript, this.context.FRAGMENT_SHADER);\n\t\tvar vertexShader = CreateShaderFromScript (this.context, vertexShaderScript, this.context.VERTEX_SHADER);\n\t\tif (fragmentShader === null || vertexShader === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.shader = this.context.createProgram ();\n\t\tthis.context.attachShader (this.shader, vertexShader);\n\t\tthis.context.attachShader (this.shader, fragmentShader);\n\t\tthis.context.linkProgram (this.shader);\n\t\tif (!this.context.getProgramParameter (this.shader, this.context.LINK_STATUS)) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.context.useProgram (this.shader);\n\n\t\tthis.shader.vertexPositionAttribute = this.context.getAttribLocation (this.shader, 'aVertexPosition');\n\t\tthis.context.enableVertexAttribArray (this.shader.vertexPositionAttribute);\n\n\t\tthis.shader.vertexColorAttribute = this.context.getAttribLocation (this.shader, 'aVertexColor');\n\t\tthis.context.enableVertexAttribArray (this.shader.vertexColorAttribute);\n\n\t\tthis.shader.pMatrixUniform = this.context.getUniformLocation (this.shader, 'uProjectionMatrix');\n\t\tthis.shader.vMatrixUniform = this.context.getUniformLocation (this.shader, 'uViewMatrix');\n\t\t\n\t\tthis.shader.pointSizeUniform = this.context.getUniformLocation (this.shader, 'uPointSize');\n\n\t\treturn true;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.InitBuffers = function ()\n\t{\n\t\tthis.points = [];\n\t\tthis.pointSize = 1.0;\n\t\treturn true;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.InitView = function (camera)\n\t{\n\t\tthis.camera = JSM.ValueOrDefault (camera, new JSM.Camera ());\n\t\tif (!this.camera) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.SetClearColor = function (red, green, blue)\n\t{\n\t\tthis.context.clearColor (red, green, blue, 1.0);\n\t};\n\n\tJSM.PointCloudRenderer.prototype.SetPointSize = function (pointSize)\n\t{\n\t\tthis.pointSize = pointSize;\n\t};\n\n\tJSM.PointCloudRenderer.prototype.AddPoints = function (points, colors)\n\t{\n\t\tvar pointBuffer = this.context.createBuffer ();\n\t\tvar pointArray = new Float32Array (points);\n\n\t\tthis.context.bindBuffer (this.context.ARRAY_BUFFER, pointBuffer);\n\t\tthis.context.bufferData (this.context.ARRAY_BUFFER, pointArray, this.context.STATIC_DRAW);\n\t\tpointBuffer.itemSize = 3;\n\t\tpointBuffer.numItems = parseInt (pointArray.length / 3, 10);\n\t\t\n\t\tvar colorBuffer = this.context.createBuffer ();\n\t\tvar colorArray = new Float32Array (colors);\n\n\t\tthis.context.bindBuffer (this.context.ARRAY_BUFFER, colorBuffer);\n\t\tthis.context.bufferData (this.context.ARRAY_BUFFER, colorArray, this.context.STATIC_DRAW);\n\t\tcolorBuffer.itemSize = 3;\n\t\tcolorBuffer.numItems = parseInt (colorArray.length / 3, 10);\n\n\t\tthis.points.push ({pointArray : pointArray, pointBuffer : pointBuffer, colorBuffer : colorBuffer});\n\t};\n\n\tJSM.PointCloudRenderer.prototype.RemovePoints = function ()\n\t{\n\t\tthis.points = [];\n\t};\n\n\tJSM.PointCloudRenderer.prototype.Resize = function ()\n\t{\n\t\tthis.context.viewport (0, 0, this.canvas.width, this.canvas.height);\n\t};\n\n\tJSM.PointCloudRenderer.prototype.Render = function ()\n\t{\n\t\tthis.context.clear (this.context.COLOR_BUFFER_BIT | this.context.DEPTH_BUFFER_BIT);\n\t\t\n\t\tvar projectionMatrix = JSM.MatrixPerspective (this.camera.fieldOfView * JSM.DegRad, this.canvas.width / this.canvas.height, this.camera.nearClippingPlane, this.camera.farClippingPlane);\n\t\tthis.context.uniformMatrix4fv (this.shader.pMatrixUniform, false, projectionMatrix);\n\n\t\tvar viewMatrix = JSM.MatrixView (this.camera.eye, this.camera.center, this.camera.up);\n\t\tthis.context.uniformMatrix4fv (this.shader.vMatrixUniform, false, viewMatrix);\n\n\t\tthis.context.uniform1f (this.shader.pointSizeUniform, this.pointSize);\n\t\t\n\t\tvar i, pointBuffer, colorBuffer;\n\t\tfor (i = 0; i < this.points.length; i++) {\n\t\t\tpointBuffer = this.points[i].pointBuffer;\n\t\t\tcolorBuffer = this.points[i].colorBuffer;\n\t\t\tthis.context.bindBuffer (this.context.ARRAY_BUFFER, pointBuffer);\n\t\t\tthis.context.vertexAttribPointer (this.shader.vertexPositionAttribute, pointBuffer.itemSize, this.context.FLOAT, false, 0, 0);\n\t\t\tthis.context.bindBuffer (this.context.ARRAY_BUFFER, colorBuffer);\n\t\t\tthis.context.vertexAttribPointer (this.shader.vertexColorAttribute, colorBuffer.itemSize, this.context.FLOAT, false, 0, 0);\n\t\t\tthis.context.drawArrays (this.context.POINTS, 0, pointBuffer.numItems);\n\t\t}\n\t};\n\n\treturn JSM;\n});\n"]}