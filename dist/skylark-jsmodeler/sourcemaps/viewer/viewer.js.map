{"version":3,"sources":["viewer/viewer.js"],"names":["define","JSM","Viewer","this","camera","renderer","navigation","cameraLight","prototype","Init","canvas","InitRenderer","InitNavigation","InitLights","Reset","RemoveBodies","RemoveLights","SetAmbientLight","RenderAmbientLight","EnableCameraLight","Renderer","ValueOrDefault","Camera","Navigation","Draw","bind","Resize","SetClearColor","red","green","blue","RenderDirectionalLight","Vector","AddLight","DisableCameraLight","RemoveLight","GetCameraLight","light","AddBody","renderBody","AddBodies","renderBodies","RemoveBody","body","FitInWindow","sphere","GetBoundingSphere","GetCenter","GetRadius","SetFullscreen","fullscreen","GetBoundingBox","min","Coord","Inf","max","EnumerateBodies","transformation","GetTransformation","EnumerateMeshes","mesh","i","vertex","VertexCount","GetTransformedVertex","x","Minimum","y","z","Maximum","Box","center","radius","distance","DistanceTo","IsGreater","Sphere","FindObjects","screenX","screenY","direction","CoordSub","eye","Normalize","Render"],"mappings":"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","file":"../../viewer/viewer.js","sourcesContent":["define([\"../core/jsm\"],function(JSM){\n\tJSM.Viewer = function ()\n\t{\n\t\tthis.camera = null;\n\t\tthis.renderer = null;\n\t\tthis.navigation = null;\n\t\tthis.cameraLight = null;\n\t};\n\n\tJSM.Viewer.prototype.Init = function (canvas, camera)\n\t{\n\t\tif (!this.InitRenderer (canvas)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitNavigation (camera)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitLights ()) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.Viewer.prototype.Reset = function ()\n\t{\n\t\tthis.RemoveBodies ();\n\t\tthis.RemoveLights ();\n\t\tthis.SetAmbientLight (new JSM.RenderAmbientLight (0x7f7f7f));\n\t\tthis.EnableCameraLight ();\n\t};\n\n\tJSM.Viewer.prototype.InitRenderer = function (canvas)\n\t{\n\t\tthis.renderer = new JSM.Renderer ();\n\t\tif (!this.renderer.Init (canvas)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\n\tJSM.Viewer.prototype.InitNavigation = function (camera)\n\t{\n\t\tthis.camera = JSM.ValueOrDefault (camera, new JSM.Camera ());\n\t\tif (!this.camera) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.navigation = new JSM.Navigation ();\n\t\tif (!this.navigation.Init (this.renderer.canvas, this.camera, this.Draw.bind (this), this.Resize.bind (this))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.Viewer.prototype.InitLights = function ()\n\t{\n\t\tthis.SetAmbientLight (new JSM.RenderAmbientLight (0x7f7f7f));\n\t\tthis.EnableCameraLight ();\n\t\treturn true;\n\t};\n\n\tJSM.Viewer.prototype.SetClearColor = function (red, green, blue)\n\t{\n\t\tthis.renderer.SetClearColor (red, green, blue);\n\t};\n\n\tJSM.Viewer.prototype.EnableCameraLight = function ()\n\t{\n\t\tif (this.cameraLight !== null) {\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraLight = new JSM.RenderDirectionalLight (0x7f7f7f, 0xffffff, new JSM.Vector (1.0, 0.0, 0.0));\n\t\tthis.AddLight (this.cameraLight);\n\t};\n\n\tJSM.Viewer.prototype.DisableCameraLight = function ()\n\t{\n\t\tif (this.cameraLight === null) {\n\t\t\treturn;\n\t\t}\n\t\tthis.RemoveLight (this.cameraLight);\n\t\tthis.cameraLight = null;\n\t};\n\n\tJSM.Viewer.prototype.GetCameraLight = function ()\n\t{\n\t\treturn this.cameraLight;\n\t};\n\n\tJSM.Viewer.prototype.SetAmbientLight = function (light)\n\t{\n\t\tthis.renderer.SetAmbientLight (light);\n\t};\n\n\tJSM.Viewer.prototype.AddLight = function (light)\n\t{\n\t\tthis.renderer.AddLight (light);\n\t};\n\n\tJSM.Viewer.prototype.RemoveLight = function (light)\n\t{\n\t\tthis.renderer.RemoveLight (light);\n\t};\n\n\tJSM.Viewer.prototype.RemoveLights = function ()\n\t{\n\t\tthis.renderer.RemoveLights ();\n\t\tthis.cameraLight = null;\n\t};\n\n\tJSM.Viewer.prototype.AddBody = function (renderBody)\n\t{\n\t\tthis.renderer.AddBody (renderBody, this.Draw.bind (this));\n\t};\n\n\tJSM.Viewer.prototype.AddBodies = function (renderBodies)\n\t{\n\t\tthis.renderer.AddBodies (renderBodies, this.Draw.bind (this));\n\t};\n\n\tJSM.Viewer.prototype.RemoveBody = function (body)\n\t{\n\t\tthis.renderer.RemoveBody (body);\n\t};\n\n\tJSM.Viewer.prototype.RemoveBodies = function ()\n\t{\n\t\tthis.renderer.RemoveBodies ();\n\t};\n\n\tJSM.Viewer.prototype.FitInWindow = function ()\n\t{\n\t\tvar sphere = this.GetBoundingSphere ();\n\t\tthis.navigation.FitInWindow (sphere.GetCenter (), sphere.GetRadius ());\n\t};\n\n\tJSM.Viewer.prototype.SetFullscreen = function (fullscreen)\n\t{\n\t\tthis.navigation.SetFullscreen (fullscreen);\n\t};\n\n\tJSM.Viewer.prototype.GetCenter = function ()\n\t{\n\t\tvar boundingBox = this.GetBoundingBox ();\n\t\treturn boundingBox.GetCenter ();\n\t};\n\n\tJSM.Viewer.prototype.GetBoundingBox = function ()\n\t{\n\t\tvar min = new JSM.Coord (JSM.Inf, JSM.Inf, JSM.Inf);\n\t\tvar max = new JSM.Coord (-JSM.Inf, -JSM.Inf, -JSM.Inf);\n\t\t\n\t\tthis.renderer.EnumerateBodies (function (body) {\n\t\t\tvar transformation = body.GetTransformation ();\n\t\t\tbody.EnumerateMeshes (function (mesh) {\n\t\t\t\tvar i, vertex;\n\t\t\t\tfor (i = 0; i < mesh.VertexCount (); i++) {\n\t\t\t\t\tvertex = mesh.GetTransformedVertex (i, transformation);\n\t\t\t\t\tmin.x = JSM.Minimum (min.x, vertex.x);\n\t\t\t\t\tmin.y = JSM.Minimum (min.y, vertex.y);\n\t\t\t\t\tmin.z = JSM.Minimum (min.z, vertex.z);\n\t\t\t\t\tmax.x = JSM.Maximum (max.x, vertex.x);\n\t\t\t\t\tmax.y = JSM.Maximum (max.y, vertex.y);\n\t\t\t\t\tmax.z = JSM.Maximum (max.z, vertex.z);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn new JSM.Box (min, max);\n\t};\n\n\tJSM.Viewer.prototype.GetBoundingSphere = function ()\n\t{\n\t\tvar center = this.GetCenter ();\n\t\tvar radius = 0.0;\n\n\t\tthis.renderer.EnumerateBodies (function (body) {\n\t\t\tvar transformation = body.GetTransformation ();\n\t\t\tbody.EnumerateMeshes (function (mesh) {\n\t\t\t\tvar i, vertex, distance;\n\t\t\t\tfor (i = 0; i < mesh.VertexCount (); i++) {\n\t\t\t\t\tvertex = mesh.GetTransformedVertex (i, transformation);\n\t\t\t\t\tdistance = center.DistanceTo (vertex);\n\t\t\t\t\tif (JSM.IsGreater (distance, radius)) {\n\t\t\t\t\t\tradius = distance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t\n\t\tvar sphere = new JSM.Sphere (center, radius);\n\t\treturn sphere;\n\t};\n\n\tJSM.Viewer.prototype.FindObjects = function (screenX, screenY)\n\t{\n\t\treturn this.renderer.FindObjects (this.camera, screenX, screenY);\n\t};\n\n\tJSM.Viewer.prototype.Resize = function ()\n\t{\n\t\tthis.renderer.Resize ();\n\t\tthis.Draw ();\n\t};\n\n\tJSM.Viewer.prototype.Draw = function ()\n\t{\n\t\tvar camera = this.camera;\n\t\tvar cameraLight = this.GetCameraLight ();\n\t\tif (cameraLight !== null) {\n\t\t\tcameraLight.direction = JSM.CoordSub (camera.center, camera.eye).Normalize ();\n\t\t}\n\t\tthis.renderer.Render (camera);\n\t};\n\n\treturn JSM;\n});\n"]}