{"version":3,"sources":["viewer/navigation.js"],"names":["define","JSM","Navigation","this","canvas","camera","drawCallback","resizeCallback","mouse","touch","cameraFixUp","cameraEnableOrbit","cameraEnablePan","cameraEnableZoom","cameraNearDistanceLimit","cameraFarDistanceLimit","orbitCenter","fullscreen","prototype","Init","Mouse","Touch","center","Clone","myThis","document","addEventListener","event","OnMouseMove","OnMouseUp","OnMouseDown","OnMouseWheel","OnTouchStart","OnTouchMove","OnTouchEnd","OnContextMenu","window","OnResize","SetCamera","eye","up","Set","EnableFixUp","enable","EnableOrbit","EnablePan","EnableZoom","SetNearDistanceLimit","limit","SetFarDistanceLimit","SetOrbitCenter","FitInWindow","radius","IsZero","offsetToOrigo","CoordSub","centerEyeDirection","Normalize","fieldOfView","width","height","distance","Math","sin","DegRad","Offset","SetFullscreen","ResizeCallback","Orbit","angleX","angleY","radAngleX","radAngleY","viewDirection","horizontalDirection","VectorCross","differentCenter","IsEqual","newAngle","AngleTo","IsGreater","IsLower","PI","Rotate","verticalDirection","Pan","moveX","moveY","Zoom","ratio","direction","Length","zoomIn","move","DrawCallback","undefined","innerWidth","innerHeight","preventDefault","Down","Move","down","button","diff","x","y","DistanceTo","Up","OnMouseOut","Out","eventParameters","delta","detail","wheelDelta","Start","fingers","End"],"mappings":";;;;;;;AAAAA,QAAQ,eAAe,SAASC,GAgV/B,OA/UAA,EAAIC,WAAa,WAEhBC,KAAKC,OAAS,KACdD,KAAKE,OAAS,KACdF,KAAKG,aAAe,KACpBH,KAAKI,eAAiB,KAEtBJ,KAAKK,MAAQ,KACbL,KAAKM,MAAQ,KAEbN,KAAKO,YAAc,KACnBP,KAAKQ,kBAAoB,KACzBR,KAAKS,gBAAkB,KACvBT,KAAKU,iBAAmB,KACxBV,KAAKW,wBAA0B,KAC/BX,KAAKY,uBAAyB,KAE9BZ,KAAKa,YAAc,KACnBb,KAAKc,WAAa,MAGnBhB,EAAIC,WAAWgB,UAAUC,KAAO,SAAUf,EAAQC,EAAQC,EAAcC,GAEvEJ,KAAKC,OAASA,EACdD,KAAKE,OAASA,EACdF,KAAKG,aAAeA,EACpBH,KAAKI,eAAiBA,EAEtBJ,KAAKK,MAAQ,IAAIP,EAAImB,MACrBjB,KAAKM,MAAQ,IAAIR,EAAIoB,MAErBlB,KAAKO,aAAc,EACnBP,KAAKQ,mBAAoB,EACzBR,KAAKS,iBAAkB,EACvBT,KAAKU,kBAAmB,EAExBV,KAAKa,YAAcb,KAAKE,OAAOiB,OAAOC,QACtCpB,KAAKc,YAAa,EAElB,IAAIO,EAASrB,KAkBb,OAjBIsB,SAASC,mBACZD,SAASC,iBAAkB,YAAa,SAAUC,GAAQH,EAAOI,YAAaD,KAC9EF,SAASC,iBAAkB,UAAW,SAAUC,GAAQH,EAAOK,UAAWF,MAEvExB,KAAKC,OAAOsB,mBACfvB,KAAKC,OAAOsB,iBAAkB,YAAa,SAAUC,GAAQH,EAAOM,YAAaH,KAAU,GAC3FxB,KAAKC,OAAOsB,iBAAkB,iBAAkB,SAAUC,GAAQH,EAAOO,aAAcJ,KAAU,GACjGxB,KAAKC,OAAOsB,iBAAkB,aAAc,SAAUC,GAAQH,EAAOO,aAAcJ,KAAU,GAC7FxB,KAAKC,OAAOsB,iBAAkB,aAAc,SAAUC,GAAQH,EAAOQ,aAAcL,KAAU,GAC7FxB,KAAKC,OAAOsB,iBAAkB,YAAa,SAAUC,GAAQH,EAAOS,YAAaN,KAAU,GAC3FxB,KAAKC,OAAOsB,iBAAkB,WAAY,SAAUC,GAAQH,EAAOU,WAAYP,KAAU,GACzFxB,KAAKC,OAAOsB,iBAAkB,cAAe,SAAUC,GAAQH,EAAOW,cAAeR,KAAU,IAE5FS,OAAOV,kBACVU,OAAOV,iBAAkB,SAAU,SAAUC,GAAQH,EAAOa,SAAUV,KAAU,IAG1E,GAGR1B,EAAIC,WAAWgB,UAAUoB,UAAY,SAAUC,EAAKjB,EAAQkB,GAE3DrC,KAAKE,OAAOoC,IAAKF,EAAKjB,EAAQkB,GAC9BrC,KAAKa,YAAcb,KAAKE,OAAOiB,OAAOC,SAGvCtB,EAAIC,WAAWgB,UAAUwB,YAAc,SAAUC,GAEhDxC,KAAKO,YAAciC,GAGpB1C,EAAIC,WAAWgB,UAAU0B,YAAc,SAAUD,GAEhDxC,KAAKQ,kBAAoBgC,GAG1B1C,EAAIC,WAAWgB,UAAU2B,UAAY,SAAUF,GAE9CxC,KAAKS,gBAAkB+B,GAGxB1C,EAAIC,WAAWgB,UAAU4B,WAAa,SAAUH,GAE/CxC,KAAKU,iBAAmB8B,GAGzB1C,EAAIC,WAAWgB,UAAU6B,qBAAuB,SAAUC,GAEzD7C,KAAKW,wBAA0BkC,GAGhC/C,EAAIC,WAAWgB,UAAU+B,oBAAsB,SAAUD,GAExD7C,KAAKY,uBAAyBiC,GAG/B/C,EAAIC,WAAWgB,UAAUgC,eAAiB,SAAUlC,GAEnDb,KAAKa,YAAcA,GAGpBf,EAAIC,WAAWgB,UAAUiC,YAAc,SAAU7B,EAAQ8B,GAExD,IAAInD,EAAIoD,OAAQD,GAAhB,CAIA,IAAIE,EAAgBrD,EAAIsD,SAAUpD,KAAKE,OAAOiB,OAAQA,GACtDnB,KAAKE,OAAOiB,OAASA,EACrBnB,KAAKE,OAAOkC,IAAMtC,EAAIsD,SAAUpD,KAAKE,OAAOkC,IAAKe,GAEjD,IAAIE,EAAqBvD,EAAIsD,SAAUpD,KAAKE,OAAOkC,IAAKpC,KAAKE,OAAOiB,QAAQmC,YACxEC,EAAcvD,KAAKE,OAAOqD,YAAc,EACxCvD,KAAKC,OAAOuD,MAAQxD,KAAKC,OAAOwD,SACnCF,EAAcA,EAAcvD,KAAKC,OAAOuD,MAAQxD,KAAKC,OAAOwD,QAE7D,IAAIC,EAAWT,EAASU,KAAKC,IAAKL,EAAczD,EAAI+D,QAEpD7D,KAAKE,OAAOkC,IAAMpC,KAAKE,OAAOiB,OAAOC,QAAS0C,OAAQT,EAAoBK,GAC1E1D,KAAKa,YAAcb,KAAKE,OAAOiB,OAAOC,UAGvCtB,EAAIC,WAAWgB,UAAUgD,cAAgB,SAAUjD,GAElDd,KAAKc,WAAaA,EAClBd,KAAKgE,kBAGNlE,EAAIC,WAAWgB,UAAUkD,MAAQ,SAAUC,EAAQC,GAElD,IAAIC,EAAYF,EAASpE,EAAI+D,OACzBQ,EAAYF,EAASrE,EAAI+D,OAEzBS,EAAgBxE,EAAIsD,SAAUpD,KAAKE,OAAOiB,OAAQnB,KAAKE,OAAOkC,KAAKkB,YACnEiB,EAAsBzE,EAAI0E,YAAaF,EAAetE,KAAKE,OAAOmC,IAAIiB,YACtEmB,GAAmBzE,KAAKa,YAAY6D,QAAS1E,KAAKE,OAAOiB,QAE7D,GAAInB,KAAKO,YAAa,CACrB,IACIoE,EADgBL,EAAcM,QAAS5E,KAAKE,OAAOmC,IACxBgC,EAC3BvE,EAAI+E,UAAWF,EAAU,IAAQ7E,EAAIgF,QAASH,EAAUhB,KAAKoB,MAChE/E,KAAKE,OAAOkC,IAAI4C,OAAQT,GAAsBF,EAAWrE,KAAKa,aAC1D4D,GACHzE,KAAKE,OAAOiB,OAAO6D,OAAQT,GAAsBF,EAAWrE,KAAKa,cAGnEb,KAAKE,OAAOkC,IAAI4C,OAAQhF,KAAKE,OAAOmC,IAAK+B,EAAWpE,KAAKa,aACrD4D,GACHzE,KAAKE,OAAOiB,OAAO6D,OAAQhF,KAAKE,OAAOmC,IAAK+B,EAAWpE,KAAKa,iBAEvD,CACN,IAAIoE,EAAoBnF,EAAI0E,YAAaD,EAAqBD,GAAehB,YAC7EtD,KAAKE,OAAOkC,IAAI4C,OAAQT,GAAsBF,EAAWrE,KAAKa,aAC9Db,KAAKE,OAAOkC,IAAI4C,OAAQC,GAAoBb,EAAWpE,KAAKa,aACxD4D,IACHzE,KAAKE,OAAOiB,OAAO6D,OAAQT,GAAsBF,EAAWrE,KAAKa,aACjEb,KAAKE,OAAOiB,OAAO6D,OAAQC,GAAoBb,EAAWpE,KAAKa,cAEhEb,KAAKE,OAAOmC,GAAK4C,IAInBnF,EAAIC,WAAWgB,UAAUmE,IAAM,SAAUC,EAAOC,GAE/C,IAAId,EAAgBxE,EAAIsD,SAAUpD,KAAKE,OAAOiB,OAAQnB,KAAKE,OAAOkC,KAAKkB,YACnEiB,EAAsBzE,EAAI0E,YAAaF,EAAetE,KAAKE,OAAOmC,IAAIiB,YACtE2B,EAAoBnF,EAAI0E,YAAaD,EAAqBD,GAAehB,YAE7EtD,KAAKE,OAAOkC,IAAI0B,OAAQS,GAAsBY,GAC9CnF,KAAKE,OAAOiB,OAAO2C,OAAQS,GAAsBY,GAEjDnF,KAAKE,OAAOkC,IAAI0B,OAAQmB,EAAmBG,GAC3CpF,KAAKE,OAAOiB,OAAO2C,OAAQmB,EAAmBG,IAG/CtF,EAAIC,WAAWgB,UAAUsE,KAAO,SAAUC,GAEzC,IAAIC,EAAYzF,EAAIsD,SAAUpD,KAAKE,OAAOiB,OAAQnB,KAAKE,OAAOkC,KAC1DsB,EAAW6B,EAAUC,SACrBC,EAASH,EAAQ,EACrB,GAAIG,GAA2C,OAAjCzF,KAAKW,yBAAoC+C,EAAW1D,KAAKW,wBACtE,OAAO,EACD,IAAK8E,GAA0C,OAAhCzF,KAAKY,wBAAmC8C,EAAW1D,KAAKY,uBAC7E,OAAO,EAGR,IAAI8E,EAAOhC,EAAW4B,EACtBtF,KAAKE,OAAOkC,IAAI0B,OAAQyB,EAAWG,IAGpC5F,EAAIC,WAAWgB,UAAU4E,aAAe,gBAEbC,IAAtB5F,KAAKG,cAAoD,OAAtBH,KAAKG,cAC3CH,KAAKG,gBAIPL,EAAIC,WAAWgB,UAAUiD,eAAiB,gBAEb4B,IAAxB5F,KAAKI,gBAAwD,OAAxBJ,KAAKI,iBACzCJ,KAAKc,aACRd,KAAKC,OAAOuD,MAAQvB,OAAO4D,WAC3B7F,KAAKC,OAAOwD,OAASxB,OAAO6D,aAE7B9F,KAAKI,mBAIPN,EAAIC,WAAWgB,UAAUY,YAAc,SAAUH,GAEhDA,EAAMuE,iBACN/F,KAAKK,MAAM2F,KAAMxE,EAAOxB,KAAKC,SAG9BH,EAAIC,WAAWgB,UAAUU,YAAc,SAAUD,GAIhD,GAFAA,EAAMuE,iBACN/F,KAAKK,MAAM4F,KAAMzE,EAAOxB,KAAKC,QACxBD,KAAKK,MAAM6F,KAAhB,CAIA,IAAIZ,EAAQ,EACZ,GAAyB,GAArBtF,KAAKK,MAAM8F,OAAa,CAC3B,IAAKnG,KAAKQ,kBACT,OAED8E,EAAQ,GACRtF,KAAKiE,MAAOjE,KAAKK,MAAM+F,KAAKC,EAAIf,EAAOtF,KAAKK,MAAM+F,KAAKE,EAAIhB,QACrD,GAAyB,GAArBtF,KAAKK,MAAM8F,OAAa,CAClC,IAAKnG,KAAKS,gBACT,OAGD6E,EAAQ,KADgBtF,KAAKE,OAAOkC,IAAImE,WAAYvG,KAAKE,OAAOiB,QAEhEnB,KAAKkF,IAAKlF,KAAKK,MAAM+F,KAAKC,EAAIf,EAAOtF,KAAKK,MAAM+F,KAAKE,EAAIhB,GAE1DtF,KAAK2F,iBAGN7F,EAAIC,WAAWgB,UAAUW,UAAY,SAAUF,GAE9CA,EAAMuE,iBACN/F,KAAKK,MAAMmG,GAAIhF,EAAOxB,KAAKC,SAG5BH,EAAIC,WAAWgB,UAAU0F,WAAa,SAAUjF,GAE/CA,EAAMuE,iBACN/F,KAAKK,MAAMqG,IAAKlF,EAAOxB,KAAKC,SAG7BH,EAAIC,WAAWgB,UAAUa,aAAe,SAAUJ,GAGjD,GADAA,EAAMuE,iBACD/F,KAAKU,iBAAV,CAIA,IAAIiG,EAAkBnF,EACE,OAApBmF,IACHA,EAAkB1E,OAAOT,OAG1B,IAAIoF,EAAQ,EACRD,EAAgBE,OACnBD,GAASD,EAAgBE,OACfF,EAAgBG,aAC1BF,EAAQD,EAAgBG,WAAa,IAGtC,IAAIxB,EAAQ,GACRsB,EAAQ,IACXtB,IAAiB,GAGlBtF,KAAKqF,KAAMC,GACXtF,KAAK2F,iBAGN7F,EAAIC,WAAWgB,UAAUc,aAAe,SAAUL,GAEjDA,EAAMuE,iBACN/F,KAAKM,MAAMyG,MAAOvF,EAAOxB,KAAKC,SAG/BH,EAAIC,WAAWgB,UAAUe,YAAc,SAAUN,GAIhD,GAFAA,EAAMuE,iBACN/F,KAAKM,MAAM2F,KAAMzE,EAAOxB,KAAKC,QACxBD,KAAKM,MAAM4F,KAAhB,CAIA,IAAIZ,EAAQ,EACZ,GAA0B,GAAtBtF,KAAKM,MAAM0G,QAAc,CAC5B,IAAKhH,KAAKQ,kBACT,OAED8E,EAAQ,GACRtF,KAAKiE,MAAOjE,KAAKM,MAAM8F,KAAKC,EAAIf,EAAOtF,KAAKM,MAAM8F,KAAKE,EAAIhB,QACrD,GAA0B,GAAtBtF,KAAKM,MAAM0G,QAAc,CACnC,IAAKhH,KAAKU,iBACT,OAED4E,EAAQ,KACRtF,KAAKqF,KAAMrF,KAAKM,MAAM8F,KAAKC,EAAIf,QACzB,GAA0B,GAAtBtF,KAAKM,MAAM0G,QAAc,CACnC,IAAKhH,KAAKS,gBACT,OAGD6E,EAAQ,KADgBtF,KAAKE,OAAOkC,IAAImE,WAAYvG,KAAKE,OAAOiB,QAEhEnB,KAAKkF,IAAKlF,KAAKM,MAAM8F,KAAKC,EAAIf,EAAOtF,KAAKM,MAAM8F,KAAKE,EAAIhB,GAE1DtF,KAAK2F,iBAGN7F,EAAIC,WAAWgB,UAAUgB,WAAa,SAAUP,GAE/CA,EAAMuE,iBACN/F,KAAKM,MAAM2G,IAAKzF,EAAOxB,KAAKC,SAG7BH,EAAIC,WAAWgB,UAAUiB,cAAgB,SAAUR,GAElDA,EAAMuE,kBAGPjG,EAAIC,WAAWgB,UAAUmB,SAAW,SAAUV,GAE7CA,EAAMuE,iBACN/F,KAAKgE,kBAGClE","file":"../../viewer/navigation.js","sourcesContent":["define([\"../core/jsm\"],function(JSM){\n\tJSM.Navigation = function ()\n\t{\n\t\tthis.canvas = null;\n\t\tthis.camera = null;\n\t\tthis.drawCallback = null;\n\t\tthis.resizeCallback = null;\n\t\t\n\t\tthis.mouse = null;\n\t\tthis.touch = null;\n\t\t\n\t\tthis.cameraFixUp = null;\n\t\tthis.cameraEnableOrbit = null;\n\t\tthis.cameraEnablePan = null;\n\t\tthis.cameraEnableZoom = null;\n\t\tthis.cameraNearDistanceLimit = null;\n\t\tthis.cameraFarDistanceLimit = null;\n\t\t\n\t\tthis.orbitCenter = null;\n\t\tthis.fullscreen = null;\n\t};\n\n\tJSM.Navigation.prototype.Init = function (canvas, camera, drawCallback, resizeCallback)\n\t{\n\t\tthis.canvas = canvas;\n\t\tthis.camera = camera;\n\t\tthis.drawCallback = drawCallback;\n\t\tthis.resizeCallback = resizeCallback;\n\n\t\tthis.mouse = new JSM.Mouse ();\n\t\tthis.touch = new JSM.Touch ();\n\t\t\n\t\tthis.cameraFixUp = true;\n\t\tthis.cameraEnableOrbit = true;\n\t\tthis.cameraEnablePan = true;\n\t\tthis.cameraEnableZoom = true;\n\t\t\n\t\tthis.orbitCenter = this.camera.center.Clone ();\n\t\tthis.fullscreen = false;\n\n\t\tvar myThis = this;\n\t\tif (document.addEventListener) {\n\t\t\tdocument.addEventListener ('mousemove', function (event) {myThis.OnMouseMove (event);});\n\t\t\tdocument.addEventListener ('mouseup', function (event) {myThis.OnMouseUp (event);});\n\t\t}\n\t\tif (this.canvas.addEventListener) {\n\t\t\tthis.canvas.addEventListener ('mousedown', function (event) {myThis.OnMouseDown (event);}, false);\n\t\t\tthis.canvas.addEventListener ('DOMMouseScroll', function (event) {myThis.OnMouseWheel (event);}, false);\n\t\t\tthis.canvas.addEventListener ('mousewheel', function (event) {myThis.OnMouseWheel (event);}, false);\n\t\t\tthis.canvas.addEventListener ('touchstart', function (event) {myThis.OnTouchStart (event);}, false);\n\t\t\tthis.canvas.addEventListener ('touchmove', function (event) {myThis.OnTouchMove (event);}, false);\n\t\t\tthis.canvas.addEventListener ('touchend', function (event) {myThis.OnTouchEnd (event);}, false);\n\t\t\tthis.canvas.addEventListener ('contextmenu', function (event) {myThis.OnContextMenu (event);}, false);\n\t\t}\n\t\tif (window.addEventListener) {\n\t\t\twindow.addEventListener ('resize', function (event) {myThis.OnResize (event);}, false);\n\t\t}\n\t\t\n\t\treturn true;\n\t};\n\n\tJSM.Navigation.prototype.SetCamera = function (eye, center, up)\n\t{\n\t\tthis.camera.Set (eye, center, up);\n\t\tthis.orbitCenter = this.camera.center.Clone ();\n\t};\n\n\tJSM.Navigation.prototype.EnableFixUp = function (enable)\n\t{\n\t\tthis.cameraFixUp = enable;\n\t};\n\n\tJSM.Navigation.prototype.EnableOrbit = function (enable)\n\t{\n\t\tthis.cameraEnableOrbit = enable;\n\t};\n\n\tJSM.Navigation.prototype.EnablePan = function (enable)\n\t{\n\t\tthis.cameraEnablePan = enable;\n\t};\n\n\tJSM.Navigation.prototype.EnableZoom = function (enable)\n\t{\n\t\tthis.cameraEnableZoom = enable;\n\t};\n\n\tJSM.Navigation.prototype.SetNearDistanceLimit = function (limit)\n\t{\n\t\tthis.cameraNearDistanceLimit = limit;\n\t};\n\n\tJSM.Navigation.prototype.SetFarDistanceLimit = function (limit)\n\t{\n\t\tthis.cameraFarDistanceLimit = limit;\n\t};\n\n\tJSM.Navigation.prototype.SetOrbitCenter = function (orbitCenter)\n\t{\n\t\tthis.orbitCenter = orbitCenter;\n\t};\n\n\tJSM.Navigation.prototype.FitInWindow = function (center, radius)\n\t{\n\t\tif (JSM.IsZero (radius)) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar offsetToOrigo = JSM.CoordSub (this.camera.center, center);\n\t\tthis.camera.center = center;\n\t\tthis.camera.eye = JSM.CoordSub (this.camera.eye, offsetToOrigo);\n\t\t\n\t\tvar centerEyeDirection = JSM.CoordSub (this.camera.eye, this.camera.center).Normalize ();\n\t\tvar fieldOfView = this.camera.fieldOfView / 2.0;\n\t\tif (this.canvas.width < this.canvas.height) {\n\t\t\tfieldOfView = fieldOfView * this.canvas.width / this.canvas.height;\n\t\t}\n\t\tvar distance = radius / Math.sin (fieldOfView * JSM.DegRad);\n\t\t\n\t\tthis.camera.eye = this.camera.center.Clone ().Offset (centerEyeDirection, distance);\n\t\tthis.orbitCenter = this.camera.center.Clone ();\n\t};\n\n\tJSM.Navigation.prototype.SetFullscreen = function (fullscreen)\n\t{\n\t\tthis.fullscreen = fullscreen;\n\t\tthis.ResizeCallback ();\n\t};\n\n\tJSM.Navigation.prototype.Orbit = function (angleX, angleY)\n\t{\n\t\tvar radAngleX = angleX * JSM.DegRad;\n\t\tvar radAngleY = angleY * JSM.DegRad;\n\t\t\n\t\tvar viewDirection = JSM.CoordSub (this.camera.center, this.camera.eye).Normalize ();\n\t\tvar horizontalDirection = JSM.VectorCross (viewDirection, this.camera.up).Normalize ();\n\t\tvar differentCenter = !this.orbitCenter.IsEqual (this.camera.center);\n\t\t\n\t\tif (this.cameraFixUp) {\n\t\t\tvar originalAngle = viewDirection.AngleTo (this.camera.up);\n\t\t\tvar newAngle = originalAngle + radAngleY;\n\t\t\tif (JSM.IsGreater (newAngle, 0.0) && JSM.IsLower (newAngle, Math.PI)) {\n\t\t\t\tthis.camera.eye.Rotate (horizontalDirection, -radAngleY, this.orbitCenter);\n\t\t\t\tif (differentCenter) {\n\t\t\t\t\tthis.camera.center.Rotate (horizontalDirection, -radAngleY, this.orbitCenter);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.camera.eye.Rotate (this.camera.up, -radAngleX, this.orbitCenter);\n\t\t\tif (differentCenter) {\n\t\t\t\tthis.camera.center.Rotate (this.camera.up, -radAngleX, this.orbitCenter);\n\t\t\t}\n\t\t} else {\n\t\t\tvar verticalDirection = JSM.VectorCross (horizontalDirection, viewDirection).Normalize ();\n\t\t\tthis.camera.eye.Rotate (horizontalDirection, -radAngleY, this.orbitCenter);\n\t\t\tthis.camera.eye.Rotate (verticalDirection, -radAngleX, this.orbitCenter);\n\t\t\tif (differentCenter) {\n\t\t\t\tthis.camera.center.Rotate (horizontalDirection, -radAngleY, this.orbitCenter);\n\t\t\t\tthis.camera.center.Rotate (verticalDirection, -radAngleX, this.orbitCenter);\n\t\t\t}\n\t\t\tthis.camera.up = verticalDirection;\n\t\t}\n\t};\n\n\tJSM.Navigation.prototype.Pan = function (moveX, moveY)\n\t{\n\t\tvar viewDirection = JSM.CoordSub (this.camera.center, this.camera.eye).Normalize ();\n\t\tvar horizontalDirection = JSM.VectorCross (viewDirection, this.camera.up).Normalize ();\n\t\tvar verticalDirection = JSM.VectorCross (horizontalDirection, viewDirection).Normalize ();\n\t\t\n\t\tthis.camera.eye.Offset (horizontalDirection, -moveX);\n\t\tthis.camera.center.Offset (horizontalDirection, -moveX);\n\n\t\tthis.camera.eye.Offset (verticalDirection, moveY);\n\t\tthis.camera.center.Offset (verticalDirection, moveY);\n\t};\n\n\tJSM.Navigation.prototype.Zoom = function (ratio)\n\t{\n\t\tvar direction = JSM.CoordSub (this.camera.center, this.camera.eye);\n\t\tvar distance = direction.Length ();\n\t\tvar zoomIn = ratio > 0;\n\t\tif (zoomIn && this.cameraNearDistanceLimit !== null && distance < this.cameraNearDistanceLimit) {\n\t\t\treturn 0;\n\t\t} else if (!zoomIn && this.cameraFarDistanceLimit !== null && distance > this.cameraFarDistanceLimit) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar move = distance * ratio;\n\t\tthis.camera.eye.Offset (direction, move);\n\t};\n\n\tJSM.Navigation.prototype.DrawCallback = function ()\n\t{\n\t\tif (this.drawCallback !== undefined && this.drawCallback !== null) {\n\t\t\tthis.drawCallback ();\n\t\t}\n\t};\n\n\tJSM.Navigation.prototype.ResizeCallback = function ()\n\t{\n\t\tif (this.resizeCallback !== undefined && this.resizeCallback !== null) {\n\t\t\tif (this.fullscreen) {\n\t\t\t\tthis.canvas.width = window.innerWidth;\n\t\t\t\tthis.canvas.height = window.innerHeight;\n\t\t\t}\n\t\t\tthis.resizeCallback ();\n\t\t}\n\t};\n\n\tJSM.Navigation.prototype.OnMouseDown = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.mouse.Down (event, this.canvas);\n\t};\n\n\tJSM.Navigation.prototype.OnMouseMove = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.mouse.Move (event, this.canvas);\n\t\tif (!this.mouse.down) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar ratio = 0.0;\n\t\tif (this.mouse.button == 1) {\n\t\t\tif (!this.cameraEnableOrbit) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\tratio = 0.5;\n\t\t\tthis.Orbit (this.mouse.diff.x * ratio, this.mouse.diff.y * ratio);\n\t\t} else if (this.mouse.button == 3) {\n\t\t\tif (!this.cameraEnablePan) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar eyeCenterDistance = this.camera.eye.DistanceTo (this.camera.center);\n\t\t\tratio = 0.001 * eyeCenterDistance;\n\t\t\tthis.Pan (this.mouse.diff.x * ratio, this.mouse.diff.y * ratio);\n\t\t}\n\t\tthis.DrawCallback ();\n\t};\n\n\tJSM.Navigation.prototype.OnMouseUp = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.mouse.Up (event, this.canvas);\n\t};\n\n\tJSM.Navigation.prototype.OnMouseOut = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.mouse.Out (event, this.canvas);\n\t};\n\n\tJSM.Navigation.prototype.OnMouseWheel = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tif (!this.cameraEnableZoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar eventParameters = event;\n\t\tif (eventParameters === null) {\n\t\t\teventParameters = window.event;\n\t\t}\n\t\t\n\t\tvar delta = 0;\n\t\tif (eventParameters.detail) {\n\t\t\tdelta = -eventParameters.detail;\n\t\t} else if (eventParameters.wheelDelta) {\n\t\t\tdelta = eventParameters.wheelDelta / 40;\n\t\t}\n\n\t\tvar ratio = 0.1;\n\t\tif (delta < 0) {\n\t\t\tratio = ratio * -1.0;\n\t\t}\n\n\t\tthis.Zoom (ratio);\n\t\tthis.DrawCallback ();\n\t};\n\n\tJSM.Navigation.prototype.OnTouchStart = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.touch.Start (event, this.canvas);\n\t};\n\n\tJSM.Navigation.prototype.OnTouchMove = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.touch.Move (event, this.canvas);\n\t\tif (!this.touch.down) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar ratio = 0.0;\n\t\tif (this.touch.fingers == 1) {\n\t\t\tif (!this.cameraEnableOrbit) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tratio = 0.5;\n\t\t\tthis.Orbit (this.touch.diff.x * ratio, this.touch.diff.y * ratio);\n\t\t} else if (this.touch.fingers == 2) {\n\t\t\tif (!this.cameraEnableZoom) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tratio = 0.005;\n\t\t\tthis.Zoom (this.touch.diff.x * ratio);\n\t\t} else if (this.touch.fingers == 3) {\n\t\t\tif (!this.cameraEnablePan) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar eyeCenterDistance = this.camera.eye.DistanceTo (this.camera.center);\n\t\t\tratio = 0.001 * eyeCenterDistance;\n\t\t\tthis.Pan (this.touch.diff.x * ratio, this.touch.diff.y * ratio);\n\t\t}\n\t\tthis.DrawCallback ();\n\t};\n\n\tJSM.Navigation.prototype.OnTouchEnd = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.touch.End (event, this.canvas);\n\t};\n\n\tJSM.Navigation.prototype.OnContextMenu = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t};\n\n\tJSM.Navigation.prototype.OnResize = function (event)\n\t{\n\t\tevent.preventDefault ();\n\t\tthis.ResizeCallback ();\n\t};\n\n\treturn JSM;\n});\n"]}