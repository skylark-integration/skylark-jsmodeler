{"version":3,"sources":["viewer/spriteviewer.js"],"names":["define","JSM","SpriteViewer","this","canvas","camera","callbacks","points","projected","navigation","prototype","Start","InitCanvas","InitCamera","InitCallbacks","ValueOrDefault","Camera","Navigation","Init","Draw","bind","onPointDraw","undefined","onDrawStart","onDrawEnd","AddPoint","point","push","RemovePoints","Resize","NearestPointUnderPosition","maxDistance","x","y","i","distance","position","Coord2D","minIndex","minDistance","Inf","length","DistanceTo","IsLower","originalIndex","NearestPointUnderMouse","mouse","curr","NearestPointUnderTouch","touch","FitInWindow","sphere","GetBoundingSphere","GetCenter","GetRadius","GetBoundingBox","coord","min","Coord","max","Minimum","z","Maximum","Box","center","radius","IsGreater","Sphere","aspectRatio","width","height","viewPort","Project","eye","up","fieldOfView","DegRad","nearClippingPlane","farClippingPlane","sort","a","b"],"mappings":"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","file":"../../viewer/spriteviewer.js","sourcesContent":["define([\"../core/jsm\"],function(JSM){\n\tJSM.SpriteViewer = function ()\n\t{\n\t\tthis.canvas = null;\n\t\tthis.camera = null;\n\t\tthis.callbacks = null;\n\t\tthis.points = null;\n\t\tthis.projected = null;\n\t\tthis.navigation = null;\n\t};\n\n\tJSM.SpriteViewer.prototype.Start = function (canvas, camera, callbacks)\n\t{\n\t\tif (!this.InitCanvas (canvas)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitCamera (camera)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.InitCallbacks (callbacks)) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\treturn true;\n\t};\n\n\tJSM.SpriteViewer.prototype.InitCanvas = function (canvas)\n\t{\n\t\tthis.points = [];\n\t\tthis.canvas = canvas;\n\t\tif (!this.canvas) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\treturn true;\n\t};\n\n\tJSM.SpriteViewer.prototype.InitCamera = function (camera)\n\t{\n\t\tthis.camera = JSM.ValueOrDefault (camera, new JSM.Camera ());\n\t\tif (!this.camera) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.navigation = new JSM.Navigation ();\n\t\tif (!this.navigation.Init (this.canvas, this.camera, this.Draw.bind (this))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.SpriteViewer.prototype.InitCallbacks = function (callbacks)\n\t{\n\t\tthis.callbacks = {\n\t\t\tonPointDraw : null\n\t\t};\n\n\t\tif (callbacks !== undefined) {\n\t\t\tif (callbacks.onDrawStart !== undefined) { this.callbacks.onDrawStart = callbacks.onDrawStart; }\n\t\t\tif (callbacks.onPointDraw !== undefined) { this.callbacks.onPointDraw = callbacks.onPointDraw; }\n\t\t\tif (callbacks.onDrawEnd !== undefined) { this.callbacks.onDrawEnd = callbacks.onDrawEnd; }\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tJSM.SpriteViewer.prototype.AddPoint = function (point)\n\t{\n\t\tthis.points.push (point);\n\t};\n\n\tJSM.SpriteViewer.prototype.RemovePoints = function ()\n\t{\n\t\tthis.points = [];\n\t};\n\n\tJSM.SpriteViewer.prototype.Resize = function ()\n\t{\n\t\tthis.Draw ();\n\t};\n\n\tJSM.SpriteViewer.prototype.NearestPointUnderPosition = function (maxDistance, x, y)\n\t{\n\t\tvar position = new JSM.Coord2D (x, y);\n\t\t\n\t\tvar minIndex = -1;\n\t\tvar minDistance = JSM.Inf;\n\t\tvar i, projected, distance;\n\t\tfor (i = 0; i < this.projected.length; i++) {\n\t\t\tprojected = this.projected[i];\n\t\t\tdistance = position.DistanceTo (new JSM.Coord2D (projected.position.x, projected.position.y));\n\t\t\tif (JSM.IsLower (distance, maxDistance) && JSM.IsLower (distance, minDistance)) {\n\t\t\t\tminIndex = projected.originalIndex;\n\t\t\t\tminDistance = distance;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn minIndex;\n\t};\n\n\tJSM.SpriteViewer.prototype.NearestPointUnderMouse = function (maxDistance)\n\t{\n\t\treturn this.NearestPointUnderPosition (maxDistance, this.navigation.mouse.curr.x, this.navigation.mouse.curr.y);\n\t};\n\n\tJSM.SpriteViewer.prototype.NearestPointUnderTouch = function (maxDistance)\n\t{\n\t\treturn this.NearestPointUnderPosition (maxDistance, this.navigation.touch.curr.x, this.navigation.touch.curr.y);\n\t};\n\n\tJSM.SpriteViewer.prototype.FitInWindow = function ()\n\t{\n\t\tvar sphere = this.GetBoundingSphere ();\n\t\tthis.navigation.FitInWindow (sphere.GetCenter (), sphere.GetRadius ());\n\t\tthis.Draw ();\n\t};\n\n\tJSM.SpriteViewer.prototype.GetCenter = function ()\n\t{\n\t\tvar boundingBox = this.GetBoundingBox ();\n\t\treturn boundingBox.GetCenter ();\n\t};\n\n\tJSM.SpriteViewer.prototype.GetBoundingBox = function ()\n\t{\n\t\tvar min = new JSM.Coord (JSM.Inf, JSM.Inf, JSM.Inf);\n\t\tvar max = new JSM.Coord (-JSM.Inf, -JSM.Inf, -JSM.Inf);\n\t\t\n\t\tvar i, coord;\n\t\tfor (i = 0; i < this.points.length; i++) {\n\t\t\tcoord = this.points[i];\n\t\t\tmin.x = JSM.Minimum (min.x, coord.x);\n\t\t\tmin.y = JSM.Minimum (min.y, coord.y);\n\t\t\tmin.z = JSM.Minimum (min.z, coord.z);\n\t\t\tmax.x = JSM.Maximum (max.x, coord.x);\n\t\t\tmax.y = JSM.Maximum (max.y, coord.y);\n\t\t\tmax.z = JSM.Maximum (max.z, coord.z);\n\t\t}\n\n\t\treturn new JSM.Box (min, max);\n\t};\n\n\tJSM.SpriteViewer.prototype.GetBoundingSphere = function ()\n\t{\n\t\tvar center = this.GetCenter ();\n\t\tvar radius = 0.0;\n\n\t\tvar i, coord, distance;\n\t\tfor (i = 0; i < this.points.length; i++) {\n\t\t\tcoord = this.points[i];\n\t\t\tdistance = center.DistanceTo (coord);\n\t\t\tif (JSM.IsGreater (distance, radius)) {\n\t\t\t\tradius = distance;\n\t\t\t}\n\t\t}\n\n\t\tvar sphere = new JSM.Sphere (center, radius);\n\t\treturn sphere;\n\t};\n\n\tJSM.SpriteViewer.prototype.Draw = function ()\n\t{\n\t\tif (this.callbacks.onDrawStart !== null) {\n\t\t\tthis.callbacks.onDrawStart (this.canvas);\n\t\t}\n\n\t\tvar aspectRatio = this.canvas.width / this.canvas.height;\n\t\tvar viewPort = [0, 0, this.canvas.width, this.canvas.height];\n\t\tthis.projected = [];\n\t\t\n\t\tvar i, coord, projected;\n\t\tfor (i = 0; i < this.points.length; i++) {\n\t\t\tcoord = this.points[i];\n\t\t\tprojected = JSM.Project (coord, this.camera.eye, this.camera.center, this.camera.up, this.camera.fieldOfView * JSM.DegRad, aspectRatio, this.camera.nearClippingPlane, this.camera.farClippingPlane, viewPort);\n\t\t\tprojected.y = this.canvas.height - projected.y;\n\t\t\tif (projected !== null) {\n\t\t\t\tthis.projected.push ({position : projected, originalIndex : i});\n\t\t\t}\n\t\t}\n\n\t\tthis.projected.sort (function (a, b) {\n\t\t\tif (a.position.z > b.position.z) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.position.z < b.position.z) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t\t\n\t\tfor (i = 0; i < this.projected.length; i++) {\n\t\t\tif (this.callbacks.onPointDraw !== null) {\n\t\t\t\tthis.callbacks.onPointDraw (this.canvas, this.projected[i].originalIndex, this.projected[i].position);\n\t\t\t}\n\t\t}\n\n\t\tif (this.callbacks.onDrawEnd !== null) {\n\t\t\tthis.callbacks.onDrawEnd (this.canvas);\n\t\t}\n\t\treturn true;\n\t};\n\n\treturn JSM;\n});\n"]}