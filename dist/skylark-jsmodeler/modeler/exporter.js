/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(o){return o.ExportBodyContentToStl=function(t,e,n){function r(o){x+=o+"\n"}function i(o,t,e,n){r("\tfacet normal "+o.x+" "+o.y+" "+o.z),r("\t\touter loop"),r("\t\t\tvertex "+t.x+" "+t.y+" "+t.z),r("\t\t\tvertex "+e.x+" "+e.y+" "+e.z),r("\t\t\tvertex "+n.x+" "+n.y+" "+n.z),r("\t\tendloop"),r("\tendfacet")}function l(e){var r=t.GetPolygon(e),l=r.VertexIndexCount();if(!(l<3)){var d=null;if(3===l)i(d=o.CalculateBodyPolygonNormal(t,e),t.GetVertex(r.GetVertexIndex(0)).position,t.GetVertex(r.GetVertexIndex(1)).position,t.GetVertex(r.GetVertexIndex(2)).position);else{var x,u=!0;if(void 0!==n&&n&&(u=!1),d=o.CalculateBodyPolygonNormal(t,e),u){var a,f=new o.Polygon;for(x=0;x<l;x++)a=t.GetVertex(r.vertices[x]),f.AddVertex(a.position.x,a.position.y,a.position.z);var G,p=o.TriangulatePolygon(f,d);if(null!==p)for(x=0;x<p.length;x++)G=p[x],i(d,t.GetVertex(r.GetVertexIndex(G[0])).position,t.GetVertex(r.GetVertexIndex(G[1])).position,t.GetVertex(r.GetVertexIndex(G[2])).position)}else for(x=0;x<l-2;x++)i(d,t.GetVertex(r.GetVertexIndex(0)).position,t.GetVertex(r.GetVertexIndex((x+1)%l)).position,t.GetVertex(r.GetVertexIndex((x+2)%l)).position)}}}var d,x="";for(d=0;d<t.PolygonCount();d++)l(d);return x},o.ExportBodyToStl=function(t,e,n){function r(o){i+=o+"\n"}var i="";return r("solid "+e),i+=o.ExportBodyContentToStl(t,e,n),r("endsolid "+e),i},o.ExportModelToStl=function(t,e,n){function r(o){d+=o+"\n"}var i,l,d="";for(r("solid "+e),i=0;i<t.BodyCount();i++)l=t.GetBody(i),d+=o.ExportBodyContentToStl(l,e+(i+1).toString(),n);return r("endsolid "+e),d},o.ExportBodyContentToObj=function(t,e,n){function r(o){f+=o}function i(o){f+=o+"\n"}function l(e){var n=o.CalculateBodyPolygonNormal(t,e);i("vn "+n.x+" "+n.y+" "+n.z)}function d(o){var l,d=t.GetPolygon(o);for(r("f "),l=0;l<d.VertexIndexCount();l++)r(e+d.GetVertexIndex(l)+1+"//"+(n+o+1)+" ");i("")}var x,u,a,f="";for(x=0;x<t.VertexCount();x++)u=x,void 0,i("v "+(a=t.GetVertex(u).position).x+" "+a.y+" "+a.z);for(x=0;x<t.PolygonCount();x++)l(x);for(x=0;x<t.PolygonCount();x++)d(x);return f},o.ExportBodyToObj=function(t){return o.ExportBodyContentToObj(t,0,0)},o.ExportModelToObj=function(t){var e,n,r="",i=0,l=0;for(e=0;e<t.BodyCount();e++)n=t.GetBody(e),r+=o.ExportBodyContentToObj(n,i,l),i+=n.VertexCount(),l+=n.PolygonCount();return r},o.ExportMaterialsToGdl=function(t){function e(t,e){var n,i,l=(n=t.diffuse,(i=o.HexColorToRGBComponents(n))[0]/255+","+i[1]/255+","+i[2]/255);r+='define material "material'+e+'" 2, '+l+" ! "+e+"\n"}var n,r="",i=!1;if(void 0!==t&&null!==t&&(i=!0),i)for(e(t.GetDefaultMaterial(),1),n=0;n<t.Count();n++)e(t.GetMaterial(n),n+2);return r},o.ExportBodyGeometryToGdl=function(t,e){function n(o){if(o.length>200){var t,e,n=0;for(t=0;t<o.length;t++)e=o[t],d+=e,++n>200&&","==e&&(d+="\n",n=0)}else d+=o}function r(o){n(o+"\n")}function i(o,e){var n=o.edges[e],i=0;-1!=n.pgon1&&-1!=n.pgon2&&t.GetPolygon(n.pgon1).HasCurveGroup()&&t.GetPolygon(n.pgon2).HasCurveGroup()&&t.GetPolygon(n.pgon1).GetCurveGroup()==t.GetPolygon(n.pgon2).GetCurveGroup()&&(i=2),r("edge "+(n.vert1+1)+", "+(n.vert2+1)+", -1, -1, "+i+" ! "+(e+1))}function l(o,i,l){var d=-1;e&&(d=t.GetPolygon(i).GetMaterialIndex()+2)!=l&&r('set material "material'+d+'"');var x=o.pgons[i],u=0;t.GetPolygon(i).HasCurveGroup()&&(u=2),n("pgon "+x.pedges.length+", 0, "+u+", ");var a,f,G="";for(a=0;a<x.pedges.length;a++)(f=x.pedges[a]).reverse?G+=-(f.index+1):G+=f.index+1,a<x.pedges.length-1&&(G+=", ");return n(G),n(" ! "+(i+1)),r(""),d}var d="";r("base");var x,u,a,f=new o.AdjacencyInfo(t);for(x=0;x<f.verts.length;x++)u=x,void 0,r("vert "+(a=t.GetVertex(u).position).x+", "+a.y+", "+a.z+" ! "+(u+1));for(x=0;x<f.edges.length;x++)i(f,x);var G=-1;for(x=0;x<f.pgons.length;x++)G=l(f,x,G);return r("body -1"),d},o.ExportBodyToGdl=function(t,e){var n="",r=!1;return void 0!==e&&null!==e&&(n+=o.ExportMaterialsToGdl(e),r=!0),n+=o.ExportBodyGeometryToGdl(t,r)},o.ExportModelToGdl=function(t,e){var n,r,i="",l=!1;for(void 0!==e&&null!==e&&(i+=o.ExportMaterialsToGdl(e),l=!0),n=0;n<t.BodyCount();n++)r=t.GetBody(n),i+=o.ExportBodyGeometryToGdl(r,l);return i},o});
//# sourceMappingURL=../sourcemaps/modeler/exporter.js.map
