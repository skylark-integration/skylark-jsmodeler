/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(e){return e.ExplodeBody=function(t,n,o){function r(e,t,n,o){var r;for(r=0;r<e.Count();r++)t.push([]);var i,l=o.itemCount();for(r=0;r<l;r++)-1!==(i=o.getMaterial(r))?t[i].push(r):n.push(r)}return void 0!==o&&null!==o&&(void 0!==n&&null!==n||(n=new e.MaterialSet),function(e,t,n){function o(n,o,r){if(0!==n.length){var i,l,u,a=t.GetMaterial(o);if(void 0!==r.onPointGeometryStart&&null!==r.onPointGeometryStart&&r.onPointGeometryStart(a),void 0!==r.onPoint&&null!==r.onPoint)for(i=0;i<n.length;i++)l=e.GetPoint(n[i]),u=e.GetVertexPosition(l.GetVertexIndex()),r.onPoint(u);void 0!==r.onPointGeometryEnd&&null!==r.onPointGeometryEnd&&r.onPointGeometryEnd(a)}}if(0!==e.PointCount()){var i,l=[],u=[];for(r(t,l,u,{itemCount:function(){return e.PointCount()},getMaterial:function(t){return e.GetPoint(t).GetMaterialIndex()}}),i=0;i<l.length;i++)o(l[i],i,n);o(u,-1,n)}}(t,n,o),function(e,t,n){function o(n,o,r){if(0!==n.length){var i,l,u,a,x=t.GetMaterial(o);if(void 0!==r.onLineGeometryStart&&null!==r.onLineGeometryStart&&r.onLineGeometryStart(x),void 0!==r.onLine&&null!==r.onLine)for(i=0;i<n.length;i++)l=e.GetLine(n[i]),u=e.GetVertexPosition(l.GetBegVertexIndex()),a=e.GetVertexPosition(l.GetEndVertexIndex()),r.onLine(u,a);void 0!==r.onLineGeometryEnd&&null!==r.onLineGeometryEnd&&r.onLineGeometryEnd(x)}}if(0!==e.LineCount()){var i,l=[],u=[];for(r(t,l,u,{itemCount:function(){return e.LineCount()},getMaterial:function(t){return e.GetLine(t).GetMaterialIndex()}}),i=0;i<l.length;i++)o(l[i],i,n);o(u,-1,n)}}(t,n,o),function(t,n,o){function i(o,r,i,l){function u(n,o,r){function i(e,t,n,o,i,l,u,a,x){void 0!==r.onTriangle&&null!==r.onTriangle&&r.onTriangle(e,t,n,o,i,l,u,a,x)}var l=t.GetPolygon(n),u=l.VertexIndexCount();if(u<3)e.Message("Invalid polygon found.");else{var a,x,d,G,f,s,v,g,y,P,m=!1;if(void 0!==r.hasConvexPolygons&&null!==r.hasConvexPolygons&&(m=r.hasConvexPolygons),3==u||m)for(P=0;P<u-2;P++)a=t.GetVertexPosition(l.GetVertexIndex(0)),x=t.GetVertexPosition(l.GetVertexIndex((P+1)%u)),d=t.GetVertexPosition(l.GetVertexIndex((P+2)%u)),G=o.vertexNormals[n][0],f=o.vertexNormals[n][(P+1)%u],s=o.vertexNormals[n][(P+2)%u],v=null,g=null,y=null,null!==o.textureCoords&&(v=o.textureCoords[n][0],g=o.textureCoords[n][(P+1)%u],y=o.textureCoords[n][(P+2)%u]),i(a,x,d,G,f,s,v,g,y);else{var C,c=new e.Polygon;for(P=0;P<u;P++)C=t.GetVertexPosition(l.vertices[P]),c.AddVertex(C.x,C.y,C.z);var V,h=e.CalculateBodyPolygonNormal(t,n),M=e.TriangulatePolygon(c,h);if(null!==M)for(P=0;P<M.length;P++)V=M[P],a=t.GetVertexPosition(l.GetVertexIndex(V[0])),x=t.GetVertexPosition(l.GetVertexIndex(V[1])),d=t.GetVertexPosition(l.GetVertexIndex(V[2])),G=o.vertexNormals[n][V[0]],f=o.vertexNormals[n][V[1]],s=o.vertexNormals[n][V[2]],v=null,g=null,y=null,null!==o.textureCoords&&(v=o.textureCoords[n][V[0]],g=o.textureCoords[n][V[1]],y=o.textureCoords[n][V[2]]),i(a,x,d,G,f,s,v,g,y);else e.Message("Triangulation failed.")}}}if(0!==o.length){var a,x=n.GetMaterial(r);for(void 0!==l.onGeometryStart&&null!==l.onGeometryStart&&l.onGeometryStart(x),a=0;a<o.length;a++)u(o[a],i,l);void 0!==l.onGeometryEnd&&null!==l.onGeometryEnd&&l.onGeometryEnd(x)}}if(0!==t.PolygonCount()){var l=[],u=[];r(n,l,u,{itemCount:function(){return t.PolygonCount()},getMaterial:function(e){return t.GetPolygon(e).GetMaterialIndex()}});var a,x=function(t,n){var o,r,i=e.CalculateBodyVertexNormals(t),l=!1;if(void 0!==n&&null!==n)for(o=0;o<n.Count();o++)if(null!==n.GetMaterial(o).texture){l=!0;break}var u,a,x=null;if(l)for(x=e.CalculateBodyTextureCoords(t),o=0;o<x.length;o++)if((u=t.GetPolygon(o)).HasMaterialIndex())for(a=n.GetMaterial(u.GetMaterialIndex()),r=0;r<x[o].length;r++)x[o][r].x/=a.textureWidth,x[o][r].y/=-a.textureHeight;return{vertexNormals:i,textureCoords:x}}(t,n);for(a=0;a<l.length;a++)i(l[a],a,x,o);i(u,-1,x,o)}}(t,n,o),!0)},e});
//# sourceMappingURL=../sourcemaps/modeler/explode.js.map
