/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(e){return e.RayTriangleIntersection=function(n,r,t,o){var i=n.GetOrigin(),a=n.GetDirection(),l=e.CoordSub(t,r),s=e.CoordSub(o,r),d=e.VectorCross(a,s),u=e.VectorDot(l,d);if(e.IsZero(u))return null;if(!e.IsPositive(u))return null;var c=1/u,I=e.CoordSub(i,r),f=e.VectorDot(I,d)*c;if(e.IsLower(f,0)||e.IsGreater(f,1))return null;var v=e.VectorCross(I,l),y=e.VectorDot(a,v)*c;if(e.IsLower(y,0)||e.IsGreater(f+y,1))return null;var g=e.VectorDot(s,v)*c;if(!e.IsPositive(g))return null;if(n.IsLengthReached(g))return null;var x=a.Clone().MultiplyScalar(g);return{position:e.CoordAdd(i,x),distance:g}},e.RayBoxIntersection=function(n,r,t){var o,i=n.GetOrigin(),a=n.GetDirection(),l=e.CoordToArray(i),s=e.CoordToArray(a),d=e.CoordToArray(r),u=e.CoordToArray(t),c=[0,0,0],I=[0,0,0],f=!0;for(o=0;o<3;o++)e.IsLower(l[o],d[o])?(c[o]=-1,I[o]=d[o],f=!1):e.IsGreater(l[o],u[o])?(c[o]=1,I[o]=u[o],f=!1):c[o]=0;if(f)return{position:i,distance:0};var v=[0,0,0];for(o=0;o<3;o++)0===c[o]||e.IsZero(s[o])?v[o]=-1:v[o]=(I[o]-l[o])/s[o];var y=0;for(o=1;o<3;o++)e.IsLower(v[y],v[o])&&(y=o);if(e.IsNegative(v[y]))return null;var g=[0,0,0];for(o=0;o<3;o++)if(y!=o){if(g[o]=l[o]+v[y]*s[o],e.IsLower(g[o],d[o])||e.IsGreater(g[o],u[o]))return null}else g[o]=I[o];var x=e.CoordFromArray(g),T=i.DistanceTo(x);return n.IsLengthReached(T)?null:{position:x,distance:T}},e.RayOctreeIntersection=function(n,r,t){var o=null,i=!1,a=null!==t&&void 0!==t;return e.TraverseOctreeNodes(r,function(r){if(!a&&i)return!1;if(!e.RayBoxIntersection(n,r.box.min,r.box.max))return!1;var t;for(t=0;t<r.triangles.length;t++){var l=r.triangles[t],s=l.v0,d=l.v1,u=l.v2,c=e.RayTriangleIntersection(n,s,d,u);if(null!==c){if(i=!0,!a)return!1;(null===o||c.distance<o.distance)&&((o=c).userData=l.userData)}}return!0}),a&&null!==o&&(t.position=o.position,t.distance=o.distance,t.userData=o.userData),i},e.RayTriangleBodyIntersection=function(n,r,t){var o,i,a,l,s,d,u=null,c=!1,I=null!==t&&void 0!==t;for(o=0;o<r.TriangleCount();o++)if(i=r.GetTriangle(o),a=r.GetVertex(i.v0),l=r.GetVertex(i.v1),s=r.GetVertex(i.v2),null!==(d=e.RayTriangleIntersection(n,a,l,s))){if(c=!0,!I)break;(null===u||d.distance<u.distance)&&((u=d).triangleIndex=o)}return I&&null!==u&&(t.position=u.position,t.distance=u.distance,t.triangleIndex=u.triangleIndex),c},e.RayTriangleModelIntersection=function(n,r,t){var o,i,a,l=null,s=!1,d=null!==t&&void 0!==t;for(o=0;o<r.BodyCount();o++)if(i=r.GetBody(o),a=d?{}:null,e.RayTriangleBodyIntersection(n,i,a)){if(s=!0,!d)break;(null===l||a.distance<l.distance)&&((l=a).bodyIndex=o)}return d&&null!==l&&(t.position=l.position,t.distance=l.distance,t.triangleIndex=l.triangleIndex,t.bodyIndex=l.bodyIndex),s},e.RayTriangleModelIntersectionWithOctree=function(n,r,t){var o,i,a,l,s=null,d=!1,u=null!==t&&void 0!==t;for(o=0;o<r.BodyCount();o++)if(i=r.GetBody(o),a=!1,l=u?{}:null,i.TriangleCount()>20?(void 0===i.octree&&(i.octree=e.ConvertTriangleBodyToOctree(i)),a=e.RayOctreeIntersection(n,i.octree,l)):a=e.RayTriangleBodyIntersection(n,i,l),a){if(d=!0,!u)break;(null===s||l.distance<s.distance)&&(s=l,void 0!==l.userData&&(s.triangleIndex=l.userData.triangleIndex),s.bodyIndex=o)}return u&&null!==s&&(t.position=s.position,t.distance=s.distance,t.triangleIndex=s.triangleIndex,t.bodyIndex=s.bodyIndex),d},e});
//# sourceMappingURL=../sourcemaps/modeler/rayutils.js.map
