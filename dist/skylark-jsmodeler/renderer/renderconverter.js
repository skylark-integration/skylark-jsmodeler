/**
 * skylark-jsmodeler - A version of jsmodeler that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsmodeler/
 * @license MIT
 */
define(["../core/jsm"],function(e){return e.ConvertBodyToRenderBody=function(n,r,t){function o(n,r){var t=e.HexColorToNormalizedRGBComponents(n.ambient),o=e.HexColorToNormalizedRGBComponents(n.diffuse),a=e.HexColorToNormalizedRGBComponents(n.specular);return new e.RenderMaterial(r,{ambient:t,diffuse:o,specular:a,shininess:n.shininess,opacity:n.opacity,singleSided:n.singleSided,pointSize:n.pointSize,texture:n.texture})}var a=!1;void 0!==t&&null!==t&&void 0!==t.hasConvexPolygons&&null!==t.hasConvexPolygons&&(a=t.hasConvexPolygons);var i=new e.RenderBody,s=null,l=null,u=null,d={hasConvexPolygons:a,onPointGeometryStart:function(){s=[],l=null,u=null},onPointGeometryEnd:function(n){var r=o(n,e.RenderMaterialFlags.Point),t=new e.RenderMesh(r);t.SetVertexArray(s),i.AddMesh(t)},onPoint:function(e){s.push(e.x,e.y,e.z)},onLineGeometryStart:function(){s=[],l=null,u=null},onLineGeometryEnd:function(n){var r=o(n,e.RenderMaterialFlags.Line),t=new e.RenderMesh(r);t.SetVertexArray(s),i.AddMesh(t)},onLine:function(e,n){s.push(e.x,e.y,e.z),s.push(n.x,n.y,n.z)},onGeometryStart:function(){s=[],l=[],u=[]},onGeometryEnd:function(n){var r=e.RenderMaterialFlags.Triangle;null!==n.texture&&(r+=e.RenderMaterialFlags.Textured),n.opacity<1&&(r+=e.RenderMaterialFlags.Transparent);var t=o(n,r),a=new e.RenderMesh(t);a.SetVertexArray(s),a.SetNormalArray(l),null!==n.texture&&a.SetUVArray(u),i.AddMesh(a)},onTriangle:function(e,n,r,t,o,a,i,d,y){s.push(e.x,e.y,e.z),s.push(n.x,n.y,n.z),s.push(r.x,r.y,r.z),l.push(t.x,t.y,t.z),l.push(o.x,o.y,o.z),l.push(a.x,a.y,a.z),null!==i&&null!==d&&null!==y&&(u.push(i.x,i.y),u.push(d.x,d.y),u.push(y.x,y.y))}};return e.ExplodeBody(n,r,d),i},e.ConvertModelToRenderBodies=function(n,r){var t,o,a,i=[],s=n.GetMaterialSet();for(t=0;t<n.BodyCount();t++)o=n.GetBody(t),a=e.ConvertBodyToRenderBody(o,s,r),i.push(a);return i},e.ConvertJSONDataToRenderBodies=function(n,r){function t(n,r,t,o){var a=function(n,r){function t(n,r,t){function o(n,r,t,o,a){var i=new e.Vector2D(n,r);if(!e.IsZero(a)){var s=Math.sin(a*e.DegRad),l=Math.cos(a*e.DegRad);i.x=l*n-s*r,i.y=s*n+l*r}return i.x=t[0]+i.x*o[0],i.y=t[1]+i.y*o[1],i}function a(e,n,r,t,o){var a,i,s;for(a=0;a<3;a++)for(i=r[t+a],s=0;s<o;s++)e.push(n[i*o+s])}var i=t[r.material],s=new e.RenderMaterial(e.RenderMaterialFlags.Triangle,{ambient:i.ambient||[1,1,1],diffuse:i.diffuse||[1,1,1],specular:i.specular||[1,1,1],shininess:i.shininess||0,opacity:i.opacity||1}),l=void 0!==i.texture&&null!==i.texture;l&&(s.SetType(e.RenderMaterialFlags.Triangle+e.RenderMaterialFlags.Textured),s.texture=i.texture,s.ambient=[1,1,1],s.diffuse=[1,1,1]);var u,d=new e.RenderMesh(s),y=[],f=[],h=[];for(u=0;u<r.parameters.length;u+=9)a(y,n.vertices,r.parameters,u,3),a(f,n.normals,r.parameters,u+3,3),a(h,n.uvs,r.parameters,u+6,2);if(l){var x,p=i.offset||[0,0],c=i.scale||[1,1],v=i.rotation||0;for(u=0;u<h.length;u+=2)x=o(h[u+0],h[u+1],p,c,v),h[u+0]=x.x,h[u+1]=-x.y}return d.SetVertexArray(y),d.SetNormalArray(f),d.SetUVArray(h),d}var o,a,i=new e.RenderBody;for(o=0;o<n.triangles.length;o++)a=t(n,n.triangles[o],r),i.AddMesh(a);return i}(n[t],r);o.push(a)}var o=[],a=n.materials;if(void 0===a)return o;var i=n.meshes;if(void 0===i)return o;var s=0;return e.AsyncRunTask(function(){return t(i,a,s,o),s+=1,!0},r,i.length,0,o),o},e});
//# sourceMappingURL=../sourcemaps/renderer/renderconverter.js.map
